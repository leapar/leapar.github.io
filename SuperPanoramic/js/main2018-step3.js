var dom, webview, Clamp, codeToCh, fdage;
(function anonymous(
  /*``*/
) {
  function _$af268850(t) {
    "use strict";

    function e(e) {
      return this.each(function() {
        var i = t(this),
          s = i.data("bs.tooltip"),
          n = "object" == typeof e && e;
        (s || "destroy" != e) && (s || i.data("bs.tooltip", s = new o(this, n)), "string" == typeof e && s[e]())
      })
    }
    var o = function(t, e) {
      this.type = this.options = this.enabled = this.timeout = this.hoverState = this.$element = null, this.init("tooltip", t, e)
    };
    o.VERSION = "3.2.0", o.DEFAULTS = {
      animation: !0,
      placement: "top",
      selector: !1,
      template: "<div class=\"tooltip\" role=\"tooltip\"><div class=\"tooltip-arrow\"></div><div class=\"tooltip-inner\"></div></div>",
      trigger: "hover focus",
      title: "",
      delay: 0,
      html: !1,
      container: !1,
      viewport: {
        selector: "body",
        padding: 0
      }
    }, o.prototype.init = function(e, o, i) {
      this.enabled = !0, this.type = e, this.$element = t(o), this.options = this.getOptions(i), this.$viewport = this.options.viewport && t(this.options.viewport.selector || this.options.viewport);
      for (var s = this.options.trigger.split(" "), n = s.length; n--;) {
        var r = s[n];
        if ("click" == r) {
          this.$element.on("click." + this.type, this.options.selector, t.proxy(this.toggle, this))
        } else {
          if ("manual" != r) {
            var a = "hover" == r ? "mouseenter" : "focusin",
              l = "hover" == r ? "mouseleave" : "focusout";
            this.$element.on(a + "." + this.type, this.options.selector, t.proxy(this.enter, this)), this.$element.on(l + "." + this.type, this.options.selector, t.proxy(this.leave, this))
          }
        }
      };
      this.options.selector ? this._options = t.extend({}, this.options, {
        trigger: "manual",
        selector: ""
      }) : this.fixTitle()
    }, o.prototype.getDefaults = function() {
      return o.DEFAULTS
    }, o.prototype.getOptions = function(e) {
      return e = t.extend({}, this.getDefaults(), this.$element.data(), e), e.delay && "number" == typeof e.delay && (e.delay = {
        show: e.delay,
        hide: e.delay
      }), e
    }, o.prototype.getDelegateOptions = function() {
      var e = {},
        o = this.getDefaults();
      return this._options && t.each(this._options, function(t, i) {
        o[t] != i && (e[t] = i)
      }), e
    }, o.prototype.enter = function(e) {
      var o = e instanceof this.constructor ? e : t(e.currentTarget).data("bs." + this.type);
      return o || (o = new this.constructor(e.currentTarget, this.getDelegateOptions()), t(e.currentTarget).data("bs." + this.type, o)), clearTimeout(o.timeout), o.hoverState = "in", o.options.delay && o.options.delay.show ? void((o.timeout = setTimeout(function() {
        "in" == o.hoverState && o.show()
      }, o.options.delay.show))) : o.show()
    }, o.prototype.leave = function(e) {
      var o = e instanceof this.constructor ? e : t(e.currentTarget).data("bs." + this.type);
      return o || (o = new this.constructor(e.currentTarget, this.getDelegateOptions()), t(e.currentTarget).data("bs." + this.type, o)), clearTimeout(o.timeout), o.hoverState = "out", o.options.delay && o.options.delay.hide ? void((o.timeout = setTimeout(function() {
        "out" == o.hoverState && o.hide()
      }, o.options.delay.hide))) : o.hide()
    }, o.prototype.show = function() {
      var e = t.Event("show.bs." + this.type);
      if (this.hasContent() && this.enabled) {
        this.$element.trigger(e);
        var o = t.contains(document.documentElement, this.$element[0]);
        if (e.isDefaultPrevented() || !o) {
          return
        };
        var i = this,
          s = this.tip(),
          n = this.getUID(this.type);
        this.setContent(), s.attr("id", n), this.$element.attr("aria-describedby", n), this.options.animation && s.addClass("fade");
        var r = "function" == typeof this.options.placement ? this.options.placement.call(this, s[0], this.$element[0]) : this.options.placement,
          a = /\s?auto?\s?/i,
          l = a.test(r);
        l && (r = r.replace(a, "") || "top"), s.detach().css({
          top: 0,
          left: 0,
          display: "block"
        }).addClass(r).data("bs." + this.type, this), this.options.container ? s.appendTo(this.options.container) : s.insertAfter(this.$element);
        var p = this.getPosition(),
          h = s[0].offsetWidth,
          f = s[0].offsetHeight;
        if (l) {
          var u = r,
            d = this.$element.parent(),
            c = this.getPosition(d);
          r = "bottom" == r && p.top + p.height + f - c.scroll > c.height ? "top" : "top" == r && p.top - c.scroll - f < 0 ? "bottom" : "right" == r && p.right + h > c.width ? "left" : "left" == r && p.left - h < c.left ? "right" : r, s.removeClass(u).addClass(r)
        };
        var g = this.getCalculatedOffset(r, p, h, f);
        this.applyPlacement(g, r);
        var y = function() {
          i.$element.trigger("shown.bs." + i.type), i.hoverState = null
        };
        t.support.transition && this.$tip.hasClass("fade") ? s.one("bsTransitionEnd", y).emulateTransitionEnd(150) : y()
      }
    }, o.prototype.applyPlacement = function(e, o) {
      var i = this.tip(),
        s = i[0].offsetWidth,
        n = i[0].offsetHeight,
        r = parseInt(i.css("margin-top"), 10),
        a = parseInt(i.css("margin-left"), 10);
      isNaN(r) && (r = 0), isNaN(a) && (a = 0), e.top = e.top + r, e.left = e.left + a, t.offset.setOffset(i[0], t.extend({
        using: function(t) {
          i.css({
            top: Math.round(t.top),
            left: Math.round(t.left)
          })
        }
      }, e), 0), i.addClass("in");
      var l = i[0].offsetWidth,
        p = i[0].offsetHeight;
      "top" == o && p != n && (e.top = e.top + n - p);
      var h = this.getViewportAdjustedDelta(o, e, l, p);
      h.left ? e.left += h.left : e.top += h.top;
      var f = h.left ? 2 * h.left - s + l : 2 * h.top - n + p,
        u = h.left ? "left" : "top",
        d = h.left ? "offsetWidth" : "offsetHeight";
      i.offset(e), this.replaceArrow(f, i[0][d], u)
    }, o.prototype.replaceArrow = function(t, e, o) {
      this.arrow().css(o, t ? 50 * (1 - t / e) + "%" : "")
    }, o.prototype.setContent = function() {
      var t = this.tip(),
        e = this.getTitle();
      t.find(".tooltip-inner")[this.options.html ? "html" : "text"](e), t.removeClass("fade in top bottom left right")
    }, o.prototype.hide = function() {
      function e() {
        "in" != o.hoverState && i.detach(), o.$element.trigger("hidden.bs." + o.type)
      }
      var o = this,
        i = this.tip(),
        s = t.Event("hide.bs." + this.type);
      return this.$element.removeAttr("aria-describedby"), this.$element.trigger(s), s.isDefaultPrevented() ? void(0) : (i.removeClass("in"), t.support.transition && this.$tip.hasClass("fade") ? i.one("bsTransitionEnd", e).emulateTransitionEnd(150) : e(), this.hoverState = null, this)
    }, o.prototype.fixTitle = function() {
      var t = this.$element;
      (t.attr("title") || "string" != typeof t.attr("data-original-title")) && t.attr("data-original-title", t.attr("title") || "").attr("title", "")
    }, o.prototype.hasContent = function() {
      return this.getTitle()
    }, o.prototype.getPosition = function(e) {
      e = e || this.$element;
      var o = e[0],
        i = "BODY" == o.tagName;
      return t.extend({}, "function" == typeof o.getBoundingClientRect ? o.getBoundingClientRect() : null, {
        scroll: i ? document.documentElement.scrollTop || document.body.scrollTop : e.scrollTop(),
        width: i ? t(window).width() : e.outerWidth(),
        height: i ? t(window).height() : e.outerHeight()
      }, i ? {
        top: 0,
        left: 0
      } : e.offset())
    }, o.prototype.getCalculatedOffset = function(t, e, o, i) {
      return "bottom" == t ? {
        top: e.top + e.height,
        left: e.left + e.width / 2 - o / 2
      } : "top" == t ? {
        top: e.top - i,
        left: e.left + e.width / 2 - o / 2
      } : "left" == t ? {
        top: e.top + e.height / 2 - i / 2,
        left: e.left - o
      } : {
        top: e.top + e.height / 2 - i / 2,
        left: e.left + e.width
      }
    }, o.prototype.getViewportAdjustedDelta = function(t, e, o, i) {
      var s = {
        top: 0,
        left: 0
      };
      if (!this.$viewport) {
        return s
      };
      var n = this.options.viewport && this.options.viewport.padding || 0,
        r = this.getPosition(this.$viewport);
      if (/right|left/.test(t)) {
        var a = e.top - n - r.scroll,
          l = e.top + n - r.scroll + i;
        a < r.top ? s.top = r.top - a : l > r.top + r.height && (s.top = r.top + r.height - l)
      } else {
        var p = e.left - n,
          h = e.left + n + o;
        p < r.left ? s.left = r.left - p : h > r.width && (s.left = r.left + r.width - h)
      };
      return s
    }, o.prototype.getTitle = function() {
      var t, e = this.$element,
        o = this.options;
      return t = e.attr("data-original-title") || ("function" == typeof o.title ? o.title.call(e[0]) : o.title)
    }, o.prototype.getUID = function(t) {
      do {
        t += ~~(1e6 * Math.random())
      } while (document.getElementById(t));;
      return t
    }, o.prototype.tip = function() {
      return this.$tip = this.$tip || t(this.options.template)
    }, o.prototype.arrow = function() {
      return this.$arrow = this.$arrow || this.tip().find(".tooltip-arrow")
    }, o.prototype.validate = function() {
      this.$element[0].parentNode || (this.hide(), this.$element = null, this.options = null)
    }, o.prototype.enable = function() {
      this.enabled = !0
    }, o.prototype.disable = function() {
      this.enabled = !1
    }, o.prototype.toggleEnabled = function() {
      this.enabled = !this.enabled
    }, o.prototype.toggle = function(e) {
      var o = this;
      e && (o = t(e.currentTarget).data("bs." + this.type), o || (o = new this.constructor(e.currentTarget, this.getDelegateOptions()), t(e.currentTarget).data("bs." + this.type, o))), o.tip().hasClass("in") ? o.leave(o) : o.enter(o)
    }, o.prototype.destroy = function() {
      clearTimeout(this.timeout), this.hide().$element.off("." + this.type).removeData("bs." + this.type)
    };
    var i = t.fn.tooltip;
    t.fn.tooltip = e, t.fn.tooltip.Constructor = o, t.fn.tooltip.noConflict = function() {
      return t.fn.tooltip = i, this
    }
  }

  function _$af268888() {
    "use strict";

    function Keen() {
      return _init.apply(this, arguments)
    }

    function _init(e) {
      if (_isUndefined(e)) {
        throw new Error("332")
      };
      if (_isUndefined(e.projectId) || "String" !== _type(e.projectId) || e.projectId.length < 1) {
        throw new Error("334")
      }
    }

    function _extend(e) {
      for (var t = 1; t < arguments.length; t++) {
        for (var n in arguments[t]) {
          e[n] = arguments[t][n]
        }
      };
      return e
    }

    function _isUndefined(e) {
      return void(0) === e
    }

    function _type(e) {
      var t = e && e.constructor ? e.constructor.toString() : void(0);
      return t ? t.match(/function (.*)\(/)[1] : "Null"
    }

    function _each(e, t, n) {
      var r;
      if (!e) {
        return 0
      };
      if (n = n ? n : e, "array" === _type(e)) {
        for (r = 0; r < e.length; r++) {
          if (t.call(n, e[r], r, e) === !1) {
            return 0
          }
        }
      } else {
        for (r in e) {
          if (e.hasOwnProperty(r) && t.call(n, e[r], r, e) === !1) {
            return 0
          }
        }
      };
      return 1
    }

    function _parse_params(e) {
      for (var t, n = {}, r = /\+/g, i = /([^&=]+)=?([^&]*)/g, o = function(e) {
          return decodeURIComponent(e.replace(r, " "))
        }, a = e.split("?")[1]; t = i.exec(a);) {
        n[o(t[1])] = o(t[2])
      };
      return n
    }

    function _set_protocol(e) {
      switch (e) {
        case "http":
          return "http";
        case "auto":
          return location.protocol.replace(/:/g, "");
        case "https":
          ;
        case void(0):
          ;
        default:
          return "https"
      }
    }

    function _set_request_type(e) {
      var t = e || "jsonp",
        n = !1;
      return ("Object" === _type(XMLHttpRequest) || "Function" === _type(XMLHttpRequest)) && "withCredentials" in new XMLHttpRequest && (n = !0), null == t || "xhr" == t ? n ? "xhr" : "jsonp" : t
    }

    function _build_url(e) {
      return this.client.endpoint + "/projects/" + this.client.projectId + e
    }

    function _uploadEvent(e, t, n, r, i) {
      var o = _build_url.apply(this, ["/events/" + e]),
        a = {};
      n = n === !1 ? !1 : !0, this.client.globalProperties && (a = this.client.globalProperties(e));
      for (var c in t) {
        t.hasOwnProperty(c) && (a[c] = t[c])
      };
      switch (this.client.requestType) {
        case "xhr":
          _request.xhr.apply(this, ["POST", o, null, a, this.client.writeKey, n, r, i]);
          break;
        case "jsonp":
          var s = JSON.stringify(a),
            l = Keen.Base64.encode(s);
          o = o + "?api_key=" + this.client.writeKey, o = o + "&data=" + l, o = o + "&modified=" + (new Date).getTime(), _request.jsonp.apply(this, [o, this.client.writeKey, r, i]);
          break;
        case "beacon":
          var s = JSON.stringify(a),
            l = Keen.Base64.encode(s);
          o = o + "?api_key=" + encodeURIComponent(this.client.writeKey), o = o + "&data=" + encodeURIComponent(l), o = o + "&modified=" + encodeURIComponent((new Date).getTime()), o += "&c=clv1", _request.beacon.apply(this, [o, null, r, i])
      }
    }
    Keen.prototype.configure = function(e) {
      return e.host = _isUndefined(e.host) ? "api.keen.io/3.0" : e.host.replace(/.*?:\/\//g, ""), e.protocol = _set_protocol(e.protocol), e.requestType = _set_request_type(e.requestType), this.client = {
        projectId: e.projectId,
        writeKey: e.writeKey,
        readKey: e.readKey,
        globalProperties: null,
        endpoint: e.protocol + "://" + e.host,
        requestType: e.requestType
      }, Keen.trigger("client", this, e), this.trigger("ready"), this
    };
    var _request = {
        xhr: function(e, t, n, r, i, o, a, c) {
          if (!i) {
            return Keen.log("443" + this.client.projectId)
          };
          var s = new XMLHttpRequest;
          if (s.onreadystatechange = function() {
              if (4 == s.readyState) {
                if (s.status >= 200 && s.status < 300) {
                  var e;
                  try {
                    e = JSON.parse(s.responseText)
                  } catch (t) {
                    Keen.log("Could not JSON parse HTTP response: " + s.responseText), c && c(s, t)
                  };
                  a && e && a(e)
                } else {
                  Keen.log("HTTP request failed."), c && c(s, null)
                }
              }
            }, s.open(e, t, o), i && s.setRequestHeader("Authorization", i), r && s.setRequestHeader("Content-Type", "application/json"), n) {
            for (var l in n) {
              n.hasOwnProperty(l) && s.setRequestHeader(l, n[l])
            }
          };
          var u = r ? JSON.stringify(r) : null;
          s.send(u)
        },
        jsonp: function(e, t, n, r) {
          if (!t) {
            return Keen.log("472" + this.client.projectId)
          };
          if (t && e.indexOf("api_key") < 0) {
            var i = e.indexOf("?") > 0 ? "&" : "?";
            e = e + i + "api_key=" + t
          };
          for (var o = "keenJSONPCallback" + (new Date).getTime(); o in window;) {
            o += "a"
          };
          var a = !1;
          window[o] = function(e) {
            a = !0, n && e && n(e), window[o] = void(0)
          }, e = e + "&jsonp=" + o;
          var c = document.createElement("script");
          c.id = "keen-jsonp", c.src = e, document.getElementsByTagName("head")[0].appendChild(c), c.onreadystatechange = function() {
            a === !1 && "loaded" === this.readyState && (a = !0, r && r())
          }, c.onerror = function() {
            a === !1 && (a = !0, r && r())
          }
        },
        beacon: function(e, t, n, r) {
          if (t && e.indexOf("api_key") < 0) {
            var i = e.indexOf("?") > 0 ? "&" : "?";
            e = e + i + "api_key=" + t
          };
          var o = !1,
            a = document.createElement("img");
          a.onload = function() {
            if (o = !0, "naturalHeight" in this) {
              if (this.naturalHeight + this.naturalWidth === 0) {
                return void(this.onerror())
              }
            } else {
              if (this.width + this.height === 0) {
                return void(this.onerror())
              }
            };
            n && n({
              created: !0
            })
          }, a.onerror = function() {
            o = !0, r && r()
          }, a.src = e
        }
      },
      Events = Keen.Events = {
        on: function(e, t) {
          this.listeners || (this.listeners = {});
          var n = this.listeners[e] || (this.listeners[e] = []);
          return n.push({
            callback: t
          }), this
        },
        off: function(e, t) {
          if (!e && !t) {
            return this.listeners = void(0), delete this.listeners, this
          };
          for (var n = this.listeners[e] || [], r = n.length; r--;) {
            t && t == n[r].callback && this.listeners[e].splice(r, 1), t && 0 != n.length || (this.listeners[e] = void(0), delete this.listeners[e])
          };
          return this
        },
        trigger: function(e) {
          if (!this.listeners) {
            return this
          };
          for (var t = Array.prototype.slice.call(arguments, 1), n = this.listeners[e] || [], r = 0; r < n.length; r++) {
            n[r].callback.apply(this, t)
          };
          return this
        }
      };
    _extend(Keen.prototype, Events), _extend(Keen, Events), Keen.loaded = !0, Keen.utils = {
      each: _each,
      extend: _extend,
      parseParams: _parse_params
    }, Keen.ready = function(e) {
      Keen.loaded ? e() : Keen.on("ready", e)
    }, Keen.log = function(e) {
      "object" == typeof console && console.log("[Keen IO]", e)
    };
    var Plugins = Keen.Plugins = {};
    Keen.prototype.addEvent = function() {
        _uploadEvent.apply(this, arguments)
      }, Keen.prototype.addEventSync = function(e, t, n, r) {
        _uploadEvent.apply(this, [e, t, !1, n, r])
      }, Keen.prototype.trackExternalLink = function(e, t, n, r, i) {
        var o = e,
          a = o.metaKey,
          c = o.target,
          s = !1,
          l = function() {};
        return void(0) === r && (r = 500), "A" === c.nodeName ? l = function() {
          a || s || (s = !0, window.location = c.href)
        } : "FORM" === c.nodeName && (l = function() {
          s || (s = !0, c.submit())
        }), i && (l = function() {
          s || (s = !0, i())
        }), _uploadEvent.call(this, t, n, l, l), setTimeout(function() {
          l()
        }, r), a ? void(0) : !1
      }, Keen.prototype.setGlobalProperties = function(e) {
        if (!this.client) {
          return Keen.log("612")
        };
        if (!e || "function" != typeof e) {
          throw new Error("Invalid value for global properties: " + e)
        };
        this.client.globalProperties = e
      }, Keen.Base64 = {
        map: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
        encode: function(e) {
          var t, n, r, i, o, a, c, s = "",
            l = 0,
            u = this.map;
          for (e = this.utf8.encode(e); l < e.length;) {
            t = e.charCodeAt(l++), n = e.charCodeAt(l++), r = e.charCodeAt(l++), i = t >> 2, o = (3 & t) << 4 | n >> 4, a = isNaN(n) ? 64 : (15 & n) << 2 | r >> 6, c = isNaN(n) || isNaN(r) ? 64 : 63 & r, s = s + u.charAt(i) + u.charAt(o) + u.charAt(a) + u.charAt(c)
          };
          return s
        },
        decode: function(e) {
          var t, n, r, i, o, a, c, s = "",
            l = 0,
            u = this.map,
            f = String.fromCharCode;
          for (e = e.replace(/[^A-Za-z0-9\+\/\=]/g, ""); l < e.length;) {
            t = u.indexOf(e.charAt(l++)), n = u.indexOf(e.charAt(l++)), r = u.indexOf(e.charAt(l++)), i = u.indexOf(e.charAt(l++)), o = t << 2 | n >> 4, a = (15 & n) << 4 | r >> 2, c = (3 & r) << 6 | i, s = s + (f(o) + (64 != r ? f(a) : "")) + (64 != i ? f(c) : "")
          };
          return this.utf8.decode(s)
        },
        utf8: {
          encode: function(e) {
            for (var t, n = "", r = 0, i = String.fromCharCode; r < e.length;) {
              t = e.charCodeAt(r++), n += 128 > t ? i(t) : t > 127 && 2048 > t ? i(t >> 6 | 192) + i(63 & t | 128) : i(t >> 12 | 224) + i(t >> 6 & 63 | 128) + i(63 & t | 128)
            };
            return n
          },
          decode: function(e) {
            for (var t, n, r = "", i = 0, o = String.fromCharCode; i < e.length;) {
              n = e.charCodeAt(i), r += 128 > n ? [o(n), i++][0] : n > 191 && 224 > n ? [o((31 & n) << 6 | 63 & (t = e.charCodeAt(i + 1))), i += 2][0] : [o((15 & n) << 12 | (63 & (t = e.charCodeAt(i + 1))) << 6 | 63 & (c3 = e.charCodeAt(i + 2))), i += 3][0]
            };
            return r
          }
        }
      }, "object" != typeof JSON && (JSON = {}),
      function() {
        function f(e) {
          return 10 > e ? "0" + e : e
        }

        function quote(e) {
          return escapable.lastIndex = 0, escapable.test(e) ? "\"" + e.replace(escapable, function(e) {
            var t = meta[e];
            return "string" == typeof t ? t : "\\u" + ("0000" + e.charCodeAt(0).toString(16)).slice(-4)
          }) + "\"" : "\"" + e + "\""
        }

        function str(e, t) {
          var n, r, i, o, a, c = gap,
            s = t[e];
          switch (s && "object" == typeof s && "function" == typeof s.toJSON && (s = s.toJSON(e)), "function" == typeof rep && (s = rep.call(t, e, s)), typeof s) {
            case "string":
              return quote(s);
            case "number":
              return isFinite(s) ? String(s) : "null";
            case "boolean":
              ;
            case "null":
              return String(s);
            case "object":
              if (!s) {
                return "null"
              };
              if (gap += indent, a = [], "[object Array]" === Object.prototype.toString.apply(s)) {
                for (o = s.length, n = 0; o > n; n += 1) {
                  a[n] = str(n, s) || "null"
                };
                return i = 0 === a.length ? "[]" : gap ? "[\x0A" + gap + a.join(",\x0A" + gap) + "\x0A" + c + "]" : "[" + a.join(",") + "]", gap = c, i
              };
              if (rep && "object" == typeof rep) {
                for (o = rep.length, n = 0; o > n; n += 1) {
                  "string" == typeof rep[n] && (r = rep[n], i = str(r, s), i && a.push(quote(r) + (gap ? ": " : ":") + i))
                }
              } else {
                for (r in s) {
                  Object.prototype.hasOwnProperty.call(s, r) && (i = str(r, s), i && a.push(quote(r) + (gap ? ": " : ":") + i))
                }
              };
              return i = 0 === a.length ? "{}" : gap ? "{\x0A" + gap + a.join(",\x0A" + gap) + "\x0A" + c + "}" : "{" + a.join(",") + "}", gap = c, i
          }
        }
        "function" != typeof Date.prototype.toJSON && (Date.prototype.toJSON = function() {
          return isFinite(this.valueOf()) ? this.getUTCFullYear() + "-" + f(this.getUTCMonth() + 1) + "-" + f(this.getUTCDate()) + "T" + f(this.getUTCHours()) + ":" + f(this.getUTCMinutes()) + ":" + f(this.getUTCSeconds()) + "Z" : null
        }, String.prototype.toJSON = Number.prototype.toJSON = Boolean.prototype.toJSON = function() {
          return this.valueOf()
        });
        var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
          escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
          gap, indent, meta = {
            "\x08": "\\b",
            "\x09": "\\t",
            "\x0A": "\\n",
            "\x0C": "\\f",
            "\x0D": "\\r",
            "\"": "\\\"",
            "\\": "\\\\"
          },
          rep;
        "function" != typeof JSON.stringify && (JSON.stringify = function(e, t, n) {
          var r;
          if (gap = "", indent = "", "number" == typeof n) {
            for (r = 0; n > r; r += 1) {
              indent += " "
            }
          } else {
            "string" == typeof n && (indent = n)
          };
          if (rep = t, t && "function" != typeof t && ("object" != typeof t || "number" != typeof t.length)) {
            throw new Error("JSON.stringify")
          };
          return str("", {
            "": e
          })
        }), "function" != typeof JSON.parse && (JSON.parse = function(text, reviver) {
          function walk(e, t) {
            var n, r, i = e[t];
            if (i && "object" == typeof i) {
              for (n in i) {
                Object.prototype.hasOwnProperty.call(i, n) && (r = walk(i, n), void(0) !== r ? i[n] = r : delete i[n])
              }
            };
            return reviver.call(e, t, i)
          }
          var j;
          if (text = String(text), cx.lastIndex = 0, cx.test(text) && (text = text.replace(cx, function(e) {
              return "\\u" + ("0000" + e.charCodeAt(0).toString(16)).slice(-4)
            })), /^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, "@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g, ""))) {
            return j = eval("(" + text + ")"), "function" == typeof reviver ? walk({
              "": j
            }, "") : j
          };
          throw new SyntaxError("JSON.parse")
        })
      }(), ! function(e, t, n) {
        "undefined" != typeof module && module.exports ? module.exports = n() : "function" == typeof define && define.amd ? define(n) : t[e] = n()
      }("domready", Keen.utils, function(e) {
        function t(e) {
          for (d = 1; e = r.shift();) {
            e()
          }
        }
        var n, r = [],
          i = !1,
          o = document,
          a = o.documentElement,
          c = a.doScroll,
          s = "DOMContentLoaded",
          l = "addEventListener",
          u = "onreadystatechange",
          f = "readyState",
          p = c ? /^loaded|^c/ : /^loaded|c/,
          d = p.test(o[f]);
        return o[l] && o[l](s, n = function() {
          o.removeEventListener(s, n, i), t()
        }, i), c && o.attachEvent(u, n = function() {
          /^c/.test(o[f]) && (o.detachEvent(u, n), t())
        }), e = c ? function(t) {
          self != top ? d ? t() : r.push(t) : function() {
            try {
              a.doScroll("left")
            } catch (n) {
              return setTimeout(function() {
                e(t)
              }, 50)
            };
            t()
          }()
        } : function(e) {
          d ? e() : r.push(e)
        }
      });
    var loaded = window.Keen,
      cached = window._Keen || {},
      clients, ready;
    if (loaded && cached) {
      clients = cached.clients || {}, ready = cached.ready || [];
      for (var instance in clients) {
        if (clients.hasOwnProperty(instance)) {
          var client = clients[instance];
          for (var method in Keen.prototype) {
            Keen.prototype.hasOwnProperty(method) && (loaded.prototype[method] = Keen.prototype[method])
          };
          if (loaded.Query = Keen.Query ? Keen.Query : function() {}, loaded.Visualization = Keen.Visualization ? Keen.Visualization : function() {}, client._config && (client.configure.call(client, client._config), delete client._config), client._setGlobalProperties) {
            for (var globals = client._setGlobalProperties, i = 0; i < globals.length; i++) {
              client.setGlobalProperties.apply(client, globals[i])
            };
            delete client._setGlobalProperties
          };
          if (client._addEvent) {
            for (var queue = client._addEvent || [], i = 0; i < queue.length; i++) {
              client.addEvent.apply(client, queue[i])
            };
            delete client._addEvent
          };
          var callback = client._on || [];
          if (client._on) {
            for (var i = 0; i < callback.length; i++) {
              client.on.apply(client, callback[i])
            };
            client.trigger("ready"), delete client._on
          }
        }
      };
      for (var i = 0; i < ready.length; i++) {
        var callback = ready[i];
        Keen.on("ready", function() {
          callback()
        })
      }
    };
    return Keen.loaded && setTimeout(function() {
      Keen.utils.domready(function() {
        Keen.trigger("ready")
      })
    }, 0), Keen
  }

  function _$af268887(e, t, n) {
    "undefined" != typeof module && module.exports ? module.exports = n() : "function" == typeof define && define.amd ? define(n) : t[e] = n()
  }

  function _$af268954(e, t) {
    if (!t.__SV) {
      var n, p, i, r;
      window.mixpanel = t, t._i = [], t.init = function(e, n, p) {
        function a(e, t) {
          var n = t.split(".");
          2 == n.length && (e = e[n[0]], t = n[1]), e[t] = function() {
            e.push([t].concat(Array.prototype.slice.call(arguments, 0)))
          }
        }
        var o = t;
        for ("undefined" != typeof p ? o = t[p] = [] : p = "mixpanel", o.people = o.people || [], o.toString = function(e) {
            var t = "mixpanel";
            return "mixpanel" !== p && (t += "." + p), e || (t += " (stub)"), t
          }, o.people.toString = function() {
            return o.toString(1) + ".people (stub)"
          }, i = "disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" "), r = 0; r < i.length; r++) {
          a(o, i[r])
        };
        t._i.push([e, n, p])
      }, t.__SV = 1.2
    }
  }

  function _$af268960(i, e) {
    "use strict";
    var s = "",
      r = "?",
      o = "function",
      a = "undefined",
      n = "object",
      t = "major",
      d = "model",
      w = "name",
      l = "type",
      p = "vendor",
      m = "version",
      c = "architecture",
      u = "console",
      g = "mobile",
      f = "tablet",
      h = "smarttv",
      b = {
        has: function(i, e) {
          return -1 !== e.toLowerCase().indexOf(i.toLowerCase())
        },
        lowerize: function(i) {
          return i.toLowerCase()
        }
      },
      y = {
        rgx: function() {
          for (var i, s, r, t, d, w, l, p = 0, m = arguments; p < m.length; p += 2) {
            var c = m[p],
              u = m[p + 1];
            if (typeof i === a) {
              i = {};
              for (t in u) {
                d = u[t], typeof d === n ? i[d[0]] = e : i[d] = e
              }
            };
            for (s = r = 0; s < c.length; s++) {
              if (w = c[s].exec(this.getUA())) {
                for (t = 0; t < u.length; t++) {
                  l = w[++r], d = u[t], typeof d === n && d.length > 0 ? 2 == d.length ? i[d[0]] = typeof d[1] == o ? d[1].call(this, l) : d[1] : 3 == d.length ? i[d[0]] = typeof d[1] !== o || d[1].exec && d[1].test ? l ? l.replace(d[1], d[2]) : e : l ? d[1].call(this, l, d[2]) : e : 4 == d.length && (i[d[0]] = l ? d[3].call(this, l.replace(d[1], d[2])) : e) : i[d] = l ? l : e
                };
                break
              }
            };
            if (w) {
              break
            }
          };
          return i
        },
        str: function(i, s) {
          for (var o in s) {
            if (typeof s[o] === n && s[o].length > 0) {
              for (var a = 0; a < s[o].length; a++) {
                if (b.has(s[o][a], i)) {
                  return o === r ? e : o
                }
              }
            } else {
              if (b.has(s[o], i)) {
                return o === r ? e : o
              }
            }
          };
          return i
        }
      },
      v = {
        browser: {
          oldsafari: {
            major: {
              1: ["/8", "/1", "/3"],
              2: "/4",
              "?": "/"
            },
            version: {
              "1.0": "/8",
              1.2: "/1",
              1.3: "/3",
              "2.0": "/412",
              "2.0.2": "/416",
              "2.0.3": "/417",
              "2.0.4": "/419",
              "?": "/"
            }
          }
        },
        device: {
          sprint: {
            model: {
              "Evo Shift 4G": "7373KT"
            },
            vendor: {
              HTC: "APA",
              Sprint: "Sprint"
            }
          }
        },
        os: {
          windows: {
            version: {
              ME: "4.90",
              "NT 3.11": "NT3.51",
              "NT 4.0": "NT4.0",
              2e3: "NT 5.0",
              XP: ["NT 5.1", "NT 5.2"],
              Vista: "NT 6.0",
              7: "NT 6.1",
              8: "NT 6.2",
              8.1: "NT 6.3",
              RT: "ARM"
            }
          }
        }
      },
      k = {
        browser: [
          [/(opera\smini)\/((\d+)?[\w\.-]+)/i, /(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i, /(opera).+version\/((\d+)?[\w\.]+)/i, /(opera)[\/\s]+((\d+)?[\w\.]+)/i],
          [w, m, t],
          [/\s(opr)\/((\d+)?[\w\.]+)/i],
          [
            [w, "Opera"], m, t
          ],
          [/(kindle)\/((\d+)?[\w\.]+)/i, /(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i, /(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i, /(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i, /(rekonq)((?:\/)[\w\.]+)*/i, /(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],
          [w, m, t],
          [/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],
          [
            [w, "IE"], m, t
          ],
          [/(yabrowser)\/((\d+)?[\w\.]+)/i],
          [
            [w, "Yandex"], m, t
          ],
          [/(comodo_dragon)\/((\d+)?[\w\.]+)/i],
          [
            [w, /_/g, " "], m, t
          ],
          [/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],
          [w, m, t],
          [/(dolfin)\/((\d+)?[\w\.]+)/i],
          [
            [w, "Dolphin"], m, t
          ],
          [/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],
          [
            [w, "Chrome"], m, t
          ],
          [/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],
          [m, t, [w, "Mobile Safari"]],
          [/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],
          [m, t, w],
          [/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],
          [w, [t, y.str, v.browser.oldsafari.major],
            [m, y.str, v.browser.oldsafari.version]
          ],
          [/(konqueror)\/((\d+)?[\w\.]+)/i, /(webkit|khtml)\/((\d+)?[\w\.]+)/i],
          [w, m, t],
          [/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],
          [
            [w, "Netscape"], m, t
          ],
          [/(swiftfox)/i, /(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i, /(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i, /(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i, /(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i, /(links)\s\(((\d+)?[\w\.]+)/i, /(gobrowser)\/?((\d+)?[\w\.]+)*/i, /(ice\s?browser)\/v?((\d+)?[\w\._]+)/i, /(mosaic)[\/\s]((\d+)?[\w\.]+)/i],
          [w, m, t],
          [/(apple(?:coremedia|))\/((\d+)[\w\._]+)/i, /(coremedia) v((\d+)[\w\._]+)/i],
          [w, m, t],
          [/(aqualung|lyssna|bsplayer)\/([\w\.-]+)/i],
          [w, m],
          [/(ares|ossproxy)\s((\d+)[\w\.-]+)/i],
          [w, m, t],
          [/(audacious|audimusicstream|amarok|bass|core|dalvik|gnomemplayer|music on console|nsplayer|psp-internetradioplayer|videos)\/((\d+)[\w\.-]+)/i, /(clementine|music player daemon)\s((\d+)[\w\.-]+)/i, /(lg player|nexplayer)\s((\d+)[\d\.]+)/i, /player\/(nexplayer|lg player)\s((\d+)[\w\.-]+)/i],
          [w, m, t],
          [/(nexplayer)\s((\d+)[\w\.-]+)/i],
          [w, m, t],
          [/(flrp)\/((\d+)[\w\.-]+)/i],
          [
            [w, "Flip Player"], m, t
          ],
          [/(fstream|nativehost|queryseekspider|ia-archiver|facebookexternalhit)/i],
          [w],
          [/(gstreamer) souphttpsrc (?:\([^\)]+\)){0,1} libsoup\/((\d+)[\w\.-]+)/i],
          [w, m, t],
          [/(htc streaming player)\s[\w_]+\s\/\s((\d+)[\d\.]+)/i, /(java|python-urllib|python-requests|wget|libcurl)\/((\d+)[\w\.-_]+)/i, /(lavf)((\d+)[\d\.]+)/i],
          [w, m, t],
          [/(htc_one_s)\/((\d+)[\d\.]+)/i],
          [
            [w, /_/g, " "], m, t
          ],
          [/(mplayer)(?:\s|\/)(?:(?:sherpya-){0,1}svn)(?:-|\s)(r\d+(?:-\d+[\w\.-]+){0,1})/i],
          [w, m],
          [/(mplayer)(?:\s|\/)((\d+)[\w\.-]+)/i, /(mplayer) unknown-((\d+)[\w\.\-]+)/i],
          [w, m, t],
          [/(mplayer)/i, /(yourmuze)/i, /(media player classic|nero showtime)/i],
          [w],
          [/(nero (?:home|scout))\/((\d+)[\w\.-]+)/i],
          [w, m, t],
          [/(nokia\d+)\/((\d+)[\w\.-]+)/i],
          [w, m, t],
          [/\s(songbird)\/((\d+)[\w\.-]+)/i],
          [w, m, t],
          [/(winamp)3 version ((\d+)[\w\.-]+)/i, /(winamp)\s((\d+)[\w\.-]+)/i, /(winamp)mpeg\/((\d+)[\w\.-]+)/i],
          [w, m, t],
          [/(ocms-bot|tapinradio|tunein radio|unknown|winamp|inlight radio)/i],
          [w],
          [/(quicktime|rma|radioapp|radioclientapplication|soundtap|totem|stagefright|streamium)\/((\d+)[\w\.-]+)/i],
          [w, m, t],
          [/(smp)((\d+)[\d\.]+)/i],
          [w, m, t],
          [/(vlc) media player - version ((\d+)[\w\.]+)/i, /(vlc)\/((\d+)[\w\.-]+)/i, /(xbmc|gvfs|xine|xmms|irapp)\/((\d+)[\w\.-]+)/i, /(foobar2000)\/((\d+)[\d\.]+)/i, /(itunes)\/((\d+)[\d\.]+)/i],
          [w, m, t],
          [/(wmplayer)\/((\d+)[\w\.-]+)/i, /(windows-media-player)\/((\d+)[\w\.-]+)/i],
          [
            [w, /-/g, " "], m, t
          ],
          [/windows\/((\d+)[\w\.-]+) upnp\/[\d\.]+ dlnadoc\/[\d\.]+ (home media server)/i],
          [m, t, [w, "Windows"]],
          [/(com\.riseupradioalarm)\/((\d+)[\d\.]*)/i],
          [w, m, t],
          [/(rad.io)\s((\d+)[\d\.]+)/i, /(radio.(?:de|at|fr))\s((\d+)[\d\.]+)/i],
          [
            [w, "rad.io"], m, t
          ]
        ],
        cpu: [
          [/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],
          [
            [c, "amd64"]
          ],
          [/(ia32(?=;))/i],
          [
            [c, b.lowerize]
          ],
          [/((?:i[346]|x)86)[;\)]/i],
          [
            [c, "ia32"]
          ],
          [/windows\s(ce|mobile);\sppc;/i],
          [
            [c, "arm"]
          ],
          [/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],
          [
            [c, /ower/, "", b.lowerize]
          ],
          [/(sun4\w)[;\)]/i],
          [
            [c, "sparc"]
          ],
          [/(ia64(?=;)|68k(?=\))|arm(?=v\d+;)|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],
          [c, b.lowerize]
        ],
        device: [
          [/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],
          [d, p, [l, f]],
          [/applecoremedia\/[\w\.]+ \((ipad)/],
          [d, [p, "Apple"],
            [l, f]
          ],
          [/(apple\s{0,1}tv)/i],
          [
            [d, "Apple TV"],
            [p, "Apple"]
          ],
          [/(hp).+(touchpad)/i, /(kindle)\/([\w\.]+)/i, /\s(nook)[\w\s]+build\/(\w+)/i, /(dell)\s(strea[kpr\s\d]*[\dko])/i],
          [p, d, [l, f]],
          [/\((ip[honed|\s\w*]+);.+(apple)/i],
          [d, p, [l, g]],
          [/\((ip[honed|\s\w*]+);/i],
          [d, [p, "Apple"],
            [l, g]
          ],
          [/(blackberry)[\s-]?(\w+)/i, /(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola)[\s_-]?([\w-]+)*/i, /(hp)\s([\w\s]+\w)/i, /(asus)-?(\w+)/i],
          [p, d, [l, g]],
          [/\((bb10);\s(\w+)/i],
          [
            [p, "BlackBerry"], d, [l, g]
          ],
          [/android.+((transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+))/i],
          [
            [p, "Asus"], d, [l, f]
          ],
          [/(sony)\s(tablet\s[ps])/i],
          [p, d, [l, f]],
          [/(nintendo)\s([wids3u]+)/i],
          [p, d, [l, u]],
          [/((playstation)\s[3portablevi]+)/i],
          [
            [p, "Sony"], d, [l, u]
          ],
          [/(sprint\s(\w+))/i],
          [
            [p, y.str, v.device.sprint.vendor],
            [d, y.str, v.device.sprint.model],
            [l, g]
          ],
          [/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i, /(zte)-(\w+)*/i, /(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],
          [p, [d, /_/g, " "],
            [l, g]
          ],
          [/\s((milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?))[\w\s]+build\//i, /(mot)[\s-]?(\w+)*/i],
          [
            [p, "Motorola"], d, [l, g]
          ],
          [/android.+\s((mz60\d|xoom[\s2]{0,2}))\sbuild\//i],
          [
            [p, "Motorola"], d, [l, f]
          ],
          [/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9))/i],
          [
            [p, "Samsung"], d, [l, f]
          ],
          [/((s[cgp]h-\w+|gt-\w+|galaxy\snexus))/i, /(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i, /sec-((sgh\w+))/i],
          [
            [p, "Samsung"], d, [l, g]
          ],
          [/(sie)-(\w+)*/i],
          [
            [p, "Siemens"], d, [l, g]
          ],
          [/(maemo|nokia).*(n900|lumia\s\d+)/i, /(nokia)[\s_-]?([\w-]+)*/i],
          [
            [p, "Nokia"], d, [l, g]
          ],
          [/android\s3\.[\s\w-;]{10}((a\d{3}))/i],
          [
            [p, "Acer"], d, [l, f]
          ],
          [/android\s3\.[\s\w-;]{10}(lg?)-([06cv9]{3,4})/i],
          [
            [p, "LG"], d, [l, f]
          ],
          [/((nexus\s[45]))/i, /(lg)[e;\s-\/]+(\w+)*/i],
          [
            [p, "LG"], d, [l, g]
          ],
          [/android.+((ideatab[a-z0-9\-\s]+))/i],
          [
            [p, "Lenovo"], d, [l, f]
          ],
          [/(lg) netcast\.tv/i],
          [p, [l, h]],
          [/(mobile|tablet);.+rv\:.+gecko\//i],
          [l, p, d]
        ],
        engine: [
          [/(presto)\/([\w\.]+)/i, /(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i, /(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i, /(icab)[\/\s]([23]\.[\d\.]+)/i],
          [w, m],
          [/rv\:([\w\.]+).*(gecko)/i],
          [m, w]
        ],
        os: [
          [/microsoft\s(windows)\s(vista|xp)/i],
          [w, m],
          [/(windows)\snt\s6\.2;\s(arm)/i, /(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],
          [w, [m, y.str, v.os.windows.version]],
          [/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],
          [
            [w, "Windows"],
            [m, y.str, v.os.windows.version]
          ],
          [/\((bb)(10);/i],
          [
            [w, "BlackBerry"], m
          ],
          [/(blackberry)\w*\/?([\w\.]+)*/i, /(tizen)\/([\w\.]+)/i, /(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],
          [w, m],
          [/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],
          [
            [w, "Symbian"], m
          ],
          [/mozilla.+\(mobile;.+gecko.+firefox/i],
          [
            [w, "Firefox OS"], m
          ],
          [/(nintendo|playstation)\s([wids3portablevu]+)/i, /(mint)[\/\s\(]?(\w+)*/i, /(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i, /(hurd|linux)\s?([\w\.]+)*/i, /(gnu)\s?([\w\.]+)*/i],
          [w, m],
          [/(cros)\s[\w]+\s([\w\.]+\w)/i],
          [
            [w, "Chromium OS"], m
          ],
          [/(sunos)\s?([\w\.]+\d)*/i],
          [
            [w, "Solaris"], m
          ],
          [/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],
          [w, m],
          [/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],
          [
            [w, "iOS"],
            [m, /_/g, "."]
          ],
          [/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],
          [w, [m, /_/g, "."]],
          [/(haiku)\s(\w+)/i, /(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i, /(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i, /(unix)\s?([\w\.]+)*/i],
          [w, m]
        ]
      },
      x = function(e) {
        var r = e || (i && i.navigator && i.navigator.userAgent ? i.navigator.userAgent : s);
        return this instanceof x ? (this.getBrowser = function() {
          return y.rgx.apply(this, k.browser)
        }, this.getCPU = function() {
          return y.rgx.apply(this, k.cpu)
        }, this.getDevice = function() {
          return y.rgx.apply(this, k.device)
        }, this.getEngine = function() {
          return y.rgx.apply(this, k.engine)
        }, this.getOS = function() {
          return y.rgx.apply(this, k.os)
        }, this.getResult = function() {
          return {
            ua: this.getUA(),
            browser: this.getBrowser(),
            engine: this.getEngine(),
            os: this.getOS(),
            device: this.getDevice(),
            cpu: this.getCPU()
          }
        }, this.getUA = function() {
          return r
        }, this.setUA = function(i) {
          return r = i, this
        }, void(this.setUA(r))) : new x(e).getResult()
      };

    function adaptStyle(type) {
      if (type == "mobile") {
        $(".progressbar").css({
          "width": "60%"
        })
      } else {
        if (type == "tablet") {
          $(".progressbar").css({
            "width": "60%"
          });
          $("#gui-modes-map").find("div").find("img").each(function() {
            this.style.width = "64px";
            this.style.height = "64px"
          });
          $("#volume").each(function() {
            this.style.width = "64px";
            this.style.height = "64px"
          })
        }
      }
    }
    if (typeof exports !== a) {
      typeof module !== a && module.exports && (exports = module.exports = x), exports.UAParser = x
    } else {
      if (i.UAParser = x, typeof define === o && define.amd && define(function() {
          return x
        }), typeof i.jQuery !== a) {
        var A = i.jQuery,
          _ = new x;
        A.ua = _.getResult(), A.ua["get"] = function() {
          return _.getUA()
        }, A.ua["set"] = function(i) {
          _.setUA(i);
          var e = _.getResult();
          for (var s in e) {
            A.ua[s] = e[s]
          }
        };
        adaptStyle(A.ua.device.type)
      }
    }
  }

  function _$af268980(n, e, t) {
    function r(n) {
      d.cssText = n
    }

    function o(n, e) {
      return typeof n === e
    }
    var i, u, c, a = "2.8.2",
      s = {},
      f = e.documentElement,
      l = "modernizr",
      p = e.createElement(l),
      d = p.style,
      y = ({}.toString, {}),
      m = [],
      w = m.slice,
      b = {}.hasOwnProperty;
    c = o(b, "undefined") || o(b.call, "undefined") ? function(n, e) {
      return e in n && o(n.constructor.prototype[e], "undefined")
    } : function(n, e) {
      return b.call(n, e)
    }, Function.prototype.bind || (Function.prototype.bind = function(n) {
      var e = this;
      if ("function" != typeof e) {
        throw new TypeError
      };
      var t = w.call(arguments, 1),
        r = function() {
          if (this instanceof r) {
            var o = function() {};
            o.prototype = e.prototype;
            var i = new o,
              u = e.apply(i, t.concat(w.call(arguments)));
            return Object(u) === u ? u : i
          };
          return e.apply(n, t.concat(w.call(arguments)))
        };
      return r
    }), y.webgl = function() {
      return !!n.WebGLRenderingContext
    };
    for (var v in y) {
      c(y, v) && (u = v.toLowerCase(), s[u] = y[v](), m.push((s[u] ? "" : "no-") + u))
    };
    return s.addTest = function(n, e) {
      if ("object" == typeof n) {
        for (var r in n) {
          c(n, r) && s.addTest(r, n[r])
        }
      } else {
        if (n = n.toLowerCase(), s[n] !== t) {
          return s
        };
        e = "function" == typeof e ? e() : e, "undefined" != typeof enableClasses && enableClasses && (f.className += " " + (e ? "" : "no-") + n), s[n] = e
      };
      return s
    }, r(""), p = i = null, s._version = a, s
  }

  function _$af268990(e, t, a) {
    "use strict";

    function n(t, h, m) {
      function H(a) {
        var n = 0,
          i = Ee.length;
        if (Ce.old = e.extend({}, Ce), Ie = we ? 0 : be[ge.horizontal ? "width" : "height"](), ke = Be[ge.horizontal ? "width" : "height"](), ze = we ? t : Pe[ge.horizontal ? "outerWidth" : "outerHeight"](), Ee.length = 0, Ce.start = 0, Ce.end = q(ze - Ie, 0), Re) {
          n = Ne.length, qe = Pe.children(ge.itemSelector), Ne.length = 0;
          var r, s = c(Pe, ge.horizontal ? "paddingLeft" : "paddingTop"),
            o = c(Pe, ge.horizontal ? "paddingRight" : "paddingBottom"),
            l = "border-box" === e(qe).css("boxSizing"),
            u = "none" !== qe.css("float"),
            f = 0,
            v = qe.length - 1;
          ze = 0, qe.each(function(t, a) {
            var n = e(a),
              i = a.getBoundingClientRect(),
              l = E(ge.horizontal ? i.width || i.right - i.left : i.height || i.bottom - i.top),
              d = c(n, ge.horizontal ? "marginLeft" : "marginTop"),
              p = c(n, ge.horizontal ? "marginRight" : "marginBottom"),
              h = l + d + p,
              m = !d || !p,
              g = {};
            g.el = a, g.size = m ? l : h, g.half = g.size / 2, g.start = ze + (m ? d : 0), g.center = g.start - E(Ie / 2 - g.size / 2), g.end = g.start - Ie + g.size, t || (ze += s), ze += h, ge.horizontal || u || p && d && t > 0 && (ze -= N(d, p)), t === v && (g.end += o, ze += o, f = m ? p : 0), Ne.push(g), r = g
          }), Pe[0].style[ge.horizontal ? "width" : "height"] = (l ? ze : ze - s - o) + "px", ze -= f, Ne.length ? (Ce.start = Ne[0][Me ? "center" : "start"], Ce.end = Me ? r.center : ze > Ie ? r.end : Ce.start) : Ce.start = Ce.end = 0
        };
        if (Ce.center = E(Ce.end / 2 + Ce.start / 2), Q(), Se.length && ke > 0 && (ge.dynamicHandle ? (Te = Ce.start === Ce.end ? ke : E(ke * Ie / ze), Te = d(Te, ge.minHandleSize, ke), Se[0].style[ge.horizontal ? "width" : "height"] = Te + "px") : Te = Se[ge.horizontal ? "outerWidth" : "outerHeight"](), xe.end = ke - Te, it || j()), !we && Ie > 0) {
          var p = Ce.start,
            h = "";
          if (Re) {
            e.each(Ne, function(e, t) {
              Me ? Ee.push(t.center) : t.start + t.size > p && p <= Ce.end && (p = t.start, Ee.push(p), p += Ie, p > Ce.end && p < Ce.end + Ie && Ee.push(Ce.end))
            })
          } else {
            for (; p - Ie < Ce.end;) {
              Ee.push(p), p += Ie
            }
          };
          if (De[0] && i !== Ee.length) {
            for (var m = 0; m < Ee.length; m++) {
              h += ge.pageBuilder.call(ye, m)
            };
            Ae = De.html(h).children(), Ae.eq(Oe.activePage).addClass(ge.activeClass)
          }
        };
        if (Oe.slideeSize = ze, Oe.frameSize = Ie, Oe.sbSize = ke, Oe.handleSize = Te, Re) {
          a && null != ge.startAt && (W(ge.startAt), ye[Le ? "toCenter" : "toStart"](ge.startAt));
          var g = Ne[Oe.activeItem];
          X(Le && g ? g.center : d(Ce.dest, Ce.start, Ce.end))
        } else {
          a ? null != ge.startAt && X(ge.startAt, 1) : X(d(Ce.dest, Ce.start, Ce.end))
        };
        pe("load")
      }

      function X(e, t, a) {
        if (Re && at.released && !a) {
          var n = $(e),
            i = e > Ce.start && e < Ce.end;
          Le ? (i && (e = Ne[n.centerItem].center), Me && ge.activateMiddle && W(n.centerItem)) : i && (e = Ne[n.firstItem].start)
        };
        at.init && at.slidee && ge.elasticBounds ? e > Ce.end ? e = Ce.end + (e - Ce.end) / 6 : e < Ce.start && (e = Ce.start + (e - Ce.start) / 6) : e = d(e, Ce.start, Ce.end), et.start = +new Date, et.time = 0, et.from = Ce.cur, et.to = e, et.delta = e - Ce.cur, et.tweesing = at.tweese || at.init && !at.slidee, et.immediate = !et.tweesing && (t || at.init && at.slidee || !ge.speed), at.tweese = 0, e !== Ce.dest && (Ce.dest = e, pe("change"), it || Y()), K(), Q(), Z(), F()
      }

      function Y() {
        if (ye.initialized) {
          if (!it) {
            return it = w(Y), void((at.released && pe("moveStart")))
          };
          et.immediate ? Ce.cur = et.to : et.tweesing ? (et.tweeseDelta = et.to - Ce.cur, x(et.tweeseDelta) < 0.1 ? Ce.cur = et.to : Ce.cur += et.tweeseDelta * (at.released ? ge.swingSpeed : ge.syncSpeed)) : (et.time = N(+new Date - et.start, ge.speed), Ce.cur = et.from + et.delta * e.easing[ge.easing](et.time / ge.speed, et.time, 0, 1, ge.speed)), et.to === Ce.cur ? (Ce.cur = et.to, at.tweese = it = 0) : it = w(Y), pe("move"), we || (f ? Pe[0].style[f] = v + (ge.horizontal ? "translateX" : "translateY") + "(" + -Ce.cur + "px)" : Pe[0].style[ge.horizontal ? "left" : "top"] = -E(Ce.cur) + "px"), !it && at.released && pe("moveEnd"), j()
        }
      }

      function j() {
        Se.length && (xe.cur = Ce.start === Ce.end ? 0 : ((at.init && !at.slidee ? Ce.dest : Ce.cur) - Ce.start) / (Ce.end - Ce.start) * xe.end, xe.cur = d(E(xe.cur), xe.start, xe.end), _e.hPos !== xe.cur && (_e.hPos = xe.cur, f ? Se[0].style[f] = v + (ge.horizontal ? "translateX" : "translateY") + "(" + xe.cur + "px)" : Se[0].style[ge.horizontal ? "left" : "top"] = xe.cur + "px"))
      }

      function F() {
        Ae[0] && _e.page !== Oe.activePage && (_e.page = Oe.activePage, Ae.removeClass(ge.activeClass).eq(Oe.activePage).addClass(ge.activeClass), pe("activePage", _e.page))
      }

      function M() {
        tt.speed && Ce.cur !== (tt.speed > 0 ? Ce.end : Ce.start) || ye.stop(), ot = at.init ? w(M) : 0, tt.now = +new Date, tt.pos = Ce.cur + (tt.now - tt.lastTime) / 1e3 * tt.speed, X(at.init ? tt.pos : E(tt.pos)), at.init || Ce.cur !== Ce.dest || pe("moveEnd"), tt.lastTime = tt.now
      }

      function L(e, t, n) {
        if ("boolean" === i(t) && (n = t, t = a), t === a) {
          X(Ce[e], n)
        } else {
          if (Le && "center" !== e) {
            return
          };
          var r = ye.getPos(t);
          r && X(r[e], n, !Le)
        }
      }

      function R(e) {
        return null != e ? l(e) ? e >= 0 && e < Ne.length ? e : -1 : qe.index(e) : -1
      }

      function U(e) {
        return R(l(e) && 0 > e ? e + Ne.length : e)
      }

      function W(e, t) {
        var a = R(e);
        return !Re || 0 > a ? !1 : ((_e.active !== a || t) && (qe.eq(Oe.activeItem).removeClass(ge.activeClass), qe.eq(a).addClass(ge.activeClass), _e.active = Oe.activeItem = a, Z(), pe("active", a)), a)
      }

      function $(e) {
        e = d(l(e) ? e : Ce.dest, Ce.start, Ce.end);
        var t = {},
          a = Me ? 0 : Ie / 2;
        if (!we) {
          for (var n = 0, i = Ee.length; i > n; n++) {
            if (e >= Ce.end || n === Ee.length - 1) {
              t.activePage = Ee.length - 1;
              break
            };
            if (e <= Ee[n] + a) {
              t.activePage = n;
              break
            }
          }
        };
        if (Re) {
          for (var r = !1, s = !1, o = !1, c = 0, u = Ne.length; u > c; c++) {
            if (r === !1 && e <= Ne[c].start + Ne[c].half && (r = c), o === !1 && e <= Ne[c].center + Ne[c].half && (o = c), c === u - 1 || e <= Ne[c].end + Ne[c].half) {
              s = c;
              break
            }
          };
          t.firstItem = l(r) ? r : 0, t.centerItem = l(o) ? o : t.firstItem, t.lastItem = l(s) ? s : t.centerItem
        };
        return t
      }

      function Q(t) {
        e.extend(Oe, $(t))
      }

      function Z() {
        var e = Ce.dest <= Ce.start,
          t = Ce.dest >= Ce.end,
          a = (e ? 1 : 0) | (t ? 2 : 0);
        if (_e.slideePosState !== a && (_e.slideePosState = a, Je.is("button,input") && Je.prop("disabled", e), Ke.is("button,input") && Ke.prop("disabled", t), Je.add(Qe)[e ? "addClass" : "removeClass"](ge.disabledClass), Ke.add($e)[t ? "addClass" : "removeClass"](ge.disabledClass)), _e.fwdbwdState !== a && at.released && (_e.fwdbwdState = a, Qe.is("button,input") && Qe.prop("disabled", e), $e.is("button,input") && $e.prop("disabled", t)), Re && null != Oe.activeItem) {
          var n = 0 === Oe.activeItem,
            i = Oe.activeItem >= Ne.length - 1,
            r = (n ? 1 : 0) | (i ? 2 : 0);
          _e.itemsButtonState !== r && (_e.itemsButtonState = r, Ze.is("button,input") && Ze.prop("disabled", n), Ge.is("button,input") && Ge.prop("disabled", i), Ze[n ? "addClass" : "removeClass"](ge.disabledClass), Ge[i ? "addClass" : "removeClass"](ge.disabledClass))
        }
      }

      function G(e, t, a) {
        if (e = U(e), t = U(t), e > -1 && t > -1 && e !== t && (!a || t !== e - 1) && (a || t !== e + 1)) {
          qe.eq(e)[a ? "insertAfter" : "insertBefore"](Ne[t].el);
          var n = t > e ? e : a ? t : t - 1,
            i = e > t ? e : a ? t + 1 : t,
            r = e > t;
          null != Oe.activeItem && (e === Oe.activeItem ? _e.active = Oe.activeItem = a ? r ? t + 1 : t : r ? t : t - 1 : Oe.activeItem > n && Oe.activeItem < i && (_e.active = Oe.activeItem += r ? 1 : -1)), H()
        }
      }

      function J(e, t) {
        for (var a = 0, n = Ve[e].length; n > a; a++) {
          if (Ve[e][a] === t) {
            return a
          }
        };
        return -1
      }

      function K() {
        at.released && !ye.isPaused && ye.resume()
      }

      function V(e) {
        return E(d(e, xe.start, xe.end) / xe.end * (Ce.end - Ce.start)) + Ce.start
      }

      function _() {
        at.history[0] = at.history[1], at.history[1] = at.history[2], at.history[2] = at.history[3], at.history[3] = at.delta
      }

      function ee(e) {
        at.released = 0, at.source = e, at.slidee = "slidee" === e
      }

      function te(t) {
        var a = "touchstart" === t.type,
          n = t.data.source,
          i = "slidee" === n;
        at.init || !a && ie(t.target) || ("handle" !== n || ge.dragHandle && xe.start !== xe.end) && (!i || (a ? ge.touchDragging : ge.mouseDragging && t.which < 2)) && (a || r(t), ee(n), at.init = 0, at.$source = e(t.target), at.touch = a, at.pointer = a ? t.originalEvent.touches[0] : t, at.initX = at.pointer.pageX, at.initY = at.pointer.pageY, at.initPos = i ? Ce.cur : xe.cur, at.start = +new Date, at.time = 0, at.path = 0, at.delta = 0, at.locked = 0, at.history = [0, 0, 0, 0], at.pathToLock = i ? a ? 30 : 10 : 0, b.on(a ? z : I, ae), ye.pause(1), (i ? Pe : Se).addClass(ge.draggedClass), pe("moveStart"), i && (rt = setInterval(_, 10)))
      }

      function ae(e) {
        if (at.released = "mouseup" === e.type || "touchend" === e.type, at.pointer = at.touch ? e.originalEvent[at.released ? "changedTouches" : "touches"][0] : e, at.pathX = at.pointer.pageX - at.initX, at.pathY = at.pointer.pageY - at.initY, at.path = D(A(at.pathX, 2) + A(at.pathY, 2)), at.delta = ge.horizontal ? at.pathX : at.pathY, at.released || !(at.path < 1)) {
          if (!at.init) {
            if (!(ge.horizontal ? x(at.pathX) > x(at.pathY) : x(at.pathX) < x(at.pathY))) {
              return ne()
            };
            at.init = 1
          };
          r(e), !at.locked && at.path > at.pathToLock && at.slidee && (at.locked = 1, at.$source.on(B, s)), at.released && (ne(), ge.releaseSwing && at.slidee && (at.swing = (at.delta - at.history[0]) / 40 * 300, at.delta += at.swing, at.tweese = x(at.swing) > 10)), X(at.slidee ? E(at.initPos - at.delta) : V(at.initPos + at.delta))
        }
      }

      function ne() {
        clearInterval(rt), at.released = !0, b.off(at.touch ? z : I, ae), (at.slidee ? Pe : Se).removeClass(ge.draggedClass), setTimeout(function() {
          at.$source.off(B, s)
        }), Ce.cur === Ce.dest && at.init && pe("moveEnd"), ye.resume(1), at.init = 0
      }

      function ie(t) {
        return ~e.inArray(t.nodeName, k) || e(t).is(ge.interactive)
      }

      function re() {
        ye.stop(), b.off("mouseup", re)
      }

      function se(e) {
        switch (r(e), this) {
          case $e[0]:
            ;
          case Qe[0]:
            ye.moveBy($e.is(this) ? ge.moveBy : -ge.moveBy), b.on("mouseup", re);
            break;
          case Ze[0]:
            ye.prev();
            break;
          case Ge[0]:
            ye.next();
            break;
          case Je[0]:
            ye.prevPage();
            break;
          case Ke[0]:
            ye.nextPage()
        }
      }

      function oe(e) {
        return nt.curDelta = (ge.horizontal ? e.deltaY || e.deltaX : e.deltaY) || -e.wheelDelta, nt.curDelta /= 1 === e.deltaMode ? 3 : 100, Re ? (p = +new Date, nt.last < p - nt.resetTime && (nt.delta = 0), nt.last = p, nt.delta += nt.curDelta, x(nt.delta) < 1 ? nt.finalDelta = 0 : (nt.finalDelta = E(nt.delta / 1), nt.delta %= 1), nt.finalDelta) : nt.curDelta
      }

      function le(e) {
        e.originalEvent[g] = ye;
        var t = +new Date;
        if (O + ge.scrollHijack > t && Ue[0] !== document && Ue[0] !== window) {
          return void((O = t))
        };
        if (ge.scrollBy && Ce.start !== Ce.end) {
          var a = oe(e.originalEvent);
          (ge.scrollTrap || a > 0 && Ce.dest < Ce.end || 0 > a && Ce.dest > Ce.start) && r(e, 1), ye.slideBy(ge.scrollBy * a)
        }
      }

      function ce(e) {
        ge.clickBar && e.target === Be[0] && (r(e), X(V((ge.horizontal ? e.pageX - Be.offset().left : e.pageY - Be.offset().top) - Te / 2)))
      }

      function de(e) {
        if (ge.keyboardNavBy) {
          switch (e.which) {
            case ge.horizontal ? 37:
              38: r(e), ye["pages" === ge.keyboardNavBy ? "prevPage" : "prev"]();
              break;
            case ge.horizontal ? 39:
              40: r(e), ye["pages" === ge.keyboardNavBy ? "nextPage" : "next"]()
          }
        }
      }

      function ue(e) {
        return ie(this) ? void((e.originalEvent[g + "ignore"] = !0)) : void((this.parentNode !== Pe[0] || e.originalEvent[g + "ignore"] || ye.activate(this)))
      }

      function fe() {
        this.parentNode === De[0] && ye.activatePage(Ae.index(this))
      }

      function ve(e) {
        ge.pauseOnHover && ye["mouseenter" === e.type ? "pause" : "resume"](2)
      }

      function pe(e, t) {
        if (Ve[e]) {
          for (me = Ve[e].length, T.length = 0, he = 0; me > he; he++) {
            T.push(Ve[e][he])
          };
          for (he = 0; me > he; he++) {
            T[he].call(ye, e, t)
          }
        }
      }
      var he, me, ge = e.extend({}, n.defaults, h),
        ye = this,
        we = l(t),
        be = e(t),
        Pe = ge.slidee ? e(ge.slidee).eq(0) : be.children().eq(0),
        Ie = 0,
        ze = 0,
        Ce = {
          start: 0,
          center: 0,
          end: 0,
          cur: 0,
          dest: 0
        },
        Be = e(ge.scrollBar).eq(0),
        Se = Be.children().eq(0),
        ke = 0,
        Te = 0,
        xe = {
          start: 0,
          end: 0,
          cur: 0
        },
        De = e(ge.pagesBar),
        Ae = 0,
        Ee = [],
        qe = 0,
        Ne = [],
        Oe = {
          firstItem: 0,
          lastItem: 0,
          centerItem: 0,
          activeItem: null,
          activePage: 0
        },
        He = new u(be[0]),
        Xe = new u(Pe[0]),
        Ye = new u(Be[0]),
        je = new u(Se[0]),
        Fe = "basic" === ge.itemNav,
        Me = "forceCentered" === ge.itemNav,
        Le = "centered" === ge.itemNav || Me,
        Re = !we && (Fe || Le || Me),
        Ue = ge.scrollSource ? e(ge.scrollSource) : be,
        We = ge.dragSource ? e(ge.dragSource) : be,
        $e = e(ge.forward),
        Qe = e(ge.backward),
        Ze = e(ge.prev),
        Ge = e(ge.next),
        Je = e(ge.prevPage),
        Ke = e(ge.nextPage),
        Ve = {},
        _e = {},
        et = {},
        tt = {},
        at = {
          released: 1
        },
        nt = {
          last: 0,
          delta: 0,
          resetTime: 200
        },
        it = 0,
        rt = 0,
        st = 0,
        ot = 0;
      we || (t = be[0]), ye.initialized = 0, ye.frame = t, ye.slidee = Pe[0], ye.pos = Ce, ye.rel = Oe, ye.items = Ne, ye.pages = Ee, ye.isPaused = 0, ye.options = ge, ye.dragging = at, ye.reload = function() {
        H()
      }, ye.getPos = function(e) {
        if (Re) {
          var t = R(e);
          return -1 !== t ? Ne[t] : !1
        };
        var a = Pe.find(e).eq(0);
        if (a[0]) {
          var n = ge.horizontal ? a.offset().left - Pe.offset().left : a.offset().top - Pe.offset().top,
            i = a[ge.horizontal ? "outerWidth" : "outerHeight"]();
          return {
            start: n,
            center: n - Ie / 2 + i / 2,
            end: n - Ie + i,
            size: i
          }
        };
        return !1
      }, ye.moveBy = function(e) {
        tt.speed = e, !at.init && tt.speed && Ce.cur !== (tt.speed > 0 ? Ce.end : Ce.start) && (tt.lastTime = +new Date, tt.startPos = Ce.cur, ee("button"), at.init = 1, pe("moveStart"), y(ot), M())
      }, ye.stop = function() {
        "button" === at.source && (at.init = 0, at.released = 1)
      }, ye.prev = function() {
        ye.activate(null == Oe.activeItem ? 0 : Oe.activeItem - 1)
      }, ye.next = function() {
        ye.activate(null == Oe.activeItem ? 0 : Oe.activeItem + 1)
      }, ye.prevPage = function() {
        ye.activatePage(Oe.activePage - 1)
      }, ye.nextPage = function() {
        ye.activatePage(Oe.activePage + 1)
      }, ye.slideBy = function(e, t) {
        e && (Re ? ye[Le ? "toCenter" : "toStart"](d((Le ? Oe.centerItem : Oe.firstItem) + ge.scrollBy * e, 0, Ne.length)) : X(Ce.dest + e, t))
      }, ye.slideTo = function(e, t) {
        X(e, t)
      }, ye.toStart = function(e, t) {
        L("start", e, t)
      }, ye.toEnd = function(e, t) {
        L("end", e, t)
      }, ye.toCenter = function(e, t) {
        L("center", e, t)
      }, ye.getIndex = R, ye.activate = function(e, t) {
        var a = W(e);
        ge.smart && a !== !1 && (Le ? ye.toCenter(a, t) : a >= Oe.lastItem ? ye.toStart(a, t) : a <= Oe.firstItem ? ye.toEnd(a, t) : K())
      }, ye.activatePage = function(e, t) {
        l(e) && X(Ee[d(e, 0, Ee.length - 1)], t)
      }, ye.resume = function(e) {
        ge.cycleBy && ge.cycleInterval && ("items" !== ge.cycleBy || Ne[0] && null != Oe.activeItem) && !(e < ye.isPaused) && (ye.isPaused = 0, st ? st = clearTimeout(st) : pe("resume"), st = setTimeout(function() {
          switch (pe("cycle"), ge.cycleBy) {
            case "items":
              ye.activate(Oe.activeItem >= Ne.length - 1 ? 0 : Oe.activeItem + 1);
              break;
            case "pages":
              ye.activatePage(Oe.activePage >= Ee.length - 1 ? 0 : Oe.activePage + 1)
          }
        }, ge.cycleInterval))
      }, ye.pause = function(e) {
        e < ye.isPaused || (ye.isPaused = e || 100, st && (st = clearTimeout(st), pe("pause")))
      }, ye.toggle = function() {
        ye[st ? "pause" : "resume"]()
      }, ye["set"] = function(t, a) {
        e.isPlainObject(t) ? e.extend(ge, t) : ge.hasOwnProperty(t) && (ge[t] = a)
      }, ye.add = function(t, a) {
        var n = e(t);
        Re ? (null == a || !Ne[0] || a >= Ne.length ? n.appendTo(Pe) : Ne.length && n.insertBefore(Ne[a].el), null != Oe.activeItem && a <= Oe.activeItem && (_e.active = Oe.activeItem += n.length)) : Pe.append(n), H()
      }, ye.remove = function(t) {
        if (Re) {
          var a = U(t);
          if (a > -1) {
            qe.eq(a).remove();
            var n = a === Oe.activeItem;
            null != Oe.activeItem && a < Oe.activeItem && (_e.active = --Oe.activeItem), H(), n && (_e.active = null, ye.activate(Oe.activeItem))
          }
        } else {
          e(t).remove(), H()
        }
      }, ye.moveAfter = function(e, t) {
        G(e, t, 1)
      }, ye.moveBefore = function(e, t) {
        G(e, t)
      }, ye.on = function(e, t) {
        if ("object" === i(e)) {
          for (var a in e) {
            e.hasOwnProperty(a) && ye.on(a, e[a])
          }
        } else {
          if ("function" === i(t)) {
            for (var n = e.split(" "), r = 0, s = n.length; s > r; r++) {
              Ve[n[r]] = Ve[n[r]] || [], -1 === J(n[r], t) && Ve[n[r]].push(t)
            }
          } else {
            if ("array" === i(t)) {
              for (var o = 0, l = t.length; l > o; o++) {
                ye.on(e, t[o])
              }
            }
          }
        }
      }, ye.one = function(e, t) {
        function a() {
          t.apply(ye, arguments), ye.off(e, a)
        }
        ye.on(e, a)
      }, ye.off = function(e, t) {
        if (t instanceof Array) {
          for (var a = 0, n = t.length; n > a; a++) {
            ye.off(e, t[a])
          }
        } else {
          for (var i = e.split(" "), r = 0, s = i.length; s > r; r++) {
            if (Ve[i[r]] = Ve[i[r]] || [], null == t) {
              Ve[i[r]].length = 0
            } else {
              var o = J(i[r], t); - 1 !== o && Ve[i[r]].splice(o, 1)
            }
          }
        }
      }, ye.destroy = function() {
        return Ue.add(Se).add(Be).add(De).add($e).add(Qe).add(Ze).add(Ge).add(Je).add(Ke).off("." + g), b.off("keydown", de), Ze.add(Ge).add(Je).add(Ke).removeClass(ge.disabledClass), qe && null != Oe.activeItem && qe.eq(Oe.activeItem).removeClass(ge.activeClass), De.empty(), we || (be.off("." + g), He.restore(), Xe.restore(), Ye.restore(), je.restore(), e.removeData(t, g)), Ne.length = Ee.length = 0, _e = {}, ye.initialized = 0, ye
      }, ye.init = function() {
        if (!ye.initialized) {
          ye.on(m);
          var e = ["overflow", "position"],
            t = ["position", "webkitTransform", "msTransform", "transform", "left", "top", "width", "height"];
          He.save.apply(He, e), Ye.save.apply(Ye, e), Xe.save.apply(Xe, t), je.save.apply(je, t);
          var a = Se;
          return we || (a = a.add(Pe), be.css("overflow", "hidden"), f || "static" !== be.css("position") || be.css("position", "relative")), f ? v && a.css(f, v) : ("static" === Be.css("position") && Be.css("position", "relative"), a.css({
            position: "absolute"
          })), ge.forward && $e.on(S, se), ge.backward && Qe.on(S, se), ge.prev && Ze.on(B, se), ge.next && Ge.on(B, se), ge.prevPage && Je.on(B, se), ge.nextPage && Ke.on(B, se), Ue.on(C, le), Be[0] && Be.on(B, ce), Re && ge.activateOn && be.on(ge.activateOn + "." + g, "*", ue), De[0] && ge.activatePageOn && De.on(ge.activatePageOn + "." + g, "*", fe), We.on(P, {
            source: "slidee"
          }, te), Se && Se.on(P, {
            source: "handle"
          }, te), b.on("keydown", de), we || (be.on("mouseenter." + g + " mouseleave." + g, ve), be.on("scroll." + g, o)), ye.initialized = 1, H(!0), ge.cycleBy && !we && ye[ge.startPaused ? "pause" : "resume"](), ye
        }
      }
    }

    function i(e) {
      return null == e ? String(e) : "object" == typeof e || "function" == typeof e ? Object.prototype.toString.call(e).match(/\s([a-z]+)/i)[1].toLowerCase() || "object" : typeof e
    }

    function r(e, t) {
      e.preventDefault(), t && e.stopPropagation()
    }

    function s(t) {
      r(t, 1), e(this).off(t.type, s)
    }

    function o() {
      this.scrollLeft = 0, this.scrollTop = 0
    }

    function l(e) {
      return !isNaN(parseFloat(e)) && isFinite(e)
    }

    function c(e, t) {
      return 0 | E(String(e.css(t)).replace(/[^\-0-9.]/g, ""))
    }

    function d(e, t, a) {
      return t > e ? t : e > a ? a : e
    }

    function u(e) {
      var t = {};
      return t.style = {}, t.save = function() {
        if (e && e.nodeType) {
          for (var a = 0; a < arguments.length; a++) {
            t.style[arguments[a]] = e.style[arguments[a]]
          };
          return t
        }
      }, t.restore = function() {
        if (e && e.nodeType) {
          for (var a in t.style) {
            t.style.hasOwnProperty(a) && (e.style[a] = t.style[a])
          };
          return t
        }
      }, t
    }
    var f, v, p, h = "sly",
      m = "Sly",
      g = h,
      y = t.cancelAnimationFrame || t.cancelRequestAnimationFrame,
      w = t.requestAnimationFrame,
      b = e(document),
      P = "touchstart." + g + " mousedown." + g,
      I = "mousemove." + g + " mouseup." + g,
      z = "touchmove." + g + " touchend." + g,
      C = (document.implementation.hasFeature("Event.wheel", "3.0") ? "wheel." : "mousewheel.") + g,
      B = "click." + g,
      S = "mousedown." + g,
      k = ["INPUT", "SELECT", "BUTTON", "TEXTAREA"],
      T = [],
      x = Math.abs,
      D = Math.sqrt,
      A = Math.pow,
      E = Math.round,
      q = Math.max,
      N = Math.min,
      O = 0;
    b.on(C, function(e) {
        var t = e.originalEvent[g],
          a = +new Date;
        (!t || t.options.scrollHijack < a - O) && (O = a)
      }),
      function(e) {
        function t(e) {
          var t = (new Date).getTime(),
            n = Math.max(0, 16 - (t - a)),
            i = setTimeout(e, n);
          return a = t, i
        }
        w = e.requestAnimationFrame || e.webkitRequestAnimationFrame || t;
        var a = (new Date).getTime(),
          n = e.cancelAnimationFrame || e.webkitCancelAnimationFrame || e.clearTimeout;
        y = function(t) {
          n.call(e, t)
        }
      }(window),
      function() {
        function e(e) {
          for (var n = 0, i = t.length; i > n; n++) {
            var r = t[n] ? t[n] + e.charAt(0).toUpperCase() + e.slice(1) : e;
            if (null != a.style[r]) {
              return r
            }
          }
        }
        var t = ["", "webkit", "moz", "ms", "o"],
          a = document.createElement("div");
        f = e("transform"), v = e("perspective") ? "translateZ(0) " : ""
      }(), t[m] = n, e.fn[h] = function(t, a) {
        var r, s;
        return e.isPlainObject(t) || (("string" === i(t) || t === !1) && (r = t === !1 ? "destroy" : t, s = Array.prototype.slice.call(arguments, 1)), t = {}), this.each(function(i, o) {
          var l = e.data(o, g);
          l || r ? l && r && l[r] && l[r].apply(l, s) : l = e.data(o, g, new n(o, t, a).init())
        })
      }, n.defaults = {
        slidee: null,
        horizontal: !1,
        itemNav: null,
        itemSelector: null,
        smart: !1,
        activateOn: null,
        activateMiddle: !1,
        scrollSource: null,
        scrollBy: 0,
        scrollHijack: 300,
        scrollTrap: !1,
        dragSource: null,
        mouseDragging: !1,
        touchDragging: !1,
        releaseSwing: !1,
        swingSpeed: 0.2,
        elasticBounds: !1,
        interactive: null,
        scrollBar: null,
        dragHandle: !1,
        dynamicHandle: !1,
        minHandleSize: 50,
        clickBar: !1,
        syncSpeed: 0.5,
        pagesBar: null,
        activatePageOn: null,
        pageBuilder: function(e) {
          return "<li>" + (e + 1) + "</li>"
        },
        forward: null,
        backward: null,
        prev: null,
        next: null,
        prevPage: null,
        nextPage: null,
        cycleBy: null,
        cycleInterval: 5e3,
        pauseOnHover: !1,
        startPaused: !1,
        moveBy: 300,
        speed: 0,
        easing: "swing",
        startAt: null,
        keyboardNavBy: null,
        draggedClass: "dragged",
        activeClass: "active",
        disabledClass: "disabled"
      }
  }

  function _$af269080(e, t, i) {
    (function(i) {
      "use strict";
      var n = e("./util/logger"),
        r = new n(i),
        o = {
          init: function(e, t) {
            var i = Math.random();
            for (var n in e) {
              if (n.indexOf("cdn_traffic_") > -1) {
                try {
                  var a = n.split("_").splice(2).map(function(e) {
                    return parseFloat(e) / 100
                  });
                  o.cdn = i < a[0] ? "cloudfront" : i < a[0] + a[1] ? "fastly" : "cdn-1"
                } catch (s) {
                  r.warn("A/B flag " + n + " failed parsing")
                }
              }
            };
            for (var h in t) {
              o[h] = t[h]
            };
            o.cdnUrl = {
              cloudfront: "",
              fastly: "",
              "cdn-1": ""
            }[o.cdn] || ""
          },
          cdn: "",
          cdnUrl: ""
        };
      t.exports = o
    }).call(this, "/js/ab.js")
  }

  function _$af269084(e, t, i) {
    (function(i) {
      "use strict";

      function n() {
        return {
          addons: [{
            name: "keen:ua_parser",
            input: {
              ua_string: "user_agent"
            },
            output: "parsed_user_agent"
          }]
        }
      }

      function r() {
        var e;
        try {
          e = window.localStorage.getItem("distinctID"), null === e && (e = "anon_" + d.randomString(11), window.localStorage.setItem("distinctID", e))
        } catch (t) {
          e = "anon_" + d.randomString(11)
        };
        return e
      }

      function o() {
        var e = 0,
          t = window.onerror;
        window.onerror = function(i, n, r) {
          return e++ <= p.analytics.maxTrackedErrors && mixpanel.track("USER", {
            event_type: "error",
            error_type: "window",
            error_severity: "error"
          }), t ? t(i, n, r) : !1
        };
        var i = console.warn;
        console.warn = function() {
          var t = Array.prototype.slice.call(arguments);
          e++ <= p.analytics.maxTrackedErrors && mixpanel.track("USER", {
            event_type: "error",
            error_type: "console",
            error_severity: "warning"
          }), i.apply(console, t)
        };
        var n = console.error;
        console.error = function() {
          var t = Array.prototype.slice.call(arguments);
          e++ <= p.analytics.maxTrackedErrors && mixpanel.track("USER", {
            event_type: "error",
            error_type: "console",
            error_severity: "error"
          }), n.apply(console, t)
        }
      }

      function a(e, t) {
        var i = {},
          n = Date.now() - x;
        clearTimeout(M), mixpanel.track("USER", {
          event_type: "model_loaded",
          duration: n
        }), e.panos.forEach(function(e) {
          e.on("enter", function() {
            mixpanel.track("USER", {
              event_type: "view_pano",
              pano_id: e.id,
              interaction_source: b,
              navigation_source: h
            })
          })
        });
        for (var r in e.mattertags) {
          e.mattertags[r].on("tag.opened", function() {
            i[this.sid] = !0, mixpanel.track("USER", {
              event_type: "tag_opened",
              tag_id: this.sid,
              tags_visited: Object.keys(i).length,
              tag_count: Object.keys(e.mattertags).length
            })
          }.bind(e.mattertags[r]))
        };
        t.on("tour_auto", function(e) {
          h = "tour_" + e
        }), t.on("tour_manual", function(e) {
          h = "tour_manual"
        }), t.controls[f.PANORAMA].on("interaction.key", function() {
          t.mode === f.TRANSITIONING || t.flying || (b = "keyboard", h = "self_guided")
        }), t.controls[f.PANORAMA].on("interaction.direct", function() {
          t.mode === f.TRANSITIONING || t.flying || (b = "direct", h = "self_guided")
        }), t.controls[f.PANORAMA].on("interaction.gui", function() {
          t.mode === f.TRANSITIONING || t.flying || (b = "gui", h = "self_guided")
        }), $(window).resize(function() {
          mixpanel.register({
            aspect_ratio: u.aspectRatio()
          })
        })
      }

      function s(e, t) {
        if (_) {
          var i = {},
            n = {};
          e.panos.forEach(function(e) {
            e.on("loading", function(t) {
              n[e.id] || (n[e.id] = E.getElapsedTime())
            }), e.on("load", function(t) {
              if ("high" === t) {
                var r = E.getElapsedTime() - n[e.id];
                if (mixpanel.track("USER", {
                    event_type: "pano_loaded",
                    pano_id: e.id,
                    download_time: r.toFixed(1)
                  }), i[e.id]) {
                  var o = E.getElapsedTime() - i[e.id];
                  mixpanel.track("USER", {
                    event_type: "pano_wait",
                    pano_id: e.id,
                    wait_duration: o.toFixed(1),
                    navigation_source: h
                  })
                }
              }
            }), e.on("enter", function() {
              void(0) === i[e.id] && (i[e.id] = E.getElapsedTime(), e.isLoaded("high") && mixpanel.track("USER", {
                event_type: "pano_wait",
                pano_id: e.id,
                wait_duration: 0,
                navigation_source: h
              }))
            })
          }), e.on("floor.changed", function(e, t) {
            mixpanel.track("USER", {
              event_type: "floor_change",
              floor_id: e.name,
              interaction_source: b
            })
          }), t.on("mode.changed", function(e, t) {
            t !== f.TRANSITIONING && mixpanel.track("USER", {
              event_type: "mode_change",
              view_mode: t,
              interaction_source: b
            })
          }), mixpanel.track("USER", {
            event_type: "session_duration_start"
          }), setInterval(function() {
            var e = (Date.now() - S) / 1e3,
              i = (Date.now() - t.lastChangeTime) / 1e3;
            !document.hidden && i < p.analytics.sessionDurationTimeout && e >= p.analytics.sessionDurationPingFrequency && (S = Date.now(), mixpanel.track("USER", {
              event_type: "session_duration_ping"
            }))
          }, 1e3)
        }
      }
      var h, l = e("three"),
        c = e("./util/ajax"),
        u = e("./util/browser"),
        d = e("./util/common"),
        p = e("./settings"),
        f = e("./enum/Viewmode"),
        m = e("./util/logger"),
        g = e("./ab"),
        v = new m(i),
        y = new Keen({
          projectId: "53a9baf536bca4213d000000",
          writeKey: "dcfae0ec6709a6d21f2f5e50a091a0cc6ab8abc88f1c66e961f9e33db58544ca90a37d6698df874334c6dddbde8eaaeb45d8e80d963978d87ada717c1b66e8e3a46d7686538c29db04227fd2ce04a0f7e35c3c5ef07b24b2c77400f29ed15258efbe9312722711abb9fbc2d7bf245803",
          readKey: "",
          requestType: "xhr"
        }),
        b = "direct",
        w = null,
        _ = !1,
        x = null,
        M = null,
        E = new l.Clock(!0),
        S = 0;
      E.start(), t.exports = {
        report: function(e, t) {
          try {
            y.addEvent("Session starts", {
              host: window.location.host,
              model: e,
              keen: n(),
              user_agent: "${keen.user_agent}",
              status: t,
              referrer: {
                url: document.referrer,
                domain: d.domainFromUrl(document.referrer)
              },
              embedded: u.inIframe(),
              loadtime: Date.now() - (x || Date.now()),
              cdn: g.cdn
            })
          } catch (i) {
            v.warn("2245: " + i)
          }
        },
        getMixpanelToken: function(e) {
          var t = $.Deferred();
          return p.debug ? t.resolve("") : e.data && e.data.mixpanel ? (v.info("Using prefetched mixpanel token"), t.resolve(e.data.mixpanel)) : (c["get"](e.urlBase + "/api/v1/metrics/keys/", {
            responseType: "json"
          }).done(function(e) {
            "mixpanel" in e ? t.resolve(e.mixpanel) : (v.error("No mixpanel token available"), t.reject("loading-failed-mixpanel"))
          }).fail(function(e) {
            v.error("No mixpanel token available"), t.reject("loading-failed-mixpanel")
          }), t.promise())
        },
        impression: function(e) {
          if (w) {
            var t = window.location.search.substr(1).split("&");
            mixpanel.track("USER", {
              event_type: "impression",
              visible: e,
              url_params: t
            }), _ && o()
          }
        },
        initMixpanel: function(e) {
          w = e.token, mixpanel.init(w, {
            persistence: "localStorage"
          }), mixpanel.identify(r()), p.analytics.sessionTrackingRate = 1 === p.analytics.sessionTrackingRate ? 1 : 0.15, _ = Math.random() < p.analytics.sessionTrackingRate, v.debug("tracking sample rate = " + p.analytics.sessionTrackingRate), v.debug("tracking this session = " + _);
          var t = "anonymous",
            i = "anonymous";
          mixpanel.register({
            app: "showcase",
            app_version: e.version,
            model_id: e.model,
            user_id: t,
            group_id: i,
            session_tracking_rate: p.analytics.sessionTrackingRate,
            session_tracking: _,
            start_source: e.startSource,
            cdn: e.cdn
          })
        },
        initMixpanelModel: function(e) {
          if (w) {
            var t = e.data.owner,
              i = t && t.user_sid ? t.user_sid : "anonymous",
              n = t && t.group_sid ? t.group_sid : "anonymous",
              r = "anonymous",
              o = "anonymous";
            mixpanel.register({
              manifest_id: e.data.job.uuid,
              owner_user_id: i,
              owner_group_id: n,
              editor_user_id: r,
              editor_group_id: o,
              ua_string: u.userAgent(),
              is_mobile: u.isMobile(),
              iframe: u.inIframe(),
              aspect_ratio: u.aspectRatio()
            })
          }
        },
        sessionStart: function(e) {
          if (w && (mixpanel.track("USER", {
              event_type: "user_session_start"
            }), x = Date.now(), _)) {
            var t = function() {
              mixpanel.track("USER", {
                event_type: "long_load"
              })
            };
            M = setTimeout(t, 15e3)
          }
        },
        modelLoaded: function(e, t) {
          w && (a(e, t), s(e, t))
        },
        track: function(e, t) {
          w && _ && mixpanel.track(e, t)
        },
        trackAlways: function(e, t) {
          w && mixpanel.track(e, t)
        }
      }
    }).call(this, "/js/analytics.js")
  }

  function _$af269122(e, t, i) {
    (function(i) {
      "use strict";

      function n(e, t, i) {
        e && (e = e.toLowerCase().trim());
        var n = new c.Vector3(0, 1, 0),
          r = Math.PI / 3,
          o = Math.PI / 2;
        switch (e) {
          case "left":
            i.copy(t), i.applyAxisAngle(n, o);
            break;
          case "right":
            i.copy(t), i.applyAxisAngle(n, -o);
            break;
          case "forwardleft":
            i.copy(t), i.applyAxisAngle(n, r);
            break;
          case "forwardright":
            i.copy(t), i.applyAxisAngle(n, -r);
            break;
          case "forward":
            ;
          default:
            i.copy(t)
        };
        return i
      }

      function r(e, t) {
        e ? this.player.flyToPano(e, null, function() {
          t && t({
            success: !0,
            message: "Transition complete."
          })
        }) : (y.warn("Automation -> clickPanoObject:\u627e\u4e0d\u5230pano."), t && t({
          success: !1,
          error: "Unable to find pano."
        }))
      }

      function o(e, t) {
        var i = this.findRankedPano(e, t);
        return i >= 0 ? this.handleToObject[i] : (y.warn("Automation -> findRankedPanoObject: \u627e\u4e0d\u5230pano."), null)
      }

      function a(e, t) {
        var i = this.findRankedMattertag(e, t);
        return i >= 0 ? this.handleToObject[i] : (y.warn("Automation -> findRankedMattertagObject: \u627e\u4e0d\u5230Mattertag."), null)
      }

      function s(e, t) {
        t.copy(m.FORWARD), e.getDirection(t)
      }

      function h(e, t, i) {
        var n = t.targetFunction,
          r = t.params;
        if (n) {
          var o = b[n];
          if (o) {
            r = r || {}, r.onDone = function(e) {
              g.respondToMessage(i, e)
            };
            var a = [];
            for (var s in r) {
              r.hasOwnProperty(s) && a.push(r[s])
            };
            o.apply(b, a)
          }
        }
      }

      function l(e) {
        e({
          success: !0,
          message: "Init complete."
        })
      }
      var c = e("three"),
        u = e("./util/logger"),
        d = e("./enum/Viewmode"),
        p = e("./enum/Keys"),
        f = e("./settings"),
        m = e("./enum/Vectors"),
        g = e("./postmessage.js"),
        v = e("./util/math.js"),
        y = new u(i),
        b = null,
        w = function() {
          var e = new c.Vector3;
          return function(t) {
            t ? (e.copy(t.position), e.add(t.discPosition), v.projectPositionToCanvas(e, this.player.camera, e), this.click(e.x, e.y)) : y.warn("Automation -> clickMattertagObject: \u627e\u4e0d\u5230Mattertag.")
          }
        }(),
        _ = function(e) {
          var t = new c.Vector3;
          return function(e) {
            var i = this.player.getDirection(),
              n = 0,
              r = 0;
            if (this.player.mode === d.PANORAMA) {
              n = f.insideLookLimitUp, r = f.insideLookLimitDown
            } else {
              if (this.player.mode !== d.DOLLHOUSE) {
                return e
              };
              n = f.dollhouseDefault.maxPolarAngle, r = f.dollhouseDefault.minPolarAngle
            };
            t.copy(i), t.y = 0, t.normalize();
            var o = -c.Math.radToDeg(t.angleTo(i));
            return r -= o, n -= o, e > n && (e = n), r > e && (e = r), e
          }
        }();
      g.setReceiver(h);
      var x = {};
      b = {
          handleToObject: {},
          objectToHandle: {},
          handleCount: 0,
          director: null,
          player: null,
          waitForInit: function(e) {
            var t = x.onInitComplete;
            t && t.completed ? l(e) : x.onInitComplete = e
          },
          init: function(e, t) {
            this.director = e, this.player = t;
            var i = x.onInitComplete;
            i ? l(i) : x.onInitComplete = {
              completed: !0
            }
          },
          findRankedPano: function(e, t) {
            var i = new c.Vector3,
              r = new c.Vector3;
            return function(e, t) {
              s(this.player, r), n(t, r, i);
              var o = this.player.rankedPanoInDirection(e, i);
              if (o) {
                var a = this.objectToHandle[o.id];
                return a || (this.objectToHandle[o.id] = a = this.handleCount++, this.handleToObject[a] = o), a
              };
              return y.warn("Automation -> findRankedPano: Unable to find nearby pano."), -1
            }
          }(),
          findRankedMattertag: function(e, t) {
            var i = new c.Vector3,
              r = new c.Vector3;
            return function(e, t) {
              s(this.player, r), n(t, r, i);
              var o = this.player.rankedMattertagInDirection(e, i);
              if (o) {
                var a = this.objectToHandle[o.sid];
                return a || (this.objectToHandle[o.sid] = a = this.handleCount++, this.handleToObject[a] = o), a
              };
              return y.warn("Automation -> findRankedMattertag: \u627e\u4e0d\u5230\u6700\u8fd1\u7684Mattertag."), -1
            }
          }(),
          clickNearestMattertag: function(e) {
            this.clickRankedMattertag(0, e)
          },
          clickRankedMattertag: function(e, t) {
            var i = a.call(this, e, t);
            i && w.call(this, i)
          },
          clickNearestPano: function(e, t) {
            this.clickRankedPano(0, e, t)
          },
          clickRankedPano: function(e, t, i) {
            var n = o.call(this, e, t);
            n ? r.call(this, n, i) : i(null)
          },
          clickPano: function(e, t) {
            var i = this.handleTable[e];
            i ? r.call(this, i, t) : t(null)
          },
          rotate: function() {
            function e(e) {
              return "right" === e ? p.RIGHTARROW : "left" === e ? p.LEFTARROW : "up" === e ? p.I : "down" === e ? p.K : void(0)
            }
            var t = (new c.Vector3, new c.Vector3),
              i = new c.Vector3(0, 0, 0),
              n = !1,
              r = new c.Vector3;
            return function(o, a, s) {
              if (!n) {
                if (!a || isNaN(a)) {
                  return y.warn("Automation -> rotate: \u65cb\u8f6c\u89d2\u5ea6\u65e0\u6548."), void((s && s({
                    success: !1,
                    error: "\u65cb\u8f6c\u89d2\u5ea6\u65e0\u6548."
                  })))
                };
                "right" === o || "left" === o ? (i["set"](0, 1, 0), "right" === o && (a = -a)) : "up" === o || "down" === o ? (i["set"](1, 0, 0), "down" === o && (a = -a), a = _.call(this, a)) : (y.warn("Automation -> rotate: \u65cb\u8f6c\u65b9\u5411\u65e0\u6548: " + o), s && s({
                  success: !1,
                  error: "\u65cb\u8f6c\u65b9\u5411\u65e0\u6548."
                })), a = c.Math.degToRad(a), t = this.player.getDirection(), n = !0;
                var h = this.player.controls[this.player.mode];
                h.handleKeyDown(e(o));
                var l = 0;
                (function u() {
                  r.copy(m.FORWARD), this.player.getDirection(r);
                  var i = r.angleTo(t);
                  l += Math.abs(i), l >= Math.abs(a) ? (n = !1, h.handleKeyUp(e(o)), s && s({
                    success: !0,
                    message: "\u65cb\u8f6c\u5b8c\u6210."
                  })) : (t.copy(r), window.setTimeout(u.bind(this), 4))
                }).bind(this)()
              }
            }
          }(),
          click: function(e, t, i) {
            i === !0 && (e = e / 100 * window.innerWidth, t = t / 100 * window.innerHeight), this.player.handleTouchStart(e, t), this.player.updateIntersect(), this.player.handleTouchEnd(e, t)
          },
          mouseOver: function(e, t, i) {
            i === !0 && (e = e / 100 * window.innerWidth, t = t / 100 * window.innerHeight), this.player.handleTouchMove(e, t), this.player.updateIntersect()
          }
        },
        function() {
          t.exports = b, window.__showcaseAutomationApi = b
        }()
    }).call(this, "/js/automation.js")
  }

  function _$af269155(e, t, i) {
    "use strict";

    function n(e) {
      r.PerspectiveCamera.call(this, a.dollhouseFOV, window.innerWidth / window.innerHeight, 1, 500), this.parent = e, this.controls = null
    }
    var r = e("three"),
      o = e("../enum/Viewmode"),
      a = e("../settings");
    n.prototype = Object.create(r.PerspectiveCamera.prototype), n.prototype["set"] = function(e) {
      if (this.controls.target.copy(this.parent.target), this.controls.target.y = 0, this.parent.mode === o.PANORAMA) {
        this.position["set"](0, 6, 0).add(this.parent.position).add(this.parent.getDirection().multiplyScalar(-10))
      } else {
        if (this.parent.mode === o.FLOORPLAN) {
          var t = new r.Vector3(0, -1, 0).applyQuaternion(this.parent.quaternion);
          this.position.copy(this.parent.position).add(t.multiplyScalar(6)), this.position.y = 6
        }
      };
      this.controls.update()
    }, t.exports = n
  }

  function _$af269158(e, t, i) {
    "use strict";

    function n(e) {
      r.OrthographicCamera.call(this, -o.orthoBase, o.orthoBase, o.orthoBase / (window.innerWidth / window.innerHeight), -o.orthoBase / (window.innerWidth / window.innerHeight), 1, 500), this.parent = e, this.controls = null
    }
    var r = e("three"),
      o = (e("../util/transitions"), e("../util/easing"), e("../util/lerp"), e("../settings"));
    n.prototype = Object.create(r.OrthographicCamera.prototype), n.prototype["set"] = function(e) {
      var t = this.parent.model;
      this.controls.target["set"](t.center.x, 0, t.center.z), this.position["set"](t.center.x, 10, t.center.z);
      var i = Math.max(t.size.x, t.size.z),
        n = Math.min(t.size.x, t.size.z);
      this.controls.zoomToContain(Math.max(i, n * o.aspect));
      var r;
      t.size.x < t.size.z ? (r = Math.PI / 2, this.parent.getDirection().x < 0 && (r += Math.PI)) : (r = 0, this.parent.getDirection().z > 0 && (r += Math.PI)), this.controls.rotateLeft(r), this.controls.update()
    }, t.exports = n
  }

  function _$af269161(e, t, i) {
    "use strict";

    function n(e) {
      r.PerspectiveCamera.call(this, o.insideFOV, window.innerWidth / window.innerHeight, 0.1, 500), this.parent = e, this.controls = null
    } {
      var r = e("three"),
        o = e("../settings");
      e("../util/transitions"), e("../util/lerp")
    }
    n.prototype = Object.create(r.PerspectiveCamera.prototype), n.prototype["set"] = function(e, t) {
      this.parent.model.setProjectedPanos(e, e), this.parent.currentPano = e, this.parent.emit("pano.chosen", e, e), this.position.copy(e.position);
      var i;
      t ? i = new r.Vector3(0, 0, -1).applyQuaternion(t) : (i = this.parent.getDirection(), i.y = 0, i.normalize());
      var n = i.add(e.position);
      this.controls.reset(), this.controls.lookAt(n), this.controls.update(0, !0)
    }, t.exports = n
  }

  function _$af269164(e, t, i) {
    "use strict";

    function n(e, t, i, n, r) {
      a.call(this, e, t, i, n, r), this.minPolarAngle = o.dollhouseDefault.minPolarAngle, this.maxPolarAngle = o.dollhouseDefault.maxPolarAngle, this.defaultMinDistance = this.adjustedMinDistance(), this.defaultMaxDistance = this.adjustedMaxDistance(), this.minDistance = this.defaultMinDistance, this.maxDistance = this.defaultMinDistance
    }
    var r = e("three"),
      o = e("../settings"),
      a = e("./OutsideControls");
    n.prototype = Object.create(a.prototype), t.exports = n, n.prototype.setModel = function(e) {
      a.prototype.setModel.call(this, e), this.defaultMinDistance = this.adjustedMinDistance(), this.defaultMaxDistance = this.adjustedMaxDistance(), this.resetRanges()
    }, n.prototype.adjustedMinDistance = function() {
      if (void(0) === this.model) {
        return o.dollhouseDefault.minDistance
      };
      var e = this.model.boundingBox.max,
        t = this.model.boundingBox.min,
        i = t.distanceTo(e);
      return Math.min(i / 2, o.dollhouseDefault.minDistance)
    }, n.prototype.adjustedMaxDistance = function() {
      if (void(0) === this.model) {
        return o.dollhouseDefault.maxDistance
      };
      var e = this.model.boundingBox.max,
        t = this.model.boundingBox.min,
        i = t.distanceTo(e);
      return Math.max(i, o.dollhouseDefault.maxDistance)
    }, n.prototype.resetRanges = function(e, t) {
      var i = e || this.adjustedMinDistance();
      i = Math.min(i, this.defaultMinDistance), this.minDistance = i, i = Math.max(this.adjustedMaxDistance(), this.defaultMaxDistance), this.maxDistance = i;
      var n = t || !1;
      n ? (this.minPolarAngle = r.Math.degToRad(-15), this.maxPolarAngle = r.Math.degToRad(89.9)) : (this.minPolarAngle = o.dollhouseDefault.minPolarAngle, this.maxPolarAngle = o.dollhouseDefault.maxPolarAngle)
    }, n.prototype.calculateMaxDistance = function(e) {
      var t = this.object,
        i = e.boundingBox.max,
        n = e.boundingBox.min,
        r = Math.max(i.x - n.x, i.z - n.z) / 2,
        o = (i.y - n.y) / 2,
        a = r / Math.tan(t.fov / 2 * t.aspect * (Math.PI / 180));
      a += Math.min(i.x - n.x, i.z - n.z) / 2;
      var s = o / Math.tan(t.fov / 2 * (Math.PI / 180));
      return 1.1 * Math.min(Math.max(a, s, 25), this.scene.skybox.geometry.boundingSphere.radius)
    }
  }

  function _$af269171(e, t, i) {
    "use strict";

    function n(e, t, i, n, o) {
      r.call(this, e, t, i, n, o), this.minDistance = 15, this.maxDistance = 50, this.noRotateUpDown = !0, this.minPolarAngle = 0, this.maxPolarAngle = 0
    }
    var r = (e("three"), e("../settings"), e("./OutsideControls"));
    n.prototype = Object.create(r.prototype), t.exports = n
  }

  function _$af269173(e, t, i) {
    "use strict";

    function n(e, t, i, o, a) {
      this.player = e, this.model = a, this.object = t, this.object.controls = this, this.scene = o, this.domElement = void(0) !== i ? i : document, this.enabled = !0, this.target = new r.Vector3, this.noZoom = !1, this.zoomSpeed = 1, this.minDistance = 0, this.maxDistance = 1 / 0, this.noRotate = !1, this.noRotateUpDown = !1, this.rotateSpeed = 1, this.keyboardZoomSpeed = 0, this.noPan = !1, this.keyPanSpeed = 7, this.autoRotate = !1, this.autoRotateSpeed = 2, this.minPolarAngle = r.Math.degToRad(25), this.maxPolarAngle = r.Math.degToRad(65), this.noKeys = !1, this.rotationAcceleration = new r.Vector2, this.rotationSpeed = new r.Vector2, this.panAcceleration = new r.Vector2, this.panSpeed = new r.Vector2, this.rotateStart = new r.Vector2, this.rotateEnd = new r.Vector2, this.rotateDelta = new r.Vector2, this.panStart = new r.Vector2, this.panEnd = new r.Vector2, this.panDelta = new r.Vector2, this.panOffset = new r.Vector3, this.offset = new r.Vector3, this.dollyStart = new r.Vector2, this.dollyEnd = new r.Vector2, this.dollyDelta = new r.Vector2, this.phiDelta = 0, this.thetaDelta = 0, this.scale = 1, this.panVector = new r.Vector3, this.lastPosition = new r.Vector3, this.state = c.NONE, this.target0 = this.target.clone(), this.position0 = this.object.position.clone(), this.lastMoveTime = 0, this.pointersLimit = 2, this.pointers = [], this.absoluteScale = 1, this.currentScale = 1, this.originalTop = this.object.top, this.originalBottom = this.object.bottom, this.originalLeft = this.object.left, this.originalRight = this.object.right, this.on("touch-one-finger-start", n.touch.rotate.start), this.on("touch-one-finger-move", n.touch.rotate.move), this.on("touch-two-finger-start", n.touch.pan.start), this.on("touch-two-finger-move", n.touch.pan.move), this.on("touch-two-finger-start", n.touch.zoom.start), this.on("touch-two-finger-move", n.touch.zoom.move)
    }
    var r = e("three"),
      o = e("../settings"),
      a = e("../util/common"),
      s = (e("../enum/Vectors"), e("../enum/Keys")),
      h = e("events").EventEmitter,
      l = 1e-6,
      c = {
        NONE: -1,
        ROTATE: 0,
        DOLLY: 1,
        PAN: 2,
        TOUCH_ROTATE: 3,
        TOUCH_DOLLY_PAN: 4
      };
    n.prototype = Object.create(h.prototype), n.prototype.setModel = function(e) {
      this.model = e
    }, n.prototype.bindEvents = function() {
      this.domElement.addEventListener("contextmenu", function(e) {
        e.preventDefault()
      }), this.domElement.addEventListener("mousedown", this.onMouseDown.bind(this)), this.domElement.addEventListener("mousemove", this.onMouseMove.bind(this)), this.domElement.addEventListener("mouseup", this.onMouseUp.bind(this)), this.domElement.addEventListener("mouseover", function(e) {
        (0 === e.which || 0 === e.buttons) && this.onMouseUp(e)
      }.bind(this)), o.useWheel && (this.domElement.addEventListener("mousewheel", this.onMouseWheel.bind(this)), this.domElement.addEventListener("DOMMouseScroll", this.onMouseWheel.bind(this))), this.domElement.addEventListener("touchstart", this.touchstart.bind(this)), this.domElement.addEventListener("touchend", this.touchend.bind(this)), this.domElement.addEventListener("touchmove", this.touchmove.bind(this)), this.domElement.addEventListener("pointerdown", this.pointerdown.bind(this)), this.domElement.addEventListener("pointerup", this.pointerup.bind(this)), this.domElement.addEventListener("pointerout", this.pointerup.bind(this)), this.domElement.addEventListener("pointercancel", this.pointerup.bind(this)), this.domElement.addEventListener("pointermove", this.pointermove.bind(this)), document.addEventListener("keydown", this.onKeyDown.bind(this)), document.addEventListener("keyup", this.onKeyUp.bind(this))
    }, n.prototype.rotateLeft = function(e) {
      void(0) === e && (e = this.getAutoRotationAngle()), this.thetaDelta -= e
    }, n.prototype.rotateUp = function(e) {
      this.noRotateUpDown || (void(0) === e && (e = this.getAutoRotationAngle()), this.phiDelta -= e)
    }, n.prototype.panLeft = function(e) {
      var t = this.object.matrix.elements;
      this.panOffset["set"](t[0], 0, t[2]).normalize(), this.panOffset.multiplyScalar(-e), this.panVector.add(this.panOffset)
    }, n.prototype.panUp = function(e) {
      var t = this.object.matrix.elements;
      this.panOffset["set"](t[4], 0, t[6]).normalize(), this.panOffset.multiplyScalar(-e), this.panVector.add(this.panOffset)
    }, n.prototype.pan = function(e, t) {
      var i = this.domElement === document ? this.domElement.body : this.domElement;
      if (this.object.updateMatrix(), void(0) !== this.object.fov) {
        var n = this.object.position,
          r = n.clone().sub(this.target),
          o = r.length();
        o *= Math.tan(this.object.fov / 2 * Math.PI / 180), this.panLeft(2 * e * o / i.clientHeight), this.panUp(-2 * t * o / i.clientHeight)
      } else {
        void(0) !== this.object.top ? (this.panLeft(e * (this.object.right - this.object.left) / i.clientWidth), this.panUp(-t * (this.object.top - this.object.bottom) / i.clientHeight)) : console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")
      }
    }, n.prototype.dollyIn = function(e) {
      void(0) === e && (e = this.getZoomScale()), this.scale /= e
    }, n.prototype.dollyOut = function(e) {
      void(0) === e && (e = this.getZoomScale()), this.scale *= e
    }, n.prototype.update = function(e) {
      this.rotationSpeed.x = this.rotationSpeed.x * (1 - o.rotationFriction) + this.rotationAcceleration.x * o.rotationAccelerationOutside / 1e3, this.rotationSpeed.y = this.rotationSpeed.y * (1 - o.rotationFriction) + this.rotationAcceleration.y * o.rotationAccelerationOutside / 1e3, this.rotateLeft(-this.rotationSpeed.x), this.noRotateUpDown || this.rotateUp(this.rotationSpeed.y), this.panSpeed.x = this.panSpeed.x * (1 - o.panFriction) + this.panAcceleration.x * o.panAccelerationOutside, this.panSpeed.y = this.panSpeed.y * (1 - o.panFriction) + this.panAcceleration.y * o.panAccelerationOutside, this.pan(-this.panSpeed.x, this.panSpeed.y);
      var t = this.object.position;
      this.offset.copy(t).sub(this.target);
      var i = Math.atan2(this.offset.x, this.offset.z),
        n = Math.atan2(Math.sqrt(this.offset.x * this.offset.x + this.offset.z * this.offset.z), this.offset.y);
      this.autoRotate && this.rotateLeft(this.getAutoRotationAngle()), i += this.thetaDelta, n += this.phiDelta, n = Math.max(this.minPolarAngle, Math.min(this.maxPolarAngle, n)), n = Math.max(l, Math.min(Math.PI - l, n));
      var r = this.offset.length();
      this.object.top ? (this.absoluteScale *= this.scale - 0.03 * this.keyboardZoomSpeed, this.absoluteScale = Math.max(o.zoomNearLimit, Math.min(this.absoluteScale, o.zoomFarLimit)), this.currentScale = 0.8 * this.currentScale + 0.2 * this.absoluteScale, this.object.left = -o.orthoBase * this.currentScale, this.object.right = o.orthoBase * this.currentScale, this.object.top = o.orthoBase * this.currentScale / o.aspect, this.object.bottom = -o.orthoBase * this.currentScale / o.aspect, this.object.updateProjectionMatrix()) : r *= this.scale, r = Math.max(this.minDistance, Math.min(this.maxDistance, r)), this.target.add(this.panVector), this.model.boundingBoxWithPadding.clampPoint(this.target, this.target), this.offset.x = r * Math.sin(n) * Math.sin(i), this.offset.y = r * Math.cos(n), this.offset.z = r * Math.sin(n) * Math.cos(i), t.copy(this.target).add(this.offset), this.object.lookAt(this.target);
      g_DirectionalLight.position.copy(t);
      g_DirectionalLight.target.position.copy(this.target);
      this.thetaDelta = 0, this.phiDelta = 0, this.scale = 1, this.panVector["set"](0, 0, 0), this.lastPosition.distanceTo(this.object.position) > 0 && this.lastPosition.copy(this.object.position)
    }, n.prototype.zoomToContain = function(e) {
      this.absoluteScale = e / 2 / o.orthoBase * 1.2, this.currentScale = this.absoluteScale
    }, n.prototype.getAutoRotationAngle = function() {
      return 2 * Math.PI / 60 / 60 * this.autoRotateSpeed
    }, n.prototype.getZoomScale = function() {
      return Math.pow(0.95, this.zoomSpeed)
    }, n.prototype.onMouseDown = function(e) {
      this.enabled !== !1 && (e.preventDefault(), this.player.director.nav(function() {
        if (this.mouseDown = !0, 2 === e.button) {
          if (this.noRotate === !0) {
            return
          };
          this.state = c.ROTATE, this.rotateStart["set"](e.clientX, this.noRotateUpDown ? 0 : e.clientY), this.rotationSpeed["set"](0, 0)
        } else {
          if (1 === e.button) {
            if (this.noZoom === !0) {
              return
            };
            this.state = c.DOLLY, this.dollyStart["set"](e.clientX, e.clientY)
          } else {
            if (0 === e.button) {
              if (this.noPan === !0) {
                return
              };
              this.state = c.PAN, this.panStart["set"](e.clientX, e.clientY)
            }
          }
        }
      }.bind(this)))
    }, n.prototype.onMouseMove = function(e) {
      if (this.enabled !== !1 && this.mouseDown && 0 !== e.buttons) {
        this.emit("move", "mouse"), e.preventDefault();
        var t = this.domElement === document ? this.domElement.body : this.domElement;
        if (this.state === c.ROTATE) {
          if (this.noRotate === !0) {
            return
          };
          this.rotateEnd["set"](e.clientX, this.noRotateUpDown ? 0 : e.clientY), this.rotateDelta.subVectors(this.rotateEnd, this.rotateStart), this.rotateLeft(2 * Math.PI * this.rotateDelta.x / t.clientWidth * this.rotateSpeed), this.rotateUp(2 * Math.PI * this.rotateDelta.y / t.clientHeight * this.rotateSpeed), this.rotateStart.copy(this.rotateEnd)
        } else {
          if (this.state === c.DOLLY) {
            if (this.noZoom === !0) {
              return
            };
            this.dollyEnd["set"](e.clientX, e.clientY), this.dollyDelta.subVectors(this.dollyEnd, this.dollyStart), this.dollyDelta.y > 0 ? this.dollyIn() : this.dollyOut(), this.dollyStart.copy(this.dollyEnd)
          } else {
            if (this.state === c.PAN) {
              if (this.noPan === !0) {
                return
              };
              this.panEnd["set"](e.clientX, e.clientY), this.panDelta.subVectors(this.panEnd, this.panStart), this.pan(this.panDelta.x, this.panDelta.y), this.panStart.copy(this.panEnd)
            }
          }
        };
        this.lastMoveTime = e.timeStamp, this.update()
      }
    }, n.prototype.onMouseUp = function(e) {
      this.enabled !== !1 && (this.mouseDown = !1, this.state = c.NONE, "mouseover" !== e.type && (e.timeStamp > this.lastMoveTime + 100 ? (this.rotationSpeed["set"](0, 0), this.rotationAcceleration["set"](0, 0)) : this.rotationAcceleration["set"](-this.rotateDelta.x, this.rotateDelta.y), this.update(), this.rotationAcceleration["set"](0, 0), this.rotateDelta["set"](0, 0)))
    }, n.prototype.onMouseWheel = function(e) {
      if (this.enabled !== !1 && this.noZoom !== !0 && o.useWheel) {
        this.emit("move", "wheel"), $("#debug-console").is(":visible") || e.preventDefault();
        var t = 0;
        void(0) !== e.wheelDelta ? t = e.wheelDelta : void(0) !== e.detail && (t = -e.detail), this.player.director.nav(t > 0 ? function() {
          this.dollyOut()
        }.bind(this) : function() {
          this.dollyIn()
        }.bind(this)), this.update()
      }
    }, n.prototype.onKeyDown = function(e) {
      this.enabled !== !1 && this.noKeys !== !0 && this.noPan !== !0 && (e.metaKey || e.ctrlKey || (e.preventDefault(), this.handleKeyDown(e.which)))
    }, n.prototype.handleKeyDown = function(e) {
      var t = this.player.director,
        i = function(e, i) {
          t.nav(function() {
            "y" === e ? this.noRotateUpDown ? this.keyboardZoomSpeed = i : this.rotationAcceleration.y = i : this.rotationAcceleration.x = i
          }.bind(this))
        }.bind(this),
        n = function(e, i) {
          t.nav(function() {
            this.panAcceleration[e] = i
          }.bind(this))
        }.bind(this),
        r = !0;
      switch (e) {
        case s.F:
          t.changeFloor(-1);
          break;
        case s.R:
          t.changeFloor(1);
          break;
        case s.UPARROW:
          ;
        case s.I:
          i("y", 1);
          break;
        case s.DOWNARROW:
          ;
        case s.K:
          i("y", -1);
          break;
        case s.LEFTARROW:
          ;
        case s.J:
          i("x", -1);
          break;
        case s.RIGHTARROW:
          ;
        case s.L:
          i("x", 1);
          break;
        case s.W:
          n("y", 1);
          break;
        case s.S:
          n("y", -1);
          break;
        case s.A:
          n("x", -1);
          break;
        case s.D:
          n("x", 1);
          break;
        default:
          r = !1
      };
      r === !0 && this.emit("move", "key")
    }, n.prototype.onKeyUp = function(e) {
      this.enabled !== !1 && this.noKeys !== !0 && this.noPan !== !0 && (e.preventDefault(), e.stopPropagation(), this.handleKeyUp(e.which))
    }, n.prototype.handleKeyUp = function(e) {
      switch (e) {
        case s.I:
          ;
        case s.K:
          ;
        case s.UPARROW:
          ;
        case s.DOWNARROW:
          this.keyboardZoomSpeed = 0, this.rotationAcceleration.y = 0;
          break;
        case s.J:
          ;
        case s.L:
          ;
        case s.LEFTARROW:
          ;
        case s.RIGHTARROW:
          this.rotationAcceleration.x = 0;
          break;
        case s.S:
          ;
        case s.W:
          this.panAcceleration.y = 0;
          break;
        case s.A:
          ;
        case s.D:
          this.panAcceleration.x = 0
      }
    }, n.prototype.touchstart = function(e) {
      if (g_bgaudio) {
        document.getElementById("bgaudio").play()
      };
      if (this.enabled !== !1) {
        e.preventDefault();
        e.stopPropagation();
        this.player.director.nav(function() {
          switch (e.touches.length) {
            case 1:
              this.emit("touch-one-finger-start", e);
              break;
            case 2:
              this.emit("touch-two-finger-start", e);
              break;
            default:
              this.state = c.NONE
          };
          this.rotationSpeed["set"](0, 0)
        }.bind(this))
      }
    }, n.prototype.touchmove = function(e) {
      if (this.enabled !== !1) {
        switch (e.preventDefault(), e.stopPropagation(), e.touches.length) {
          case 1:
            this.emit("touch-one-finger-move", e), this.update();
            break;
          case 2:
            this.emit("touch-two-finger-move", e), this.update();
            break;
          default:
            this.state = c.NONE
        };
        this.lastMoveTime = e.timeStamp
      }
    }, n.prototype.touchend = function(e) {
      this.enabled !== !1 && (this.emit("touch-one-finger-end", e), this.emit("touch-two-finger-end", e), this.state = c.NONE, e.timeStamp > this.lastMoveTime + 100 ? (this.rotationSpeed["set"](0, 0), this.rotationAcceleration["set"](0, 0)) : this.rotationAcceleration["set"](-this.rotateDelta.x, this.rotateDelta.y), this.update(), this.rotationAcceleration["set"](0, 0), this.rotateDelta["set"](0, 0))
    }, n.prototype.pointerdown = function(e) {
      this.enabled !== !1 && "touch" === e.pointerType && (this.pointers.length < this.pointersLimit && this.pointers.push({
        id: e.pointerId,
        pageX: e.pageX,
        pageY: e.pageY
      }), e.touches = this.pointers, this.touchstart(e))
    }, n.prototype.pointermove = function(e) {
      this.enabled !== !1 && "touch" === e.pointerType && (this.pointers.forEach(function(t) {
        e.pointerId === t.id && (t.pageX = e.pageX, t.pageY = e.pageY)
      }), e.touches = this.pointers, this.touchmove(e))
    }, n.prototype.pointerup = function(e) {
      this.enabled !== !1 && "touch" === e.pointerType && (this.pointers.forEach(function(t, i) {
        e.pointerId === t.id && this.pointers.splice(i, 1)
      }.bind(this)), e.touches = this.pointers, this.touchend(e))
    }, n.prototype.reset = function() {
      this.state = c.NONE, this.target.copy(this.target0), this.object.position.copy(this.position0), this.pointers = [], this.update()
    }, n.prototype.stop = function() {
      this.rotationSpeed["set"](0, 0), this.rotationAcceleration["set"](0, 0), this.panSpeed["set"](0, 0), this.panAcceleration["set"](0, 0)
    }, n.touch = {
      rotate: {
        start: function(e) {
          this.state = c.TOUCH_ROTATE, this.rotateStart["set"](e.touches[0].pageX, e.touches[0].pageY)
        },
        move: function(e) {
          if (this.state === c.TOUCH_ROTATE) {
            this.emit("move", "touch");
            var t = this.domElement === document ? this.domElement.body : this.domElement;
            this.rotateEnd["set"](e.touches[0].pageX, e.touches[0].pageY), this.rotateDelta.subVectors(this.rotateEnd, this.rotateStart), this.rotateLeft(2 * Math.PI * this.rotateDelta.x / t.clientWidth * this.rotateSpeed), this.rotateUp(2 * Math.PI * this.rotateDelta.y / t.clientHeight * this.rotateSpeed), this.rotateStart.copy(this.rotateEnd)
          }
        }
      },
      zoom: {
        start: function(e) {
          this.state = c.TOUCH_DOLLY_PAN;
          var t = e.touches[0].pageX - e.touches[1].pageX,
            i = e.touches[0].pageY - e.touches[1].pageY,
            n = Math.sqrt(t * t + i * i);
          this.dollyStart["set"](0, n)
        },
        move: function(e) {
          if (this.state === c.TOUCH_DOLLY_PAN) {
            this.emit("move", "touch");
            var t = e.touches[0].pageX - e.touches[1].pageX,
              i = e.touches[0].pageY - e.touches[1].pageY,
              n = Math.sqrt(t * t + i * i);
            this.dollyEnd["set"](0, n), this.dollyDelta.subVectors(this.dollyEnd, this.dollyStart), this.dollyDelta.y > 0 ? this.dollyOut(1 - this.dollyDelta.y / 500) : this.dollyIn(1 + this.dollyDelta.y / 500), this.dollyStart.copy(this.dollyEnd)
          }
        }
      },
      pan: {
        start: function(e) {
          this.state = c.TOUCH_DOLLY_PAN, this.panStart["set"](a.average(e.touches, "pageX"), a.average(e.touches, "pageY"))
        },
        move: function(e) {
          this.state === c.TOUCH_DOLLY_PAN && (this.emit("move", "touch"), this.panEnd["set"](a.average(e.touches, "pageX"), a.average(e.touches, "pageY")), this.panDelta.subVectors(this.panEnd, this.panStart), this.pan(this.panDelta.x, this.panDelta.y), this.panStart.copy(this.panEnd), this.rotateDelta["set"](0, 0))
        }
      }
    }, t.exports = n
  }

  function _$af269222(e, t, i) {
    (function(i) {
      "use strict";

      function n(e, t, i, n) {
        this.player = e, this.scene = n, this.object = t, this.object.controls = this, this.target = new r.Vector3(0, 0, 0), this.aimFrom = this.object.position, this.lookVector = new r.Vector3, this.domElement = void(0) !== i ? i : document.documentElement, this.lookSpeed = 0.05, this.rotationAcc = new r.Vector2, this.rotationSpeed = new r.Vector2, this.lat = 0, this.lon = 0, this.phi = 0, this.theta = 0, this.enabled = !0, this.pointer = new r.Vector3(0, 0, -1), this.rotationHistory = [], this.rotationDifference = new r.Vector2, this.pointerDragOn = !1, this.pointerDragStart = new r.Vector3(0, 0, -1), this.pinchDistance = 0, this.moveStart = new r.Vector2, this.moveTolerance = 0.01, this.pointersLimit = 2, this.pointers = [], this.domElement !== document && this.domElement.setAttribute("tabindex", -1)
      } {
        var r = e("three"),
          o = e("../util/logger"),
          a = e("../settings"),
          s = e("../util/common"),
          h = e("../enum/Vectors"),
          l = e("../enum/Keys"),
          c = e("../enum/Joystick"),
          u = e("events").EventEmitter;
        new o(i)
      }
      n.prototype = Object.create(u.prototype), n.prototype.bindEvents = function() {
        this.domElement.addEventListener("mousemove", this.onMouseMove.bind(this)), this.domElement.addEventListener("mousedown", this.onMouseDown.bind(this)), this.domElement.addEventListener("mouseup", this.onMouseUp.bind(this)), this.domElement.addEventListener("mouseover", function(e) {
          !this.pointerDragOn || 0 !== e.which && 0 !== e.buttons || this.onMouseUp(e)
        }.bind(this)), this.domElement.addEventListener("touchstart", this.onTouchStart.bind(this)), this.domElement.addEventListener("touchmove", this.onTouchMove.bind(this)), this.domElement.addEventListener("touchend", this.onTouchEnd.bind(this)), a.useWheel && (this.domElement.addEventListener("mousewheel", this.onMouseWheel.bind(this)), this.domElement.addEventListener("DOMMouseScroll", this.onMouseWheel.bind(this))), this.domElement.addEventListener("contextmenu", function(e) {
          e.preventDefault()
        }), this.domElement.addEventListener("pointerdown", this.onPointerDown.bind(this)), this.domElement.addEventListener("pointerup", this.onPointerUp.bind(this)), this.domElement.addEventListener("pointerout", this.onPointerUp.bind(this)), this.domElement.addEventListener("pointercancel", this.onPointerUp.bind(this)), this.domElement.addEventListener("pointermove", this.onPointerMove.bind(this)), document.addEventListener("keydown", this.onKeyDown.bind(this)), document.addEventListener("keyup", this.onKeyUp.bind(this))
      }, n.prototype.lookAt = function(e) {
        var t = this.object.position.clone().sub(e),
          i = Math.atan(t.z / t.x);
        i += t.x < 0 ? Math.PI : 0, i += t.x > 0 && t.z < 0 ? 2 * Math.PI : 0, this.lon = r.Math.radToDeg(i) + 180;
        var n = Math.sqrt(t.x * t.x + t.z * t.z),
          o = Math.atan(t.y / n);
        this.lat = -r.Math.radToDeg(o)
      }, n.prototype.startRotationFrom = function(e, t) {
        this.domElement !== document && this.domElement.focus(), this.updatePointer(e, t), this.pointerDragOn = !0, this.pointerDragStart.copy(this.pointer), this.moveStart.copy(this.pointer), this.pointerDragStartIntersect = this.player.getMouseIntersect(this.pointer.clone(), [this.scene.skybox]).point, this.rotationHistory = [], this.rotationSpeed["set"](0, 0)
      }, n.prototype.onTouchStart = function(e) {
        this.enabled && (e.preventDefault(), e.stopPropagation(), this.player.director.nav(function() {
          switch (e.touches.length) {
            case 1:
              this.startRotationFrom(e.touches[0].clientX, e.touches[0].clientY);
              break;
            case 2:
              var t = (e.touches[0].clientX - e.touches[1].clientX) / window.innerWidth,
                i = (e.touches[0].clientY - e.touches[1].clientY) / window.innerHeight;
              this.pinchDistance = Math.sqrt(t * t + i * i)
          }
        }.bind(this)))
      }, n.prototype.onPointerDown = function(e) {
        this.enabled && "touch" === e.pointerType && (this.pointers.length < this.pointersLimit && this.pointers.push({
          id: e.pointerId,
          clientX: e.clientX,
          clientY: e.clientY
        }), e.touches = this.pointers, this.onTouchStart(e))
      }, n.prototype.onMouseDown = function(e) {
        this.enabled && (e.preventDefault(), e.stopPropagation(), this.player.director.nav(function() {
          switch (e.button) {
            case 0:
              this.startRotationFrom(e.clientX, e.clientY);
              break;
            case 2:
          }
        }.bind(this)))
      }, n.prototype.updateRotation = function() {
        if (this.enabled && this.pointerDragOn) {
          var e = this.player.getMouseIntersect(this.pointerDragStart.clone(), [this.scene.skybox]).point.sub(this.player.position),
            t = this.player.getMouseIntersect(this.pointer.clone(), [this.scene.skybox]).point.sub(this.player.position),
            i = Math.sqrt(e.x * e.x + e.z * e.z),
            n = Math.sqrt(t.x * t.x + t.z * t.z),
            o = Math.atan2(e.y, i),
            a = Math.atan2(t.y, n);
          this.rotationDifference.y = r.Math.radToDeg(o - a), e.y = 0, t.y = 0;
          var s = Math.acos(e.dot(t) / e.length() / t.length());
          isNaN(s) || (this.rotationDifference.x = r.Math.radToDeg(s), this.pointerDragStart.x < this.pointer.x && (this.rotationDifference.x *= -1)), this.pointerDragStart.copy(this.pointer)
        }
      }, n.prototype.selectText = function(x, y) {
        function showText(text) {
          var configuratorWindow = document.getElementById("configuratorWindow");
          var dialogText = document.getElementById("dialogText");
          dialogText.innerText = text;
          configuratorWindow.style.top = y + "px";
          configuratorWindow.style.left = x + "px";
          configuratorWindow.style.display = "block";
          configuratorWindow.style.cursor = "pointer"
        }
        var vector = new r.Vector3(this.player.mouse.x, this.player.mouse.y, this.player.mouse.z);
        var raycaster = new r.Raycaster();
        vector.unproject(this.player.camera);
        raycaster["set"](this.player.camera.position, vector.sub(this.player.camera.position).normalize());
        if (g_TextIconMesh.length > 0) {
          var intersects = raycaster.intersectObjects(g_TextIconMesh);
          if (intersects.length > 0) {
            g_SelectTextIndex = intersects[0].object.groupIndex;
            showText(g_Text["Text" + g_SelectTextIndex].floatText);
            return
          } else {
            if (g_SelectTextIndex != null) {
              document.getElementById("configuratorWindow").style.display = "none"
            }
          }
        }
      }, n.prototype.onMouseMove = function(e) {
        this.enabled && (this.selectText(e.clientX, e.clientY), this.updatePointer(e.clientX, e.clientY), this.pointerDragOn && (Math.abs(this.pointer.x - this.moveStart.x) > this.moveTolerance || Math.abs(this.pointer.y - this.moveStart.y) > this.moveTolerance) && this.emit("move", "mouse"))
      }, n.prototype.onTouchMove = function(e) {
        if (this.enabled) {
          this.selectText(e.touches[0].clientX, e.touches[0].clientY);
          switch (this.emit("move", "touch"), e.touches.length) {
            case 1:
              this.updatePointer(e.touches[0].clientX, e.touches[0].clientY);
              break;
            case 2:
              var t = (e.touches[0].clientX - e.touches[1].clientX) / window.innerWidth,
                i = (e.touches[0].clientY - e.touches[1].clientY) / window.innerHeight,
                n = this.pinchDistance - Math.sqrt(t * t + i * i);
              Math.abs(n) > 0.1 && (this.emit("interaction.direct"), this.player.director.history.invalidate(), this.flyDirection(new r.Vector3(0, 0, n).normalize()), this.pinchDistance -= n)
          }
        }
      }, n.prototype.onPointerMove = function(e) {
        this.enabled && "touch" === e.pointerType && (this.pointers.forEach(function(t) {
          e.pointerId === t.id && (t.clientX = e.clientX, t.clientY = e.clientY)
        }), e.touches = this.pointers, this.onTouchMove(e))
      }, n.prototype.updatePointer = function(e, t) {
        this.pointer.x = e / window.innerWidth * 2 - 1, this.pointer.y = 2 * -(t / window.innerHeight) + 1
      }, n.prototype.endRotation = function() {
        if (this.pointerDragOn = !1, !this.player.flying) {
          var e = s.averageVectors(this.rotationHistory);
          this.rotationSpeed["set"](e.x * a.rotationAfterMoveMultiplier, e.y * a.rotationAfterMoveMultiplier)
        }
      }, n.prototype.onTouchEnd = function(e) {
        this.enabled && (e.preventDefault(), e.stopPropagation(), this.endRotation())
      }, n.prototype.onMouseUp = function(e) {
        this.enabled && (e.preventDefault(), e.stopPropagation(), this.endRotation())
      }, n.prototype.onPointerUp = function(e) {
        this.enabled && "touch" === e.pointerType && (this.pointers.forEach(function(t, i) {
          e.pointerId === t.id && this.pointers.splice(i, 1)
        }.bind(this)), e.touches = this.pointers, this.onTouchEnd(e))
      }, n.prototype.update = function(e, t) {
        if (this.enabled || t) {
          {
            this.lon, this.lat
          }
          for (this.updateRotation(), this.rotationHistory.push(this.rotationDifference.clone()); this.rotationHistory.length > a.rotationAfterMoveHistoryCount;) {
            this.rotationHistory.shift()
          };
          this.lon += this.rotationDifference.x, this.lat += this.rotationDifference.y, this.rotationDifference["set"](0, 0), this.rotationSpeed.x = this.rotationSpeed.x * (1 - a.rotationFriction) + this.rotationAcc.x * a.rotationAccelerationInside, this.rotationSpeed.y = this.rotationSpeed.y * (1 - a.rotationFriction) + this.rotationAcc.y * a.rotationAccelerationInside, this.lon += this.rotationSpeed.x * e, this.lat += this.rotationSpeed.y * e, this.lat = Math.max(a.insideLookLimitDown, Math.min(a.insideLookLimitUp, this.lat)), this.phi = r.Math.degToRad(90 - this.lat), this.theta = r.Math.degToRad(this.lon), this.lookVector.x = Math.sin(this.phi) * Math.cos(this.theta), this.lookVector.y = Math.cos(this.phi), this.lookVector.z = Math.sin(this.phi) * Math.sin(this.theta), this.target.copy(this.lookVector).add(this.aimFrom), this.object.lookAt(this.target)
        }
      }, n.prototype.onMouseWheel = function(e) {
        if (this.enabled && a.useWheel) {
          this.emit("move", "wheel"), $("#debug-console").is(":visible") || e.preventDefault();
          var t = 0;
          void(0) !== e.wheelDelta ? t = e.wheelDelta : void(0) !== e.detail && (t = -e.detail), this.emit("interaction.direct"), this.player.director.history.invalidate(), this.player.director.nav(function() {
            this.flyDirection(new r.Vector3(0, 0, -t).normalize())
          }.bind(this))
        }
      }, n.prototype.onKeyDown = function(e) {
        this.enabled && (e.metaKey || e.ctrlKey || (e.preventDefault(), this.handleKeyDown(e.which)))
      }, n.prototype.handleKeyDown = function(e) {
        var t = this.player.director,
          i = function(e) {
            t.history.invalidate(), t.nav(function() {
              this.flyDirection(e)
            }.bind(this))
          }.bind(this),
          n = function(e, i) {
            t.nav(function() {
              this.rotationAcc[e] = i
            }.bind(this))
          }.bind(this);
        this.emit("interaction.key");
        var r = !0;
        switch (e) {
          case l.F:
            t.changeFloor(c.DOWN);
            break;
          case l.R:
            t.changeFloor(c.UP);
            break;
          case l.UPARROW:
            ;
          case l.W:
            i(h.FORWARD);
            break;
          case l.DOWNARROW:
            ;
          case l.S:
            i(h.BACK);
            break;
          case l.A:
            i(h.LEFT);
            break;
          case l.D:
            i(h.RIGHT);
            break;
          case l.LEFTARROW:
            ;
          case l.J:
            n("x", -1);
            break;
          case l.RIGHTARROW:
            ;
          case l.L:
            n("x", 1);
            break;
          case l.I:
            n("y", 1);
            break;
          case l.K:
            n("y", -1);
            break;
          case l.T:
            a.debug && this.player.reticule.writeAsMattertag(), r = !1;
            break;
          default:
            r = !1
        };
        r === !0 && this.emit("move", "key")
      }, n.prototype.onKeyUp = function(e) {
        this.enabled && (e.preventDefault(), e.stopPropagation(), this.handleKeyUp(e.which))
      }, n.prototype.handleKeyUp = function(e) {
        switch (e) {
          case l.LEFTARROW:
            ;
          case l.J:
            ;
          case l.RIGHTARROW:
            ;
          case l.L:
            this.rotationAcc.x = 0;
            break;
          case l.I:
            ;
          case l.K:
            this.rotationAcc.y = 0
        }
      }, n.prototype.reset = function() {
        this.stop()
      }, n.prototype.stop = function() {
        this.pointerDragOn = !1, this.rotationAcc["set"](0, 0), this.rotationSpeed["set"](0, 0), this.pointers = []
      }, n.prototype.flyDirection = function(e) {
        if (!this.player.flying) {
          var t = e.clone();
          this.player.getDirection(t);
          var i = 1 === e.z ? 0.4 : 0.75,
            n = 1 === Math.abs(e.x);
          this.player.flyDirection(t, i, n)
        }
      }, t.exports = n
    }).call(this, "/js/controls/PanoramaControls.js")
  }

  function _$af269262(e, t, i) {
    (function(i) {
      "use strict";

      function n(e) {
        this.player = e, this.nItems = this.player.model.heroLocations.length, this.endlessLoop = a.warp.loop, this.clock = new r.Clock(!0), this.history = new d, this.resetAll()
      }
      var r = e("three"),
        o = e("./util/logger"),
        a = e("./settings"),
        s = e("./util/transitions"),
        h = e("events").EventEmitter,
        l = e("./enum/Viewmode"),
        c = e("./analytics"),
        u = e("./enum/WarpStyle"),
        s = e("./util/transitions"),
        d = e("./util/history"),
        p = new o(i);
      n.prototype = Object.create(h.prototype), n.prototype.resetAll = function() {
        this.currentItem = null, this.destinationItem = null, this.userCmd = !1, this.tourIsPlaying = !1, this.isWarping = !1, this.waiting = !1, this.pendingHalt = !1, this.nextFunc = null, this.onTheBus = !1, this.randomThumbnail = !1, this.reachSource = null;
        this.player && this.player.model ? this.defaultWarpStyle = this.player.model.data.hasOwnProperty("player_options") && this.player.model.data.player_options && this.player.model.data.player_options.fast_transitions === !1 ? u.STD : u.BLACK : (this.defaultWarpStyle = u.BLACK, p.warn("No model yet, choosing \"" + this.defaultWarpStyle + "\" transitions")), this.resetSpecialTransition();
        this.clock.getDelta()
      }, n.prototype.describe = function() {
        return {
          nItems: this.nItems,
          currentItem: this.currentItem,
          destinationItem: this.destinationItem,
          tourIsPlaying: this.tourIsPlaying,
          isWarping: this.isWarping,
          waiting: this.waiting,
          pendingHalt: this.pendingHalt,
          onTheBus: this.onTheBus,
          endlessLoop: this.endlessLoop,
          viewMode: this.player.mode,
          inTransition: this._inTransition()
        }
      }, n.prototype._inTransition = function() {
        return this.player.flying || this.player.mode === l.TRANSITIONING || this.tourIsPlaying
      }, n.prototype.isIdle = function() {
        return !(this.waiting || this.pendingHalt)
      }, n.prototype.bounceable = function() {
        var e = this.clock.getDelta();
        return this.pendingHalt || 0.9 > e || this.player.flying && !this.isWarping
      }, n.prototype.playTour = function() {
        if (this.tourIsPlaying) {
          return void(p.info(""))
        };
        if (!this.bounceable()) {
          if (this.isWarping) {
            return void((this.tourIsPlaying = !0))
          };
          if (this.isAnInteruption("tour.play")) {
            return void(p.debug(""))
          };
          this.player.emit("tour_auto", this.defaultWarpStyle);
          this.reachSource = "play";
          this.userCmd = !0;
          this.tourIsPlaying = !0;
          this.resetSpecialTransition();
          this.emit("update.controls");
          this.goNext()
        }
      }, n.prototype.stopTour = function() {
        this.isAnInteruption("tour.stop") || (this.userCmd = !0, this.player.path.haltWarp(), this.tourIsPlaying = !1)
      }, n.prototype.goToHighlight = function(e) {
        if (p.debug(""), !this.bounceable()) {
          if (this.randomThumbnail) {
            return void(p.debug(""))
          };
          if (this.isAnInteruption("tour.goto", e)) {
            if (this.isWarping) {
              return this.redirectToItem(e, "gotToHighlight"), void(this.emit("update.controls"))
            }
          };
          this.randomThumbnail = !0;
          this.userCmd = !0;
          this.useSpecialTransition("Hilight");
          this.destinationItem = e;
          if (this.player.path.selectWarpHeroLocation(e)) {
            this.player.path.transType = this.nextWarpStyle;
            this.player.path.brushToWarpPano();
            this.isWarping = !0;
            this.onTheBus = !0;
            this.emit("update.controls");
            this.player.path.warpToPano(function() {
              c.trackAlways("USER", {
                event_type: "reach_highlight",
                reach_source: "thumb"
              }), this.currentItem = e, this.isWarping = !1, this.resetSpecialTransition(), this.player.path.discardPathObject(), this.actionComplete("_gthE")
            }.bind(this));
            this.player.model.fadePanoMarkers(0)
          } else {
            p.warn("you made a selection but didn't move!")
          };
          this.emit("update.controls")
        }
      }, n.prototype.prevHighlight = function() {
        if (!this.bounceable()) {
          if (this.isAnInteruption("tour.prev")) {
            return void(this.redirectToItem(this.currentItem, "prevHighlight"))
          };
          this.userCmd = !0, this.goPrev(), this.reachSource = "prev"
        }
      }, n.prototype.nextHighlight = function() {
        if (!this.bounceable()) {
          if (this.player.emit("tour_manual", "next"), this.isAnInteruption("tour.next")) {
            return void((this.isWarping && !this._inTransition() && s.start(function() {}, 22, function() {
              this.detourComplete("_anh")
            }.bind(this), 0, null, "_anh")))
          };
          this.userCmd = !0, this.goNext(), this.reachSource = "next"
        }
      }, n.prototype.showPath = function(e) {
        this.player.path.selectWarpHeroLocation(e) && this.player.path.brushToWarpPano()
      }, n.prototype.clearPath = function() {
        this._inTransition() || this.player.path.discardPathObject()
      }, n.prototype.changeMode = function(e, t) {
        var i = t || "gui",
          n = "nav." + e;
        switch (this.history.invalidate(), e) {
          case l.PANORAMA:
            if (this.player.controls[l.PANORAMA].emit("interaction." + i), this.isAnInteruption(n)) {
              return void(this.player.insideMode(null, function() {
                this.detourComplete(e)
              }.bind(this)))
            };
            this.player.insideMode();
            break;
          case l.DOLLHOUSE:
            if (this.player.controls[l.PANORAMA].emit("interaction." + i), this.isAnInteruption(n)) {
              return void(this.player.flyToNewMode(l.DOLLHOUSE, {
                callback: function() {
                  this.detourComplete(e)
                }.bind(this)
              }))
            };
            this.player.flyToNewMode(l.DOLLHOUSE);
            break;
          case l.FLOORPLAN:
            if (this.player.controls[l.PANORAMA].emit("interaction." + i), this.isAnInteruption(n)) {
              return void(this.player.flyToNewMode(l.FLOORPLAN, {
                callback: function() {
                  this.detourComplete(e)
                }.bind(this)
              }))
            };
            this.player.flyToNewMode(l.FLOORPLAN)
        };
        console.log("test")
      }, n.prototype.changeFloor = function(e, t) {
        var i = this.player.controls[this.player.mode];
        i && i.emit("move", t), t && this.player.controls[l.PANORAMA].emit("interaction." + t), this.player.changeFloor(e)
      }, n.prototype.gotoFloor = function(e, t) {
        var i = this.player.controls[this.player.mode];
        i && i.emit("move", t), t && this.player.controls[l.PANORAMA].emit("interaction." + t), this.player.gotoFloor(e)
      }, n.prototype.allFloors = function() {
        var e = this.player.controls[this.player.mode];
        e && e.emit("move", "gui"), this.player.controls[l.PANORAMA].emit("interaction.gui"), this.player.model.toggleAllFloors()
      }, n.prototype.actionComplete = function(e) {
        var t = e || null;
        if (this.waiting = !1, this.randomThumbnail = !1, this.resetSpecialTransition(), this.isWarping = !1, this.userCmd = !1, this.pendingHalt = !1, null !== this.destinationItem && (this.currentItem = this.destinationItem), this.nextFunc) {
          var i = this.nextFunc;
          this.nextFunc = null, i()
        };
        this.tourIsPlaying || this.player.mode !== l.PANORAMA || this.player.model.fadePanoMarkers(), this.emit("update.controls")
      }, n.prototype.detourComplete = function(e) {
        var t = e || null;
        return this.pendingHalt ? (this.pendingHalt = !1, this.tourIsPlaying = !1, void(this.actionComplete("detourComplete" + t + ")"))) : void(this.actionComplete("haltless " + t))
      }, n.prototype.nav = function(e) {
        var t = e || null;
        return this.isWarping ? void(p.debug("")) : (this.onTheBus = !1, this.isAnInteruption("usernav", t) ? void(setTimeout(function() {
          this.detourComplete("_dredy")
        }.bind(this), 250)) : (t && t(), void(this.emit("update.controls"))))
      }, n.prototype.awaitCompletion = function(e, t) {
        this.nextFunc = t, t && (this.waiting = !0), this.onTheBus = !0, e()
      }, n.prototype.isAnInteruption = function() {
        return this.waiting ? (this.waiting = !1, this.nextFunc = null, this.tourIsPlaying = !1, this.pendingHalt = !0, !0) : !1
      }, n.prototype.autoTour = function() {
        a.warp.auto >= 0 && s.trigger({
          duration: 1e3 * Math.min(300, a.warp.auto),
          done: function() {
            this.playTour()
          }.bind(this),
          name: "_atr"
        })
      }, n.prototype.atDestinationPano = function() {
        if (!this.player.currentPano || null === this.destinationItem) {
          return !1
        };
        var e = this.player.currentPano.id;
        if (void(0) === e) {
          return !1
        };
        var t = this.player.model.heroLocations;
        return null !== this.destinationItem && void(0) !== t[this.destinationItem] && e == t[this.destinationItem].scan_id ? !0 : !1
      }, n.prototype.currentAimIsGood = function() {
        if (this.player.mode !== l.PANORAMA) {
          return !1
        };
        if (null === this.destinationItem) {
          return !1
        };
        var e = this.player.model.heroLocations[this.destinationItem],
          t = this.player.model.panos.dict[e.scan_id];
        if (void(0) === t) {
          return !1
        };
        var i = this.player.cameras[l.PANORAMA],
          n = new r.Vector3(0, 0, 1).applyQuaternion(e.quaternion).normalize(),
          o = new r.Vector3(0, 0, 1).applyQuaternion(i.quaternion).normalize(),
          s = o.dot(n);
        return s > Math.cos(r.Math.degToRad(a.warp.minRotation))
      }, n.prototype.jumpToHighlight = function(e) {
        s.start(function() {}, 22, function() {
          this.detourComplete("_jmp2"), this.goToHighlight(e)
        }.bind(this), 0, null, "_jmp2")
      }, n.prototype.redirectToItem = function(e, t) {
        if (!this.player.path.selectWarpHeroLocation(e)) {
          return void(p.warn("redirectToItem(" + e + ",\"" + t + "\"): no such destination"))
        };
        if ("" === this.player.path.warpDestHeroLoc.scan_id) {
          return this.destinationItem = e, this.isWarping = !0, void(this.player.path.warpToNonPano(function() {
            this.currentItem = e, this.isWarping = !1, this.detourComplete("_npo")
          }.bind(this)))
        };
        if (this.player.mode != l.PANORAMA) {
          return this.destinationItem = e, this.isWarping = !0, this.player.reticule.hide(), void(this.player.path.warpToPano(function() {
            this.currentItem = e, this.isWarping = !1, this.detourComplete("_npi")
          }.bind(this)))
        };
        var i;
        if (e === this.currentItem) {
          this.player.flying ? (this.player.path.warpDestPano = this.player.currentPano, this.player.path.brushToWarpPano(), i = this.player.path.chooseWarpPath(!0), this.player.model.setProjectedPanos(this.player.currentPano, this.player.path.warpDestPano), this.destinationItem = this.currentItem) : this.jumpToHighlight(e)
        } else {
          if (this.isWarping && !this._inTransition()) {
            return void(this.jumpToHighlight(e))
          };
          this.destinationItem = e, this.player.path.brushToWarpPano(), i = this.player.path.chooseWarpPath(!0), i ? this.player.model.setProjectedPanos(this.player.currentPano, this.player.path.warpDestPano) : (this.player.path.warpDestPano = this.player.currentPano, this.player.path.brushToWarpPano(), i = this.player.path.chooseWarpPath(!0), this.player.model.setProjectedPanos(this.player.currentPano, this.player.path.warpDestPano), this.destinationItem = this.currentItem)
        }
      }, n.prototype.useSpecialTransition = function(e) {
        this.nextWarpStyle = this.defaultWarpStyle
      }, n.prototype.resetSpecialTransition = function() {
        this.nextWarpStyle = this.defaultWarpStyle
      }, n.prototype.adjustAimOnly = function() {
        this.player.model.fadePanoMarkers(0);
        this.history.invalidate();
        this.awaitCompletion(function() {
          this.resetSpecialTransition(), this.isWarping = !0, this.player.aimTourCamera(this.destinationItem)
        }.bind(this), this.tourInterlude.bind(this))
      }, n.prototype.warpToDestination = function() {
        this.emit("update.controls");
        this.history.invalidate();
        this.player.model.fadePanoMarkers(0);
        this.awaitCompletion(function() {
          this.player.path.transType = this.nextWarpStyle, this.isWarping = !0, this.player.reticule.hide(), this.player.warpTo(this.destinationItem), this.emit("update.controls")
        }.bind(this), this.tourInterlude.bind(this))
      }, n.prototype.tourInterlude = function() {
        c.trackAlways("USER", {
          event_type: "reach_highlight",
          reach_source: this.reachSource
        });
        this.player.model.fadePanoMarkers(0);
        null !== this.destinationItem && (this.currentItem = this.destinationItem);
        return this.tourIsPlaying ? this.atEndOfTour() && !this.endlessLoop ? void(this.endTour("interlude")) : (this.history.invalidate(), this.emit("update.controls"), void(this.awaitCompletion(function() {
          this.player.tourInterlude()
        }.bind(this), function() {
          this.goNext()
        }.bind(this)))) : void(this.emit("update.controls"))
      }, n.prototype.atEndOfTour = function() {
        var e = this.currentItem >= this.nItems - 1;
        return e
      }, n.prototype.firstDestination = function() {
        return this.nItems > 0 ? 0 : null
      }, n.prototype.finalDestination = function() {
        return this.nItems > 0 ? this.nItems - 1 : null
      }, n.prototype.endTour = function(e) {
        this.tourIsPlaying = !1, this.resetSpecialTransition(), this.emit("update.controls")
      }, n.prototype.goPrev = function() {
        null === this.currentItem || 0 === this.currentItem ? (this.destinationItem = this.finalDestination(), this.useSpecialTransition("reverse-looping to end")) : this.destinationItem -= 1, this.tourAdvance(-1)
      }, n.prototype.nextItem = function(e) {
        return null === e ? this.firstDestination() : e >= this.nItems - 1 ? this.endlessLoop ? this.firstDestination() : null : e + 1
      }, n.prototype.goNext = function() {
        var e = this.atEndOfTour();
        if (this.tourIsPlaying && e) {
          this.endlessLoop || this.userCmd || this.endTour("goNext() reached end")
        };
        if (null === this.currentItem || e) {
          this.destinationItem = this.firstDestination();
          e && this.useSpecialTransition("looping back to start")
        } else {
          if (null === this.destinationItem) {
            this.destinationItem = this.firstDestination()
          } else {
            this.destinationItem += 1
          }
        };
        this.tourAdvance(1)
      }, n.prototype.tourAdvance = function(e) {
        this.onTheBus = !0;
        if (this.atDestinationPano()) {
          this.resetSpecialTransition();
          this.currentItem = this.destinationItem;
          this.emit("update.controls");
          if (this.randomThumbnail) {
            this.adjustAimOnly()
          } else {
            if (this.currentAimIsGood()) {
              this.currentItem = this.destinationItem;
              if (0 > e) {
                this.goPrev()
              } else {
                this.goNext()
              }
            } else {
              this.adjustAimOnly()
            }
          }
        } else {
          if (null === this.currentItem) {
            this.destinationItem = this.firstDestination();
            this.useSpecialTransition("start of tour");
            this.currentItem = this.destinationItem
          };
          this.warpToDestination();
          this.emit("update.controls")
        }
      }, t.exports = n
    }).call(this, "/js/director.js")
  }

  function _$af269320(e, t, i) {
    "use strict";
    var n = e("three"),
      r = e("./enum/Viewmode"),
      o = (e("./settings"), e("./util/transitions")),
      a = new n.ShaderPass(n.HorizontalBlurShader),
      s = new n.ShaderPass(n.VerticalBlurShader);
    s.renderToScreen = !0;
    var h = window.innerWidth / window.innerHeight;
    isNaN(h) && (h = 1);
    var l = {
      currentBlur: 0,
      aspect: h,
      blurStrength: 1,
      init: function(e, t) {
        e.addPass(a), e.addPass(s), t.on("mode.changed", function(e, t) {
          e === r.PANORAMA && (o.cancel(l.blur), o.cancel(l.addBlur), o.start(l.removeBlur, 500, null, 0, null, "deblur"))
        })
      },
      blur: function(e) {
        l.currentBlur = e;
        var t = e * l.blurStrength;
        s.uniforms.v.value = t / 512 * l.aspect, a.uniforms.h.value = t / 512
      },
      addBlur: function(e) {
        e = Math.max(e, l.currentBlur), l.blur(e)
      },
      removeBlur: function(e) {
        e = Math.min(1 - e, l.currentBlur), l.blur(e)
      }
    };
    l.blur(0), t.exports = l
  }

  function _$af269326(e, t, i) {
    "use strict";
    var n = e("three");
    t.exports = {
      newBlue: new n.Color(4967932),
      altBlue: new n.Color(47355),
      classicBlue: new n.Color(53759),
      mpYellow: new n.Color(16502016),
      mpOrange: new n.Color(16428055),
      mpBlue: new n.Color(12096),
      mpLtGrey: new n.Color(13751252),
      mpDkGrey: new n.Color(10000019),
      mpRed: new n.Color(12525854),
      mpOrangeDesat: new n.Color(16764529),
      mpBlueDesat: new n.Color(4034734),
      mpRedDesat: new n.Color(14705505),
      white: new n.Color(16777215),
      black: new n.Color(0),
      _desat: function(e, t) {
        var i = t || 0.3,
          r = (new n.Color).copy(e).getHSL();
        return (new n.Color).setHSL(r.h, r.s * (1 - i), r.l)
      },
      _darken: function(e, t) {
        var i = t || 0.2,
          r = (new n.Color).copy(e).getHSL();
        return (new n.Color).setHSL(r.h, r.s, r.l * (1 - i))
      }
    }
  }

  function _$af269329(e, t, i) {
    "use strict";
    var n = {
      UP: 1,
      DOWN: -1,
      LEFT: "L",
      RIGHT: "R",
      FORWARD: "F",
      BACK: "B",
      reverse: {},
      opposite: function(e) {
        return this.reverse[e.toString()]
      }
    };
    ! function() {
      n.reverse[n.UP] = n.DOWN, n.reverse[n.DOWN] = n.UP, n.reverse[n.LEFT] = n.RIGHT, n.reverse[n.RIGHT] = n.LEFT, n.reverse[n.FORWARD] = n.BACK, n.reverse[n.BACK] = n.FORWARD
    }(), t.exports = n
  }

  function _$af269332(e, t, i) {
    "use strict";
    e("three");
    t.exports = {
      ZERO: 48,
      ONE: 49,
      TWO: 50,
      THREE: 51,
      FOUR: 52,
      FIVE: 53,
      SIX: 54,
      SEVEN: 55,
      EIGHT: 56,
      NINE: 57,
      LEFTARROW: 37,
      UPARROW: 38,
      RIGHTARROW: 39,
      DOWNARROW: 40,
      A: 65,
      B: 66,
      C: 67,
      D: 68,
      E: 69,
      F: 70,
      G: 71,
      H: 72,
      I: 73,
      J: 74,
      K: 75,
      L: 76,
      M: 77,
      N: 78,
      O: 79,
      P: 80,
      Q: 81,
      R: 82,
      S: 83,
      T: 84,
      U: 85,
      V: 86,
      W: 87,
      X: 88,
      Y: 89,
      Z: 90,
      SPACE: 32,
      RETURN: 13
    }
  }

  function _$af269333(e, t, i) {
    "use strict";
    t.exports = {
      iframe: "iframe",
      tab: "tab",
      window: "window"
    }
  }

  function _$af269334(e, t, i) {
    "use strict";
    t.exports = {
      visibleFloor: 1,
      ghostFloor: 3,
      mattertagDisc: 1,
      mattertagCutout: 2,
      mattertagStem: 3,
      ribbon: 100
    }
  }

  function _$af269335(e, t, i) {
    "use strict";
    t.exports = {
      IDLE: "idle",
      BROWSE: "browse",
      EXAMINE: "examine"
    }
  }

  function _$af269336(e, t, i) {
    "use strict";
    var n = e("three");
    t.exports = {
      UP: new n.Vector3(0, 1, 0),
      DOWN: new n.Vector3(0, -1, 0),
      LEFT: new n.Vector3(-1, 0, 0),
      RIGHT: new n.Vector3(1, 0, 0),
      FORWARD: new n.Vector3(0, 0, -1),
      BACK: new n.Vector3(0, 0, 1)
    }
  }

  function _$af269337(e, t, i) {
    "use strict";
    t.exports = {
      PANORAMA: "panorama",
      DOLLHOUSE: "dollhouse",
      FLOORPLAN: "floorplan",
      TRANSITIONING: "transitioning",
      toInt: function(e) {
        switch (e) {
          case this.PANORAMA:
            return 1;
          case this.DOLLHOUSE:
            return 2;
          case this.FLOORPLAN:
            return 3;
          case this.TRANSITIONING:
            return -1
        };
        throw new Error("Unknown mode: " + e)
      },
      fromInt: function(e) {
        switch (e) {
          case "1":
            ;
          case 1:
            return this.PANORAMA;
          case "2":
            ;
          case 2:
            return this.DOLLHOUSE;
          case "3":
            ;
          case 3:
            return this.FLOORPLAN
        };
        throw new Error("Unknown mode: " + e)
      },
      convertWorkshopModeInt: function(e) {
        switch (e) {
          case "0":
            ;
          case 0:
            return this.PANORAMA;
          case "1":
            ;
          case 1:
            return this.FLOORPLAN;
          case "2":
            ;
          case 2:
            return this.DOLLHOUSE
        }
      }
    }
  }

  function _$af269341(e, t, i) {
    "use strict";
    t.exports = {
      BLACK: "black",
      STD: "std"
    }
  }

  function _$af269342(e, t, i) {
    (function(i) {
      "use strict";

      function n(e) {
        var t = {};
        if (e) {
          var i = e.flags;
          if (i) {
            for (var n in i) {
              i.hasOwnProperty(n) && (t[i[n]] = !0)
            }
          };
          return t
        };
        return null
      }
      var r = (e("three"), e("url"), e("./util/ajax")),
        o = e("./settings"),
        a = e("./util/logger"),
        s = "/data/" + g_index + "/user.js",
        h = new a(i),
        l = {};
      t.exports = {
        loadFeatureFlags: function(e) {
          var t = $.Deferred();
          return r["get"](e.urlBase + s, {
            responseType: "json",
            auth: o.authorizationHeader
          }).done(function(e) {
            l = n(e), l ? t.resolve(l) : t.reject("loading-failed")
          }).fail(function() {
            t.reject("loading-failed")
          }), t.promise()
        },
        getFlags: function() {
          return l
        },
        updateDependentSettings: function(e) {
          e = e || l, o.mattertags.enabled = e.mattertags ? !0 : !1, e.tag_links && (o.mattertags.enableLinking = !0), o.labels.enabled = e.labels ? !0 : !1
        }
      }
    }).call(this, "/js/featureflags.js")
  }

  function _$af269350(e, t, i) {
    "use strict";
    var n = e("../util/common"),
      r = {
        settings: {
          minimum: 1,
          initLoadAmt: 10,
          trickle: !0,
          trickleRate: 8,
          trickleSpeed: 200
        },
        status: 0,
        configure: function(e) {
          return Settings = n.deepExtend(Settings, e), this
        },
        set: function(e) {
          var t = $(".progressbar");
          0 > e && (e = 0);
          e > 100 && (e = 100);
          var width = parseInt(t.css("width").replace("px", "")) / 100;
          var barperc = e * width - 2;
          var length = barperc;
          var perc = Math.round(e);
          var labelpos = (parseInt(length) - 2);
          t.find(".bar").css("width", barperc);
          t.find(".label").css("left", labelpos);
          t.find(".perc").text(perc + "%")
        },
        isStarted: function() {
          return "number" == typeof this.status
        },
        start: function() {
          this.status || this["set"](this.settings.initLoadAmt);
          var e = this;
          this.settings.trickle && (this.work = setInterval(function() {
            if (null !== e.status) {
              var t = Math.max(Math.random() * e.settings.trickleRate, e.settings.minimum);
              e.inc(t)
            }
          }, 800))
        },
        inc: function(e) {
          var t = this.status;
          this["set"](Math.floor(t + e))
        },
        trickle: function() {
          return this.inc(Math.random() * this.settings.trickleRate)
        },
        done: function(e) {
          return e || this.status ? (this.settings.trickle = !1, this.status = null, clearInterval(this.work), this["set"](100)) : this
        }
      };
    t.exports.circleLoader = r
  }

  function _$af269359(e, t, i) {
    "use strict";

    function n(e, t) {
      var i = new r.GUI,
        n = i.addFolder("Flydown from Dollhouse");
      n.add(c.flydown, "movementEasing", Object.keys(a)), n.add(c.flydown, "movementDelay", 0, 1).step(0.01), n.add(c.flydown, "rotationEasing", Object.keys(a)), n.add(c.flydown, "rotationDelay", 0, 1).step(0.01), n.add(c.flydown, "modelTextureDelay", 0, 1).step(0.01), n.add(c.flydown, "skyboxDelay", 0, 1).step(0.01), n.add(c.dollhouseDefault, "minPolarAngle", 0, o.Math.degToRad(50)), n.add(c.dollhouseDefault, "maxPolarAngle", o.Math.degToRad(50), o.Math.degToRad(170));
      var p = i.addFolder("Transition between panos");
      p.add(c.transition, "blur", 0, 10).onFinishChange(function() {}), p.add(c.transition, "flySpeed", 0, 10).step(0.01).onFinishChange(function() {
        c.transition.flyTime = 0, p.__controllers.forEach(function(e) {
          e.updateDisplay()
        })
      }), p.add(c.transition, "flyTime", 0, 5e3).onFinishChange(function() {
        c.transition.flySpeed = 0, p.__controllers.forEach(function(e) {
          e.updateDisplay()
        })
      }), p.add(c.transition, "aimTime", 500, 2500).step(50), p.add(c.transition, "aimSlowFactor", 1, 3).step(0.1), p.add(c.transition, "movementEasing", Object.keys(a));
      var f = i.addFolder("Path Display");
      f.add(c.path, "opacity", 0, 1).step(0.01).onFinishChange(function() {}), f.add(c.path, "height", 0, 0.2).step(0.01).onFinishChange(function() {}), f.add(c.path, "outsideHeight", 0, 2).step(0.01).onFinishChange(function() {}), f.add(c.path, "ribbonWidth", 0.01, 0.35).step(0.01).onFinishChange(function() {}), f.add(c.path, "waypointRadius", 0.01, 1.2).step(0.01).onFinishChange(function() {}), f.add(c.path, "waypointPulse", 0, 3600).step(20).onFinishChange(function() {}), f.add(c.path, "waypointIndoorRadius", 0.01, 1.2).step(0.01).onFinishChange(function() {}), f.add(c.path, "fadeInTime", 0, 1200).step(10).onFinishChange(function() {}), f.add(c.path, "fadeOutTime", 0, 1200).step(10).onFinishChange(function() {}), f.add(c.path, "color", Object.keys(h)).onFinishChange(function() {
        c.path.color = h[c.path.color], c.path.colorUp = h.desat(c.path.color), c.path.colorDown = h.darken(c.path.color)
      }), f.add(c, "reticuleColor", Object.keys(h)).onFinishChange(function() {
        c.reticuleColor = h[c.reticuleColor], t.reticule.material.uniforms.color.value["set"](c.reticuleColor)
      });
      var m = i.addFolder("Warping"),
        g = m.addFolder("Warp/Teleport");
      g.add(c.warp, "softPushDist", 0, 2).onFinishChange(function() {}), g.add(c.warp, "softPushEnd", 0, 1).step(0.01).onFinishChange(function() {}), g.add(c.warp, "softBendAngle", 0, 45).onFinishChange(function() {}), g.add(c.warp, "softBendTilt", 0, 45).onFinishChange(function() {}), g.add(c.warp, "softBendEnd", 0, 1).step(0.01).onFinishChange(function() {}), g.add(c.warp, "burnsAngle", 0, 30).onFinishChange(function() {}), g.add(c.path, "mapGuides").onFinishChange(function() {}), g.add(c.warp, "teleportTime", 0, 5e3).step(10).onFinishChange(function() {}), g.add(c.warp, "outsideTime", 0, 5e3).step(10).onFinishChange(function() {}), g.add(c.path, "typ", Object.keys(l)).onFinishChange(function() {
        c.path.typ = l[c.path.typ]
      }), g.add(c.warp, "tourStepDelay", 0, 1e4).step(100).onFinishChange(function() {}), g.add(c.warp, "loop").onChange(function() {}).onFinishChange(function() {
        t.director.endlessLoop = c.warp.loop
      });
      var v = m.addFolder("Long Warp Only");
      v.add(c.warp, "minWarpTime", 0, 5e3).step(10).onFinishChange(function() {
        c.warp.flySpeed = 0, v.__controllers.forEach(function(e) {
          e.updateDisplay()
        })
      }), v.add(c.warp, "moveDelay", 0, 5e3).step(10).onFinishChange(function() {}), v.add(c.warp, "timePerMeter", 0, 5e3).step(10).onFinishChange(function() {}), v.add(c.warp, "lookAheadDist", 0.01, 4).step(0.01).onFinishChange(function() {}), v.add(c.warp, "maxTurnPerSec", 0, 720).step(1).onFinishChange(function() {}), v.add(c.warp, "maxAimPerSec", 0, 720).step(1).onFinishChange(function() {}), v.add(c.warp, "turnFriction", 0, 1).step(0.01).onFinishChange(function() {});
      var y = i.addFolder("Warp Esoterica");
      y.add(c.warp, "nearPanoDist", 0.01, 12).step(0).onFinishChange(function() {}), y.add(c.warp, "blur", 0.01, 1).onFinishChange(function() {}), y.add(c.warp, "flySpeed", 0, 10).step(0.01).onFinishChange(function() {
        c.warp.minWarpTime = 0, y.__controllers.forEach(function(e) {
          e.updateDisplay()
        })
      }), y.add(c.warp, "showBunny").onFinishChange(function() {}), y.add(c.warp, "fastTime", 0, 2500).step(10).onFinishChange(function() {}), y.add(c.warp, "movementEasing", Object.keys(a));
      var b = i.addFolder("Misc");
      b.add(c, "dollhouseFOV", 10, 180).onChange(function() {
        t.controls[s.DOLLHOUSE].object.fov = c.dollhouseFOV
      }), b.add(c, "insideFOV", 10, 180).onChange(function() {
        t.controls[s.PANORAMA].object.fov = c.insideFOV
      }), b.add(c, "insideLookSpeed", 0.01, 0.3).step(0.01).onChange(function() {}), b.add(c, "rotationAccelerationInside", 0.1, 10).step(0.1).onChange(function() {}), b.add(c, "rotationAccelerationOutside", 0.1, 10).step(0.1).onChange(function() {});
      var w = i.addFolder("Navigation");
      w.add(c.navigation, "panoScores").onFinishChange(function() {
        c.navigation.panoScores || e.panos.forEach(function(e) {
          e.floor.remove(e.text3d), e.text3d = null
        })
      }), w.add(c.navigation, "mouseDirection"), w.add(c.navigation, "filterStrictness", 0, 1), w.add(c.navigation, "angleFactor", -60, 0), w.add(c.navigation, "directionFactor", 1, 20), w.add(c.navigation, "distanceFactor", -5, 5);
      var _ = i.addFolder("Mattertags");
      c.mattertags.enableLinking && _.add(c.mattertags, "linkDestination", Object.keys(d));
      var x = _.addFolder("Tag Creation");
      x.add(c.mattertags.pole, "enabled").name("poleEnabled"), x.add(c.mattertags.pole, "height", 0, 2.5).step(0.01).name("poleHeight"), x.add(c.mattertags.pole, "width", 1, 10).step(1).name("poleWidth"), x.add(c.mattertags.pole, "opacity", 0.1, 1).step(0.1).name("poleOpacity");
      var M = _.addFolder("Visibility");
      M.add(c.mattertags.visibility, "anyDistance"), M.add(c.mattertags.visibility, "visibleDistance", 0.1, 30).step(0.1), M.add(c.mattertags.visibility, "cameraClearance", 0, 1).step(0.01), M.add(c.mattertags.visibility, "hideViaFloor"), M.add(c.mattertags.visibility, "hideObscured"), M.add(c.mattertags.visibility, "hideOffScreenDisc").name("hideEdgeDisc"), M.add(c.mattertags.visibility, "hideOffScreenObject").name("hideEdgeObject");
      var E = _.addFolder("Disc Parameters");
      E.add(c.mattertags.disc.scale, "nearBound", 0.1, 10).step(0.1), E.add(c.mattertags.disc.scale, "farBound", 0.1, 20).step(0.1).listen(), E.add(c.mattertags.disc.scale, "linkFarBound").onChange(function(e) {
        e && (c.mattertags.disc.scale.farBound = c.mattertags.visibility.visibleDistance * (1 - c.mattertags.disc.scale.linkPercent / 100))
      }), E.add(c.mattertags.disc.scale, "linkPercent", 0, 100).step(1).onChange(function(e) {
        c.mattertags.disc.scale.linkFarBound && (c.mattertags.disc.scale.farBound = c.mattertags.visibility.visibleDistance * (1 - e / 100))
      }), E.add(c.mattertags.disc.scale, "maxSize", 40, 200).step(1), E.add(c.mattertags.disc.scale, "minSize", 20, 100).step(1), E.add(c.mattertags.disc.scale, "responsiveness", 0, 100).step(1);
      var S = _.addFolder("Deadzones");
      S.add(c.mattertags.deadzone, "checkDeadzone"), S.add(c.mattertags.deadzone, "showDeadZone").onChange(function() {
        u.deadzoneOverlay.style.visibility = c.mattertags.deadzone.showDeadZone ? "visible" : "hidden"
      }), S.add(c.mattertags.deadzone, "useDiscCenter");
      var T = S.addFolder("Deadzone Bounds");
      T.add(c.mattertags.deadzone.deadzoneBounds, "top", 0, 500).step(10).onChange(function() {
        c.mattertags.deadzone.deadzoneBounds.top >= window.innerHeight / 2 && (c.mattertags.deadzone.deadzoneBounds.top = window.innerHeight / 2)
      }), T.add(c.mattertags.deadzone.deadzoneBounds, "left", 0, 500).step(10).onChange(function() {
        c.mattertags.deadzone.deadzoneBounds.left >= window.innerWidth / 2 && (c.mattertags.deadzone.deadzoneBounds.left = window.innerWidth / 2)
      }), T.add(c.mattertags.deadzone.deadzoneBounds, "bottom", 0, 500).step(10).onChange(function() {
        var e = $("#drawer").height();
        c.mattertags.deadzone.deadzoneBounds.bottom >= window.innerHeight / 2 - e && (c.mattertags.deadzone.deadzoneBounds.bottom = window.innerHeight / 2 - e)
      }), T.add(c.mattertags.deadzone.deadzoneBounds, "right", 0, 500).step(10).onChange(function() {
        c.mattertags.deadzone.deadzoneBounds.right >= window.innerWidth / 2 && (c.mattertags.deadzone.deadzoneBounds.right = window.innerWidth / 2)
      });
      var P = _.addFolder("Animation Timers");
      P.add(c.mattertags.animation, "hoverOnClosing"), P.add(c.mattertags.animation, "animInDelay", 0, 500).step(10).name("Opening Delay"), P.add(c.mattertags.animation, "animOutDelay", 0, 500).step(10).name("Closing Delay"), P.add(c.mattertags.animation, "animInTime", 0, 1e3).step(25).name("Opening Duration"), P.add(c.mattertags.animation, "animOutTime", 0, 1e3).step(25).name("Closing Duration");
      var A = _.addFolder("Billboard Scaling");
      A.add(c.mattertags.boardScale, "billboardScale", 0.5, 5).step(0.1), A.add(c.mattertags.boardScale, "scaleToDisc"), A.add(c.mattertags.boardScale, "boardToDiscRatio", 0.5, 5).step(0.1);
      var L = _.addFolder("Navigate");
      L.add(c.mattertags.navigate, "nearestPano").name("nearestPano"), L.add(c.mattertags.navigate, "lineOfSight").name("lineOfSight"), L.add(c.mattertags.navigate, "reactivate").name("reactivate"), L.add(c.mattertags.navigate, "aimAt", ["disc", "object", "pole", "nothing"]).name("aim at"), L.add(c.mattertags.navigate, "tiltTolerance", 0, 50).step(1), L.add(c.mattertags.navigate, "rotateSpeedFactor", 0, 5).step(0.1);
      var C = i.addFolder("Debug");
      C.add(c, "wireframe").onFinishChange(function() {
        e.chunks.forEach(function(t) {
          t.material && (t.wireframeTwin || (t.wireframeTwin = new o.WireframeHelper(t), t.wireframeTwin.material.depthWrite = !1, t.wireframeTwin.material.depthTest = !1, t.wireframeTwin.material.opacity = 0.5, t.wireframeTwin.material.transparent = !0), c.wireframe ? e.add(t.wireframeTwin) : e.remove(t.wireframeTwin))
        })
      }), C.add(c, "skyboxWireframe").onFinishChange(function() {
        c.skyboxWireframe ? (e.skybox.wireframe = new o.WireframeHelper(e.skybox), e.add(e.skybox.wireframe)) : (e.skybox.remove(e.skybox.wireframe), e.skybox.wireframe = null)
      }), C.add(c, "showSweeps").onFinishChange(function() {
        e.setSweepVisibility(c.showSweeps)
      }), C.add(c, "showMesh").onFinishChange(function() {
        e.chunks.forEach(function(e) {
          e.visible = c.showMesh
        })
      }), C.add(c, "showFloors").onFinishChange(function() {
        e.floorList.forEach(function(e) {
          e.collider.children.forEach(function(e) {
            e.visible = c.showFloors
          })
        })
      }), C.add(c, "showSkyboxes").onFinishChange(function() {
        e.panos.forEach(function(e) {
          e.mesh.visible = c.showSkyboxes
        })
      }), C.add(c, "showNeighbors").onChange(function() {}), C.add(c, "modelAlpha", 0, 1).listen().onChange(function() {
        e.changeModelAlpha(c.modelAlpha)
      })
    }
    var r = e("../lib/dat.gui"),
      o = e("three"),
      a = e("../util/easing"),
      s = e("../enum/Viewmode"),
      h = e("../enum/Colors"),
      l = e("../enum/WarpStyle"),
      c = e("../settings"),
      u = e("../objects/Mattertag"),
      d = e("../enum/LinkDestination");
    r.GUI.prototype.removeFolder = function(e) {
      var t = this.__folders[e];
      t && (t.close(), this.__ul.removeChild(t.domElement.parentNode), delete this.__folders[e], this.onResize())
    }, t.exports.toggle = n
  }

  function _$af269432(e, t, i) {
    (function(i) {
      "use strict";

      function n(e, t, i, n) {
        $(".gui-error .error-problem-text").text(e), $(".gui-error .error-solution-text").text(t), $(".gui-error .error-explanation").text(i), $(".gui-error .error-actions").html(n), $(window).resize(), $(".gui-error").fadeIn(), $("#bottom-logo").fadeIn()
      }

      function r(e) {
        var t = ["<div class=\"browser-tiles\">", "<div class=\"tile\">", "<a href=\"https://www.google.com/chrome/browser/\" target=\"_blank\">", "<img class=\"icon\" src=\"./images/icon_Google_Chrome_2011.png\" ", "rel=\"tiletip\" title=\"Chrome\"></a>", "</div>", "<div class=\"tile\">", "<a href=\"https://www.mozilla.org/en-US/firefox/new/\" target=\"_blank\">", "<img class=\"icon\" src=\"./images/icon_Mozilla_Firefox.png\" ", "rel=\"tiletip\" title=\"Firefox\"></a>", "</div>", "<div class=\"tile\">", "<a href=\"http://windows.microsoft.com/en-us/internet-explorer/download-ie\" target=\"_blank\">", "<img class=\"icon\" src=\"./images/icon_Internet_Explorer_10.png\" ", "rel=\"tiletip\" title=\"Internet\xA0Explorer(11\u6216\u8005\u66f4\u9ad8\u7248\u672c)\"></a>", "</div>", "<div class=\"tile\">", "<a href=\"https://support.apple.com/en-us/HT204416\" target=\"_blank\">", "<img class=\"icon\" src=\"./images/icon_MacOSX_Safari.png\" ", "rel=\"tiletip\" title=\"Safari\"></a>", "</div>", "</div>"].join("");
        n(e, "\u5b89\u88c5\u4e00\u4e2a\u65b0\u7684\u6d4f\u89c8\u5668\u6765\u4f53\u9a8c3D", "WebGL\u9700\u8981\u5148\u8fdb\u7684\u6d4f\u89c8\u5668.", t), s.isMobile() || $("[rel=tiletip]").tooltip({
          placement: "bottom",
          delay: {
            show: 50,
            hide: 0
          },
          trigger: "hover",
          viewport: {
            selector: "body",
            padding: 10
          }
        })
      }

      function o() {
        var e = s.isMobile() ? "" : "<span class=\"link install-browser\">\u8bf7\u5b89\u88c5\u652f\u6301WebGL\u7684\u6d4f\u89c8\u5668</span> \u6216\u8005 ",
          t = ["\u5982\u679c\u95ee\u9898\u6301\u7eed\uff0c ", e, "<span>\u8bf7\u4e0e\u6211\u4eec\u8054\u7cfb\uff01</span>."].join("");
        n("\u7cfb\u7edf\u51fa\u4e86\u70b9\u95ee\u9898", "\u8bf7\u5237\u65b0\u6d4f\u89c8\u5668", "", t), s.isMobile() || $(".install-browser").on("click touchstart", function(e) {
          e.preventDefault(), e.stopPropagation(), r(" ")
        })
      }

      function a(e) {
        if ($("head title").text(l.pageTitle), $("#gui-message, #gui-loading, #nprogress, #gui-thumb, #bottom-logo").hide(), $("#gui-loading").fadeOut(250), h.track("USER", {
            event_type: "showcase_error",
            error_key: e
          }), "webgl-unsupported" === e) {
          s.isMobile() ? o() : r("\u6d4f\u89c8\u5668\u4e0d\u652f\u6301.")
        } else {
          if ("webgl-ios" === e) {
            n("iOS\u7248\u672c\u4e0d\u652f\u6301", "\u8bf7\u5347\u7ea7\u5230iOS 8\u6216\u8005\u66f4\u9ad8\u7248\u672c\u3002", "", "Tap <strong>Settings > General > Software\xA0Update</strong>.")
          } else {
            if ("webgl-safari" === e) {
              n("\u542f\u7528WebGL", "", "", "Click <strong>Preferences > Advanced > Show\xA0Develop menu</strong>. Then click <strong>Develop\xA0>\xA0Enable\xA0WebGL</strong>.")
            } else {
              if ("webgl-generic" === e) {
                o()
              } else {
                if ("missing-urls" === e) {
                  n("\u8fd9\u79cd\u6a21\u578b\u6ca1\u6709\u5168\u666f\u56fe", "", "\u8fd9\u4e2a\u6a21\u578b\u592a\u65e7\u4e86\uff0c\u9700\u8981\u63d0\u4f9b\u65b0\u7684\u6a21\u578b")
                } else {
                  if ("loading-failed" === e) {
                    n("\u6a21\u578b\u4e0d\u53ef\u7528", "", "", "\u5982\u679c\u95ee\u9898\u7ee7\u7eed, <span>\u8bf7\u4e0e\u6211\u4eec\u8054\u7cfb\uff01</span>.")
                  } else {
                    if ("loading-failed-maintenance" !== e) {
                      return void(u.error("Unhandled error: " + e))
                    };
                    n("\u6b63\u5728\u7ef4\u4fee", "\u8bf7\u8fc7\u51e0\u5206\u949f\u518d\u56de\u6765\uff01")
                  }
                }
              }
            }
          }
        }
      }
      var s = e("./../util/browser"),
        h = e("./../analytics"),
        l = e("./../settings"),
        c = e("./../util/logger"),
        u = new c(i),
        d = "";
      t.exports.error = a
    }).call(this, "/js/gui/error.js")
  }

  function _$af269439(e, t, i) {
    (function(i) {
      "use strict";

      function n() {
        pe = [], ge.upMode.visible && pe.push("#gui-modes-map"), ge.floors.visible && pe.push(".gui-floor", ".gui-floor-title"), pe.push(".hideTarget", ".pinTop.right")
      }

      function r() {
        for (var e in ge) {
          if (ge.hasOwnProperty(e)) {
            var t = ge[e];
            if (!t.visible) {
              for (var i = 0; i < t.elements.length; i++) {
                if (e != "upMode") {
                  $(t.elements[i]).hide()
                }
              }
            }
          }
        };
        ge.highlight.visible && (ie.addHighlightReelHelp(), $(".pinBottom").addClass("highlightExists")), ge.tourControls.visible === !1 ? $("#drawer").addClass("fullWidth") : ie.addPlayHelp(), ge.upMode.visible === !0 && ie.addDollhouseHelp(), ge.titleContainer.visible || $(".pinTop.right").addClass("reposition"), n()
      }

      function o() {
        $("#mattertag-toggles").show(), document.getElementById("radio-tag-show").checked = !0, $("#mattertag-inputs input").on("change", function(e) {
          j.showingMattertags = "show" === this.value, j.showingMattertags ? (J.trackAlways("USER", {
            event_type: "showcase_gui",
            gui_action: "show_mattertags"
          }), G.showAllMattertags(K.mattertags.startup.fadeInDuration)) : (J.trackAlways("USER", {
            event_type: "showcase_gui",
            gui_action: "hide_mattertags"
          }), G.hideAllMattertags(K.mattertags.startup.fadeInDuration))
        })
      }

      function a(e) {
        u(), $(".pinBottom").toggleClass("open"), $("#drawer").toggleClass("open"), $("#pullTab").find("span").toggle(), e || l("highlights")
      }

      function s() {
        $(window).height() < 400 && $("#drawer").hasClass("open") && a(!0)
      }

      function h() {
        $(window).height() < 400 && $("#meta-info").is(":visible") && y(!0)
      }

      function l(e) {
        function t() {
          c.is(":visible") && (c.slideUp(250), $("#more-hint").toggle(), $("#less-hint").toggle())
        }

        function i() {
          u.is(":visible") && u.fadeOut()
        }

        function n() {
          d.is(":visible") && ie.closeHelp()
        }

        function r() {
          p.hasClass("open") && a(!0)
        }

        function o() {
          f.is(":visible") && f.fadeOut()
        }

        function l() {
          m.hasClass("open") && m.removeClass("open")
        } {
          var c = $("#meta-info"),
            u = $("#terms-modal"),
            d = $(".nav-help-dialog"),
            p = $("#drawer"),
            f = $("#share-modal"),
            m = $(".gui-floor");
          $("#gui-modes-map")
        }
        switch (e) {
          case "info":
            i(), n(), s(), o(), l();
            break;
          case "terms":
            t(), n(), r(), o(), l();
            break;
          case "help":
            t(), i(), r(), o(), l();
            break;
          case "highlights":
            h(), i(), o(), l();
            break;
          case "share":
            i(), l();
            break;
          case "floor":
            i(), o();
            break;
          case "view":
            l(), o(), i();
            break;
          case "tour":
            i(), o(), l();
            break;
          case "move":
            i(), o(), l();
            break;
          case "resize":
            t(), s(), o(), l()
        }
      }

      function c(e) {
        "touchstart" === e.type && e.preventDefault(), e.stopPropagation()
      }

      function u() {
        H && (H.reload(), H.init())
      }

      function d(e) {
        $("#gui-loading").fadeIn(500, function() {
          e(p);
          $(this).css("display", "table")
        });
        r();
        $("body").addClass("player-active")
      }

      function p(e) {
        ne && ne["set"](e)
      }

      function f(e, i, n) {
        if (j != e && se.warn("Model mismatch in endLoading()"), z != i && se.warn("Director mismatch in endLoading()"), G != n && se.warn("Player mismatch in endLoading()"), t.exports.player = G, ne.done(), $("#gui-loading, #gui-thumb").fadeOut(2500), g_modeldata.model.fdageTag && Object.keys(e.mattertags).length && o(), K.labels.enabled && Object.keys(e.labels).length, ge.address.visible || ge.contact.visible || ge.description.visible ? $("#mattertag-toggles").prepend("<br>") : Object.keys(e.mattertags).length || Object.keys(e.labels).length || ($(".meta-toggle").off("mousedown touchstart"), $(".title-container").removeClass("meta-toggle"), ge.metaInfo.visible = !1), j.panos.length || $("#gui-modes-inside").remove(), j.floorList.length <= 1 || !ge.floors.visible ? ge.floors.visible = !1 : (M(j), j.on("floor.changed", E)), r(), $("#gui").fadeIn(1500), ge.highlight.visible && setTimeout(function() {
            a(), K.startHighlights || setTimeout(a, 2e3)
          }, 2e3), G.mode !== ee.PANORAMA && U(e, G.mode), !Q.isMobile()) {
          for (var s = ["a", "#title-toggle", ".next-button", ".prev-button", ".gui-floor", ".meta-toggle", ".thumbImg"], h = 0; h < s.length; h++) {
            $(s[h]).addClass("hasHover")
          }
        }
      }

      function m() {
        $("#gui-spinner").stop(!0, !0).show()
      }

      function g() {
        $("#gui-spinner").fadeOut(1e3)
      }

      function v(e) {
        c(e), Q.requestFullscreen($("body")[0]), J.track("USER", {
          event_type: "showcase_gui",
          gui_action: "click_enter_fullscreen",
          interaction_source: "gui"
        }), H.reload()
      }

      function y(e) {
        var t = $("#meta-info");
        "block" === t.css("display") ? J.trackAlways("USER", {
          event_type: "showcase_gui",
          gui_action: "about_collapse"
        }) : "none" === $("#meta-info").css("display") && (J.trackAlways("USER", {
          event_type: "showcase_gui",
          gui_action: "about_expand"
        }), l("info")), $(".pinTop.right").toggleClass("hideUnderMeta"), t.slideToggle(le), $("#more-hint").toggle(), $("#less-hint").toggle(), e || s()
      }

      function b() {
        w(), $("#pause").hide(), $("#play").show(), $(".pinBottom").removeClass("playing"), $("#drawer").removeClass("playing"), $("#playHead").removeClass("playing"), z.stopTour()
      }

      function w() {
        for (var e = $(pe[0]), t = 1; t < pe.length; t++) {
          e = e.add(pe[t])
        };
        e.removeClass("hidden")
      }

      function _() {
        return z.describe().inTransition
      }

      function x(e) {}

      function M(e) {
        de = e.floorNames();
        for (var t = $(".gui-floor"), i = de.length; i > -1; --i) {
          var n = $("<div class=\"floorChoice\" data-index=\"" + i + "\"></div>").text(de[i]);
          $(".gui-floor").find(".container").prepend(n)
        };
        t.find(".container").prepend("<div class=\"floorChoice darkGlass allFloorBtn\" data-index=\"all\" style=\"display:none\">\u5168\u90e8</div>"), t.on("mousedown touchstart", function(e) {
          c(e), l("floor"), t.addClass("open")
        }), $(".floorChoice").on("mousedown touchstart", function(i) {
          c(i);
          var n = $(this).data("index");
          "all" !== n ? (z.gotoFloor(n, "gui"), J.track("USER", {
            event_type: "showcase_gui",
            gui_action: "click_floor_select_button",
            interaction_source: "gui"
          })) : (z.allFloors(), E(e.currentFloor, "gui"), J.track("USER", {
            event_type: "showcase_gui",
            gui_action: "click_toggle_all_floors_button",
            interaction_source: "gui"
          })), t.removeClass("open")
        })
      }

      function E(e, t) {
        e && ($(".gui-floor").removeClass("open"), t = t || G.mode, t === ee.DOLLHOUSE || t === ee.FLOORPLAN ? $(".allFloorBtn").show() : $(".allFloorBtn").hide(), e.model.allFloorsVisible ? ($(".gui-floor-title").text("All"), $(".floorChoice").removeClass("active"), $(".floorChoice[data-index=\"all\"]").addClass("active")) : ($(".gui-floor-title").text(de[e.floorIndex]), $(".floorChoice").removeClass("active"), $(".floorChoice[data-index=" + e.floorIndex + "]").addClass("active")))
      }

      function S(e) {
        $("<img/>").attr("src", e).on("load", function() {
          j || ($("#gui-thumb").css("backgroundImage", "url(" + e + ")").fadeIn(500), $("#gui-loading").addClass("use-background")), $(this).remove()
        })
      }

      function T(e) {
        ce = e.heroLocations.length;
        var t = "<li class=\"thumbImg\" data-index=\"\"><img src=\"\"></li>",
          i = 100 / ce + "%";
        $("#status").find(".totalSteps").text(ce);
        for (var n = 0; ce > n; n++) {
          var r = $(t);
          r.attr("data-index", n);
          r.find("img").attr("title", e.heroLocations[n].name);
          r.find("img").attr("src", g_Prefix + e.heroLocations[n].thumb);
          if (e.heroLocations[n].name) {
            var o = $("<div class=\"overlay\"></div>").text(e.heroLocations[n].name);
            r.prepend(o)
          };
          $("#thumb-container").append(r);
          $("#progressBar").append("<div class=\"step\" data-idx=\"" + n + "\" style=\"width:" + i + "\"></div>")
        };
        W = 144 * ce, Y = 111 * ce, $(".thumbImg").on("mouseover", function() {
          _() || z.showPath($(this).data("index"))
        }), $(".thumbImg").on("mouseout", function() {
          z.clearPath()
        });
        $(".thumbImg").on("click", function(e) {
          c(e);
          var t = $(this);
          J.trackAlways("USER", {
            event_type: "showcase_gui",
            gui_action: "click_highlight"
          }), z.goToHighlight(t.data("index"))
        }), $(".previous").find("a").on("mousedown touchstart", function(e) {
          c(e), J.trackAlways("USER", {
            event_type: "showcase_gui",
            gui_action: "prev_highlight"
          }), z.prevHighlight()
        }), $(".next").find("a").on("mousedown touchstart", function(e) {
          c(e), J.trackAlways("USER", {
            event_type: "showcase_gui",
            gui_action: "next_highlight"
          }), z.nextHighlight()
        }), $("#drawer").on("mouseleave", function(e) {
          c(e);
          var t = new MouseEvent("mouseup", {
            clientX: e.clientX,
            clientY: e.clientY,
            screenX: e.screenX,
            screenY: e.screenY
          });
          document.dispatchEvent(t)
        }), H = new Sly($("#scrollFrame"), {
          horizontal: !0,
          itemNav: "centered",
          smart: !0,
          scrollTrap: !0,
          scrollBy: 1,
          mouseDragging: !0,
          touchDragging: !0,
          speed: 300,
          dragHandle: !0,
          dynamicHandle: !0,
          clickBar: !0,
          scrollBar: $("#scroller"),
          activateOn: null
        }).init(), H.on("active", function(e, t) {
          ue = t, l("tour"), $(".step").removeClass("active"), $("#status").find(".curIdx").text(t + 1);
          for (var i = 0; t >= i; i++) {
            $("#progressBar").find("[data-idx='" + i + "']").addClass("active")
          }
        }), P()
      }

      function P() {
        var e;
        e = "undefined" != typeof window.innerWidth ? window.innerWidth : "undefined" != typeof document.documentElement && "undefined" != typeof document.documentElement.clientWidth && 0 !== document.documentElement.clientWidth ? document.documentElement.clientWidth : document.getElementsByTagName("body")[0].clientWidth;
        var t = e - 20,
          i = $("#scroller"),
          n = $("#scrollFrame");
        488 > e ? t >= Y ? (i.addClass("hidden"), n.addClass("noScroll")) : (i.removeClass("hidden"), n.removeClass("noScroll")) : t >= W ? (i.addClass("hidden"), n.addClass("noScroll")) : (i.removeClass("hidden"), n.removeClass("noScroll"))
      }

      function A(e) {
        var t = function(e, t) {
          ge[e].visible = t
        };
        t("address", e.address), t("email", e.contact_email), t("contactName", e.contact_name), t("phone", e.contact_phone), t("titleContainer", e.model_name), t("description", e.model_summary), t("upMode", e.dollhouse), t("highlight", e.highlight_reel), t("url", e.external_url), t("tourControls", e.tour_buttons)
      }

      function L(e) {
        $(".model-title").text(e.name);
        var t = $(".titleText");
        if (t.text(e.name), e.name.length > 19 && t.attr("title", e.name), $("head title").text(e.name + " - " + K.pageTitle), Q.isMobile() ? $("#gui-fullscreen").css("display", "none") : $("[rel=tooltip]").tooltip({
            delay: {
              show: 50,
              hide: 0
            },
            trigger: "hover",
            html: !1,
            viewport: {
              selector: "body",
              padding: 10
            }
          }), ge.description.visible && e.hasOwnProperty("summary") && e.summary ? $("#meta-description").text(e.summary) : ge.description.visible = !1, ge.contact.visible) {
          var i = [],
            n = !0,
            r = function(e, t) {
              var r = t || "<br>";
              n && (r = "", n = !1), i.push(r, e)
            };
          if (ge.contactName.visible && e.hasOwnProperty("contact_name") && e.contact_name && ($("#contact-data").append("<span id=\"contactName\"></span>").text(e.contact_name), n = !1), ge.phone.visible && e.hasOwnProperty("contact_phone") && e.contact_phone) {
            var o = e.contact_phone;
            e.formatted_contact_phone && (o = e.formatted_contact_phone), r(Q.isMobile() ? "<a id=\"phone\" href=\"callto:" + e.contact_phone + "\">" + o + "</a>" : "<span>" + o + "</span>")
          };
          ge.email.visible && e.hasOwnProperty("contact_email") && e.contact_email && r("<a id=\"email\" href=\"mailTo:" + e.contact_email + "\">" + e.contact_email + "</a>"), ge.url.visible && e.hasOwnProperty("external_url") && e.external_url && r("<a id=\"url\" target=\"blank\" href=\"" + e.external_url + "\">" + e.external_url + "</a>"), n ? ge.contact.visible = !1 : $("#contact-data").append(i.join(""))
        };
        if (ge.address.visible && e.hasOwnProperty("address") && e.address) {
          var a = [],
            s = JSON.parse(e.address),
            h = !1,
            l = !0,
            u = function(e, t) {
              var i = t || " ";
              l && (i = "", l = !1), a.push(i, e)
            };
          if (s.address_1 && u(s.address_1), s.address_2 && u(s.address_2), s.city && u(s.city, ", "), s.state && (h = !0, u(s.state, ", ")), s.zip) {
            var d = ", ";
            h && (d = " "), u(s.zip, d)
          };
          l ? ge.address.visible = !1 : $("#addressTxt").text(a.join(""))
        } else {
          ge.address.visible = !1
        };
        $(".meta-toggle").on("mousedown touchstart", function(e) {
          c(e), y()
        }), $("#meta-description").find("a").on("mousedown touchstart", function(e) {
          J.trackAlways("USER", {
            event_type: "about_link"
          })
        }), $(".contact-info a").on("mousedown touchstart", function(e) {
          var t = {
            event_type: "about_link"
          };
          switch ($(this).attr("id")) {
            case "phone":
              t.contact_type = "phone";
              break;
            case "email":
              t.contact_type = "email"
          };
          J.trackAlways("USER", t)
        }), $(".address a").on("mousedown touchstart", function(e) {
          J.trackAlways("USER", {
            event_type: "map_link"
          })
        })
      }

      function C() {
        if (K.mattertags.enableLinking) {
          var e = (document.getElementById("gui"), document.createElement("div"));
          e.id = "lightbox", e.classList.add("hidden"), e.classList.add("transparent"), e.innerHTML = "<a><div id=\"lightbox-close\">&#10005;</div></a>\x0A<iframe id=\"lightbox-contents\"></iframe>", gui.parentNode.insertBefore(e, gui);
          var t = document.getElementById("lightbox-contents"),
            i = document.getElementById("lightbox-close"),
            n = function(i) {
              e.classList.add("transparent"), t.src = "about:blank"
            },
            r = function(e) {
              "lightbox" === e.target.id && e.target.classList.contains("transparent") && e.target.classList.add("hidden")
            };
          i.addEventListener("mousedown", n), i.addEventListener("touchstart", n), e.addEventListener("webkitTransitionEnd", r, !0), e.addEventListener("transitionend", r, !0)
        }
      }

      function R(e, t) {
        e.data.player_options && A(e.data.player_options), L(e.data), e.data.image && S(e.data.image), K.autoplay ? (J.impression(!0), d(t), V()) : ($("#gui-message").fadeIn(250, function() {
          $(this).css("display", "table");
          var e = $("#gui-message").fracs().visible >= 0.5;
          J.impression(e)
        }), $("#button-play").on("mousedown touchstart", function(e) {
          return c(e), Q.inIframe() && Q.isMobile() ? void((top.location.href = self.location.href)) : ($("#gui-message").fadeOut(500, function() {
            d(t)
          }), void(V()))
        }))
      }

      function I(e, t, i) {
        j = e, z = t, G = i, G !== z.player && se.warn("Player/Director mismatch in gui.init()");
        j.outsideAllowed() || (ge.upMode.visible = !1), oe.init(j), C(), x(j), j.heroLocations.length > 1 ? T(j) : (ge.highlight.visible = !1, ge.tourControls.visible = !1), j.on("floor.changed", E), j.on("waiting", m), j.on("waiting-done", g), G.on("mode.changed", function(e, t) {
          U(j, t)
        }), G.on("mode.changing", function(e, t) {
          $(".nav-help-dialog").is(":visible") && ie.navHelpModeChange(e, t)
        }), G.controls[ee.PANORAMA].on("move", function() {
          l("move")
        }), G.controls[ee.DOLLHOUSE].on("move", function() {
          l("move")
        }), G.controls[ee.FLOORPLAN].on("move", function() {
          l("move")
        }), z.on("update.controls", function() {
          var t = z.describe();
          ge.tourControls.visible && (t.tourIsPlaying || t.isWarping ? ($("#play").hide(), $("#pause").show(), t.tourIsPlaying && ($(".pinBottom").addClass("playing"), $("#drawer").addClass("playing"), $("#playHead").addClass("playing"))) : ($("#play").show(), $("#pause").hide(), $(".pinBottom").removeClass("playing"), $("#drawer").removeClass("playing"), $("#playHead").removeClass("playing"))), E(j.currentFloor);
          var i, n, r, o = $("#progressBar"),
            a = $("#thumb-container");
          if (null !== t.currentItem) {
            var s, h;
            $("#status").find(".curIdx").text(t.currentItem + 1), t.onTheBus ? (s = "active", h = "recent") : (h = "active", s = "recent");
            var l = null === t.destinationItem || t.currentItem === t.destinationItem;
            if (t.destinationItem != null) {
              var keys = Object.keys(g_audio);
              var musicid = keys[t.destinationItem];
              if ("undefined" != typeof(g_audio[musicid])) {
                if (("undefined" != typeof(g_audio[musicid]["music"])) && g_touraudio.src != (g_Prefix + g_audio[musicid]["music"])) {
                  g_touraudio.src = g_Prefix + g_audio[musicid]["music"];
                  g_touraudio.play();
                  g_touraudio.loop = false;
                  document.getElementById("bgaudio").pause()
                }
              }
            };
            for (i = 0; i < e.heroLocations.length; i += 1) {
              r = a.find("[data-index='" + i + "']"), n = o.find("[data-idx='" + i + "']"), r.removeClass(h), n.removeClass(h), i === t.destinationItem ? (r.addClass(s), n.addClass(s), H.activate(i)) : l && i === t.currentItem ? (r.addClass(s), n.addClass(s)) : (r.removeClass(s), n.removeClass(s))
            }
          } else {
            for (i = 0; i < e.heroLocations.length; i += 1) {
              r = a.find("[data-index='" + i + "']"), n = o.find("[data-idx='" + i + "']"), r.removeClass("active"), r.removeClass("recent"), n.removeClass("active"), n.removeClass("recent")
            }
          }
        }), document.addEventListener("keydown", function(e) {
          switch (e.which) {
            case re.ZERO:
              K.debug && (K.modelAlpha = K.modelAlpha < 1 ? 1 : 0, j.changeModelAlpha(K.modelAlpha));
              break;
            case re.ONE:
              z.player.isInMode(ee.PANORAMA, ee.TRANSITIONING) || z.changeMode(ee.PANORAMA, "key");
              break;
            case re.TWO:
              ge.upMode.visible && !z.player.isInMode(ee.DOLLHOUSE, ee.TRANSITIONING) && (z.changeMode(ee.DOLLHOUSE, "key"), E(j.currentFloor));
              break;
            case re.THREE:
              ge.upMode.visible && !z.player.isInMode(ee.FLOORPLAN, ee.TRANSITIONING) && z.changeMode(ee.FLOORPLAN, "key");
              break;
            case re.SPACE:
              K.debug && j.toggleExplode();
              break;
            case re.RETURN:
              K.debug && j.toggleExplodeUp();
              break;
            case re.P:
              N();
              break;
            case re.U:
              k()
          };
          return z.player && z.player.reticule.hide(), !0
        }.bind(this)), B(), D()
      }

      function D() {
        function e() {
          t.linkToLocation = window.location.protocol + "//" + window.location.host + window.location.pathname + "?m=" + j.sid + "&start=" + G.serialize(), (K.mattertags.enableLinking || K.outdoorPanos) && (t.tagNav = "#tn=" + G.serialize()), G.activeTag && (t.linkToLocation += "&tag=" + G.activeTag.sid)
        }
        var t = {},
          i = new ae.GUI({
            autoPlace: !0,
            width: "60%"
          });
        me = {
          gui: i,
          visible: !0
        }, setInterval(e, 500), e();
        var n = "\u8fde\u63a5\u5230\u4f4d\u7f6e";
        i.add(t, "linkToLocation").name(n).listen();
        var r = null,
          o = null,
          a = null,
          s = null;
        if ($(i.domElement).find(".property-name").each(function() {
            var e = $(this);
            e.text() === n && (r = e)
          }), r && (i.domElement.style.width = "60%", r.css("width", "10%"), o = r.next(), o.css("width", "90%"), o.css("float", "left"), o.css("padding", "0px"), o.css("margin", "0px"), a = o.children().first(), a.css("height", "20px"), a.css("line-height", "20px"), a.css("width", "85%"), a.css("float", "left"), !Q.detectSafari())) {
          s = $("<button>Copy</button>"), s.addClass("btn-deep-link"), o.append(" "), o.append(s);
          var h = function() {
            alert("Please use CTRL/CMD + C to copy."), s.hide()
          };
          s.click(function() {
            try {
              var e = a[0];
              e.select();
              var t = document.execCommand("copy");
              e.blur(), t || h()
            } catch (i) {
              h()
            }
          })
        };
        $(i.__closeButton).hide(), O(!1)
      }

      function O(e) {
        me && (me.visible = e, e ? $(me.gui.domElement).show() : $(me.gui.domElement).hide())
      }

      function k() {
        O(!me.visible)
      }

      function B() {
        var e = new ae.GUI;
        fe = {
          gui: e,
          visible: !0
        }, e.add(K, "showSweeps").name("Show sweeps").onFinishChange(function() {
          j.setSweepVisibility(K.showSweeps)
        }), e.add(K, "rotationAccelerationInside", 0.1, 10).name("Rotation speed").step(0.1), e.add(K.transition, "flyTime", 0, 5e3).name("Transition time").onFinishChange(function() {
          K.transition.flySpeed = 0, e.__controllers.forEach(function(e) {
            e.updateDisplay()
          })
        }), e.add(K.path, "opacity", 0, 1).name("Path opacity"), $(e.__closeButton).hide(), F(!1)
      }

      function F(e) {
        fe && (fe.visible = e, e ? $(fe.gui.domElement).show() : $(fe.gui.domElement).hide())
      }

      function N() {
        F(!fe.visible)
      }

      function U(e, t) {
        E(e.currentFloor, t);
        var i = function() {
          $("#view-controllers").is(":visible") || $("#view-controllers").slideDown(le)
        };
        t === ee.DOLLHOUSE ? (g(), $("#gui-modes-dollhouse").toggleClass("active", t === ee.DOLLHOUSE), $("#gui-modes-floorplan").toggleClass("active", t === ee.FLOORPLAN), $("#gui-modes-inside").toggleClass("active", t === ee.PANORAMA), he = ee.DOLLHOUSE, i(), $("#gui-modes-map").addClass("active")) : t === ee.FLOORPLAN ? (g(), $("#gui-modes-dollhouse").toggleClass("active", t === ee.DOLLHOUSE), $("#gui-modes-floorplan").toggleClass("active", t === ee.FLOORPLAN), $("#gui-modes-inside").toggleClass("active", t === ee.PANORAMA), he = ee.FLOORPLAN, i(), $("#gui-modes-map").addClass("active")) : t === ee.PANORAMA ? (g(), $("#gui-modes-dollhouse").toggleClass("active", t === ee.DOLLHOUSE), $("#gui-modes-floorplan").toggleClass("active", t === ee.FLOORPLAN), $("#gui-modes-inside").toggleClass("active", t === ee.PANORAMA), he = ee.PANORAMA, i(), $("#gui-modes-map").addClass("active")) : "transitioning" !== t && ($("#view-controllers").slideUp(500), $("#gui-modes-map").removeClass("active", t === ee.PANORAMA))
      }

      function V() {
        $("body").css("touch-action", "none"), $("#gui-parent").find("*").on("touchmove", function(e) {
          e.preventDefault()
        }), $("#terms-text").off("touchmove").on("touchmove", function(e) {
          e.stopPropagation()
        })
      }
      var z, G, j, H, W, Y, X, q, Z = e("../util/ajax"),
        Q = (e("../util/common"), e("../util/browser")),
        K = e("../settings"),
        J = e("../analytics"),
        ee = (e("../objects/Model"), e("../enum/Viewmode")),
        te = e("../util/logger"),
        ie = (e("../util/lerp"), e("../util/easing"), e("../util/transitions"), e("./help")),
        ne = e("./circleLoader").circleLoader,
        re = e("../enum/Keys"),
        oe = e("./konami"),
        ae = e("../lib/dat.gui"),
        se = new te(i),
        he = ee.DOLLHOUSE,
        le = 250,
        ce = 0,
        ue = 0,
        de = [],
        pe = [".hideTarget"],
        fe = null,
        me = null,
        ge = {
          titleContainer: {
            visible: !0,
            elements: ["#model-title"]
          },
          coBrand: {
            visible: !0,
            elements: [".co-brand", "#loaderCoBrand"]
          },
          metaInfo: {
            visible: !0,
            elements: ["#meta-info", "#more-hint", "#less-hint"]
          },
          description: {
            visible: !0,
            elements: ["#meta-description"]
          },
          contact: {
            visible: !0,
            elements: [".contact-info"]
          },
          email: {
            visible: !0,
            elements: ["#email"]
          },
          address: {
            visible: !0,
            elements: [".address"]
          },
          phone: {
            visible: !0,
            elements: ["#phone"]
          },
          contactName: {
            visible: !0,
            elements: ["#contactName"]
          },
          url: {
            visible: !0,
            elements: ["#url"]
          },
          help: {
            visible: !0,
            elements: [".nav-help", "#nav-help"]
          },
          tourControls: {
            visible: !0,
            elements: [".next", ".previous", "#play"]
          },
          upMode: {
            visible: !0,
            elements: ["#gui-modes-map"]
          },
          highlight: {
            visible: !0,
            elements: ["#drawer", "#pullTab"]
          },
          share: {
            visible: !0,
            elements: [".socialButton", "#share"]
          },
          fullScreen: {
            visible: !0,
            elements: ["#gui-fullscreen"]
          },
          floors: {
            visible: !0,
            elements: [".gui-floor"]
          }
        };
      $(document).on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange", function(e) {
        $("#gui-fullscreen").toggle(!Q.isFullscreen()), $("#gui-fullscreen-exit").toggle(!!Q.isFullscreen()), setTimeout(function() {
          $(".icon:visible").hide().show(0)
        }, 100)
      }), Q.detectIE() ? $("#gui-fullscreen").find("a").on("mouseup", v) : $("#gui-fullscreen").find("a").on("mousedown touchstart", v), $("#gui-fullscreen-exit").find("a").on("mousedown touchstart", function(e) {
        c(e), Q.exitFullscreen(), J.track("USER", {
          event_type: "showcase_gui",
          gui_action: "click_exit_fullscreen",
          interaction_source: "gui"
        })
      }), $(window).on("resize", function(e) {
        var t = e.target.innerHeight,
          i = e.target.innerWidth;
        (t !== X || i !== q) && (ge.highlight.visible && P(), l("resize"), $(".pinTop.right").removeClass("hideUnderMeta"), u(), X = t, q = i)
      }).resize(), Q.supportsFullscreen() || $("#gui-fullscreen").hide(), $("#title-toggle").on("mousedown touchstart", function(e) {
        function t() {
          i && r.toggleClass("closed")
        }
        c(e);
        var i, n = $(".title-container"),
          r = $("#model-title");
        $("#title-toggle").find("i").toggleClass("icon-dpad-left icon-dpad-right"), $(".pinTop.right").toggleClass("reposition"), "none" === n.css("display") ? (J.trackAlways("USER", {
          event_type: "showcase_gui",
          gui_action: "about_show"
        }), i = !1) : (J.trackAlways("USER", {
          event_type: "showcase_gui",
          gui_action: "about_hide"
        }), i = !0), i || r.toggleClass("closed"), $("#meta-info").is(":visible") ? (y(), $(".title-container").animate({
          opacity: 1
        }, le).animate({
          width: "toggle"
        }, {
          duration: le,
          complete: t
        })) : $(".title-container").animate({
          width: "toggle"
        }, {
          duration: le,
          complete: t
        })
      }), $("#configuratorWindow").on("mousedown touchstart", function(e) {
        if (g_SelectTextIndex != null) {
          $("#text")[0].innerText = g_TextShow[parseInt(g_SelectTextIndex)];
          $("#sideimg")[0].src = g_Prefix + g_Text["Text" + g_SelectTextIndex].imgsrc;
          $(".sidecontent").animate({
            left: "0",
            opacity: "show"
          }, 800)
        }
      }), $("#gui-modes-map").find("a").on("mousedown touchstart", function(e) {
        c(e), G.mode === ee.DOLLHOUSE || G.mode === ee.FLOORPLAN ? (J.track("USER", {
          event_type: "showcase_gui",
          gui_action: "click_inside_mode_button"
        }), z.changeMode(ee.PANORAMA, "gui")) : (J.track("USER", {
          event_type: "showcase_gui",
          gui_action: "click_outside_mode_button"
        }), z.changeMode(he, "gui"))
      }), $("#gui-modes-floorplan").on("mousedown touchstart", function(e) {
        c(e);
        $("#gui-remove-face").css("display", "none");
        if (G.mode !== ee.FLOORPLAN) {
          J.track("USER", {
            event_type: "showcase_gui",
            gui_action: "click_floorplan_mode_button"
          });
          z.changeMode(ee.FLOORPLAN)
        }
      }), $("#gui-remove-face").on("mousedown touchstart", function(e) {
        c(e);
        $("#gui-remove-face").toggleClass("active");

        function r(t) {
          if (g_roof.indexOf(t.name) > -1) {
            if ($("#gui-remove-face").css("opacity") == 0.2) {
              t.visible = true
            } else {
              t.visible = false
            }
          }
        }
        G.model.chunks.map(r)
      }), $("#gui-modes-edithot").on("mousedown touchstart", function(e) {
        if (g_HotStatus == "add") {
          g_HotStatus = null
        } else {
          g_HotStatus = "add"
        }
      }), $("#gui-modes-dollhouse").on("mousedown touchstart", function(e) {
        if (g_roof != null) {
          $("#gui-remove-face").css("display", "table")
        };
        c(e), G.mode !== ee.DOLLHOUSE && (J.track("USER", {
          event_type: "showcase_gui",
          gui_action: "click_dollhouse_mode_button"
        }), z.changeMode(ee.DOLLHOUSE))
      }), $("#gui-modes-inside").on("mousedown touchstart", function(e) {
        $("#gui-remove-face").css("display", "none");
        c(e), G.mode !== ee.PANORAMA && (J.track("USER", {
          event_type: "showcase_gui",
          gui_action: "click_panorama_mode_button"
        }), z.changeMode(ee.PANORAMA))
      }), $("#pullTab").on("mousedown touchstart", function(e) {
        c(e), $("#drawer").hasClass("open") ? J.trackAlways("USER", {
          event_type: "showcase_gui",
          gui_action: "hide_highlight_reel"
        }) : J.trackAlways("USER", {
          event_type: "showcase_gui",
          gui_action: "show_highlight_reel"
        }), a()
      }), $("#more-menu-button").on("mousedown touchstart", function(e) {
        c(e);
        var t = $("#more-menu");
        t.toggleClass("open")
      }), $("#play").on("mousedown touchstart", function(e) {
        c(e);
        l("tour");
        z.playTour();
        J.trackAlways("USER", {
          event_type: "showcase_gui",
          gui_action: "play_highlights"
        })
      }), $("#pause").find("a").on("mousedown touchstart", function(e) {
        if (g_bgaudio) {
          document.getElementById("bgaudio").play()
        };
        c(e), z.stopTour(), J.trackAlways("USER", {
          event_type: "showcase_gui",
          gui_action: "pause_highlights"
        })
      }), $(".icon").on("mouseover", function() {
        G && G.reticule.hide()
      }), $(".side-client-close").click(function() {
        $(".sidecontent").animate({
          left: "-2050",
          opacity: "show"
        }, 800)
      }), t.exports.init = I, t.exports.startLoading = d, t.exports.coverScreen = R, t.exports.endLoading = f, t.exports.endTour = b, t.exports.paneControl = l
    }).call(this, "/js/gui/gui.js")
  }

  function _$af269547(e, t, i) {
    (function(i) {
      "use strict";

      function n(e, t) {
        var i = f.isMobile() ? _[e] : w[e];
        if (i) {
          var o = $(".nav-help-elements"),
            a = o.find(".prev-button"),
            s = o.find(".next-button"),
            h = i.length / 2;
          if (!(1 > t || t > h)) {
            var l = i[2 * t - 1],
              c = "<img class=\"icon\" src=\"images/" + l + "\" title=\"navigation icon\">";
            o.find(".nav-icon").html(c);
            var u = i[2 * t - 2];
            o.find(".nav-text").text(u), o.find(".page-count").text(t + " / " + h), x = t, $(".nav-help-dialog .close").off().on("mousedown touchstart", function(e) {
              e.preventDefault(), e.stopImmediatePropagation(), d.track("USER", {
                event_type: "showcase_gui",
                gui_action: "help_close"
              }), r()
            }), a.off(), 1 === t ? a.hide() : a.show().on("mousedown touchstart", function(e) {
              e.preventDefault(), e.stopImmediatePropagation(), d.track("USER", {
                event_type: "showcase_gui",
                gui_action: "help_prev"
              }), n(m.player.mode, --t)
            }), s.off(), t === h ? $(".nav-help-elements .next-button").text("\u641e\u5b9a\u4e86").on("mousedown touchstart", function(e) {
              e.preventDefault(), e.stopImmediatePropagation(), d.track("USER", {
                event_type: "showcase_gui",
                gui_action: "help_done"
              }), r()
            }) : s.text("\u4e0b\u4e00\u4e2a").on("mousedown touchstart", function(e) {
              e.preventDefault(), e.stopImmediatePropagation(), d.track("USER", {
                event_type: "showcase_gui",
                gui_action: "help_next"
              }), n(m.player.mode, ++t)
            }), $(window).resize(), $(".nav-help-dialog").fadeIn()
          }
        }
      }

      function r() {
        var e = $(".nav-help-dialog");
        e.fadeOut(1e3), x = 0
      }

      function o() {
        var e;
        try {
          e = window.localStorage.getItem("visitCount") || "0", e = (parseFloat(e) + 1).toString(), window.localStorage.setItem("visitCount", e)
        } catch (t) {
          e = "1"
        };
        (null === p.autohelp && "1" === e || "1" === p.autohelp) && setTimeout(function() {
          n(m.player.mode, 1)
        }, 5e3)
      }

      function a() {
        y || (y = !0, w[u.PANORAMA].splice(4, 0, "\u5355\u51fb\u64ad\u653e\u6309\u94ae\u4ee5\u83b7\u5f97\u5bfc\u6e38", "Nav_Help_Play.png"), _[u.PANORAMA].splice(4, 0, "\u5355\u51fb\u64ad\u653e\u6309\u94ae\u4ee5\u83b7\u5f97\u5bfc\u6e38", "Nav_Help_Touch_Play.png"))
      }

      function s() {
        v || (v = !0, w[u.PANORAMA].splice(4, 0, "\u5355\u51fb\"\u5bfc\u89c8\"\u6309\u94ae\u770b\u5230\u5bfc\u89c8\u7684\u7a7a\u95f4", "Nav_Help_Highlights.png"), _[u.PANORAMA].splice(4, 0, "\u5355\u51fb\"\u5bfc\u89c8\"\u6309\u94ae\u770b\u5230\u5bfc\u89c8\u7684\u7a7a\u95f4", "Nav_Help_Touch_Highlights.png"))
      }

      function h() {
        b || (b = !0, w[u.PANORAMA].push("\u5355\u51fb\u8ff7\u4f60\u6a21\u578b\u56fe\u6807\u53ef\u67e5\u770b\u6574\u4e2a\u7a7a\u95f4", "Nav_Help_New_dollhouse.png"), _[u.PANORAMA].push("\u5355\u51fb\u8ff7\u4f60\u6a21\u578b\u56fe\u6807\u53ef\u67e5\u770b\u6574\u4e2a\u7a7a\u95f4", "Nav_Help_Touch_Dollhouse.png"))
      }

      function l(e, t) {
        if (e === u.PANORAMA && t === u.DOLLHOUSE) {
          var i = f.isMobile() ? _[e] : w[e],
            o = i ? i.length / 2 : 0;
          if (x === o) {
            return $(".nav-help-dialog .close").off().on("mousedown touchstart", function(e) {
              e.preventDefault(), e.stopPropagation(), d.track("USER", {
                event_type: "showcase_gui",
                gui_action: "help_close"
              }), r(), setTimeout(function() {
                m.player.insideMode()
              }, 1e3)
            }), $(".nav-help-elements .next-button").off().on("mousedown touchstart", function(e) {
              e.preventDefault(), e.stopPropagation(), d.track("USER", {
                event_type: "showcase_gui",
                gui_action: "help_done"
              }), r(), setTimeout(function() {
                m.player.insideMode()
              }, 1e3)
            }), void($(".nav-help-elements .prev-button").off().on("mousedown touchstart", function(e) {
              e.preventDefault(), e.stopPropagation(), d.track("USER", {
                event_type: "showcase_gui",
                gui_action: "help_prev"
              }), M = !0, m.player.insideMode()
            }))
          }
        };
        return e === u.DOLLHOUSE && t === u.PANORAMA && M ? (M = !1, void(n(u.PANORAMA, x - 1))) : void((e !== t && (M = !1, r())))
      }
      var c = e("./../util/logger"),
        u = e("./../enum/Viewmode"),
        d = e("./../analytics"),
        p = e("./../settings"),
        f = e("./../util/browser"),
        m = e("./gui"),
        g = new c(i),
        v = !1,
        y = !1,
        b = !1,
        w = {};
      w[u.PANORAMA] = ["\u4f7f\u7528\u7bad\u5934\u952e\u79fb\u52a8", "Nav_Help_Arrow_keys.png", "\u5355\u51fb\u6216\u8005\u62d6\u52a8\u9f20\u6807\u6765\u79fb\u52a8", "Nav_Help_Left_Mouse.png"], w[u.DOLLHOUSE] = ["\u4f7f\u7528\u7bad\u5934\u952e\u6765\u63a2\u7d22\u8ff7\u4f60\u6a21\u578b", "Nav_Help_Arrow_keys.png", "\u901a\u8fc7\u70b9\u51fb\u5b83\u80fd\u5230\u67d0\u4e2a\u623f\u95f4\u91cc. \u5355\u51fb\u6216\u8005\u62d6\u52a8\u9f20\u6807\u6765\u79fb\u52a8.", "Nav_Help_Left_Mouse.png"], w[u.FLOORPLAN] = ["\u4f7f\u7528\u5de6\u3001\u53f3\u7bad\u5934\u952e\u6765\u65cb\u8f6c", "Nav_Help_LeftRight_Keys.png", "\u4f7f\u7528\u4e0a\u3001\u4e0b\u7bad\u5934\u952e\u6765\u7f29\u653e", "Nav_Help_UpDown_Keys.png", "\u70b9\u51fb\u6765\u8fdb\u884c\u6f2b\u6e38", "Nav_Help_Left_Mouse.png"];
      var _ = {};
      _[u.PANORAMA] = ["\u70b9\u51fb\u4f60\u60f3\u5230\u7684\u4efb\u4f55\u5730\u65b9", "Nav_Help_Tap.png", "\u901a\u8fc7\u62d6\u52a8\u6765\u8fdb\u884c\u79fb\u52a8", "Nav_Help_Drag_Turn.png"], _[u.DOLLHOUSE] = ["\u70b9\u51fb\u5e95\u90e8\u7684\"\u8ff7\u4f60\u6a21\u578b\"\u53ef\u4ee5\u770b\u5230\u6574\u4e2a\u623f\u5b50", "Nav_Help_Tap.png", "\u901a\u8fc7\u62d6\u52a8\u6765\u8fdb\u884c\u65cb\u8f6c", "Nav_Help_Drag_Rotate.png"], _[u.FLOORPLAN] = ["\u70b9\u51fb\u5e95\u90e8\u7684\"\u4fef\u89c6\u56fe\"\u53ef\u4ee5\u770b\u5230\u6574\u4e2a\u623f\u5b50", "Nav_Help_Tap.png", "\u901a\u8fc7\u62d6\u52a8\u6765\u8fdb\u884c\u65cb\u8f6c", "Nav_Help_Drag_Pan.png"];
      var x = 0,
        M = !1;
      $(".nav-help").on("mousedown touchstart", function(e) {
        e.preventDefault(), e.stopPropagation();
        if ($("#volume")[0].src.indexOf("btn_on.png") > -1) {
          g_bgaudio = false;
          document.getElementById("bgaudio").pause();
          g_touraudio.volume = 0;
          $("#volume").attr("src", "./images/Volume btn_off.png");
          $("#volume").attr("title", "\u5173\u95ed\u58f0\u97f3")
        } else {
          if ($("#volume")[0].src.indexOf("btn_off.png") > -1) {
            g_bgaudio = true;
            document.getElementById("bgaudio").play();
            $("#volume").attr("src", "./images/Volume btn_on.png");
            $("#volume").attr("title", "\u6253\u5f00\u58f0\u97f3")
          }
        }
      }), t.exports.navHelpSessionStart = o, t.exports.navHelpModeChange = l, t.exports.addPlayHelp = a, t.exports.addHighlightReelHelp = s, t.exports.addDollhouseHelp = h, t.exports.closeHelp = r
    }).call(this, "/js/gui/help.js")
  }

  function _$af269567(e, t, i) {
    (function(i) {
      "use strict";

      function n(e) {
        r = e
      }
      var r, o = e("./../util/logger"),
        a = e("./../settings"),
        s = e("./debug"),
        h = e("./../util/common"),
        l = e("./gui"),
        c = new o(i),
        u = [];
      $(window).on("keydown", function(e) {
        u.push(e.which), u.length > a.secretPanelWord.length && u.shift(), h.equalLists(u, a.secretPanelWord) && (a.debug = !0)
      }), $(window).on("keydown", function d(e) {
        a.debug && 72 == e.which && (r && l.player ? (s.toggle(r, l.player), $(window).off("keydown", d)) : console.warn("sorry we're not ready yet"))
      }), a.console && $("body").append("<div id=\"debug-console\"></div>"), t.exports.init = n
    }).call(this, "/js/gui/konami.js")
  }

  function _$af269572(e, t, i) {
    "use strict";
    var n = n || {};
    t.exports = n, n.gui = n.gui || {}, n.utils = n.utils || {}, n.controllers = n.controllers || {}, n.dom = n.dom || {}, n.color = n.color || {}, n.utils.css = function() {
      return {
        load: function(e, t) {
          t = t || document;
          var i = t.createElement("link");
          i.type = "text/css", i.rel = "stylesheet", i.href = e, t.getElementsByTagName("head")[0].appendChild(i)
        },
        inject: function(e, t) {
          t = t || document;
          var i = document.createElement("style");
          i.type = "text/css", i.innerHTML = e, t.getElementsByTagName("head")[0].appendChild(i)
        }
      }
    }(), n.utils.common = function() {
      var e = Array.prototype.forEach,
        t = Array.prototype.slice;
      return {
        BREAK: {},
        extend: function(e) {
          return this.each(t.call(arguments, 1), function(t) {
            for (var i in t) {
              this.isUndefined(t[i]) || (e[i] = t[i])
            }
          }, this), e
        },
        defaults: function(e) {
          return this.each(t.call(arguments, 1), function(t) {
            for (var i in t) {
              this.isUndefined(e[i]) && (e[i] = t[i])
            }
          }, this), e
        },
        compose: function() {
          var e = t.call(arguments);
          return function() {
            for (var i = t.call(arguments), n = e.length - 1; n >= 0; n--) {
              i = [e[n].apply(this, i)]
            };
            return i[0]
          }
        },
        each: function(t, i, n) {
          if (t) {
            if (e && t.forEach && t.forEach === e) {
              t.forEach(i, n)
            } else {
              if (t.length === t.length + 0) {
                for (var r = 0, o = t.length; o > r; r++) {
                  if (r in t && i.call(n, t[r], r) === this.BREAK) {
                    return
                  }
                }
              } else {
                for (var r in t) {
                  if (i.call(n, t[r], r) === this.BREAK) {
                    return
                  }
                }
              }
            }
          }
        },
        defer: function(e) {
          setTimeout(e, 0)
        },
        toArray: function(e) {
          return e.toArray ? e.toArray() : t.call(e)
        },
        isUndefined: function(e) {
          return void(0) === e
        },
        isNull: function(e) {
          return null === e
        },
        isNaN: function(e) {
          return e !== e
        },
        isArray: Array.isArray || function(e) {
          return e.constructor === Array
        },
        isObject: function(e) {
          return e === Object(e)
        },
        isNumber: function(e) {
          return e === e + 0
        },
        isString: function(e) {
          return e === e + ""
        },
        isBoolean: function(e) {
          return e === !1 || e === !0
        },
        isFunction: function(e) {
          return "[object Function]" === Object.prototype.toString.call(e)
        }
      }
    }(), n.controllers.Controller = function(e) {
      var t = function(e, t) {
        this.initialValue = e[t], this.domElement = document.createElement("div"), this.object = e, this.property = t, this.__onChange = void(0), this.__onFinishChange = void(0)
      };
      return e.extend(t.prototype, {
        onChange: function(e) {
          return this.__onChange = e, this
        },
        onFinishChange: function(e) {
          return this.__onFinishChange = e, this
        },
        setValue: function(e) {
          return this.object[this.property] = e, this.__onChange && this.__onChange.call(this, e), this.updateDisplay(), this
        },
        getValue: function() {
          return this.object[this.property]
        },
        updateDisplay: function() {
          return this
        },
        isModified: function() {
          return this.initialValue !== this.getValue()
        }
      }), t
    }(n.utils.common), n.dom.dom = function(e) {
      function t(t) {
        if ("0" === t || e.isUndefined(t)) {
          return 0
        };
        var i = t.match(r);
        return e.isNull(i) ? 0 : parseFloat(i[1])
      }
      var i = {
          HTMLEvents: ["change"],
          MouseEvents: ["click", "mousemove", "mousedown", "mouseup", "mouseover"],
          KeyboardEvents: ["keydown"]
        },
        n = {};
      e.each(i, function(t, i) {
        e.each(t, function(e) {
          n[e] = i
        })
      });
      var r = /(\d+(\.\d+)?)px/,
        o = {
          makeSelectable: function(e, t) {
            void(0) !== e && void(0) !== e.style && (e.onselectstart = t ? function() {
              return !1
            } : function() {}, e.style.MozUserSelect = t ? "auto" : "none", e.style.KhtmlUserSelect = t ? "auto" : "none", e.unselectable = t ? "on" : "off")
          },
          makeFullscreen: function(t, i, n) {
            e.isUndefined(i) && (i = !0), e.isUndefined(n) && (n = !0), t.style.position = "absolute", i && (t.style.left = 0, t.style.right = 0), n && (t.style.top = 0, t.style.bottom = 0)
          },
          fakeEvent: function(t, i, r, o) {
            r = r || {};
            var a = n[i];
            if (!a) {
              throw new Error("Event type " + i + " not supported.")
            };
            var s = document.createEvent(a);
            switch (a) {
              case "MouseEvents":
                var h = r.x || r.clientX || 0,
                  l = r.y || r.clientY || 0;
                s.initMouseEvent(i, r.bubbles || !1, r.cancelable || !0, window, r.clickCount || 1, 0, 0, h, l, !1, !1, !1, !1, 0, null);
                break;
              case "KeyboardEvents":
                var c = s.initKeyboardEvent || s.initKeyEvent;
                e.defaults(r, {
                  cancelable: !0,
                  ctrlKey: !1,
                  altKey: !1,
                  shiftKey: !1,
                  metaKey: !1,
                  keyCode: void(0),
                  charCode: void(0)
                }), c(i, r.bubbles || !1, r.cancelable, window, r.ctrlKey, r.altKey, r.shiftKey, r.metaKey, r.keyCode, r.charCode);
                break;
              default:
                s.initEvent(i, r.bubbles || !1, r.cancelable || !0)
            };
            e.defaults(s, o), t.dispatchEvent(s)
          },
          bind: function(e, t, i, n) {
            return n = n || !1, e.addEventListener ? e.addEventListener(t, i, n) : e.attachEvent && e.attachEvent("on" + t, i), o
          },
          unbind: function(e, t, i, n) {
            return n = n || !1, e.removeEventListener ? e.removeEventListener(t, i, n) : e.detachEvent && e.detachEvent("on" + t, i), o
          },
          addClass: function(e, t) {
            if (void(0) === e.className) {
              e.className = t
            } else {
              if (e.className !== t) {
                var i = e.className.split(/ +/); - 1 == i.indexOf(t) && (i.push(t), e.className = i.join(" ").replace(/^\s+/, "").replace(/\s+$/, ""))
              }
            };
            return o
          },
          removeClass: function(e, t) {
            if (t) {
              if (void(0) === e.className) {;
              } else {
                if (e.className === t) {
                  e.removeAttribute("class")
                } else {
                  var i = e.className.split(/ +/),
                    n = i.indexOf(t); - 1 != n && (i.splice(n, 1), e.className = i.join(" "))
                }
              }
            } else {
              e.className = void(0)
            };
            return o
          },
          hasClass: function(e, t) {
            return new RegExp("(?:^|\\s+)" + t + "(?:\\s+|$)").test(e.className) || !1
          },
          getWidth: function(e) {
            var i = getComputedStyle(e);
            return t(i["border-left-width"]) + t(i["border-right-width"]) + t(i["padding-left"]) + t(i["padding-right"]) + t(i.width)
          },
          getHeight: function(e) {
            var i = getComputedStyle(e);
            return t(i["border-top-width"]) + t(i["border-bottom-width"]) + t(i["padding-top"]) + t(i["padding-bottom"]) + t(i.height)
          },
          getOffset: function(e) {
            var t = {
              left: 0,
              top: 0
            };
            if (e.offsetParent) {
              do {
                t.left += e.offsetLeft, t.top += e.offsetTop
              } while (e = e.offsetParent);
            };
            return t
          },
          isActive: function(e) {
            return e === document.activeElement && (e.type || e.href)
          }
        };
      return o
    }(n.utils.common), n.controllers.OptionController = function(e, t, i) {
      var n = function(e, r, o) {
        n.superclass.call(this, e, r);
        var a = this;
        if (this.__select = document.createElement("select"), i.isArray(o)) {
          var s = {};
          i.each(o, function(e) {
            s[e] = e
          }), o = s
        };
        i.each(o, function(e, t) {
          var i = document.createElement("option");
          i.innerHTML = t, i.setAttribute("value", e), a.__select.appendChild(i)
        }), this.updateDisplay(), t.bind(this.__select, "change", function() {
          var e = this.options[this.selectedIndex].value;
          a.setValue(e)
        }), this.domElement.appendChild(this.__select)
      };
      return n.superclass = e, i.extend(n.prototype, e.prototype, {
        setValue: function(e) {
          var t = n.superclass.prototype.setValue.call(this, e);
          return this.__onFinishChange && this.__onFinishChange.call(this, this.getValue()), t
        },
        updateDisplay: function() {
          return this.__select.value = this.getValue(), n.superclass.prototype.updateDisplay.call(this)
        }
      }), n
    }(n.controllers.Controller, n.dom.dom, n.utils.common), n.controllers.NumberController = function(e, t) {
      function i(e) {
        return e = e.toString(), e.indexOf(".") > -1 ? e.length - e.indexOf(".") - 1 : 0
      }
      var n = function(e, r, o) {
        n.superclass.call(this, e, r), o = o || {}, this.__min = o.min, this.__max = o.max, this.__step = o.step, this.__impliedStep = t.isUndefined(this.__step) ? 0 == this.initialValue ? 1 : Math.pow(10, Math.floor(Math.log(this.initialValue) / Math.LN10)) / 10 : this.__step, this.__precision = i(this.__impliedStep)
      };
      return n.superclass = e, t.extend(n.prototype, e.prototype, {
        setValue: function(e) {
          return void(0) !== this.__min && e < this.__min ? e = this.__min : void(0) !== this.__max && e > this.__max && (e = this.__max), void(0) !== this.__step && e % this.__step != 0 && (e = Math.round(e / this.__step) * this.__step), n.superclass.prototype.setValue.call(this, e)
        },
        min: function(e) {
          return this.__min = e, this
        },
        max: function(e) {
          return this.__max = e, this
        },
        step: function(e) {
          return this.__step = e, this.__impliedStep = e, this.__precision = i(e), this
        }
      }), n
    }(n.controllers.Controller, n.utils.common), n.controllers.NumberControllerBox = function(e, t, i) {
      function n(e, t) {
        var i = Math.pow(10, t);
        return Math.round(e * i) / i
      }
      var r = function(e, n, o) {
        function a() {
          var e = parseFloat(d.__input.value);
          i.isNaN(e) || d.setValue(e)
        }

        function s() {
          a(), d.__onFinishChange && d.__onFinishChange.call(d, d.getValue())
        }

        function h(e) {
          t.bind(window, "mousemove", l), t.bind(window, "mouseup", c), u = e.clientY
        }

        function l(e) {
          var t = u - e.clientY;
          d.setValue(d.getValue() + t * d.__impliedStep), u = e.clientY
        }

        function c() {
          t.unbind(window, "mousemove", l), t.unbind(window, "mouseup", c)
        }
        this.__truncationSuspended = !1, r.superclass.call(this, e, n, o);
        var u, d = this;
        this.__input = document.createElement("input"), this.__input.setAttribute("type", "text"), t.bind(this.__input, "change", a), t.bind(this.__input, "blur", s), t.bind(this.__input, "mousedown", h), t.bind(this.__input, "keydown", function(e) {
          13 === e.keyCode && (d.__truncationSuspended = !0, this.blur(), d.__truncationSuspended = !1)
        }), this.updateDisplay(), this.domElement.appendChild(this.__input)
      };
      return r.superclass = e, i.extend(r.prototype, e.prototype, {
        updateDisplay: function() {
          return this.__input.value = this.__truncationSuspended ? this.getValue() : n(this.getValue(), this.__precision), r.superclass.prototype.updateDisplay.call(this)
        }
      }), r
    }(n.controllers.NumberController, n.dom.dom, n.utils.common), n.controllers.NumberControllerSlider = function(e, t, i, n, r) {
      function o(e, t, i, n, r) {
        return n + (r - n) * ((e - t) / (i - t))
      }
      var a = function(e, i, n, r, s) {
        function h(e) {
          t.bind(window, "mousemove", l), t.bind(window, "mouseup", c), l(e)
        }

        function l(e) {
          e.preventDefault();
          var i = t.getOffset(u.__background),
            n = t.getWidth(u.__background);
          return u.setValue(o(e.clientX, i.left, i.left + n, u.__min, u.__max)), !1
        }

        function c() {
          t.unbind(window, "mousemove", l), t.unbind(window, "mouseup", c), u.__onFinishChange && u.__onFinishChange.call(u, u.getValue())
        }
        a.superclass.call(this, e, i, {
          min: n,
          max: r,
          step: s
        });
        var u = this;
        this.__background = document.createElement("div"), this.__foreground = document.createElement("div"), t.bind(this.__background, "mousedown", h), t.addClass(this.__background, "slider"), t.addClass(this.__foreground, "slider-fg"), this.updateDisplay(), this.__background.appendChild(this.__foreground), this.domElement.appendChild(this.__background)
      };
      return a.superclass = e, a.useDefaultStyles = function() {
        i.inject(r)
      }, n.extend(a.prototype, e.prototype, {
        updateDisplay: function() {
          var e = (this.getValue() - this.__min) / (this.__max - this.__min);
          return this.__foreground.style.width = 100 * e + "%", a.superclass.prototype.updateDisplay.call(this)
        }
      }), a
    }(n.controllers.NumberController, n.dom.dom, n.utils.css, n.utils.common, ""), n.controllers.FunctionController = function(e, t, i) {
      var n = function(e, i, r) {
        n.superclass.call(this, e, i);
        var o = this;
        this.__button = document.createElement("div"), this.__button.innerHTML = void(0) === r ? "Fire" : r, t.bind(this.__button, "click", function(e) {
          return e.preventDefault(), o.fire(), !1
        }), t.addClass(this.__button, "button"), this.domElement.appendChild(this.__button)
      };
      return n.superclass = e, i.extend(n.prototype, e.prototype, {
        fire: function() {
          this.__onChange && this.__onChange.call(this), this.__onFinishChange && this.__onFinishChange.call(this, this.getValue()), this.getValue().call(this.object)
        }
      }), n
    }(n.controllers.Controller, n.dom.dom, n.utils.common), n.controllers.BooleanController = function(e, t, i) {
      var n = function(e, i) {
        function r() {
          o.setValue(!o.__prev)
        }
        n.superclass.call(this, e, i);
        var o = this;
        this.__prev = this.getValue(), this.__checkbox = document.createElement("input"), this.__checkbox.setAttribute("type", "checkbox"), t.bind(this.__checkbox, "change", r, !1), this.domElement.appendChild(this.__checkbox), this.updateDisplay()
      };
      return n.superclass = e, i.extend(n.prototype, e.prototype, {
        setValue: function(e) {
          var t = n.superclass.prototype.setValue.call(this, e);
          return this.__onFinishChange && this.__onFinishChange.call(this, this.getValue()), this.__prev = this.getValue(), t
        },
        updateDisplay: function() {
          return this.getValue() === !0 ? (this.__checkbox.setAttribute("checked", "checked"), this.__checkbox.checked = !0) : this.__checkbox.checked = !1, n.superclass.prototype.updateDisplay.call(this)
        }
      }), n
    }(n.controllers.Controller, n.dom.dom, n.utils.common), n.color.toString = function(e) {
      return function(t) {
        if (1 == t.a || e.isUndefined(t.a)) {
          for (var i = t.hex.toString(16); i.length < 6;) {
            i = "0" + i
          };
          return "#" + i
        };
        return "rgba(" + Math.round(t.r) + "," + Math.round(t.g) + "," + Math.round(t.b) + "," + t.a + ")"
      }
    }(n.utils.common), n.color.interpret = function(e, t) {
      var i, n, r = function() {
          n = !1;
          var e = arguments.length > 1 ? t.toArray(arguments) : arguments[0];
          return t.each(o, function(r) {
            return r.litmus(e) ? (t.each(r.conversions, function(r, o) {
              return i = r.read(e), n === !1 && i !== !1 ? (n = i, i.conversionName = o, i.conversion = r, t.BREAK) : void(0)
            }), t.BREAK) : void(0)
          }), n
        },
        o = [{
          litmus: t.isString,
          conversions: {
            THREE_CHAR_HEX: {
              read: function(e) {
                var t = e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);
                return null === t ? !1 : {
                  space: "HEX",
                  hex: parseInt("0x" + t[1].toString() + t[1].toString() + t[2].toString() + t[2].toString() + t[3].toString() + t[3].toString())
                }
              },
              write: e
            },
            SIX_CHAR_HEX: {
              read: function(e) {
                var t = e.match(/^#([A-F0-9]{6})$/i);
                return null === t ? !1 : {
                  space: "HEX",
                  hex: parseInt("0x" + t[1].toString())
                }
              },
              write: e
            },
            CSS_RGB: {
              read: function(e) {
                var t = e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);
                return null === t ? !1 : {
                  space: "RGB",
                  r: parseFloat(t[1]),
                  g: parseFloat(t[2]),
                  b: parseFloat(t[3])
                }
              },
              write: e
            },
            CSS_RGBA: {
              read: function(e) {
                var t = e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);
                return null === t ? !1 : {
                  space: "RGB",
                  r: parseFloat(t[1]),
                  g: parseFloat(t[2]),
                  b: parseFloat(t[3]),
                  a: parseFloat(t[4])
                }
              },
              write: e
            }
          }
        }, {
          litmus: t.isNumber,
          conversions: {
            HEX: {
              read: function(e) {
                return {
                  space: "HEX",
                  hex: e,
                  conversionName: "HEX"
                }
              },
              write: function(e) {
                return e.hex
              }
            }
          }
        }, {
          litmus: t.isArray,
          conversions: {
            RGB_ARRAY: {
              read: function(e) {
                return 3 != e.length ? !1 : {
                  space: "RGB",
                  r: e[0],
                  g: e[1],
                  b: e[2]
                }
              },
              write: function(e) {
                return [e.r, e.g, e.b]
              }
            },
            RGBA_ARRAY: {
              read: function(e) {
                return 4 != e.length ? !1 : {
                  space: "RGB",
                  r: e[0],
                  g: e[1],
                  b: e[2],
                  a: e[3]
                }
              },
              write: function(e) {
                return [e.r, e.g, e.b, e.a]
              }
            }
          }
        }, {
          litmus: t.isObject,
          conversions: {
            RGBA_OBJ: {
              read: function(e) {
                return t.isNumber(e.r) && t.isNumber(e.g) && t.isNumber(e.b) && t.isNumber(e.a) ? {
                  space: "RGB",
                  r: e.r,
                  g: e.g,
                  b: e.b,
                  a: e.a
                } : !1
              },
              write: function(e) {
                return {
                  r: e.r,
                  g: e.g,
                  b: e.b,
                  a: e.a
                }
              }
            },
            RGB_OBJ: {
              read: function(e) {
                return t.isNumber(e.r) && t.isNumber(e.g) && t.isNumber(e.b) ? {
                  space: "RGB",
                  r: e.r,
                  g: e.g,
                  b: e.b
                } : !1
              },
              write: function(e) {
                return {
                  r: e.r,
                  g: e.g,
                  b: e.b
                }
              }
            },
            HSVA_OBJ: {
              read: function(e) {
                return t.isNumber(e.h) && t.isNumber(e.s) && t.isNumber(e.v) && t.isNumber(e.a) ? {
                  space: "HSV",
                  h: e.h,
                  s: e.s,
                  v: e.v,
                  a: e.a
                } : !1
              },
              write: function(e) {
                return {
                  h: e.h,
                  s: e.s,
                  v: e.v,
                  a: e.a
                }
              }
            },
            HSV_OBJ: {
              read: function(e) {
                return t.isNumber(e.h) && t.isNumber(e.s) && t.isNumber(e.v) ? {
                  space: "HSV",
                  h: e.h,
                  s: e.s,
                  v: e.v
                } : !1
              },
              write: function(e) {
                return {
                  h: e.h,
                  s: e.s,
                  v: e.v
                }
              }
            }
          }
        }];
      return r
    }(n.color.toString, n.utils.common), n.GUI = n.gui.GUI = function(e, t, i, n, r, o, a, s, h, l, c, u, d, p, f) {
      function m(e, t, i, o) {
        if (void(0) === t[i]) {
          throw new Error("Object " + t + " has no property \"" + i + "\"")
        };
        var a;
        if (o.color) {
          a = new c(t, i)
        } else {
          var s = [t, i].concat(o.factoryArgs);
          a = n.apply(e, s)
        };
        o.before instanceof r && (o.before = o.before.__li), y(e, a), p.addClass(a.domElement, "c");
        var h = document.createElement("span");
        p.addClass(h, "property-name"), h.innerHTML = a.property;
        var l = document.createElement("div");
        l.appendChild(h), l.appendChild(a.domElement);
        var u = g(e, l, o.before);
        return p.addClass(u, N.CLASS_CONTROLLER_ROW), p.addClass(u, typeof a.getValue()), v(e, u, a), e.__controllers.push(a), a
      }

      function g(e, t, i) {
        var n = document.createElement("li");
        return t && n.appendChild(t), i ? e.__ul.insertBefore(n, params.before) : e.__ul.appendChild(n), e.onResize(), n
      }

      function v(e, t, i) {
        if (i.__li = t, i.__gui = e, f.extend(i, {
            options: function(t) {
              return arguments.length > 1 ? (i.remove(), m(e, i.object, i.property, {
                before: i.__li.nextElementSibling,
                factoryArgs: [f.toArray(arguments)]
              })) : f.isArray(t) || f.isObject(t) ? (i.remove(), m(e, i.object, i.property, {
                before: i.__li.nextElementSibling,
                factoryArgs: [t]
              })) : void(0)
            },
            name: function(e) {
              return i.__li.firstElementChild.firstElementChild.innerHTML = e, i
            },
            listen: function() {
              return i.__gui.listen(i), i
            },
            remove: function() {
              return i.__gui.remove(i), i
            }
          }), i instanceof h) {
          var n = new s(i.object, i.property, {
            min: i.__min,
            max: i.__max,
            step: i.__step
          });
          f.each(["updateDisplay", "onChange", "onFinishChange"], function(e) {
            var t = i[e],
              r = n[e];
            i[e] = n[e] = function() {
              var e = Array.prototype.slice.call(arguments);
              return t.apply(i, e), r.apply(n, e)
            }
          }), p.addClass(t, "has-slider"), i.domElement.insertBefore(n.domElement, i.domElement.firstElementChild)
        } else {
          if (i instanceof s) {
            var r = function(t) {
              return f.isNumber(i.__min) && f.isNumber(i.__max) ? (i.remove(), m(e, i.object, i.property, {
                before: i.__li.nextElementSibling,
                factoryArgs: [i.__min, i.__max, i.__step]
              })) : t
            };
            i.min = f.compose(r, i.min), i.max = f.compose(r, i.max)
          } else {
            i instanceof o ? (p.bind(t, "click", function() {
              p.fakeEvent(i.__checkbox, "click")
            }), p.bind(i.__checkbox, "click", function(e) {
              e.stopPropagation()
            })) : i instanceof a ? (p.bind(t, "click", function() {
              p.fakeEvent(i.__button, "click")
            }), p.bind(t, "mouseover", function() {
              p.addClass(i.__button, "hover")
            }), p.bind(t, "mouseout", function() {
              p.removeClass(i.__button, "hover")
            })) : i instanceof c && (p.addClass(t, "color"), i.updateDisplay = f.compose(function(e) {
              return t.style.borderLeftColor = i.__color.toString(), e
            }, i.updateDisplay), i.updateDisplay())
          }
        };
        i.setValue = f.compose(function(t) {
          return e.getRoot().__preset_select && i.isModified() && T(e.getRoot(), !0), t
        }, i.setValue)
      }

      function y(e, t) {
        var i = e.getRoot(),
          n = i.__rememberedObjects.indexOf(t.object);
        if (-1 != n) {
          var r = i.__rememberedObjectIndecesToControllers[n];
          if (void(0) === r && (r = {}, i.__rememberedObjectIndecesToControllers[n] = r), r[t.property] = t, i.load && i.load.remembered) {
            var o, a = i.load.remembered;
            if (a[e.preset]) {
              o = a[e.preset]
            } else {
              if (!a[D]) {
                return
              };
              o = a[D]
            };
            if (o[n] && void(0) !== o[n][t.property]) {
              var s = o[n][t.property];
              t.initialValue = s, t.setValue(s)
            }
          }
        }
      }

      function b(e, t) {
        return document.location.href + "." + t
      }

      function w(e) {
        var t = e.__save_row = document.createElement("li");
        p.addClass(e.domElement, "has-save"), e.__ul.insertBefore(t, e.__ul.firstChild), p.addClass(t, "save-row");
        var i = document.createElement("span");
        i.innerHTML = "&nbsp;", p.addClass(i, "button gears");
        var n = document.createElement("span");
        n.innerHTML = "Save", p.addClass(n, "button"), p.addClass(n, "save");
        var r = document.createElement("span");
        r.innerHTML = "New", p.addClass(r, "button"), p.addClass(r, "save-as");
        var o = document.createElement("span");
        o.innerHTML = "Revert", p.addClass(o, "button"), p.addClass(o, "revert");
        var a = e.__preset_select = document.createElement("select");
        if (e.load && e.load.remembered ? f.each(e.load.remembered, function(t, i) {
            E(e, i, i == e.preset)
          }) : E(e, D, !1), p.bind(a, "change", function() {
            for (var t = 0; t < e.__preset_select.length; t++) {
              e.__preset_select[t].innerHTML = e.__preset_select[t].value
            };
            e.preset = this.value
          }), t.appendChild(a), t.appendChild(i), t.appendChild(n), t.appendChild(r), t.appendChild(o), O) {
          var s = document.getElementById("dg-save-locally"),
            h = document.getElementById("dg-local-explain");
          s.style.display = "block";
          var l = document.getElementById("dg-local-storage");
          "true" === localStorage.getItem(b(e, "isLocal")) && l.setAttribute("checked", "checked");
          var c = function() {
            h.style.display = e.useLocalStorage ? "block" : "none"
          };
          c(), p.bind(l, "change", function() {
            e.useLocalStorage = !e.useLocalStorage, c()
          })
        };
        var u = document.getElementById("dg-new-constructor");
        p.bind(u, "keydown", function(e) {
          !e.metaKey || 67 !== e.which && 67 != e.keyCode || A.hide()
        }), p.bind(i, "click", function() {
          u.innerHTML = JSON.stringify(e.getSaveObject(), void(0), 2), A.show(), u.focus(), u.select()
        }), p.bind(n, "click", function() {
          e.save()
        }), p.bind(r, "click", function() {
          var t = prompt("Enter a new preset name.");
          t && e.saveAs(t)
        }), p.bind(o, "click", function() {
          e.revert()
        })
      }

      function _(e) {
        function t(t) {
          return t.preventDefault(), r = t.clientX, p.addClass(e.__closeButton, N.CLASS_DRAG), p.bind(window, "mousemove", i), p.bind(window, "mouseup", n), !1
        }

        function i(t) {
          return t.preventDefault(), e.width += r - t.clientX, e.onResize(), r = t.clientX, !1
        }

        function n() {
          p.removeClass(e.__closeButton, N.CLASS_DRAG), p.unbind(window, "mousemove", i), p.unbind(window, "mouseup", n)
        }
        e.__resize_handle = document.createElement("div"), f.extend(e.__resize_handle.style, {
          width: "6px",
          marginLeft: "-3px",
          height: "200px",
          cursor: "ew-resize",
          position: "absolute"
        });
        var r;
        p.bind(e.__resize_handle, "mousedown", t), p.bind(e.__closeButton, "mousedown", t), e.domElement.insertBefore(e.__resize_handle, e.domElement.firstElementChild)
      }

      function x(e, t) {
        e.domElement.style.width = t + "px", e.__save_row && e.autoPlace && (e.__save_row.style.width = t + "px"), e.__closeButton && (e.__closeButton.style.width = t + "px")
      }

      function M(e, t) {
        var i = {};
        return f.each(e.__rememberedObjects, function(n, r) {
          var o = {},
            a = e.__rememberedObjectIndecesToControllers[r];
          f.each(a, function(e, i) {
            o[i] = t ? e.initialValue : e.getValue()
          }), i[r] = o
        }), i
      }

      function E(e, t, i) {
        var n = document.createElement("option");
        n.innerHTML = t, n.value = t, e.__preset_select.appendChild(n), i && (e.__preset_select.selectedIndex = e.__preset_select.length - 1)
      }

      function S(e) {
        for (var t = 0; t < e.__preset_select.length; t++) {
          e.__preset_select[t].value == e.preset && (e.__preset_select.selectedIndex = t)
        }
      }

      function T(e, t) {
        var i = e.__preset_select[e.__preset_select.selectedIndex];
        i.innerHTML = t ? i.value + "*" : i.value
      }

      function P(e) {
        0 != e.length && u(function() {
          P(e)
        }), f.each(e, function(e) {
          e.updateDisplay()
        })
      }
      e.inject(i);
      var A, L, C = "dg",
        R = 72,
        I = 20,
        D = "Default",
        O = function() {
          try {
            return "localStorage" in window && null !== window.localStorage
          } catch (e) {
            return !1
          }
        }(),
        k = !0,
        B = !1,
        F = [],
        N = function(e) {
          function t() {
            var e = i.getRoot();
            e.width += 1, f.defer(function() {
              e.width -= 1
            })
          }
          var i = this;
          this.domElement = document.createElement("div"), this.__ul = document.createElement("ul"), this.domElement.appendChild(this.__ul), p.addClass(this.domElement, C), this.__folders = {}, this.__controllers = [], this.__rememberedObjects = [], this.__rememberedObjectIndecesToControllers = [], this.__listening = [], e = e || {}, e = f.defaults(e, {
            autoPlace: !0,
            width: N.DEFAULT_WIDTH
          }), e = f.defaults(e, {
            resizable: e.autoPlace,
            hideable: e.autoPlace
          }), f.isUndefined(e.load) ? e.load = {
            preset: D
          } : e.preset && (e.load.preset = e.preset), f.isUndefined(e.parent) && e.hideable && F.push(this), e.resizable = f.isUndefined(e.parent) && e.resizable, e.autoPlace && f.isUndefined(e.scrollable) && (e.scrollable = !0);
          var n, r = O && "true" === localStorage.getItem(b(this, "isLocal"));
          if (Object.defineProperties(this, {
              parent: {
                get: function() {
                  return e.parent
                }
              },
              scrollable: {
                get: function() {
                  return e.scrollable
                }
              },
              autoPlace: {
                get: function() {
                  return e.autoPlace
                }
              },
              preset: {
                get: function() {
                  return i.parent ? i.getRoot().preset : e.load.preset
                },
                set: function(t) {
                  i.parent ? i.getRoot().preset = t : e.load.preset = t, S(this), i.revert()
                }
              },
              width: {
                get: function() {
                  return e.width
                },
                set: function(t) {
                  e.width = t, x(i, t)
                }
              },
              name: {
                get: function() {
                  return e.name
                },
                set: function(t) {
                  e.name = t, a && (a.innerHTML = e.name)
                }
              },
              closed: {
                get: function() {
                  return e.closed
                },
                set: function(t) {
                  e.closed = t, e.closed ? p.addClass(i.__ul, N.CLASS_CLOSED) : p.removeClass(i.__ul, N.CLASS_CLOSED), this.onResize(), i.__closeButton && (i.__closeButton.innerHTML = t ? N.TEXT_OPEN : N.TEXT_CLOSED)
                }
              },
              load: {
                get: function() {
                  return e.load
                }
              },
              useLocalStorage: {
                get: function() {
                  return r
                },
                set: function(e) {
                  O && (r = e, e ? p.bind(window, "unload", n) : p.unbind(window, "unload", n), localStorage.setItem(b(i, "isLocal"), e))
                }
              }
            }), f.isUndefined(e.parent)) {
            if (e.closed = !1, p.addClass(this.domElement, N.CLASS_MAIN), p.makeSelectable(this.domElement, !1), O && r) {
              i.useLocalStorage = !0;
              var o = localStorage.getItem(b(this, "gui"));
              o && (e.load = JSON.parse(o))
            };
            this.__closeButton = document.createElement("div"), this.__closeButton.innerHTML = N.TEXT_CLOSED, p.addClass(this.__closeButton, N.CLASS_CLOSE_BUTTON), this.domElement.appendChild(this.__closeButton), p.bind(this.__closeButton, "click", function() {
              i.closed = !i.closed
            })
          } else {
            void(0) === e.closed && (e.closed = !0);
            var a = document.createTextNode(e.name);
            p.addClass(a, "controller-name");
            var s = g(i, a),
              h = function(e) {
                return e.preventDefault(), i.closed = !i.closed, !1
              };
            p.addClass(this.__ul, N.CLASS_CLOSED), p.addClass(s, "title"), p.bind(s, "click", h), e.closed || (this.closed = !1)
          };
          e.autoPlace && (f.isUndefined(e.parent) && (k && (L = document.createElement("div"), p.addClass(L, C), p.addClass(L, N.CLASS_AUTO_PLACE_CONTAINER), document.body.appendChild(L), k = !1), L.appendChild(this.domElement), p.addClass(this.domElement, N.CLASS_AUTO_PLACE)), this.parent || x(i, e.width)), p.bind(window, "resize", function() {
            i.onResize()
          }), p.bind(this.__ul, "webkitTransitionEnd", function() {
            i.onResize()
          }), p.bind(this.__ul, "transitionend", function() {
            i.onResize()
          }), p.bind(this.__ul, "oTransitionEnd", function() {
            i.onResize()
          }), this.onResize(), e.resizable && _(this), n = function() {
            O && "true" === localStorage.getItem(b(i, "isLocal")) && localStorage.setItem(b(i, "gui"), JSON.stringify(i.getSaveObject()))
          }, this.saveToLocalStorageIfPossible = n;
          i.getRoot();
          e.parent || t()
        };
      return N.toggleHide = function() {
        B = !B, f.each(F, function(e) {
          e.domElement.style.zIndex = B ? -999 : 999, e.domElement.style.opacity = B ? 0 : 1
        })
      }, N.CLASS_AUTO_PLACE = "a", N.CLASS_AUTO_PLACE_CONTAINER = "ac", N.CLASS_MAIN = "main", N.CLASS_CONTROLLER_ROW = "cr", N.CLASS_TOO_TALL = "taller-than-window", N.CLASS_CLOSED = "closed", N.CLASS_CLOSE_BUTTON = "close-button", N.CLASS_DRAG = "drag", N.DEFAULT_WIDTH = 245, N.TEXT_CLOSED = "Close Controls", N.TEXT_OPEN = "Open Controls", p.bind(window, "keydown", function(e) {
        "text" === document.activeElement.type || e.which !== R && e.keyCode != R || N.toggleHide()
      }, !1), f.extend(N.prototype, {
        add: function(e, t) {
          return m(this, e, t, {
            factoryArgs: Array.prototype.slice.call(arguments, 2)
          })
        },
        addColor: function(e, t) {
          return m(this, e, t, {
            color: !0
          })
        },
        remove: function(e) {
          this.__ul.removeChild(e.__li), this.__controllers.slice(this.__controllers.indexOf(e), 1);
          var t = this;
          f.defer(function() {
            t.onResize()
          })
        },
        destroy: function() {
          this.autoPlace && L.removeChild(this.domElement)
        },
        addFolder: function(e) {
          if (void(0) !== this.__folders[e]) {
            throw new Error("You already have a folder in this GUI by the name \"" + e + "\"")
          };
          var t = {
            name: e,
            parent: this
          };
          t.autoPlace = this.autoPlace, this.load && this.load.folders && this.load.folders[e] && (t.closed = this.load.folders[e].closed, t.load = this.load.folders[e]);
          var i = new N(t);
          this.__folders[e] = i;
          var n = g(this, i.domElement);
          return p.addClass(n, "folder"), i
        },
        open: function() {
          this.closed = !1
        },
        close: function() {
          this.closed = !0
        },
        onResize: function() {
          var e = this.getRoot();
          if (e.scrollable) {
            var t = p.getOffset(e.__ul).top,
              i = 0;
            f.each(e.__ul.childNodes, function(t) {
              e.autoPlace && t === e.__save_row || (i += p.getHeight(t))
            }), window.innerHeight - t - I < i ? (p.addClass(e.domElement, N.CLASS_TOO_TALL), e.__ul.style.height = window.innerHeight - t - I + "px") : (p.removeClass(e.domElement, N.CLASS_TOO_TALL), e.__ul.style.height = "auto")
          };
          e.__resize_handle && f.defer(function() {
            e.__resize_handle.style.height = e.__ul.offsetHeight + "px"
          }), e.__closeButton && (e.__closeButton.style.width = e.width + "px")
        },
        remember: function() {
          if (f.isUndefined(A) && (A = new d, A.domElement.innerHTML = t), this.parent) {
            throw new Error("You can only call remember on a top level GUI.")
          };
          var e = this;
          f.each(Array.prototype.slice.call(arguments), function(t) {
            0 == e.__rememberedObjects.length && w(e), -1 == e.__rememberedObjects.indexOf(t) && e.__rememberedObjects.push(t)
          }), this.autoPlace && x(this, this.width)
        },
        getRoot: function() {
          for (var e = this; e.parent;) {
            e = e.parent
          };
          return e
        },
        getSaveObject: function() {
          var e = this.load;
          return e.closed = this.closed, this.__rememberedObjects.length > 0 && (e.preset = this.preset, e.remembered || (e.remembered = {}), e.remembered[this.preset] = M(this)), e.folders = {}, f.each(this.__folders, function(t, i) {
            e.folders[i] = t.getSaveObject()
          }), e
        },
        save: function() {
          this.load.remembered || (this.load.remembered = {}), this.load.remembered[this.preset] = M(this), T(this, !1), this.saveToLocalStorageIfPossible()
        },
        saveAs: function(e) {
          this.load.remembered || (this.load.remembered = {}, this.load.remembered[D] = M(this, !0)), this.load.remembered[e] = M(this), this.preset = e, E(this, e, !0), this.saveToLocalStorageIfPossible()
        },
        revert: function(e) {
          f.each(this.__controllers, function(t) {
            this.getRoot().load.remembered ? y(e || this.getRoot(), t) : t.setValue(t.initialValue)
          }, this), f.each(this.__folders, function(e) {
            e.revert(e)
          }), e || T(this.getRoot(), !1)
        },
        listen: function(e) {
          var t = 0 == this.__listening.length;
          this.__listening.push(e), t && P(this.__listening)
        }
      }), N
    }(n.utils.css, "<div id=\"dg-save\" class=\"dg dialogue\">\x0A\x0A  Here's the new load parameter for your <code>GUI</code>'s constructor:\x0A\x0A  <textarea id=\"dg-new-constructor\"></textarea>\x0A\x0A  <div id=\"dg-save-locally\">\x0A\x0A    <input id=\"dg-local-storage\" type=\"checkbox\"/> Automatically save\x0A    values to <code>localStorage</code> on exit.\x0A\x0A    <div id=\"dg-local-explain\">The values saved to <code>localStorage</code> will\x0A      override those passed to <code>dat.GUI</code>'s constructor. This makes it\x0A      easier to work incrementally, but <code>localStorage</code> is fragile,\x0A      and your friends may not see the same values you do.\x0A      \x0A    </div>\x0A    \x0A  </div>\x0A\x0A</div>", ".dg {\x0A  /** Clear list styles */\x0A  /* Auto-place container */\x0A  /* Auto-placed GUI's */\x0A  /* Line items that don't contain folders. */\x0A  /** Folder names */\x0A  /** Hides closed items */\x0A  /** Controller row */\x0A  /** Name-half (left) */\x0A  /** Controller-half (right) */\x0A  /** Controller placement */\x0A  /** Shorter number boxes when slider is present. */\x0A  /** Ensure the entire boolean and function row shows a hand */ }\x0A  .dg ul {\x0A    list-style: none;\x0A    margin: 0;\x0A    padding: 0;\x0A    width: 100%;\x0A    clear: both; }\x0A  .dg.ac {\x0A    position: fixed;\x0A    top: 0;\x0A    left: 0;\x0A    right: 0;\x0A    height: 0;\x0A    z-index: 0; }\x0A  .dg:not(.ac) .main {\x0A    /** Exclude mains in ac so that we don't hide close button */\x0A    overflow: hidden; }\x0A  .dg.main {\x0A    -webkit-transition: opacity 0.1s linear;\x0A    -o-transition: opacity 0.1s linear;\x0A    -moz-transition: opacity 0.1s linear;\x0A    transition: opacity 0.1s linear; }\x0A    .dg.main.taller-than-window {\x0A      overflow-y: auto; }\x0A      .dg.main.taller-than-window .close-button {\x0A        opacity: 1;\x0A        /* TODO, these are style notes */\x0A        margin-top: -1px;\x0A        border-top: 1px solid #2c2c2c; }\x0A    .dg.main ul.closed .close-button {\x0A      opacity: 1 !important; }\x0A    .dg.main:hover .close-button,\x0A    .dg.main .close-button.drag {\x0A      opacity: 1; }\x0A    .dg.main .close-button {\x0A      /*opacity: 0;*/\x0A      -webkit-transition: opacity 0.1s linear;\x0A      -o-transition: opacity 0.1s linear;\x0A      -moz-transition: opacity 0.1s linear;\x0A      transition: opacity 0.1s linear;\x0A      border: 0;\x0A      position: absolute;\x0A      line-height: 19px;\x0A      height: 20px;\x0A      /* TODO, these are style notes */\x0A      cursor: pointer;\x0A      text-align: center;\x0A      background-color: #000; }\x0A      .dg.main .close-button:hover {\x0A        background-color: #111; }\x0A  .dg.a {\x0A    float: right;\x0A    margin-right: 15px;\x0A    overflow-x: hidden; }\x0A    .dg.a.has-save > ul {\x0A      margin-top: 27px; }\x0A      .dg.a.has-save > ul.closed {\x0A        margin-top: 0; }\x0A    .dg.a .save-row {\x0A      position: fixed;\x0A      top: 0;\x0A      z-index: 1002; }\x0A  .dg li {\x0A    -webkit-transition: height 0.1s ease-out;\x0A    -o-transition: height 0.1s ease-out;\x0A    -moz-transition: height 0.1s ease-out;\x0A    transition: height 0.1s ease-out; }\x0A  .dg li:not(.folder) {\x0A    cursor: auto;\x0A    height: 27px;\x0A    line-height: 27px;\x0A    overflow: hidden;\x0A    padding: 0 4px 0 5px; }\x0A  .dg li.folder {\x0A    padding: 0;\x0A    border-left: 4px solid rgba(0, 0, 0, 0); }\x0A  .dg li.title {\x0A    cursor: pointer;\x0A    margin-left: -4px; }\x0A  .dg .closed li:not(.title),\x0A  .dg .closed ul li,\x0A  .dg .closed ul li > * {\x0A    height: 0;\x0A    overflow: hidden;\x0A    border: 0; }\x0A  .dg .cr {\x0A    clear: both;\x0A    padding-left: 3px;\x0A    height: 27px; }\x0A  .dg .property-name {\x0A    cursor: default;\x0A    float: left;\x0A    clear: left;\x0A    width: 40%;\x0A    overflow: hidden;\x0A    text-overflow: ellipsis; }\x0A  .dg .c {\x0A    float: left;\x0A    width: 60%; }\x0A  .dg .c input[type=text] {\x0A    border: 0;\x0A    margin-top: 4px;\x0A    padding: 3px;\x0A    width: 100%;\x0A    float: right; }\x0A  .dg .has-slider input[type=text] {\x0A    width: 30%;\x0A    /*display: none;*/\x0A    margin-left: 0; }\x0A  .dg .slider {\x0A    float: left;\x0A    width: 66%;\x0A    margin-left: -5px;\x0A    margin-right: 0;\x0A    height: 19px;\x0A    margin-top: 4px; }\x0A  .dg .slider-fg {\x0A    height: 100%; }\x0A  .dg .c input[type=checkbox] {\x0A    margin-top: 9px; }\x0A  .dg .c select {\x0A    margin-top: 5px; }\x0A  .dg .cr.function,\x0A  .dg .cr.function .property-name,\x0A  .dg .cr.function *,\x0A  .dg .cr.boolean,\x0A  .dg .cr.boolean * {\x0A    cursor: pointer; }\x0A  .dg .selector {\x0A    display: none;\x0A    position: absolute;\x0A    margin-left: -9px;\x0A    margin-top: 23px;\x0A    z-index: 10; }\x0A  .dg .c:hover .selector,\x0A  .dg .selector.drag {\x0A    display: block; }\x0A  .dg li.save-row {\x0A    padding: 0; }\x0A    .dg li.save-row .button {\x0A      display: inline-block;\x0A      padding: 0px 6px; }\x0A  .dg.dialogue {\x0A    background-color: #222;\x0A    width: 460px;\x0A    padding: 15px;\x0A    font-size: 13px;\x0A    line-height: 15px; }\x0A\x0A/* TODO Separate style and structure */\x0A#dg-new-constructor {\x0A  padding: 10px;\x0A  color: #222;\x0A  font-family: Monaco, monospace;\x0A  font-size: 10px;\x0A  border: 0;\x0A  resize: none;\x0A  box-shadow: inset 1px 1px 1px #888;\x0A  word-wrap: break-word;\x0A  margin: 12px 0;\x0A  display: block;\x0A  width: 440px;\x0A  overflow-y: scroll;\x0A  height: 100px;\x0A  position: relative; }\x0A\x0A#dg-local-explain {\x0A  display: none;\x0A  font-size: 11px;\x0A  line-height: 17px;\x0A  border-radius: 3px;\x0A  background-color: #333;\x0A  padding: 8px;\x0A  margin-top: 10px; }\x0A  #dg-local-explain code {\x0A    font-size: 10px; }\x0A\x0A#dat-gui-save-locally {\x0A  display: none; }\x0A\x0A/** Main type */\x0A.dg {\x0A  color: #eee;\x0A  font: 11px 'Lucida Grande', sans-serif;\x0A  text-shadow: 0 -1px 0 #111;\x0A  /** Auto place */\x0A  /* Controller row, <li> */\x0A  /** Controllers */ }\x0A  .dg.main {\x0A    /** Scrollbar */ }\x0A    .dg.main::-webkit-scrollbar {\x0A      width: 5px;\x0A      background: #1a1a1a; }\x0A    .dg.main::-webkit-scrollbar-corner {\x0A      height: 0;\x0A      display: none; }\x0A    .dg.main::-webkit-scrollbar-thumb {\x0A      border-radius: 5px;\x0A      background: #676767; }\x0A  .dg li:not(.folder) {\x0A    background: #1a1a1a;\x0A    border-bottom: 1px solid #2c2c2c; }\x0A  .dg li.save-row {\x0A    line-height: 25px;\x0A    background: #dad5cb;\x0A    border: 0; }\x0A    .dg li.save-row select {\x0A      margin-left: 5px;\x0A      width: 108px; }\x0A    .dg li.save-row .button {\x0A      margin-left: 5px;\x0A      margin-top: 1px;\x0A      border-radius: 2px;\x0A      font-size: 9px;\x0A      line-height: 7px;\x0A      padding: 4px 4px 5px 4px;\x0A      background: #c5bdad;\x0A      color: #fff;\x0A      text-shadow: 0 1px 0 #b0a58f;\x0A      box-shadow: 0 -1px 0 #b0a58f;\x0A      cursor: pointer; }\x0A      .dg li.save-row .button.gears {\x0A        background: #c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;\x0A        height: 7px;\x0A        width: 8px; }\x0A      .dg li.save-row .button:hover {\x0A        background-color: #bab19e;\x0A        box-shadow: 0 -1px 0 #b0a58f; }\x0A  .dg li.folder {\x0A    border-bottom: 0; }\x0A  .dg li.title {\x0A    padding-left: 16px;\x0A    background: black url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;\x0A    cursor: pointer;\x0A    border-bottom: 1px solid rgba(255, 255, 255, 0.2); }\x0A  .dg .closed li.title {\x0A    background-image: url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==); }\x0A  .dg .cr.boolean {\x0A    border-left: 3px solid #806787; }\x0A  .dg .cr.function {\x0A    border-left: 3px solid #e61d5f; }\x0A  .dg .cr.number {\x0A    border-left: 3px solid #2fa1d6; }\x0A    .dg .cr.number input[type=text] {\x0A      color: #2fa1d6; }\x0A  .dg .cr.string {\x0A    border-left: 3px solid #1ed36f; }\x0A    .dg .cr.string input[type=text] {\x0A      color: #1ed36f; }\x0A  .dg .cr.function:hover, .dg .cr.boolean:hover {\x0A    background: #111; }\x0A  .dg .c input[type=text] {\x0A    background: #303030;\x0A    outline: none; }\x0A    .dg .c input[type=text]:hover {\x0A      background: #3c3c3c; }\x0A    .dg .c input[type=text]:focus {\x0A      background: #494949;\x0A      color: #fff; }\x0A  .dg .c .slider {\x0A    background: #303030;\x0A    cursor: ew-resize; }\x0A  .dg .c .slider-fg {\x0A    background: #2fa1d6; }\x0A  .dg .c .slider:hover {\x0A    background: #3c3c3c; }\x0A    .dg .c .slider:hover .slider-fg {\x0A      background: #44abda; }\x0A", n.controllers.factory = function(e, t, i, n, r, o, a) {
      return function(s, h) {
        var l = s[h];
        return a.isArray(arguments[2]) || a.isObject(arguments[2]) ? new e(s, h, arguments[2]) : a.isNumber(l) ? a.isNumber(arguments[2]) && a.isNumber(arguments[3]) ? new i(s, h, arguments[2], arguments[3]) : new t(s, h, {
          min: arguments[2],
          max: arguments[3]
        }) : a.isString(l) ? new n(s, h) : a.isFunction(l) ? new r(s, h, "") : a.isBoolean(l) ? new o(s, h) : void(0)
      }
    }(n.controllers.OptionController, n.controllers.NumberControllerBox, n.controllers.NumberControllerSlider, n.controllers.StringController = function(e, t, i) {
      var n = function(e, i) {
        function r() {
          a.setValue(a.__input.value)
        }

        function o() {
          a.__onFinishChange && a.__onFinishChange.call(a, a.getValue())
        }
        n.superclass.call(this, e, i);
        var a = this;
        this.__input = document.createElement("input"), this.__input.setAttribute("type", "text"), t.bind(this.__input, "keyup", r), t.bind(this.__input, "change", r), t.bind(this.__input, "blur", o), t.bind(this.__input, "keydown", function(e) {
          13 === e.keyCode && this.blur()
        }), this.updateDisplay(), this.domElement.appendChild(this.__input)
      };
      return n.superclass = e, i.extend(n.prototype, e.prototype, {
        updateDisplay: function() {
          return t.isActive(this.__input) || (this.__input.value = this.getValue()), n.superclass.prototype.updateDisplay.call(this)
        }
      }), n
    }(n.controllers.Controller, n.dom.dom, n.utils.common), n.controllers.FunctionController, n.controllers.BooleanController, n.utils.common), n.controllers.Controller, n.controllers.BooleanController, n.controllers.FunctionController, n.controllers.NumberControllerBox, n.controllers.NumberControllerSlider, n.controllers.OptionController, n.controllers.ColorController = function(e, t, i, n, r) {
      function o(e, t, i, n) {
        e.style.background = "", r.each(h, function(r) {
          e.style.cssText += "background: " + r + "linear-gradient(" + t + ", " + i + " 0%, " + n + " 100%); "
        })
      }

      function a(e) {
        e.style.background = "", e.style.cssText += "background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);", e.style.cssText += "background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);", e.style.cssText += "background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);", e.style.cssText += "background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);", e.style.cssText += "background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"
      }
      var s = function(e, h) {
        function l(e) {
          p(e), t.bind(window, "mousemove", p), t.bind(window, "mouseup", c)
        }

        function c() {
          t.unbind(window, "mousemove", p), t.unbind(window, "mouseup", c)
        }

        function u() {
          var e = n(this.value);
          e !== !1 ? (m.__color.__state = e, m.setValue(m.__color.toOriginal())) : this.value = m.__color.toString()
        }

        function d() {
          t.unbind(window, "mousemove", f), t.unbind(window, "mouseup", d)
        }

        function p(e) {
          e.preventDefault();
          var i = t.getWidth(m.__saturation_field),
            n = t.getOffset(m.__saturation_field),
            r = (e.clientX - n.left + document.body.scrollLeft) / i,
            o = 1 - (e.clientY - n.top + document.body.scrollTop) / i;
          return o > 1 ? o = 1 : 0 > o && (o = 0), r > 1 ? r = 1 : 0 > r && (r = 0), m.__color.v = o, m.__color.s = r, m.setValue(m.__color.toOriginal()), !1
        }

        function f(e) {
          e.preventDefault();
          var i = t.getHeight(m.__hue_field),
            n = t.getOffset(m.__hue_field),
            r = 1 - (e.clientY - n.top + document.body.scrollTop) / i;
          return r > 1 ? r = 1 : 0 > r && (r = 0), m.__color.h = 360 * r, m.setValue(m.__color.toOriginal()), !1
        }
        s.superclass.call(this, e, h), this.__color = new i(this.getValue()), this.__temp = new i(0);
        var m = this;
        this.domElement = document.createElement("div"), t.makeSelectable(this.domElement, !1), this.__selector = document.createElement("div"), this.__selector.className = "selector", this.__saturation_field = document.createElement("div"), this.__saturation_field.className = "saturation-field", this.__field_knob = document.createElement("div"), this.__field_knob.className = "field-knob", this.__field_knob_border = "2px solid ", this.__hue_knob = document.createElement("div"), this.__hue_knob.className = "hue-knob", this.__hue_field = document.createElement("div"), this.__hue_field.className = "hue-field", this.__input = document.createElement("input"), this.__input.type = "text", this.__input_textShadow = "0 1px 1px ", t.bind(this.__input, "keydown", function(e) {
          13 === e.keyCode && u.call(this)
        }), t.bind(this.__input, "blur", u), t.bind(this.__selector, "mousedown", function(e) {
          t.addClass(this, "drag").bind(window, "mouseup", function(e) {
            t.removeClass(m.__selector, "drag")
          })
        });
        var g = document.createElement("div");
        r.extend(this.__selector.style, {
          width: "122px",
          height: "102px",
          padding: "3px",
          backgroundColor: "#222",
          boxShadow: "0px 1px 3px rgba(0,0,0,0.3)"
        }), r.extend(this.__field_knob.style, {
          position: "absolute",
          width: "12px",
          height: "12px",
          border: this.__field_knob_border + (this.__color.v < 0.5 ? "#fff" : "#000"),
          boxShadow: "0px 1px 3px rgba(0,0,0,0.5)",
          borderRadius: "12px",
          zIndex: 1
        }), r.extend(this.__hue_knob.style, {
          position: "absolute",
          width: "15px",
          height: "2px",
          borderRight: "4px solid #fff",
          zIndex: 1
        }), r.extend(this.__saturation_field.style, {
          width: "100px",
          height: "100px",
          border: "1px solid #555",
          marginRight: "3px",
          display: "inline-block",
          cursor: "pointer"
        }), r.extend(g.style, {
          width: "100%",
          height: "100%",
          background: "none"
        }), o(g, "top", "rgba(0,0,0,0)", "#000"), r.extend(this.__hue_field.style, {
          width: "15px",
          height: "100px",
          display: "inline-block",
          border: "1px solid #555",
          cursor: "ns-resize"
        }), a(this.__hue_field), r.extend(this.__input.style, {
          outline: "none",
          textAlign: "center",
          color: "#fff",
          border: 0,
          fontWeight: "bold",
          textShadow: this.__input_textShadow + "rgba(0,0,0,0.7)"
        }), t.bind(this.__saturation_field, "mousedown", l), t.bind(this.__field_knob, "mousedown", l), t.bind(this.__hue_field, "mousedown", function(e) {
          f(e), t.bind(window, "mousemove", f), t.bind(window, "mouseup", d)
        }), this.__saturation_field.appendChild(g), this.__selector.appendChild(this.__field_knob), this.__selector.appendChild(this.__saturation_field), this.__selector.appendChild(this.__hue_field), this.__hue_field.appendChild(this.__hue_knob), this.domElement.appendChild(this.__input), this.domElement.appendChild(this.__selector), this.updateDisplay()
      };
      s.superclass = e, r.extend(s.prototype, e.prototype, {
        updateDisplay: function() {
          var e = n(this.getValue());
          if (e !== !1) {
            var t = !1;
            r.each(i.COMPONENTS, function(i) {
              return r.isUndefined(e[i]) || r.isUndefined(this.__color.__state[i]) || e[i] === this.__color.__state[i] ? void(0) : (t = !0, {})
            }, this), t && r.extend(this.__color.__state, e)
          };
          r.extend(this.__temp.__state, this.__color.__state), this.__temp.a = 1;
          var a = this.__color.v < 0.5 || this.__color.s > 0.5 ? 255 : 0,
            s = 255 - a;
          r.extend(this.__field_knob.style, {
            marginLeft: 100 * this.__color.s - 7 + "px",
            marginTop: 100 * (1 - this.__color.v) - 7 + "px",
            backgroundColor: this.__temp.toString(),
            border: this.__field_knob_border + "rgb(" + a + "," + a + "," + a + ")"
          }), this.__hue_knob.style.marginTop = 100 * (1 - this.__color.h / 360) + "px", this.__temp.s = 1, this.__temp.v = 1, o(this.__saturation_field, "left", "#fff", this.__temp.toString()), r.extend(this.__input.style, {
            backgroundColor: this.__input.value = this.__color.toString(),
            color: "rgb(" + a + "," + a + "," + a + ")",
            textShadow: this.__input_textShadow + "rgba(" + s + "," + s + "," + s + ",.7)"
          })
        }
      });
      var h = ["-moz-", "-o-", "-webkit-", "-ms-", ""];
      return s
    }(n.controllers.Controller, n.dom.dom, n.color.Color = function(e, t, i, n) {
      function r(e, t, i) {
        Object.defineProperty(e, t, {
          get: function() {
            return "RGB" === this.__state.space ? this.__state[t] : (a(this, t, i), this.__state[t])
          },
          set: function(e) {
            "RGB" !== this.__state.space && (a(this, t, i), this.__state.space = "RGB"), this.__state[t] = e
          }
        })
      }

      function o(e, t) {
        Object.defineProperty(e, t, {
          get: function() {
            return "HSV" === this.__state.space ? this.__state[t] : (s(this), this.__state[t])
          },
          set: function(e) {
            "HSV" !== this.__state.space && (s(this), this.__state.space = "HSV"), this.__state[t] = e
          }
        })
      }

      function a(e, i, r) {
        if ("HEX" === e.__state.space) {
          e.__state[i] = t.component_from_hex(e.__state.hex, r)
        } else {
          if ("HSV" !== e.__state.space) {
            throw "Corrupted color state"
          };
          n.extend(e.__state, t.hsv_to_rgb(e.__state.h, e.__state.s, e.__state.v))
        }
      }

      function s(e) {
        var i = t.rgb_to_hsv(e.r, e.g, e.b);
        n.extend(e.__state, {
          s: i.s,
          v: i.v
        }), n.isNaN(i.h) ? n.isUndefined(e.__state.h) && (e.__state.h = 0) : e.__state.h = i.h
      }
      var h = function() {
        if (this.__state = e.apply(this, arguments), this.__state === !1) {
          throw "Failed to interpret color arguments"
        };
        this.__state.a = this.__state.a || 1
      };
      return h.COMPONENTS = ["r", "g", "b", "h", "s", "v", "hex", "a"], n.extend(h.prototype, {
        toString: function() {
          return i(this)
        },
        toOriginal: function() {
          return this.__state.conversion.write(this)
        }
      }), r(h.prototype, "r", 2), r(h.prototype, "g", 1), r(h.prototype, "b", 0), o(h.prototype, "h"), o(h.prototype, "s"), o(h.prototype, "v"), Object.defineProperty(h.prototype, "a", {
        get: function() {
          return this.__state.a
        },
        set: function(e) {
          this.__state.a = e
        }
      }), Object.defineProperty(h.prototype, "hex", {
        get: function() {
          return "HEX" !== !this.__state.space && (this.__state.hex = t.rgb_to_hex(this.r, this.g, this.b)), this.__state.hex
        },
        set: function(e) {
          this.__state.space = "HEX", this.__state.hex = e
        }
      }), h
    }(n.color.interpret, n.color.math = function() {
      var e;
      return {
        hsv_to_rgb: function(e, t, i) {
          var n = Math.floor(e / 60) % 6,
            r = e / 60 - Math.floor(e / 60),
            o = i * (1 - t),
            a = i * (1 - r * t),
            s = i * (1 - (1 - r) * t),
            h = [
              [i, s, o],
              [a, i, o],
              [o, i, s],
              [o, a, i],
              [s, o, i],
              [i, o, a]
            ][n];
          return {
            r: 255 * h[0],
            g: 255 * h[1],
            b: 255 * h[2]
          }
        },
        rgb_to_hsv: function(e, t, i) {
          var n, r, o = Math.min(e, t, i),
            a = Math.max(e, t, i),
            s = a - o;
          return 0 == a ? {
            h: 0 / 0,
            s: 0,
            v: 0
          } : (r = s / a, n = e == a ? (t - i) / s : t == a ? 2 + (i - e) / s : 4 + (e - t) / s, n /= 6, 0 > n && (n += 1), {
            h: 360 * n,
            s: r,
            v: a / 255
          })
        },
        rgb_to_hex: function(e, t, i) {
          var n = this.hex_with_component(0, 2, e);
          return n = this.hex_with_component(n, 1, t), n = this.hex_with_component(n, 0, i)
        },
        component_from_hex: function(e, t) {
          return e >> 8 * t & 255
        },
        hex_with_component: function(t, i, n) {
          return n << (e = 8 * i) | t & ~(255 << e)
        }
      }
    }(), n.color.toString, n.utils.common), n.color.interpret, n.utils.common), n.utils.requestAnimationFrame = function() {
      return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(e, t) {
        window.setTimeout(e, 1e3 / 60)
      }
    }(), n.dom.CenteredDiv = function(e, t) {
      var i = function() {
        this.backgroundElement = document.createElement("div"), t.extend(this.backgroundElement.style, {
          backgroundColor: "rgba(0,0,0,0.8)",
          top: 0,
          left: 0,
          display: "none",
          zIndex: "1000",
          opacity: 0,
          WebkitTransition: "opacity 0.2s linear"
        }), e.makeFullscreen(this.backgroundElement), this.backgroundElement.style.position = "fixed", this.domElement = document.createElement("div"), t.extend(this.domElement.style, {
          position: "fixed",
          display: "none",
          zIndex: "1001",
          opacity: 0,
          WebkitTransition: "-webkit-transform 0.2s ease-out, opacity 0.2s linear"
        }), document.body.appendChild(this.backgroundElement), document.body.appendChild(this.domElement);
        var i = this;
        e.bind(this.backgroundElement, "click", function() {
          i.hide()
        })
      };
      return i.prototype.show = function() {
        var e = this;
        this.backgroundElement.style.display = "block", this.domElement.style.display = "block", this.domElement.style.opacity = 0, this.domElement.style.webkitTransform = "scale(1.1)", this.layout(), t.defer(function() {
          e.backgroundElement.style.opacity = 1, e.domElement.style.opacity = 1, e.domElement.style.webkitTransform = "scale(1)"
        })
      }, i.prototype.hide = function() {
        var t = this,
          i = function() {
            t.domElement.style.display = "none", t.backgroundElement.style.display = "none", e.unbind(t.domElement, "webkitTransitionEnd", i), e.unbind(t.domElement, "transitionend", i), e.unbind(t.domElement, "oTransitionEnd", i)
          };
        e.bind(this.domElement, "webkitTransitionEnd", i), e.bind(this.domElement, "transitionend", i), e.bind(this.domElement, "oTransitionEnd", i), this.backgroundElement.style.opacity = 0, this.domElement.style.opacity = 0, this.domElement.style.webkitTransform = "scale(1.1)"
      }, i.prototype.layout = function() {
        this.domElement.style.left = window.innerWidth / 2 - e.getWidth(this.domElement) / 2 + "px", this.domElement.style.top = window.innerHeight / 2 - e.getHeight(this.domElement) / 2 + "px"
      }, i
    }(n.dom.dom, n.utils.common), n.dom.dom, n.utils.common)
  }

  function _$af269837(e, t, i) {
    if ("function" != typeof n) {
      var n = e("amdefine")(t)
    };
    ! function() {
      "use strict";
      var i = e("./freeze"),
        n = e("./LZ/BinTree"),
        r = e("./LZ/InWindow"),
        o = e("./LZ/OutWindow");
      t.exports = i({
        BinTree: n,
        InWindow: r,
        OutWindow: o
      })
    }()
  }

  function _$af269839(e, t, i) {
    if ("function" != typeof n) {
      var n = e("amdefine")(t)
    };
    ! function() {
      "use strict";

      function i() {
        if (r.call(this), this._cyclicBufferSize = 0, this._son = [], this._hash = [], this._cutValue = 255, this._hashSizeSum = 0, this.HASH_ARRAY = !0, this.kNumHashDirectBytes = 0, this.kMinMatchCheck = 4, this.kFixHashSize = a + s, arguments.length >= 6) {
          var e = Array.prototype.slice.call(arguments, 0);
          this.setType(e.shift());
          var t = e.pop();
          this.create.apply(this, e), this.setStream(t), this.init()
        }
      }
      var n = e("../freeze"),
        r = e("./InWindow"),
        o = function() {
          var e = [];
          "undefined" != typeof Uint32Array && (e = new Uint32Array(256));
          var t, i, n, r = 3988292384;
          for (t = 0; 256 > t; t++) {
            for (n = t, i = 0; 8 > i; i++) {
              0 !== (1 & n) ? n = n >>> 1 ^ r : n >>>= 1
            };
            e[t] = n
          };
          return e
        }();
      console.assert(256 === o.length);
      var a = 1024,
        s = 65536,
        h = 65536,
        l = 1,
        c = a,
        u = 0,
        d = (1 << 30) - 1,
        p = r.prototype;
      i.prototype = Object.create(p), i.prototype.setType = function(e) {
        this.HASH_ARRAY = e > 2, this.HASH_ARRAY ? (this.kNumHashDirectBytes = 0, this.kMinMatchCheck = 4, this.kFixHashSize = a + s) : (this.kNumHashDirectBytes = 2, this.kMinMatchCheck = 3, this.kFixHashSize = 0)
      }, i.prototype.init = function() {
        var e;
        for (p.init.call(this), e = 0; e < this._hashSizeSum; e++) {
          this._hash[e] = u
        };
        this._cyclicBufferPos = 0, this.reduceOffsets(-1)
      }, i.prototype.movePos = function() {
        ++this._cyclicBufferPos >= this._cyclicBufferSize && (this._cyclicBufferPos = 0), p.movePos.call(this), this._pos === d && this.normalize()
      }, i.prototype.create = function(e, t, i, n) {
        var r, o, a;
        return e > d - 256 ? (console.assert(!1, "Unsupported historySize"), !1) : (this._cutValue = 16 + (i >>> 1), r = (e + t + i + n) / 2 + 256, p.create.call(this, e + t, i + n, r), this._matchMaxLen = i, o = e + 1, this._cyclicBufferSize !== o && (this._cyclicBufferSize = o, this._son = [], this._son.length = 2 * o), a = h, this.HASH_ARRAY && (a = e - 1, a |= a >>> 1, a |= a >>> 2, a |= a >>> 4, a |= a >>> 8, a >>>= 1, a |= 65535, a > 1 << 24 && (a >>>= 1), this._hashMask = a, a++, a += this.kFixHashSize), a !== this._hashSizeSum && (this._hashSizeSum = a, this._hash = [], this._hash.length = this._hashSizeSum), !0)
      }, i.prototype.getMatches = function(e) {
        var t;
        if (this._pos + this._matchMaxLen <= this._streamPos) {
          t = this._matchMaxLen
        } else {
          if (t = this._streamPos - this._pos, t < this.kMinMatchCheck) {
            return this.movePos(), 0
          }
        };
        var i = 0,
          n = this._pos > this._cyclicBufferSize ? this._pos - this._cyclicBufferSize : 0,
          r = this._bufferOffset + this._pos,
          h = l,
          d = 0,
          p = 0,
          f = 0;
        if (this.HASH_ARRAY) {
          var m = o[this._bufferBase[r]] ^ this._bufferBase[r + 1];
          p = m & a - 1, m ^= this._bufferBase[r + 2] << 8, f = m & s - 1, d = (m ^ o[this._bufferBase[r + 3]] << 5) & this._hashMask
        } else {
          d = this._bufferBase[r] ^ this._bufferBase[r + 1] << 8
        };
        var g = this._hash[this.kFixHashSize + d];
        if (this.HASH_ARRAY) {
          var v = this._hash[p],
            y = this._hash[c + f];
          this._hash[p] = this._pos, this._hash[c + f] = this._pos, v > n && this._bufferBase[this._bufferOffset + v] === this._bufferBase[r] && (e[i++] = h = 2, e[i++] = this._pos - v - 1), y > n && this._bufferBase[this._bufferOffset + y] === this._bufferBase[r] && (y === v && (i -= 2), e[i++] = h = 3, e[i++] = this._pos - y - 1, v = y), 0 !== i && v === g && (i -= 2, h = l)
        };
        this._hash[this.kFixHashSize + d] = this._pos;
        var b, w, _ = (this._cyclicBufferPos << 1) + 1,
          x = this._cyclicBufferPos << 1;
        b = w = this.kNumHashDirectBytes, 0 !== this.kNumHashDirectBytes && g > n && this._bufferBase[this._bufferOffset + g + this.kNumHashDirectBytes] !== this._bufferBase[r + this.kNumHashDirectBytes] && (e[i++] = h = this.kNumHashDirectBytes, e[i++] = this._pos - g - 1);
        for (var M = this._cutValue;;) {
          if (n >= g || 0 === M--) {
            this._son[_] = this._son[x] = u;
            break
          };
          var E = this._pos - g,
            S = (E <= this._cyclicBufferPos ? this._cyclicBufferPos - E : this._cyclicBufferPos - E + this._cyclicBufferSize) << 1,
            T = this._bufferOffset + g,
            P = Math.min(b, w);
          if (this._bufferBase[T + P] === this._bufferBase[r + P]) {
            for (; ++P !== t && this._bufferBase[T + P] === this._bufferBase[r + P];) {;
            };
            if (P > h && (e[i++] = h = P, e[i++] = E - 1, P === t)) {
              this._son[x] = this._son[S], this._son[_] = this._son[S + 1];
              break
            }
          };
          this._bufferBase[T + P] < this._bufferBase[r + P] ? (this._son[x] = g, x = S + 1, g = this._son[x], w = P) : (this._son[_] = g, _ = S, g = this._son[_], b = P)
        };
        return this.movePos(), i
      }, i.prototype.skip = function(e) {
        var t, i, n, r, h, l, d, p, f, m, g, v, y, b, w, _, x;
        do {
          if (this._pos + this._matchMaxLen <= this._streamPos) {
            t = this._matchMaxLen
          } else {
            if (t = this._streamPos - this._pos, t < this.kMinMatchCheck) {
              this.movePos();
              continue
            }
          };
          for (i = this._pos > this._cyclicBufferSize ? this._pos - this._cyclicBufferSize : 0, n = this._bufferOffset + this._pos, this.HASH_ARRAY ? (p = o[this._bufferBase[n]] ^ this._bufferBase[n + 1], l = p & a - 1, this._hash[l] = this._pos, p ^= this._bufferBase[n + 2] << 8, d = p & s - 1, this._hash[c + d] = this._pos, h = (p ^ o[this._bufferBase[n + 3]] << 5) & this._hashMask) : h = this._bufferBase[n] ^ this._bufferBase[n + 1] << 8, r = this._hash[this.kFixHashSize + h], this._hash[this.kFixHashSize + h] = this._pos, f = (this._cyclicBufferPos << 1) + 1, m = this._cyclicBufferPos << 1, g = v = this.kNumHashDirectBytes, y = this._cutValue;;) {
            if (i >= r || 0 === y--) {
              this._son[f] = this._son[m] = u;
              break
            };
            if (b = this._pos - r, w = (b <= this._cyclicBufferPos ? this._cyclicBufferPos - b : this._cyclicBufferPos - b + this._cyclicBufferSize) << 1, _ = this._bufferOffset + r, x = v > g ? g : v, this._bufferBase[_ + x] === this._bufferBase[n + x]) {
              for (; ++x !== t && this._bufferBase[_ + x] === this._bufferBase[n + x];) {;
              };
              if (x === t) {
                this._son[m] = this._son[w], this._son[f] = this._son[w + 1];
                break
              }
            };
            this._bufferBase[_ + x] < this._bufferBase[n + x] ? (this._son[m] = r, m = w + 1, r = this._son[m], v = x) : (this._son[f] = r, f = w, r = this._son[f], g = x)
          };
          this.movePos()
        } while (0 !== --e);
      }, i.prototype.normalizeLinks = function(e, t, i) {
        var n, r;
        for (n = 0; t > n; n++) {
          r = e[n], i >= r ? r = u : r -= i, e[n] = r
        }
      }, i.prototype.normalize = function() {
        var e = this._pos - this._cyclicBufferSize;
        this.normalizeLinks(this._son, 2 * this._cyclicBufferSize, e), this.normalizeLinks(this._hash, this._hashSizeSum, e), this.reduceOffsets(e)
      }, i.prototype.setCutValue = function(e) {
        this._cutValue = e
      }, n(i.prototype), t.exports = n(i)
    }()
  }

  function _$af269852(e, t, i) {
    if ("function" != typeof n) {
      var n = e("amdefine")(t)
    };
    ! function() {
      "use strict";
      var i = e("../freeze"),
        n = e("../makeBuffer"),
        r = function(e, t, i, n) {
          if (arguments.length >= 4) {
            var r = Array.prototype.slice.call(arguments, 0),
              o = r.pop();
            this.create.apply(this, r), this.setStream(o), this.init()
          }
        };
      r.prototype.moveBlock = function() {
        var e, t = this._bufferOffset + this._pos + this._keepSizeBefore;
        t > 0 && t--;
        var i = this._bufferOffset + this._streamPos - t;
        for (e = 0; i > e; e++) {
          this._bufferBase[e] = this._bufferBase[t + e]
        };
        this._bufferOffset -= t
      }, r.prototype.readBlock = function() {
        if (!this._streamEndWasReached) {
          for (;;) {
            var e = -this._bufferOffset + this._blockSize - this._streamPos;
            if (0 === e) {
              return
            };
            var t = this._stream.read(this._bufferBase, this._bufferOffset + this._streamPos, e);
            if (0 >= t) {
              this._posLimit = this._streamPos;
              var i = this._bufferOffset + this._posLimit;
              return i > this._pointerToLastSafePosition && (this._posLimit = this._pointerToLastSafePosition - this._bufferOffset), void((this._streamEndWasReached = !0))
            };
            this._streamPos += t, this._streamPos >= this._pos + this._keepSizeAfter && (this._posLimit = this._streamPos - this._keepSizeAfter)
          }
        }
      }, r.prototype.free = function() {
        this._bufferBase = null
      }, r.prototype.create = function(e, t, i) {
        this._keepSizeBefore = e, this._keepSizeAfter = t;
        var r = e + t + i;
        this._bufferBase && this._blockSize === r || (this.free(), this._blockSize = r, this._bufferBase = n(this._blockSize)), this._pointerToLastSafePosition = this._blockSize - t
      }, r.prototype.setStream = function(e) {
        this._stream = e
      }, r.prototype.releaseStream = function() {
        this._stream = null
      }, r.prototype.init = function() {
        this._bufferOffset = 0, this._pos = 0, this._streamPos = 0, this._streamEndWasReached = !1, this.readBlock()
      }, r.prototype.movePos = function() {
        if (this._pos++, this._pos > this._posLimit) {
          var e = this._bufferOffset + this._pos;
          e > this._pointerToLastSafePosition && this.moveBlock(), this.readBlock()
        }
      }, r.prototype.getIndexByte = function(e) {
        return this._bufferBase[this._bufferOffset + this._pos + e]
      }, r.prototype.getMatchLen = function(e, t, i) {
        var n, r;
        for (this._streamEndWasReached && this._pos + e + i > this._streamPos && (i = this._streamPos - (this._pos + e)), t++, n = this._bufferOffset + this._pos + e, r = 0; i > r && this._bufferBase[n + r] === this._bufferBase[n + r - t];) {
          r++
        };
        return r
      }, r.prototype.getNumAvailableBytes = function() {
        return this._streamPos - this._pos
      }, r.prototype.reduceOffsets = function(e) {
        this._bufferOffset += e, this._posLimit -= e, this._pos -= e, this._streamPos -= e
      }, t.exports = i(r)
    }()
  }

  function _$af269867(e, t, i) {
    if ("function" != typeof n) {
      var n = e("amdefine")(t)
    };
    ! function() {
      "use strict";
      var i = e("../freeze"),
        n = e("../makeBuffer"),
        r = function() {
          this._windowSize = 0
        };
      r.prototype.create = function(e) {
        this._buffer && this._windowSize === e || (this._buffer = n(e)), this._windowSize = e, this._pos = 0, this._streamPos = 0
      }, r.prototype.flush = function() {
        var e = this._pos - this._streamPos;
        if (0 !== e) {
          for (; e--;) {
            this._stream.writeByte(this._buffer[this._streamPos++])
          };
          this._pos >= this._windowSize && (this._pos = 0), this._streamPos = this._pos
        }
      }, r.prototype.releaseStream = function() {
        this.flush(), this._stream = null
      }, r.prototype.setStream = function(e) {
        this.releaseStream(), this._stream = e
      }, r.prototype.init = function(e) {
        e || (this._streamPos = 0, this._pos = 0)
      }, r.prototype.copyBlock = function(e, t) {
        var i = this._pos - e - 1;
        for (0 > i && (i += this._windowSize); t--;) {
          i >= this._windowSize && (i = 0), this._buffer[this._pos++] = this._buffer[i++], this._pos >= this._windowSize && this.flush()
        }
      }, r.prototype.putByte = function(e) {
        this._buffer[this._pos++] = e, this._pos >= this._windowSize && this.flush()
      }, r.prototype.getByte = function(e) {
        var t = this._pos - e - 1;
        return 0 > t && (t += this._windowSize), this._buffer[t]
      }, i(r.prototype), t.exports = i(r)
    }()
  }

  function _$af269878(e, t, i) {
    if ("function" != typeof n) {
      var n = e("amdefine")(t)
    };
    ! function() {
      "use strict";
      var i = e("./freeze"),
        n = e("./LZMA/Decoder"),
        r = e("./LZMA/Encoder");
      t.exports = i({
        Decoder: n,
        Encoder: r
      })
    }()
  }

  function _$af269880(e, t, i) {
    if ("function" != typeof n) {
      var n = e("amdefine")(t)
    };
    ! function() {
      "use strict";
      var i = e("../freeze"),
        n = Object.create(null);
      n.kNumRepDistances = 4, n.kNumStates = 12, n.stateInit = function() {
        return 0
      }, n.stateUpdateChar = function(e) {
        return 4 > e ? 0 : 10 > e ? e - 3 : e - 6
      }, n.stateUpdateMatch = function(e) {
        return 7 > e ? 7 : 10
      }, n.stateUpdateRep = function(e) {
        return 7 > e ? 8 : 11
      }, n.stateUpdateShortRep = function(e) {
        return 7 > e ? 9 : 11
      }, n.stateIsCharState = function(e) {
        return 7 > e
      }, n.kNumPosSlotBits = 6, n.kDicLogSizeMin = 0, n.kNumLenToPosStatesBits = 2, n.kNumLenToPosStates = 1 << n.kNumLenToPosStatesBits, n.kMatchMinLen = 2, n.getLenToPosState = function(e) {
        return e -= n.kMatchMinLen, e < n.kNumLenToPosStates ? e : n.kNumLenToPosStates - 1
      }, n.kNumAlignBits = 4, n.kAlignTableSize = 1 << n.kNumAlignBits, n.kAlignMask = n.kAlignTableSize - 1, n.kStartPosModelIndex = 4, n.kEndPosModelIndex = 14, n.kNumPosModels = n.kEndPosModelIndex - n.kStartPosModelIndex, n.kNumFullDistances = 1 << n.kEndPosModelIndex / 2, n.kNumLitPosStatesBitsEncodingMax = 4, n.kNumLitContextBitsMax = 8, n.kNumPosStatesBitsMax = 4, n.kNumPosStatesMax = 1 << n.kNumPosStatesBitsMax, n.kNumPosStatesBitsEncodingMax = 4, n.kNumPosStatesEncodingMax = 1 << n.kNumPosStatesBitsEncodingMax, n.kNumLowLenBits = 3, n.kNumMidLenBits = 3, n.kNumHighLenBits = 8, n.kNumLowLenSymbols = 1 << n.kNumLowLenBits, n.kNumMidLenSymbols = 1 << n.kNumMidLenBits, n.kNumLenSymbols = n.kNumLowLenSymbols + n.kNumMidLenSymbols + (1 << n.kNumHighLenBits), n.kMatchMaxLen = n.kMatchMinLen + n.kNumLenSymbols - 1, t.exports = i(n)
    }()
  }

  function _$af269889(e, t, i) {
    if ("function" != typeof n) {
      var n = e("amdefine")(t)
    };
    ! function() {
      "use strict";
      var i = e("./Base"),
        n = e("../LZ"),
        r = e("../RangeCoder"),
        o = r.Encoder.initBitModels,
        a = function() {
          this._choice = o(null, 2), this._lowCoder = [], this._midCoder = [], this._highCoder = new r.BitTreeDecoder(8), this._numPosStates = 0
        };
      a.prototype.create = function(e) {
        for (; this._numPosStates < e; ++this._numPosStates) {
          this._lowCoder[this._numPosStates] = new r.BitTreeDecoder(3), this._midCoder[this._numPosStates] = new r.BitTreeDecoder(3)
        }
      }, a.prototype.init = function() {
        var e = this._numPosStates;
        for (o(this._choice); e--;) {
          this._lowCoder[e].init(), this._midCoder[e].init()
        };
        this._highCoder.init()
      }, a.prototype.decode = function(e, t) {
        return 0 === e.decodeBit(this._choice, 0) ? this._lowCoder[t].decode(e) : 0 === e.decodeBit(this._choice, 1) ? 8 + this._midCoder[t].decode(e) : 16 + this._highCoder.decode(e)
      };
      var s = function() {};
      s.Decoder2 = function() {
        this._decoders = o(null, 768)
      }, s.Decoder2.prototype.init = function() {
        o(this._decoders)
      }, s.Decoder2.prototype.decodeNormal = function(e) {
        var t = 1;
        do {
          t = t << 1 | e.decodeBit(this._decoders, t)
        } while (256 > t);;
        return 255 & t
      }, s.Decoder2.prototype.decodeWithMatchByte = function(e, t) {
        var i, n, r = 1;
        do {
          if (i = t >> 7 & 1, t <<= 1, n = e.decodeBit(this._decoders, (1 + i << 8) + r), r = r << 1 | n, i !== n) {
            for (; 256 > r;) {
              r = r << 1 | e.decodeBit(this._decoders, r)
            };
            break
          }
        } while (256 > r);;
        return 255 & r
      }, s.prototype.create = function(e, t) {
        var i;
        if (!this._coders || this._numPrevBits !== t || this._numPosBits !== e) {
          for (this._numPosBits = e, this._posMask = (1 << e) - 1, this._numPrevBits = t, this._coders = [], i = 1 << this._numPrevBits + this._numPosBits; i--;) {
            this._coders[i] = new s.Decoder2
          }
        }
      }, s.prototype.init = function() {
        for (var e = 1 << this._numPrevBits + this._numPosBits; e--;) {
          this._coders[e].init()
        }
      }, s.prototype.getDecoder = function(e, t) {
        return this._coders[((e & this._posMask) << this._numPrevBits) + ((255 & t) >>> 8 - this._numPrevBits)]
      };
      var h = function() {
        var e;
        for (this._outWindow = new n.OutWindow, this._rangeDecoder = new r.Decoder, this._isMatchDecoders = o(null, i.kNumStates << i.kNumPosStatesBitsMax), this._isRepDecoders = o(null, i.kNumStates), this._isRepG0Decoders = o(null, i.kNumStates), this._isRepG1Decoders = o(null, i.kNumStates), this._isRepG2Decoders = o(null, i.kNumStates), this._isRep0LongDecoders = o(null, i.kNumStates << i.kNumPosStatesBitsMax), this._posSlotDecoder = [], this._posDecoders = o(null, i.kNumFullDistances - i.kEndPosModelIndex), this._posAlignDecoder = new r.BitTreeDecoder(i.kNumAlignBits), this._lenDecoder = new a, this._repLenDecoder = new a, this._literalDecoder = new s, this._dictionarySize = -1, this._dictionarySizeCheck = -1, this._posStateMask = 0, e = 0; e < i.kNumLenToPosStates; e++) {
          this._posSlotDecoder[e] = new r.BitTreeDecoder(i.kNumPosSlotBits)
        }
      };
      h.prototype.setDictionarySize = function(e) {
        return 0 > e ? !1 : (this._dictionarySize !== e && (this._dictionarySize = e, this._dictionarySizeCheck = Math.max(this._dictionarySize, 1), this._outWindow.create(Math.max(this._dictionarySizeCheck, 4096))), !0)
      }, h.prototype.setLcLpPb = function(e, t, n) {
        var r = 1 << n;
        return e > i.kNumLitContextBitsMax || t > 4 || n > i.kNumPosStatesBitsMax ? !1 : (this._literalDecoder.create(t, e), this._lenDecoder.create(r), this._repLenDecoder.create(r), this._posStateMask = r - 1, !0)
      }, h.prototype.init = function() {
        var e = i.kNumLenToPosStates;
        for (this._outWindow.init(!1), o(this._isMatchDecoders), o(this._isRepDecoders), o(this._isRepG0Decoders), o(this._isRepG1Decoders), o(this._isRepG2Decoders), o(this._isRep0LongDecoders), o(this._posDecoders), this._literalDecoder.init(); e--;) {
          this._posSlotDecoder[e].init()
        };
        this._lenDecoder.init(), this._repLenDecoder.init(), this._posAlignDecoder.init(), this._rangeDecoder.init()
      }, h.prototype.code = function(e, t, n) {
        var o, a, s, h, l, c, u, d = 0,
          p = 0,
          f = 0,
          m = 0,
          g = 0,
          v = 0;
        for (this._rangeDecoder.setStream(e), this._outWindow.setStream(t), this.init(), o = i.stateInit(); 0 > n || n > g;) {
          if (a = g & this._posStateMask, 0 === this._rangeDecoder.decodeBit(this._isMatchDecoders, (o << i.kNumPosStatesBitsMax) + a)) {
            s = this._literalDecoder.getDecoder(g, v), v = i.stateIsCharState(o) ? s.decodeNormal(this._rangeDecoder) : s.decodeWithMatchByte(this._rangeDecoder, this._outWindow.getByte(d)), this._outWindow.putByte(v), o = i.stateUpdateChar(o), g++
          } else {
            if (1 === this._rangeDecoder.decodeBit(this._isRepDecoders, o)) {
              h = 0, 0 === this._rangeDecoder.decodeBit(this._isRepG0Decoders, o) ? 0 === this._rangeDecoder.decodeBit(this._isRep0LongDecoders, (o << i.kNumPosStatesBitsMax) + a) && (o = i.stateUpdateShortRep(o), h = 1) : (0 === this._rangeDecoder.decodeBit(this._isRepG1Decoders, o) ? l = p : (0 === this._rangeDecoder.decodeBit(this._isRepG2Decoders, o) ? l = f : (l = m, m = f), f = p), p = d, d = l), 0 === h && (h = i.kMatchMinLen + this._repLenDecoder.decode(this._rangeDecoder, a), o = i.stateUpdateRep(o))
            } else {
              if (m = f, f = p, p = d, h = i.kMatchMinLen + this._lenDecoder.decode(this._rangeDecoder, a), o = i.stateUpdateMatch(o), c = this._posSlotDecoder[i.getLenToPosState(h)].decode(this._rangeDecoder), c >= i.kStartPosModelIndex) {
                if (u = (c >> 1) - 1, d = (2 | 1 & c) << u, c < i.kEndPosModelIndex) {
                  d += r.BitTreeDecoder.reverseDecode(this._posDecoders, d - c - 1, this._rangeDecoder, u)
                } else {
                  if (d += this._rangeDecoder.decodeDirectBits(u - i.kNumAlignBits) << i.kNumAlignBits, d += this._posAlignDecoder.reverseDecode(this._rangeDecoder), 0 > d) {
                    if (-1 === d) {
                      break
                    };
                    return !1
                  }
                }
              } else {
                d = c
              }
            };
            if (d >= g || d >= this._dictionarySizeCheck) {
              return !1
            };
            this._outWindow.copyBlock(d, h), g += h, v = this._outWindow.getByte(0)
          }
        };
        return this._outWindow.flush(), this._outWindow.releaseStream(), this._rangeDecoder.releaseStream(), !0
      }, h.prototype.setDecoderProperties = function(e) {
        var t, i, n, r, o, a, s;
        if (e.length < 5) {
          return !1
        };
        if (t = 255 & e[0], i = t % 9, t = ~~(t / 9), n = t % 5, r = ~~(t / 5), !this.setLcLpPb(i, n, r)) {
          return !1
        };
        for (o = 0, a = 0, s = 1; 4 > a; a++, s *= 256) {
          o += (255 & e[1 + a]) * s
        };
        return this.setDictionarySize(o)
      }, h.prototype.setDecoderPropertiesFromStream = function(e) {
        var t, i = [];
        for (t = 0; 5 > t; t++) {
          i[t] = e.readByte()
        };
        return this.setDecoderProperties(i)
      }, t.exports = h
    }()
  }

  function _$af269910(e, t, i) {
    if ("function" != typeof n) {
      var n = e("amdefine")(t)
    };
    ! function() {
      "use strict";
      var i = e("./Base"),
        n = e("../RangeCoder"),
        r = e("../LZ"),
        o = e("../freeze"),
        a = e("../makeBuffer"),
        s = n.Encoder.initBitModels,
        h = 0,
        l = 1,
        c = 268435455,
        u = 22,
        d = 32,
        p = 4096,
        f = 5,
        m = function() {
          var e, t = a(2048),
            i = 22,
            n = 2;
          for (t[0] = 0, t[1] = 1, e = 2; i > e; e++) {
            var r, o = 1 << (e >> 1) - 1;
            for (r = 0; o > r; r++, n++) {
              t[n] = e
            }
          };
          return t
        }(),
        g = function(e) {
          return 2048 > e ? m[e] : 1 << 21 > e ? m[e >>> 10] + 20 : m[e >>> 20] + 40
        },
        v = function(e) {
          return 1 << 17 > e ? m[e >>> 6] + 12 : 1 << 27 > e ? m[e >>> 16] + 32 : m[e >>> 26] + 52
        },
        y = function() {
          var e;
          for (this._state = i.stateInit(), this._previousByte = 0, this._repDistances = [], this._repDistances.length = i.kNumRepDistances, this._optimum = [], this._matchFinder = null, this._rangeEncoder = new n.Encoder, this._isMatch = s(null, i.kNumStates << i.kNumPosStatesBitsMax), this._isRep = s(null, i.kNumStates), this._isRepG0 = s(null, i.kNumStates), this._isRepG1 = s(null, i.kNumStates), this._isRepG2 = s(null, i.kNumStates), this._isRep0Long = s(null, i.kNumStates << i.kNumPosStatesBitsMax), this._posSlotEncoder = [], this._posEncoders = s(null, i.kNumFullDistances - i.kEndPosModelIndex), this._posAlignEncoder = new n.BitTreeEncoder(i.kNumAlignBits), this._lenEncoder = new y.LenPriceTableEncoder, this._repMatchLenEncoder = new y.LenPriceTableEncoder, this._literalEncoder = new y.LiteralEncoder, this._matchDistances = [], this._matchDistances.length = 2 * i.kMatchMaxLen + 2, e = 0; e < this._matchDistances.length; e++) {
            this._matchDistances[e] = 0
          };
          for (this._numFastBytes = d, this._longestMatchLength = 0, this._numDistancePairs = 0, this._additionalOffset = 0, this._optimumEndIndex = 0, this._optimumCurrentIndex = 0, this._longestMatchWasFound = !1, this._posSlotPrices = [], this._distancesPrices = [], this._alignPrices = [], this._alignPriceCount = 0, this._distTableSize = 2 * u, this._posStateBits = 2, this._posStateMask = 3, this._numLiteralPosStateBits = 0, this._numLiteralContextBits = 3, this._dictionarySize = 1 << u, this._dictionarySizePrev = 4294967295, this._numFastBytesPrev = 4294967295, this.nowPos64 = 0, this._finished = !1, this._inStream = null, this._matchFinderType = l, this._writeEndMark = !1, this._needReleaseMFStream = !1, this.reps = [], this.repLens = [], this.backRes = 0, e = 0; p > e; e++) {
            this._optimum[e] = new y.Optimal
          };
          for (e = 0; e < i.kNumLenToPosStates; e++) {
            this._posSlotEncoder[e] = new n.BitTreeEncoder(i.kNumPosSlotBits)
          };
          this._matchPriceCount = 0, this.processedInSize = [0], this.processedOutSize = [0], this.finished = [!1]
        };
      y.prototype.baseInit = function() {
        var e;
        for (this._state = i.stateInit(), this._previousByte = 0, e = 0; e < i.kNumRepDistances; e++) {
          this._repDistances[e] = 0
        }
      };
      var b = y.LiteralEncoder = function() {
        this._coders = null, this._numPrevBits = -1, this._numPosBits = -1, this._posMask = 0
      };
      b.Encoder2 = function() {
        this._encoders = s(null, 768)
      }, b.Encoder2.prototype.init = function() {
        s(this._encoders)
      }, b.Encoder2.prototype.encode = function(e, t) {
        var i, n = 1;
        for (i = 7; i >= 0; i--) {
          var r = t >>> i & 1;
          e.encode(this._encoders, n, r), n = n << 1 | r
        }
      }, b.Encoder2.prototype.encodeMatched = function(e, t, i) {
        var n, r = 1,
          o = !0;
        for (n = 7; n >= 0; n--) {
          var a = i >> n & 1,
            s = r;
          if (o) {
            var h = t >>> n & 1;
            s += 1 + h << 8, o = h === a
          };
          e.encode(this._encoders, s, a), r = r << 1 | a
        }
      }, b.Encoder2.prototype.getPrice = function(e, t, i) {
        var r, o, a = 0,
          s = 1,
          h = 7;
        if (e) {
          for (; h >= 0; h--) {
            if (o = t >>> h & 1, r = i >>> h & 1, a += n.Encoder.getPrice(this._encoders[(1 + o << 8) + s], r), s = s << 1 | r, o !== r) {
              h--;
              break
            }
          }
        };
        for (; h >= 0; h--) {
          r = i >>> h & 1, a += n.Encoder.getPrice(this._encoders[s], r), s = s << 1 | r
        };
        return a
      }, b.prototype.create = function(e, t) {
        var i;
        if (!this._coders || this._numPrevBits !== t || this._numPosBits !== e) {
          this._numPosBits = e, this._posMask = (1 << e) - 1, this._numPrevBits = t;
          var n = 1 << this._numPrevBits + this._numPosBits;
          for (this._coders = [], i = 0; n > i; i++) {
            this._coders[i] = new b.Encoder2
          }
        }
      }, b.prototype.init = function() {
        var e, t = 1 << this._numPrevBits + this._numPosBits;
        for (e = 0; t > e; e++) {
          this._coders[e].init()
        }
      }, b.prototype.getSubCoder = function(e, t) {
        return this._coders[((e & this._posMask) << this._numPrevBits) + (t >> 8 - this._numPrevBits)]
      };
      var w = y.LenEncoder = function() {
        var e;
        for (this._choice = s(null, 2), this._lowCoder = [], this._midCoder = [], this._highCoder = new n.BitTreeEncoder(i.kNumHighLenBits), e = 0; e < i.kNumPosStatesEncodingMax; e++) {
          this._lowCoder[e] = new n.BitTreeEncoder(i.kNumLowLenBits), this._midCoder[e] = new n.BitTreeEncoder(i.kNumMidLenBits)
        }
      };
      w.prototype.init = function(e) {
        var t;
        for (s(this._choice), t = 0; e > t; t++) {
          this._lowCoder[t].init(), this._midCoder[t].init()
        };
        this._highCoder.init()
      }, w.prototype.encode = function(e, t, n) {
        t < i.kNumLowLenSymbols ? (e.encode(this._choice, 0, 0), this._lowCoder[n].encode(e, t)) : (t -= i.kNumLowLenSymbols, e.encode(this._choice, 0, 1), t < i.kNumMidLenSymbols ? (e.encode(this._choice, 1, 0), this._midCoder[n].encode(e, t)) : (e.encode(this._choice, 1, 1), this._highCoder.encode(e, t - i.kNumMidLenSymbols)))
      }, w.prototype.setPrices = function(e, t, r, o) {
        var a, s = n.Encoder.getPrice0(this._choice[0]),
          h = n.Encoder.getPrice1(this._choice[0]),
          l = h + n.Encoder.getPrice0(this._choice[1]),
          c = h + n.Encoder.getPrice1(this._choice[1]);
        for (a = 0; a < i.kNumLowLenSymbols; a++) {
          if (a >= t) {
            return
          };
          r[o + a] = s + this._lowCoder[e].getPrice(a)
        };
        for (; a < i.kNumLowLenSymbols + i.kNumMidLenSymbols; a++) {
          if (a >= t) {
            return
          };
          r[o + a] = l + this._midCoder[e].getPrice(a - i.kNumLowLenSymbols)
        };
        for (; t > a; a++) {
          r[o + a] = c + this._highCoder.getPrice(a - i.kNumLowLenSymbols - i.kNumMidLenSymbols)
        }
      };
      var _ = (i.kNumLowLenSymbols + i.kNumMidLenSymbols, y.LenPriceTableEncoder = function() {
        w.call(this), this._prices = [], this._counters = [], this._tableSize = 0
      });
      _.prototype = Object.create(w.prototype), _.prototype.setTableSize = function(e) {
        this._tableSize = e
      }, _.prototype.getPrice = function(e, t) {
        return this._prices[t * i.kNumLenSymbols + e]
      }, _.prototype.updateTable = function(e) {
        this.setPrices(e, this._tableSize, this._prices, e * i.kNumLenSymbols), this._counters[e] = this._tableSize
      }, _.prototype.updateTables = function(e) {
        var t;
        for (t = 0; e > t; t++) {
          this.updateTable(t)
        }
      }, _.prototype.encode = function(e) {
        return function(t, i, n) {
          e.call(this, t, i, n), 0 === --this._counters[n] && this.updateTable(n)
        }
      }(_.prototype.encode);
      var x = y.Optimal = function() {
        this.state = 0, this.prev1IsChar = !1, this.prev2 = !1, this.posPrev2 = 0, this.backPrev2 = 0, this.price = 0, this.posPrev = 0, this.backPrev = 0, this.backs0 = 0, this.backs1 = 0, this.backs2 = 0, this.backs3 = 0
      };
      x.prototype.makeAsChar = function() {
        this.backPrev = -1, this.prev1IsChar = !1
      }, x.prototype.makeAsShortRep = function() {
        this.backPrev = 0, this.prev1IsChar = !1
      }, x.prototype.isShortRep = function() {
        return 0 === this.backPrev
      }, y.prototype.create = function() {
        var e;
        if (!this._matchFinder) {
          var t = new r.BinTree;
          e = 4, this._matchFinderType === h && (e = 2), t.setType(e), this._matchFinder = t
        };
        this._literalEncoder.create(this._numLiteralPosStateBits, this._numLiteralContextBits), (this._dictionarySize !== this._dictionarySizePrev || this._numFastBytesPrev !== this._numFastBytes) && (this._matchFinder.create(this._dictionarySize, p, this._numFastBytes, i.kMatchMaxLen + 1), this._dictionarySizePrev = this._dictionarySize, this._numFastBytesPrev = this._numFastBytes)
      }, y.prototype.setWriteEndMarkerMode = function(e) {
        this._writeEndMark = e
      }, y.prototype.init = function() {
        var e;
        for (this.baseInit(), this._rangeEncoder.init(), s(this._isMatch), s(this._isRep0Long), s(this._isRep), s(this._isRepG0), s(this._isRepG1), s(this._isRepG2), s(this._posEncoders), this._literalEncoder.init(), e = 0; e < i.kNumLenToPosStates; e++) {
          this._posSlotEncoder[e].init()
        };
        this._lenEncoder.init(1 << this._posStateBits), this._repMatchLenEncoder.init(1 << this._posStateBits), this._posAlignEncoder.init(), this._longestMatchWasFound = !1, this._optimumEndIndex = 0, this._optimumCurrentIndex = 0, this._additionalOffset = 0
      }, y.prototype.readMatchDistances = function() {
        var e = 0;
        return this._numDistancePairs = this._matchFinder.getMatches(this._matchDistances), this._numDistancePairs > 0 && (e = this._matchDistances[this._numDistancePairs - 2], e === this._numFastBytes && (e += this._matchFinder.getMatchLen(e - 1, this._matchDistances[this._numDistancePairs - 1], i.kMatchMaxLen - e))), this._additionalOffset++, e
      }, y.prototype.movePos = function(e) {
        e > 0 && (this._matchFinder.skip(e), this._additionalOffset += e)
      }, y.prototype.getRepLen1Price = function(e, t) {
        return n.Encoder.getPrice0(this._isRepG0[e]) + n.Encoder.getPrice0(this._isRep0Long[(e << i.kNumPosStatesBitsMax) + t])
      }, y.prototype.getPureRepPrice = function(e, t, r) {
        var o;
        return 0 === e ? (o = n.Encoder.getPrice0(this._isRepG0[t]), o += n.Encoder.getPrice1(this._isRep0Long[(t << i.kNumPosStatesBitsMax) + r])) : (o = n.Encoder.getPrice1(this._isRepG0[t]), 1 === e ? o += n.Encoder.getPrice0(this._isRepG1[t]) : (o += n.Encoder.getPrice1(this._isRepG1[t]), o += n.Encoder.getPrice(this._isRepG2[t], e - 2))), o
      }, y.prototype.getRepPrice = function(e, t, n, r) {
        var o = this._repMatchLenEncoder.getPrice(t - i.kMatchMinLen, r);
        return o + this.getPureRepPrice(e, n, r)
      }, y.prototype.getPosLenPrice = function(e, t, n) {
        var r, o = i.getLenToPosState(t);
        return r = e < i.kNumFullDistances ? this._distancesPrices[o * i.kNumFullDistances + e] : this._posSlotPrices[(o << i.kNumPosSlotBits) + v(e)] + this._alignPrices[e & i.kAlignMask], r + this._lenEncoder.getPrice(t - i.kMatchMinLen, n)
      }, y.prototype.backward = function(e) {
        this._optimumEndIndex = e;
        var t = this._optimum[e].posPrev,
          i = this._optimum[e].backPrev;
        do {
          this._optimum[e].prev1IsChar && (this._optimum[t].makeAsChar(), this._optimum[t].posPrev = t - 1, this._optimum[e].prev2 && (this._optimum[t - 1].prev1IsChar = !1, this._optimum[t - 1].posPrev = this._optimum[e].posPrev2, this._optimum[t - 1].backPrev = this._optimum[e].backPrev2));
          var n = t,
            r = i;
          i = this._optimum[n].backPrev, t = this._optimum[n].posPrev, this._optimum[n].backPrev = r, this._optimum[n].posPrev = e, e = n
        } while (e > 0);;
        return this.backRes = this._optimum[0].backPrev, this._optimumCurrentIndex = this._optimum[0].posPrev, this._optimumCurrentIndex
      }, y.prototype.getOptimum = function(e) {
        if (this._optimumEndIndex !== this._optimumCurrentIndex) {
          var t = this._optimum[this._optimumCurrentIndex].posPrev - this._optimumCurrentIndex;
          return this.backRes = this._optimum[this._optimumCurrentIndex].backPrev, this._optimumCurrentIndex = this._optimum[this._optimumCurrentIndex].posPrev, t
        };
        this._optimumCurrentIndex = this._optimumEndIndex = 0;
        var r;
        this._longestMatchWasFound ? (r = this._longestMatchLength, this._longestMatchWasFound = !1) : r = this.readMatchDistances();
        var o = this._numDistancePairs,
          a = this._matchFinder.getNumAvailableBytes() + 1;
        if (2 > a) {
          return this.backRes = -1, 1
        };
        a > i.kMatchMaxLen && (a = i.kMatchMaxLen);
        var s, h = 0;
        for (s = 0; s < i.kNumRepDistances; s++) {
          this.reps[s] = this._repDistances[s], this.repLens[s] = this._matchFinder.getMatchLen(-1, this.reps[s], i.kMatchMaxLen), this.repLens[s] > this.repLens[h] && (h = s)
        };
        if (this.repLens[h] >= this._numFastBytes) {
          this.backRes = h;
          var l = this.repLens[h];
          return this.movePos(l - 1), l
        };
        if (r >= this._numFastBytes) {
          return this.backRes = this._matchDistances[o - 1] + i.kNumRepDistances, this.movePos(r - 1), r
        };
        var u = this._matchFinder.getIndexByte(-1),
          d = this._matchFinder.getIndexByte(-this._repDistances[0] - 2);
        if (2 > r && u !== d && this.repLens[h] < 2) {
          return this.backRes = -1, 1
        };
        this._optimum[0].state = this._state;
        var f = e & this._posStateMask;
        this._optimum[1].price = n.Encoder.getPrice0(this._isMatch[(this._state << i.kNumPosStatesBitsMax) + f]) + this._literalEncoder.getSubCoder(e, this._previousByte).getPrice(!i.stateIsCharState(this._state), d, u), this._optimum[1].makeAsChar();
        var m = n.Encoder.getPrice1(this._isMatch[(this._state << i.kNumPosStatesBitsMax) + f]),
          g = m + n.Encoder.getPrice1(this._isRep[this._state]);
        if (d === u) {
          var v = g + this.getRepLen1Price(this._state, f);
          v < this._optimum[1].price && (this._optimum[1].price = v, this._optimum[1].makeAsShortRep())
        };
        var y = r >= this.repLens[h] ? r : this.repLens[h];
        if (2 > y) {
          return this.backRes = this._optimum[1].backPrev, 1
        };
        this._optimum[1].posPrev = 0, this._optimum[0].backs0 = this.reps[0], this._optimum[0].backs1 = this.reps[1], this._optimum[0].backs2 = this.reps[2], this._optimum[0].backs3 = this.reps[3];
        var b = y;
        do {
          this._optimum[b--].price = c
        } while (b >= 2);;
        for (s = 0; s < i.kNumRepDistances; s++) {
          var w = this.repLens[s];
          if (!(2 > w)) {
            var _ = g + this.getPureRepPrice(s, this._state, f);
            do {
              var x = _ + this._repMatchLenEncoder.getPrice(w - 2, f),
                M = this._optimum[w];
              x < M.price && (M.price = x, M.posPrev = 0, M.backPrev = s, M.prev1IsChar = !1)
            } while (--w >= 2);
          }
        };
        var E = m + n.Encoder.getPrice0(this._isRep[this._state]);
        if (b = this.repLens[0] >= 2 ? this.repLens[0] + 1 : 2, r >= b) {
          for (var S = 0; b > this._matchDistances[S];) {
            S += 2
          };
          for (;; b++) {
            var T = this._matchDistances[S + 1],
              P = E + this.getPosLenPrice(T, b, f),
              A = this._optimum[b];
            if (P < A.price && (A.price = P, A.posPrev = 0, A.backPrev = T + i.kNumRepDistances, A.prev1IsChar = !1), b === this._matchDistances[S] && (S += 2, S === o)) {
              break
            }
          }
        };
        for (var L = 0;;) {
          if (L++, L === y) {
            return this.backward(L)
          };
          var C = this.readMatchDistances();
          if (o = this._numDistancePairs, C >= this._numFastBytes) {
            return this._longestMatchLength = C, this._longestMatchWasFound = !0, this.backward(L)
          };
          e++;
          var R, I = this._optimum[L].posPrev;
          if (this._optimum[L].prev1IsChar ? (I--, this._optimum[L].prev2 ? (R = this._optimum[this._optimum[L].posPrev2].state, R = this._optimum[L].backPrev2 < i.kNumRepDistances ? i.stateUpdateRep(R) : i.stateUpdateMatch(R)) : R = this._optimum[I].state, R = i.stateUpdateChar(R)) : R = this._optimum[I].state, I === L - 1) {
            R = this._optimum[L].isShortRep() ? i.stateUpdateShortRep(R) : i.stateUpdateChar(R)
          } else {
            var D;
            this._optimum[L].prev1IsChar && this._optimum[L].prev2 ? (I = this._optimum[L].posPrev2, D = this._optimum[L].backPrev2, R = i.stateUpdateRep(R)) : (D = this._optimum[L].backPrev, R = D < i.kNumRepDistances ? i.stateUpdateRep(R) : i.stateUpdateMatch(R));
            var O = this._optimum[I];
            D < i.kNumRepDistances ? 0 === D ? (this.reps[0] = O.backs0, this.reps[1] = O.backs1, this.reps[2] = O.backs2, this.reps[3] = O.backs3) : 1 === D ? (this.reps[0] = O.backs1, this.reps[1] = O.backs0, this.reps[2] = O.backs2, this.reps[3] = O.backs3) : 2 === D ? (this.reps[0] = O.backs2, this.reps[1] = O.backs0, this.reps[2] = O.backs1, this.reps[3] = O.backs3) : (this.reps[0] = O.backs3, this.reps[1] = O.backs0, this.reps[2] = O.backs1, this.reps[3] = O.backs2) : (this.reps[0] = D - i.kNumRepDistances, this.reps[1] = O.backs0, this.reps[2] = O.backs1, this.reps[3] = O.backs2)
          };
          this._optimum[L].state = R, this._optimum[L].backs0 = this.reps[0], this._optimum[L].backs1 = this.reps[1], this._optimum[L].backs2 = this.reps[2], this._optimum[L].backs3 = this.reps[3];
          var k = this._optimum[L].price;
          u = this._matchFinder.getIndexByte(-1), d = this._matchFinder.getIndexByte(-this.reps[0] - 2), f = e & this._posStateMask;
          var B = k + n.Encoder.getPrice0(this._isMatch[(R << i.kNumPosStatesBitsMax) + f]) + this._literalEncoder.getSubCoder(e, this._matchFinder.getIndexByte(-2)).getPrice(!i.stateIsCharState(R), d, u),
            F = this._optimum[L + 1],
            N = !1;
          if (B < F.price && (F.price = B, F.posPrev = L, F.makeAsChar(), N = !0), m = k + n.Encoder.getPrice1(this._isMatch[(R << i.kNumPosStatesBitsMax) + f]), g = m + n.Encoder.getPrice1(this._isRep[R]), d === u && !(F.posPrev < L && 0 === F.backPrev)) {
            var U = g + this.getRepLen1Price(R, f);
            U <= F.price && (F.price = U, F.posPrev = L, F.makeAsShortRep(), N = !0)
          };
          var V = this._matchFinder.getNumAvailableBytes() + 1;
          if (V = Math.min(p - 1 - L, V), a = V, !(2 > a)) {
            if (a > this._numFastBytes && (a = this._numFastBytes), !N && d !== u) {
              var z = Math.min(V - 1, this._numFastBytes),
                G = this._matchFinder.getMatchLen(0, this.reps[0], z);
              if (G >= 2) {
                for (var j = i.stateUpdateChar(R), H = e + 1 & this._posStateMask, W = B + n.Encoder.getPrice1(this._isMatch[(j << i.kNumPosStatesBitsMax) + H]) + n.Encoder.getPrice1(this._isRep[j]), Y = L + 1 + G; Y > y;) {
                  this._optimum[++y].price = c
                };
                var X = W + this.getRepPrice(0, G, j, H),
                  q = this._optimum[Y];
                X < q.price && (q.price = X, q.posPrev = L + 1, q.backPrev = 0, q.prev1IsChar = !0, q.prev2 = !1)
              }
            };
            var Z, $ = 2;
            for (Z = 0; Z < i.kNumRepDistances; Z++) {
              var Q = this._matchFinder.getMatchLen(-1, this.reps[Z], a);
              if (!(2 > Q)) {
                var K = Q;
                do {
                  for (; L + Q > y;) {
                    this._optimum[++y].price = c
                  };
                  var J = g + this.getRepPrice(Z, Q, R, f),
                    ee = this._optimum[L + Q];
                  J < ee.price && (ee.price = J, ee.posPrev = L, ee.backPrev = Z, ee.prev1IsChar = !1)
                } while (--Q >= 2);;
                if (Q = K, 0 === Z && ($ = Q + 1), V > Q) {
                  var te = Math.min(V - 1 - Q, this._numFastBytes),
                    ie = this._matchFinder.getMatchLen(Q, this.reps[Z], te);
                  if (ie >= 2) {
                    var ne = i.stateUpdateRep(R),
                      re = e + Q & this._posStateMask,
                      oe = g + this.getRepPrice(Z, Q, R, f) + n.Encoder.getPrice0(this._isMatch[(ne << i.kNumPosStatesBitsMax) + re]) + this._literalEncoder.getSubCoder(e + Q, this._matchFinder.getIndexByte(Q - 2)).getPrice(!0, this._matchFinder.getIndexByte(Q - 1 - (this.reps[Z] + 1)), this._matchFinder.getIndexByte(Q - 1));
                    ne = i.stateUpdateChar(ne), re = e + Q + 1 & this._posStateMask;
                    for (var ae = oe + n.Encoder.getPrice1(this._isMatch[(ne << i.kNumPosStatesBitsMax) + re]), se = ae + n.Encoder.getPrice1(this._isRep[ne]), he = Q + 1 + ie; L + he > y;) {
                      this._optimum[++y].price = c
                    };
                    var le = se + this.getRepPrice(0, ie, ne, re),
                      ce = this._optimum[L + he];
                    le < ce.price && (ce.price = le, ce.posPrev = L + Q + 1, ce.backPrev = 0, ce.prev1IsChar = !0, ce.prev2 = !0, ce.posPrev2 = L, ce.backPrev2 = Z)
                  }
                }
              }
            };
            if (C > a) {
              for (C = a, o = 0; C > this._matchDistances[o];) {
                o += 2
              };
              this._matchDistances[o] = C, o += 2
            };
            if (C >= $) {
              for (E = m + n.Encoder.getPrice0(this._isRep[R]); L + C > y;) {
                this._optimum[++y].price = c
              };
              for (var ue = 0; $ > this._matchDistances[ue];) {
                ue += 2
              };
              var de;
              for (de = $;; de++) {
                var pe = this._matchDistances[ue + 1],
                  fe = E + this.getPosLenPrice(pe, de, f),
                  me = this._optimum[L + de];
                if (fe < me.price && (me.price = fe, me.posPrev = L, me.backPrev = pe + i.kNumRepDistances, me.prev1IsChar = !1), de === this._matchDistances[ue]) {
                  if (V > de) {
                    var ge = Math.min(V - 1 - de, this._numFastBytes),
                      ve = this._matchFinder.getMatchLen(de, pe, ge);
                    if (ve >= 2) {
                      var ye = i.stateUpdateMatch(R),
                        be = e + de & this._posStateMask,
                        we = fe + n.Encoder.getPrice0(this._isMatch[(ye << i.kNumPosStatesBitsMax) + be]) + this._literalEncoder.getSubCoder(e + de, this._matchFinder.getIndexByte(de - 2)).getPrice(!0, this._matchFinder.getIndexByte(de - (pe + 1) - 1), this._matchFinder.getIndexByte(de - 1));
                      ye = i.stateUpdateChar(ye), be = e + de + 1 & this._posStateMask;
                      for (var _e = we + n.Encoder.getPrice1(this._isMatch[(ye << i.kNumPosStatesBitsMax) + be]), xe = _e + n.Encoder.getPrice1(this._isRep[ye]), Me = de + 1 + ve; L + Me > y;) {
                        this._optimum[++y].price = c
                      };
                      var Ee = xe + this.getRepPrice(0, ve, ye, be),
                        Se = this._optimum[L + Me];
                      Ee < Se.price && (Se.price = Ee, Se.posPrev = L + de + 1, Se.backPrev = 0, Se.prev1IsChar = !0, Se.prev2 = !0, Se.posPrev2 = L, Se.backPrev2 = pe + i.kNumRepDistances)
                    }
                  };
                  if (ue += 2, ue === o) {
                    break
                  }
                }
              }
            }
          }
        }
      }, y.prototype.changePair = function(e, t) {
        var i = 7;
        return 1 << 32 - i > e && t >= e << i
      }, y.prototype.writeEndMarker = function(e) {
        if (this._writeEndMark) {
          this._rangeEncoder.encode(this._isMatch, (this._state << i.kNumPosStatesBitsMax) + e, 1), this._rangeEncoder.encode(this._isRep, this._state, 0), this._state = i.stateUpdateMatch(this._state);
          var t = i.kMatchMinLen;
          this._lenEncoder.encode(this._rangeEncoder, t - i.kMatchMinLen, e);
          var n = (1 << i.kNumPosSlotBits) - 1,
            r = i.getLenToPosState(t);
          this._posSlotEncoder[r].encode(this._rangeEncoder, n);
          var o = 30,
            a = (1 << o) - 1;
          this._rangeEncoder.encodeDirectBits(a >> i.kNumAlignBits, o - i.kNumAlignBits), this._posAlignEncoder.reverseEncode(this._rangeEncoder, a & i.kAlignMask)
        }
      }, y.prototype.flush = function(e) {
        this.releaseMFStream(), this.writeEndMarker(e & this._posStateMask), this._rangeEncoder.flushData(), this._rangeEncoder.flushStream()
      }, y.prototype.codeOneBlock = function(e, t, r) {
        if (e[0] = 0, t[0] = 0, r[0] = !0, this._inStream && (this._matchFinder.setStream(this._inStream), this._matchFinder.init(), this._needReleaseMFStream = !0, this._inStream = null), !this._finished) {
          this._finished = !0;
          var o, a, s, h = this.nowPos64;
          if (0 === this.nowPos64) {
            if (0 === this._matchFinder.getNumAvailableBytes()) {
              return void(this.flush(this.nowPos64))
            };
            this.readMatchDistances(), o = this.nowPos64 & this._posStateMask, this._rangeEncoder.encode(this._isMatch, (this._state << i.kNumPosStatesBitsMax) + o, 0), this._state = i.stateUpdateChar(this._state), a = this._matchFinder.getIndexByte(0 - this._additionalOffset), this._literalEncoder.getSubCoder(this.nowPos64, this._previousByte).encode(this._rangeEncoder, a), this._previousByte = a, this._additionalOffset--, this.nowPos64++
          };
          if (0 === this._matchFinder.getNumAvailableBytes()) {
            return void(this.flush(this.nowPos64))
          };
          for (;;) {
            var l = this.getOptimum(this.nowPos64),
              c = this.backRes;
            o = this.nowPos64 & this._posStateMask;
            var u = (this._state << i.kNumPosStatesBitsMax) + o;
            if (1 === l && -1 === c) {
              this._rangeEncoder.encode(this._isMatch, u, 0), a = this._matchFinder.getIndexByte(-this._additionalOffset);
              var d = this._literalEncoder.getSubCoder(this.nowPos64, this._previousByte);
              if (i.stateIsCharState(this._state)) {
                d.encode(this._rangeEncoder, a)
              } else {
                var p = this._matchFinder.getIndexByte(-this._repDistances[0] - 1 - this._additionalOffset);
                d.encodeMatched(this._rangeEncoder, p, a)
              };
              this._previousByte = a, this._state = i.stateUpdateChar(this._state)
            } else {
              if (this._rangeEncoder.encode(this._isMatch, u, 1), c < i.kNumRepDistances) {
                this._rangeEncoder.encode(this._isRep, this._state, 1), 0 === c ? (this._rangeEncoder.encode(this._isRepG0, this._state, 0), 1 === l ? this._rangeEncoder.encode(this._isRep0Long, u, 0) : this._rangeEncoder.encode(this._isRep0Long, u, 1)) : (this._rangeEncoder.encode(this._isRepG0, this._state, 1), 1 === c ? this._rangeEncoder.encode(this._isRepG1, this._state, 0) : (this._rangeEncoder.encode(this._isRepG1, this._state, 1), this._rangeEncoder.encode(this._isRepG2, this._state, c - 2))), 1 === l ? this._state = i.stateUpdateShortRep(this._state) : (this._repMatchLenEncoder.encode(this._rangeEncoder, l - i.kMatchMinLen, o), this._state = i.stateUpdateRep(this._state));
                var f = this._repDistances[c];
                if (0 !== c) {
                  for (s = c; s >= 1; s--) {
                    this._repDistances[s] = this._repDistances[s - 1]
                  };
                  this._repDistances[0] = f
                }
              } else {
                this._rangeEncoder.encode(this._isRep, this._state, 0), this._state = i.stateUpdateMatch(this._state), this._lenEncoder.encode(this._rangeEncoder, l - i.kMatchMinLen, o), c -= i.kNumRepDistances;
                var m = g(c),
                  v = i.getLenToPosState(l);
                if (this._posSlotEncoder[v].encode(this._rangeEncoder, m), m >= i.kStartPosModelIndex) {
                  var y = (m >>> 1) - 1,
                    b = (2 | 1 & m) << y,
                    w = c - b;
                  m < i.kEndPosModelIndex ? n.BitTreeEncoder.reverseEncode(this._posEncoders, b - m - 1, this._rangeEncoder, y, w) : (this._rangeEncoder.encodeDirectBits(w >> i.kNumAlignBits, y - i.kNumAlignBits), this._posAlignEncoder.reverseEncode(this._rangeEncoder, w & i.kAlignMask), this._alignPriceCount++)
                };
                var _ = c;
                for (s = i.kNumRepDistances - 1; s >= 1; s--) {
                  this._repDistances[s] = this._repDistances[s - 1]
                };
                this._repDistances[0] = _, this._matchPriceCount++
              };
              this._previousByte = this._matchFinder.getIndexByte(l - 1 - this._additionalOffset)
            };
            if (this._additionalOffset -= l, this.nowPos64 += l, 0 === this._additionalOffset) {
              if (this._matchPriceCount >= 128 && this.fillDistancesPrices(), this._alignPriceCount >= i.kAlignTableSize && this.fillAlignPrices(), e[0] = this.nowPos64, t[0] = this._rangeEncoder.getProcessedSizeAdd(), 0 === this._matchFinder.getNumAvailableBytes()) {
                return void(this.flush(this.nowPos64))
              };
              if (this.nowPos64 - h >= 4096) {
                return this._finished = !1, void((r[0] = !1))
              }
            }
          }
        }
      }, y.prototype.releaseMFStream = function() {
        this._matchFinder && this._needReleaseMFStream && (this._matchFinder.releaseStream(), this._needReleaseMFStream = !1)
      }, y.prototype.setOutStream = function(e) {
        this._rangeEncoder.setStream(e)
      }, y.prototype.releaseOutStream = function() {
        this._rangeEncoder.releaseStream()
      }, y.prototype.releaseStreams = function() {
        this.releaseMFStream(), this.releaseOutStream()
      }, y.prototype.setStreams = function(e, t, n, r) {
        this._inStream = e, this._finished = !1, this.create(), this.setOutStream(t), this.init(), this.fillDistancesPrices(), this.fillAlignPrices(), this._lenEncoder.setTableSize(this._numFastBytes + 1 - i.kMatchMinLen), this._lenEncoder.updateTables(1 << this._posStateBits), this._repMatchLenEncoder.setTableSize(this._numFastBytes + 1 - i.kMatchMinLen), this._repMatchLenEncoder.updateTables(1 << this._posStateBits), this.nowPos64 = 0
      }, y.prototype.code = function(e, t, i, n, r) {
        this._needReleaseMFStream = !1;
        try {
          for (this.setStreams(e, t, i, n);;) {
            if (this.codeOneBlock(this.processedInSize, this.processedOutSize, this.finished), this.finished[0]) {
              return
            };
            r && r.setProgress(this.processedInSize[0], this.processedOutSize[0])
          }
        } finally {
          this.releaseStreams()
        }
      }, y.prototype.writeCoderProperties = function(e) {
        var t, i = a(f);
        for (i[0] = 9 * (5 * this._posStateBits + this._numLiteralPosStateBits) + this._numLiteralContextBits, t = 0; 4 > t; t++) {
          i[1 + t] = this._dictionarySize >>> 8 * t
        };
        for (t = 0; f > t; t++) {
          e.writeByte(i[t])
        }
      }, y.prototype.fillDistancesPrices = function() {
        var e = [];
        e.length = i.kNumFullDistances;
        var t, r;
        for (t = i.kStartPosModelIndex; t < i.kNumFullDistances; t++) {
          r = g(t);
          var o = (r >>> 1) - 1,
            a = (2 | 1 & r) << o;
          e[t] = n.BitTreeEncoder.reverseGetPrice(this._posEncoders, a - r - 1, o, t - a)
        };
        for (var s = 0; s < i.kNumLenToPosStates; s++) {
          var h = this._posSlotEncoder[s],
            l = s << i.kNumPosSlotBits;
          for (r = 0; r < this._distTableSize; r++) {
            this._posSlotPrices[l + r] = h.getPrice(r)
          };
          for (r = i.kEndPosModelIndex; r < this._distTableSize; r++) {
            this._posSlotPrices[l + r] += (r >>> 1) - 1 - i.kNumAlignBits << n.Encoder.kNumBitPriceShiftBits
          };
          var c = s * i.kNumFullDistances;
          for (t = 0; t < i.kStartPosModelIndex; t++) {
            this._distancesPrices[c + t] = this._posSlotPrices[l + t]
          };
          for (; t < i.kNumFullDistances; t++) {
            this._distancesPrices[c + t] = this._posSlotPrices[l + g(t)] + e[t]
          }
        };
        this._matchPriceCount = 0
      }, y.prototype.fillAlignPrices = function() {
        var e;
        for (e = 0; e < i.kAlignTableSize; e++) {
          this._alignPrices[e] = this._posAlignEncoder.reverseGetPrice(e)
        };
        this._alignPriceCount = 0
      }, y.prototype.setAlgorithm = function(e) {
        return !0
      }, y.prototype.setDictionarySize = function(e) {
        var t = 29;
        if (e < 1 << i.kDicLogSizeMin || e > 1 << t) {
          return !1
        };
        this._dictionarySize = e;
        for (var n = 0; e > 1 << n;) {
          n++
        };
        return this._distTableSize = 2 * n, !0
      }, y.prototype.setNumFastBytes = function(e) {
        return 5 > e || e > i.kMatchMaxLen ? !1 : (this._numFastBytes = e, !0)
      }, y.prototype.setMatchFinder = function(e) {
        if (0 > e || e > 2) {
          return !1
        };
        var t = this._matchFinderType;
        return this._matchFinderType = e, this._matchFinder && t != this._matchFinderType && (this._dictionarySizePrev = -1, this._matchFinder = null), !0
      }, y.prototype.setLcLpPb = function(e, t, n) {
        return 0 > t || t > i.kNumLitPosStatesBitsEncodingMax || 0 > e || e > i.kNumLitContextBitsMax || 0 > n || n > i.kNumPosStatesBitsEncodingMax ? !1 : (this._numLiteralPosStateBits = t, this._numLiteralContextBits = e, this._posStateBits = n, this._posStateMask = (1 << this._posStateBits) - 1, !0)
      }, y.prototype.setEndMarkerMode = function(e) {
        this._writeEndMark = e
      }, y.EMatchFinderTypeBT2 = h, y.EMatchFinderTypeBT4 = l, o(y.prototype), t.exports = o(y)
    }()
  }

  function _$af269971(e, t, i) {
    if ("function" != typeof n) {
      var n = e("amdefine")(t)
    };
    ! function() {
      "use strict";
      var i = e("./freeze"),
        n = e("./RangeCoder/BitTreeDecoder"),
        r = e("./RangeCoder/BitTreeEncoder"),
        o = e("./RangeCoder/Decoder"),
        a = e("./RangeCoder/Encoder");
      t.exports = i({
        BitTreeDecoder: n,
        BitTreeEncoder: r,
        Decoder: o,
        Encoder: a
      })
    }()
  }

  function _$af269973(e, t, i) {
    if ("function" != typeof n) {
      var n = e("amdefine")(t)
    };
    ! function() {
      "use strict";
      var i = e("../freeze"),
        n = e("./Encoder"),
        r = function(e) {
          this._numBitLevels = e, this.init()
        };
      r.prototype.init = function() {
        this._models = n.initBitModels(null, 1 << this._numBitLevels)
      }, r.prototype.decode = function(e) {
        for (var t = 1, i = this._numBitLevels; i--;) {
          t = t << 1 | e.decodeBit(this._models, t)
        };
        return t - (1 << this._numBitLevels)
      }, r.prototype.reverseDecode = function(e) {
        for (var t, i = 1, n = 0, r = 0; r < this._numBitLevels; ++r) {
          t = e.decodeBit(this._models, i), i = i << 1 | t, n |= t << r
        };
        return n
      }, r.reverseDecode = function(e, t, i, n) {
        for (var r, o = 1, a = 0, s = 0; n > s; ++s) {
          r = i.decodeBit(e, t + o), o = o << 1 | r, a |= r << s
        };
        return a
      }, i(r.prototype), t.exports = i(r)
    }()
  }

  function _$af269980(e, t, i) {
    if ("function" != typeof n) {
      var n = e("amdefine")(t)
    };
    ! function() {
      "use strict";
      var i = e("../freeze"),
        n = e("./Encoder"),
        r = function(e) {
          this._numBitLevels = e, this.init()
        };
      r.prototype.init = function() {
        this._models = n.initBitModels(null, 1 << this._numBitLevels)
      }, r.prototype.encode = function(e, t) {
        var i, n = 1;
        for (i = this._numBitLevels; i > 0;) {
          i--;
          var r = t >>> i & 1;
          e.encode(this._models, n, r), n = n << 1 | r
        }
      }, r.prototype.reverseEncode = function(e, t) {
        var i, n = 1;
        for (i = 0; i < this._numBitLevels; i++) {
          var r = 1 & t;
          e.encode(this._models, n, r), n = n << 1 | r, t >>>= 1
        }
      }, r.reverseEncode = function(e, t, i, n, r) {
        var o, a = 1;
        for (o = 0; n > o; o++) {
          var s = 1 & r;
          i.encode(e, t + a, s), a = a << 1 | s, r >>>= 1
        }
      }, r.prototype.getPrice = function(e) {
        var t, i = 0,
          r = 1;
        for (t = this._numBitLevels; t > 0;) {
          t--;
          var o = e >>> t & 1;
          i += n.getPrice(this._models[r], o), r = r << 1 | o
        };
        return i
      }, r.prototype.reverseGetPrice = function(e) {
        var t, i = 0,
          r = 1;
        for (t = this._numBitLevels; t > 0; t--) {
          var o = 1 & e;
          e >>>= 1, i += n.getPrice(this._models[r], o), r = r << 1 | o
        };
        return i
      }, r.reverseGetPrice = function(e, t, i, r) {
        var o, a = 0,
          s = 1;
        for (o = i; o > 0; o--) {
          var h = 1 & r;
          r >>>= 1, a += n.getPrice(e[t + s], h), s = s << 1 | h
        };
        return a
      }, i(r.prototype), t.exports = i(r)
    }()
  }

  function _$af269990(e, t, i) {
    if ("function" != typeof n) {
      var n = e("amdefine")(t)
    };
    ! function() {
      "use strict";
      var i = e("../freeze"),
        n = function(e) {
          e && (this.setStream(e), this.init())
        };
      n.prototype.setStream = function(e) {
        this._stream = e
      }, n.prototype.releaseStream = function() {
        this._stream = null
      }, n.prototype.init = function() {
        var e = 5;
        for (this._code = 0, this._range = -1; e--;) {
          this._code = this._code << 8 | this._stream.readByte()
        }
      }, n.prototype.decodeDirectBits = function(e) {
        for (var t, i = 0, n = e; n--;) {
          this._range >>>= 1, t = this._code - this._range >>> 31, this._code -= this._range & t - 1, i = i << 1 | 1 - t, 0 === (4278190080 & this._range) && (this._code = this._code << 8 | this._stream.readByte(), this._range <<= 8)
        };
        return i
      }, n.prototype.decodeBit = function(e, t) {
        var i = e[t],
          n = (this._range >>> 11) * i;
        return (2147483648 ^ this._code) < (2147483648 ^ n) ? (this._range = n, e[t] += 2048 - i >>> 5, 0 === (4278190080 & this._range) && (this._code = this._code << 8 | this._stream.readByte(), this._range <<= 8), 0) : (this._range -= n, this._code -= n, e[t] -= i >>> 5, 0 === (4278190080 & this._range) && (this._code = this._code << 8 | this._stream.readByte(), this._range <<= 8), 1)
      }, i(n.prototype), t.exports = i(n)
    }()
  }

  function _$af269998(e, t, i) {
    if ("function" != typeof n) {
      var n = e("amdefine")(t)
    };
    ! function() {
      "use strict";
      var i = e("../freeze"),
        n = 4294967295,
        r = 16777215,
        o = 255,
        a = 4278190080,
        s = 11,
        h = 1 << s,
        l = 5,
        c = 2,
        u = 6,
        d = function(e) {
          this.init(), e && this.setStream(e)
        };
      d.prototype.setStream = function(e) {
        this._stream = e
      }, d.prototype.releaseStream = function() {
        this._stream = null
      }, d.prototype.init = function() {
        this._position = 0, this.low = 0, this.range = n, this._cacheSize = 1, this._cache = 0
      }, d.prototype.flushData = function() {
        var e;
        for (e = 0; 5 > e; e++) {
          this.shiftLow()
        }
      }, d.prototype.flushStream = function() {
        this._stream.flush && this._stream.flush()
      }, d.prototype.shiftLow = function() {
        var e = this.low > n ? 1 : 0;
        if (this.low < a || e) {
          this._position += this._cacheSize;
          var t = this._cache;
          do {
            this._stream.writeByte(t + e & o), t = o
          } while (0 !== --this._cacheSize);;
          this._cache = this.low >>> 24
        };
        this._cacheSize++, this.low = 256 * (this.low & r)
      }, d.prototype.encodeDirectBits = function(e, t) {
        var i, n;
        for (n = 1 << t - 1, i = t - 1; i >= 0; i--, n >>>= 1) {
          this.range >>>= 1, e & n && (this.low += this.range), this.range <= r && (this.range *= 256, this.shiftLow())
        }
      }, d.prototype.getProcessedSizeAdd = function() {
        return this._cacheSize + this._position + 4
      }, d.initBitModels = function(e, t) {
        var i;
        for (t && !e && ("undefined" != typeof Uint16Array ? e = new Uint16Array(t) : (e = [], e.length = t)), i = 0; i < e.length; i++) {
          e[i] = h >>> 1
        };
        return e
      }, d.prototype.encode = function(e, t, i) {
        var n = e[t],
          o = (this.range >>> s) * n;
        0 === i ? (this.range = o, e[t] = n + (h - n >>> l)) : (this.low += o, this.range -= o, e[t] = n - (n >>> l)), this.range <= r && (this.range *= 256, this.shiftLow())
      };
      var p = [];
      "undefined" != typeof Uint32Array && (p = new Uint32Array(h >>> c)),
        function() {
          var e, t, i = s - c;
          for (e = i - 1; e >= 0; e--) {
            var n = 1 << i - e - 1,
              r = 1 << i - e;
            for (t = n; r > t; t++) {
              p[t] = (e << u) + (r - t << u >>> i - e - 1)
            }
          }
        }(), d.getPrice = function(e, t) {
          return p[((e - t ^ -t) & h - 1) >>> c]
        }, d.getPrice0 = function(e) {
          return p[e >>> c]
        }, d.getPrice1 = function(e) {
          return p[h - e >>> c]
        }, d.kNumBitPriceShiftBits = u, i(d.prototype), t.exports = i(d)
    }()
  }

  function _$af270015(e, t, i) {
    if ("function" != typeof n) {
      var n = e("amdefine")(t)
    };
    ! function() {
      "use strict";
      var i = e("./freeze"),
        n = function() {};
      n.prototype.readByte = function() {
        throw new Error("abstract method readByte() not implemented")
      }, n.prototype.read = function(e, t, i) {
        for (var n = 0; i > n;) {
          var r = this.readByte();
          if (0 > r) {
            return 0 === n ? -1 : n
          };
          e[t++] = r, n++
        };
        return n
      }, n.prototype.seek = function(e) {
        throw new Error("abstract method seek() not implemented")
      }, n.prototype.writeByte = function(e) {
        throw new Error("abstract method readByte() not implemented")
      }, n.prototype.write = function(e, t, i) {
        var n;
        for (n = 0; i > n; n++) {
          this.writeByte(e[t++])
        };
        return i
      }, n.prototype.flush = function() {}, t.exports = i(n)
    }()
  }

  function _$af270024(e, t, i) {
    (function(i) {
      if ("function" != typeof n) {
        var n = e("amdefine")(t)
      };
      ! function() {
        "use strict";
        var n = e("./freeze"),
          r = (e("./makeBuffer"), e("./LZMA")),
          o = e("./Stream"),
          a = function(e) {
            if ("readByte" in e) {
              return e
            };
            var t = new o;
            return t.pos = 0, t.size = e.length, t.readByte = function() {
              return this.eof() ? -1 : e[this.pos++]
            }, t.read = function(t, i, n) {
              for (var r = 0; n > r && this.pos < e.length;) {
                t[i++] = e[this.pos++], r++
              };
              return r
            }, t.seek = function(e) {
              this.pos = e
            }, t.eof = function() {
              return this.pos >= e.length
            }, t
          },
          s = function(e) {
            var t = new o,
              n = !0;
            if (e) {
              if ("number" == typeof e) {
                t.buffer = new i(e), n = !1
              } else {
                if ("writeByte" in e) {
                  return e
                };
                t.buffer = e, n = !1
              }
            } else {
              t.buffer = new i(16384)
            };
            return t.pos = 0, t.writeByte = function(e) {
              if (n && this.pos >= this.buffer.length) {
                var t = new i(2 * this.buffer.length);
                this.buffer.copy(t), this.buffer = t
              };
              this.buffer[this.pos++] = e
            }, t.getBuffer = function() {
              if (this.pos !== this.buffer.length) {
                if (!n) {
                  throw new TypeError("outputsize does not match decoded input")
                };
                var e = new i(this.pos);
                this.buffer.copy(e, 0, 0, this.pos), this.buffer = e
              };
              return this.buffer
            }, t._coerced = !0, t
          },
          h = Object.create(null);
        h.decompress = function(e, t, i, n) {
          var o = new r.Decoder;
          if (!o.setDecoderProperties(e)) {
            throw "Incorrect stream properties"
          };
          if (!o.code(t, i, n)) {
            throw "Error in data stream"
          };
          return !0
        }, h.decompressFile = function(e, t) {
          var i, n, o = new r.Decoder;
          if (e = a(e), !o.setDecoderPropertiesFromStream(e)) {
            throw "Incorrect stream properties"
          };
          var h = 0;
          for (i = 0, n = 1; 4 > i; i++, n *= 256) {
            h += e.readByte() * n
          };
          var l = 0;
          for (i = 0, n = 1; 4 > i; i++, n *= 256) {
            l += e.readByte() * n
          };
          var c = h + 4294967296 * l;
          if (4294967295 === h && 4294967295 === l ? c = -1 : l >= 2097152 && (c = -1), c >= 0 && !t && (t = c), t = s(t), !o.code(e, t, c)) {
            throw "Error in data stream"
          };
          return "getBuffer" in t ? t.getBuffer() : !0
        };
        var l = [{
            a: 0,
            d: 0,
            fb: 0,
            mf: null,
            lc: 0,
            lp: 0,
            pb: 0
          }, {
            a: 0,
            d: 16,
            fb: 64,
            mf: "hc4",
            lc: 3,
            lp: 0,
            pb: 2
          }, {
            a: 0,
            d: 20,
            fb: 64,
            mf: "hc4",
            lc: 3,
            lp: 0,
            pb: 2
          }, {
            a: 1,
            d: 19,
            fb: 64,
            mf: "bt4",
            lc: 3,
            lp: 0,
            pb: 2
          }, {
            a: 2,
            d: 20,
            fb: 64,
            mf: "bt4",
            lc: 3,
            lp: 0,
            pb: 2
          }, {
            a: 2,
            d: 21,
            fb: 128,
            mf: "bt4",
            lc: 3,
            lp: 0,
            pb: 2
          }, {
            a: 2,
            d: 22,
            fb: 128,
            mf: "bt4",
            lc: 3,
            lp: 0,
            pb: 2
          }, {
            a: 2,
            d: 23,
            fb: 128,
            mf: "bt4",
            lc: 3,
            lp: 0,
            pb: 2
          }, {
            a: 2,
            d: 24,
            fb: 255,
            mf: "bt4",
            lc: 3,
            lp: 0,
            pb: 2
          }, {
            a: 2,
            d: 25,
            fb: 255,
            mf: "bt4",
            lc: 3,
            lp: 0,
            pb: 2
          }],
          c = function(e) {
            var t = new r.Encoder,
              i = {
                a: 1,
                d: 23,
                fb: 128,
                lc: 3,
                lp: 0,
                pb: 2,
                mf: "bt4",
                eos: !1
              };
            if (e) {
              "number" == typeof e && (e = l[e]);
              var n;
              for (n in e) {
                Object.prototype.hasOwnProperty.call(e, n) && (i[n] = e[n])
              }
            };
            return t.setAlgorithm(i.a), t.setDictionarySize(1 << +i.d), t.setNumFastBytes(+i.fb), t.setMatchFinder("bt4" === i.mf ? r.Encoder.EMatchFinderTypeBT4 : r.Encoder.EMatchFinderTypeBT2), t.setLcLpPb(+i.lc, +i.lp, +i.pb), t.setEndMarkerMode(!!i.eos), t
          };
        h.compress = function(e, t, i, n) {
          var r = c(i);
          return r.writeCoderProperties(t), r.code(e, t, -1, -1, {
            setProgress: function(e, t) {
              n && n(e, t)
            }
          }), !0
        }, h.compressFile = function(e, t, i, n) {
          var r = c(i);
          e = a(e);
          var o;
          "size" in e && e.size >= 0 ? o = e.size : (o = -1, r.setEndMarkerMode(!0)), t = s(t), r.writeCoderProperties(t);
          var h = function(e) {
            var i;
            for (i = 0; 8 > i; i++) {
              t.writeByte(255 & e), e = Math.floor(e / 256)
            }
          };
          return h(o), r.code(e, t, o, -1, {
            setProgress: function(e, t) {
              n && n(e, t)
            }
          }), "getBuffer" in t ? t.getBuffer() : !0
        }, t.exports = n(h)
      }()
    }).call(this, e("buffer").Buffer)
  }

  function _$af270043(e, t, i) {
    if ("function" != typeof n) {
      var n = e("amdefine")(t)
    };
    ! function() {
      "use strict";
      t.exports = Object.freeze ? Object.freeze : function(e) {
        return e
      }
    }()
  }

  function _$af270046(e, t, i) {
    (function(i) {
      if ("function" != typeof n) {
        var n = e("amdefine")(t)
      };
      ! function() {
        "use strict";
        var e = function(e) {
          var t, i = [];
          for (t = 0; e > t; t++) {
            i[t] = 0
          };
          return i
        };
        "undefined" != typeof Uint8Array ? e = function(e) {
          return new Uint8Array(e)
        } : "undefined" != typeof i && (e = function(e) {
          var t = new i(e);
          return t.fill(0), t
        }), t.exports = e
      }()
    }).call(this, e("buffer").Buffer)
  }

  function _$af270052(e, t, i) {
    if ("function" != typeof n) {
      var n = e("amdefine")(t)
    };
    ! function() {
      "use strict";
      var i = e("./lib/freeze"),
        n = e("./lib/LZ"),
        r = e("./lib/LZMA"),
        o = e("./lib/RangeCoder"),
        a = e("./lib/Stream"),
        s = e("./lib/Util");
      t.exports = i({
        version: "0.9.0",
        LZ: n,
        LZMA: r,
        RangeCoder: o,
        Stream: a,
        Util: s,
        compress: s.compress,
        compressFile: s.compressFile,
        decompress: s.decompress,
        decompressFile: s.decompressFile
      })
    }()
  }

  function _$af270054(e, t, i) {
    "use strict";
    var n = e("three");
    n.EffectComposer = function(e, t) {
      if (this.renderer = e, void(0) === t) {
        var i = {
            minFilter: n.LinearFilter,
            magFilter: n.LinearFilter,
            format: n.RGBAFormat,
            stencilBuffer: !1
          },
          r = e.getSize();
        t = new n.WebGLRenderTarget(r.width, r.height, i)
      };
      this.renderTarget1 = t, this.renderTarget2 = t.clone(), this.writeBuffer = this.renderTarget1, this.readBuffer = this.renderTarget2, this.passes = [], void(0) === n.CopyShader && console.error(""), this.copyPass = new n.ShaderPass(n.CopyShader)
    }, n.EffectComposer.prototype = {
      swapBuffers: function() {
        var e = this.readBuffer;
        this.readBuffer = this.writeBuffer, this.writeBuffer = e
      },
      addPass: function(e) {
        this.passes.push(e)
      },
      insertPass: function(e, t) {
        this.passes.splice(t, 0, e)
      },
      render: function(e) {
        this.writeBuffer = this.renderTarget1, this.readBuffer = this.renderTarget2;
        var t, i, r = !1,
          o = this.passes.length;
        for (i = 0; o > i; i++) {
          if (t = this.passes[i], t.enabled) {
            if (t.render(this.renderer, this.writeBuffer, this.readBuffer, e, r), t.needsSwap) {
              if (r) {
                var a = this.renderer.context;
                a.stencilFunc(a.NOTEQUAL, 1, 4294967295), this.copyPass.render(this.renderer, this.writeBuffer, this.readBuffer, e), a.stencilFunc(a.EQUAL, 1, 4294967295)
              };
              this.swapBuffers()
            };
            t instanceof n.MaskPass ? r = !0 : t instanceof n.ClearMaskPass && (r = !1)
          }
        }
      },
      reset: function(e) {
        if (void(0) === e) {
          var t = this.renderer.getSize();
          e = this.renderTarget1.clone(), e.setSize(t.width, t.height)
        };
        this.renderTarget1.dispose(), this.renderTarget2.dispose(), this.renderTarget1 = e, this.renderTarget2 = e.clone(), this.writeBuffer = this.renderTarget1, this.readBuffer = this.renderTarget2
      },
      setSize: function(e, t) {
        this.renderTarget1.setSize(e, t), this.renderTarget2.setSize(e, t)
      }
    }
  }

  function _$af270062(e, t, i) {
    "use strict";
    var n = e("three");
    n.MaskPass = function(e, t) {
      this.scene = e, this.camera = t, this.enabled = !0, this.clear = !0, this.needsSwap = !1, this.inverse = !1
    }, n.MaskPass.prototype = {
      render: function(e, t, i, n) {
        var r = e.context;
        r.colorMask(!1, !1, !1, !1), r.depthMask(!1);
        var o, a;
        this.inverse ? (o = 0, a = 1) : (o = 1, a = 0), r.enable(r.STENCIL_TEST), r.stencilOp(r.REPLACE, r.REPLACE, r.REPLACE), r.stencilFunc(r.ALWAYS, o, 4294967295), r.clearStencil(a), e.render(this.scene, this.camera, i, this.clear), e.render(this.scene, this.camera, t, this.clear), r.colorMask(!0, !0, !0, !0), r.depthMask(!0), r.stencilFunc(r.EQUAL, 1, 4294967295), r.stencilOp(r.KEEP, r.KEEP, r.KEEP)
      }
    }, n.ClearMaskPass = function() {
      this.enabled = !0
    }, n.ClearMaskPass.prototype = {
      render: function(e, t, i, n) {
        var r = e.context;
        r.disable(r.STENCIL_TEST)
      }
    }
  }

  function _$af270067(e, t, i) {
    "use strict";
    var n = e("three");
    n.RenderPass = function(e, t, i, r, o) {
      this.scene = e, this.camera = t, this.overrideMaterial = i, this.clearColor = r, this.clearAlpha = void(0) !== o ? o : 1, this.oldClearColor = new n.Color, this.oldClearAlpha = 1, this.enabled = !0, this.clear = !0, this.needsSwap = !1
    }, n.RenderPass.prototype = {
      render: function(e, t, i, n) {
        this.scene.overrideMaterial = this.overrideMaterial, this.clearColor && (this.oldClearColor.copy(e.getClearColor()), this.oldClearAlpha = e.getClearAlpha(), e.setClearColor(this.clearColor, this.clearAlpha)), e.render(this.scene, this.camera, i, this.clear), this.clearColor && e.setClearColor(this.oldClearColor, this.oldClearAlpha), this.scene.overrideMaterial = null
      }
    }
  }

  function _$af270070(e, t, i) {
    "use strict";
    var n = e("three");
    n.ShaderPass = function(e, t) {
      this.textureID = void(0) !== t ? t : "tDiffuse", e instanceof n.ShaderMaterial ? (this.uniforms = e.uniforms, this.material = e) : e && (this.uniforms = n.UniformsUtils.clone(e.uniforms), this.material = new n.ShaderMaterial({
        defines: e.defines || {},
        uniforms: this.uniforms,
        vertexShader: e.vertexShader,
        fragmentShader: e.fragmentShader
      })), this.renderToScreen = !1, this.enabled = !0, this.needsSwap = !0, this.clear = !1, this.camera = new n.OrthographicCamera(-1, 1, 1, -1, 0, 1), this.scene = new n.Scene, this.quad = new n.Mesh(new n.PlaneBufferGeometry(2, 2), null), this.scene.add(this.quad)
    }, n.ShaderPass.prototype = {
      render: function(e, t, i, n) {
        this.uniforms[this.textureID] && (this.uniforms[this.textureID].value = i), this.quad.material = this.material, this.renderToScreen ? e.render(this.scene, this.camera) : e.render(this.scene, this.camera, t, this.clear)
      }
    }
  }

  function _$af270073(e, t, i) {
    "use strict";
    var n = e("three");
    n.CopyShader = {
      uniforms: {
        tDiffuse: {
          type: "t",
          value: null
        },
        opacity: {
          type: "f",
          value: 1
        }
      },
      vertexShader: ["varying vec2 vUv;", "void main() {", "vUv = uv;", "gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );", "}"].join("\x0A"),
      fragmentShader: ["uniform float opacity;", "uniform sampler2D tDiffuse;", "varying vec2 vUv;", "void main() {", "vec4 texel = texture2D( tDiffuse, vUv );", "gl_FragColor = opacity * texel;", "}"].join("\x0A")
    }
  }

  function _$af270074(e, t, i) {
    "use strict";
    var n = e("three");
    n.HorizontalBlurShader = {
      uniforms: {
        tDiffuse: {
          type: "t",
          value: null
        },
        h: {
          type: "f",
          value: 1 / 512
        }
      },
      vertexShader: ["varying vec2 vUv;", "void main() {", "vUv = uv;", "gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );", "}"].join("\x0A"),
      fragmentShader: ["uniform sampler2D tDiffuse;", "uniform float h;", "varying vec2 vUv;", "void main() {", "vec4 sum = vec4( 0.0 );", "sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;", "sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;", "sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;", "sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;", "sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;", "sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;", "sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;", "sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;", "sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;", "gl_FragColor = sum;", "}"].join("\x0A")
    }
  }

  function _$af270075(e, t, i) {
    "use strict";
    var n = e("three");
    n.VerticalBlurShader = {
      uniforms: {
        tDiffuse: {
          type: "t",
          value: null
        },
        v: {
          type: "f",
          value: 1 / 512
        }
      },
      vertexShader: ["varying vec2 vUv;", "void main() {", "vUv = uv;", "gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );", "}"].join("\x0A"),
      fragmentShader: ["uniform sampler2D tDiffuse;", "uniform float v;", "varying vec2 vUv;", "void main() {", "vec4 sum = vec4( 0.0 );", "sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;", "sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;", "sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;", "sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;", "sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;", "sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;", "sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;", "sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;", "sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;", "gl_FragColor = sum;", "}"].join("\x0A")
    }
  }

  function _$af270076(e, t, i) {
    "use strict";
    var n = e("three");
    ! function() {
      if ("performance" in window == 0 && (window.performance = {}), "now" in window.performance == 0) {
        var e = Date.now();
        performance.timing && performance.timing.navigationStart && (e = performance.timing.navigationStart), window.performance.now = function() {
          return Date.now() - e
        }
      }
    }(), n.WebGLState = function(e, t, i) {
      var r = this,
        o = new n.Vector4,
        a = e.getParameter(e.MAX_VERTEX_ATTRIBS),
        s = new Uint8Array(a),
        h = new Uint8Array(a),
        l = new Uint8Array(a),
        c = {},
        u = null,
        d = null,
        p = null,
        f = null,
        m = null,
        g = null,
        v = null,
        y = null,
        b = !1,
        w = null,
        _ = null,
        x = null,
        M = null,
        E = null,
        S = null,
        T = null,
        P = null,
        A = null,
        L = null,
        C = null,
        R = null,
        I = null,
        D = null,
        O = null,
        k = e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),
        B = void(0),
        F = {},
        N = new n.Vector4,
        U = null,
        V = null,
        z = new n.Vector4,
        G = new n.Vector4;
      this.init = function() {
        this.clearColor(0, 0, 0, 1), this.clearDepth(1), this.clearStencil(0), this.enable(e.DEPTH_TEST), e.depthFunc(e.LEQUAL), e.frontFace(e.CCW), e.cullFace(e.BACK), this.enable(e.CULL_FACE), this.enable(e.BLEND), e.blendEquation(e.FUNC_ADD), e.blendFunc(e.SRC_ALPHA, e.ONE_MINUS_SRC_ALPHA)
      }, this.initAttributes = function() {
        for (var e = 0, t = s.length; t > e; e++) {
          s[e] = 0
        }
      }, this.enableAttribute = function(i) {
        if (s[i] = 1, 0 === h[i] && (e.enableVertexAttribArray(i), h[i] = 1), 0 !== l[i]) {
          var n = t["get"]("ANGLE_instanced_arrays");
          n.vertexAttribDivisorANGLE(i, 0), l[i] = 0
        }
      }, this.enableAttributeAndDivisor = function(t, i, n) {
        s[t] = 1, 0 === h[t] && (e.enableVertexAttribArray(t), h[t] = 1), l[t] !== i && (n.vertexAttribDivisorANGLE(t, i), l[t] = i)
      }, this.disableUnusedAttributes = function() {
        for (var t = 0, i = h.length; i > t; t++) {
          h[t] !== s[t] && (e.disableVertexAttribArray(t), h[t] = 0)
        }
      }, this.enable = function(t) {
        c[t] !== !0 && (e.enable(t), c[t] = !0)
      }, this.disable = function(t) {
        c[t] !== !1 && (e.disable(t), c[t] = !1)
      }, this.getCompressedTextureFormats = function() {
        if (null === u && (u = [], t["get"]("WEBGL_compressed_texture_pvrtc") || t["get"]("WEBGL_compressed_texture_s3tc") || t["get"]("WEBGL_compressed_texture_etc1"))) {
          for (var i = e.getParameter(e.COMPRESSED_TEXTURE_FORMATS), n = 0; n < i.length; n++) {
            u.push(i[n])
          }
        };
        return u
      }, this.setBlending = function(t, r, o, a, s, h, l, c) {
        t === n.NoBlending ? this.disable(e.BLEND) : this.enable(e.BLEND), (t !== d || c !== b) && (t === n.AdditiveBlending ? c ? (e.blendEquationSeparate(e.FUNC_ADD, e.FUNC_ADD), e.blendFuncSeparate(e.ONE, e.ONE, e.ONE, e.ONE)) : (e.blendEquation(e.FUNC_ADD), e.blendFunc(e.SRC_ALPHA, e.ONE)) : t === n.SubtractiveBlending ? c ? (e.blendEquationSeparate(e.FUNC_ADD, e.FUNC_ADD), e.blendFuncSeparate(e.ZERO, e.ZERO, e.ONE_MINUS_SRC_COLOR, e.ONE_MINUS_SRC_ALPHA)) : (e.blendEquation(e.FUNC_ADD), e.blendFunc(e.ZERO, e.ONE_MINUS_SRC_COLOR)) : t === n.MultiplyBlending ? c ? (e.blendEquationSeparate(e.FUNC_ADD, e.FUNC_ADD), e.blendFuncSeparate(e.ZERO, e.ZERO, e.SRC_COLOR, e.SRC_ALPHA)) : (e.blendEquation(e.FUNC_ADD), e.blendFunc(e.ZERO, e.SRC_COLOR)) : c ? (e.blendEquationSeparate(e.FUNC_ADD, e.FUNC_ADD), e.blendFuncSeparate(e.ONE, e.ONE_MINUS_SRC_ALPHA, e.ONE, e.ONE_MINUS_SRC_ALPHA)) : (e.blendEquationSeparate(e.FUNC_ADD, e.FUNC_ADD), e.blendFuncSeparate(e.SRC_ALPHA, e.ONE_MINUS_SRC_ALPHA, e.ONE, e.ONE_MINUS_SRC_ALPHA)), d = t, b = c), t === n.CustomBlending ? (s = s || r, h = h || o, l = l || a, (r !== p || s !== g) && (e.blendEquationSeparate(i(r), i(s)), p = r, g = s), (o !== f || a !== m || h !== v || l !== y) && (e.blendFuncSeparate(i(o), i(a), i(h), i(l)), f = o, m = a, v = h, y = l)) : (p = null, f = null, m = null, g = null, v = null, y = null)
      }, this.setDepthFunc = function(t) {
        if (w !== t) {
          if (t) {
            switch (t) {
              case n.NeverDepth:
                e.depthFunc(e.NEVER);
                break;
              case n.AlwaysDepth:
                e.depthFunc(e.ALWAYS);
                break;
              case n.LessDepth:
                e.depthFunc(e.LESS);
                break;
              case n.LessEqualDepth:
                e.depthFunc(e.LEQUAL);
                break;
              case n.EqualDepth:
                e.depthFunc(e.EQUAL);
                break;
              case n.GreaterEqualDepth:
                e.depthFunc(e.GEQUAL);
                break;
              case n.GreaterDepth:
                e.depthFunc(e.GREATER);
                break;
              case n.NotEqualDepth:
                e.depthFunc(e.NOTEQUAL);
                break;
              default:
                e.depthFunc(e.LEQUAL)
            }
          } else {
            e.depthFunc(e.LEQUAL)
          };
          w = t
        }
      }, this.setDepthTest = function(t) {
        t ? this.enable(e.DEPTH_TEST) : this.disable(e.DEPTH_TEST)
      }, this.setDepthWrite = function(t) {
        _ !== t && (e.depthMask(t), _ = t)
      }, this.setColorWrite = function(t) {
        x !== t && (e.colorMask(t, t, t, t), x = t)
      }, this.setStencilFunc = function(t, i, n) {
        (E !== t || S !== i || T !== n) && (e.stencilFunc(t, i, n), E = t, S = i, T = n)
      }, this.setStencilOp = function(t, i, n) {
        (P !== t || A !== i || L !== n) && (e.stencilOp(t, i, n), P = t, A = i, L = n)
      }, this.setStencilTest = function(t) {
        t ? this.enable(e.STENCIL_TEST) : this.disable(e.STENCIL_TEST)
      }, this.setStencilWrite = function(t) {
        M !== t && (e.stencilMask(t), M = t)
      }, this.setFlipSided = function(t) {
        C !== t && (e.frontFace(t ? e.CW : e.CCW), C = t)
      }, this.setLineWidth = function(t) {
        t !== R && (e.lineWidth(t), R = t)
      }, this.setPolygonOffset = function(t, i, n) {
        t ? this.enable(e.POLYGON_OFFSET_FILL) : this.disable(e.POLYGON_OFFSET_FILL), !t || I === i && D === n || (e.polygonOffset(i, n), I = i, D = n)
      }, this.getScissorTest = function() {
        return O
      }, this.setScissorTest = function(t) {
        O = t, t ? this.enable(e.SCISSOR_TEST) : this.disable(e.SCISSOR_TEST)
      }, this.activeTexture = function(t) {
        void(0) === t && (t = e.TEXTURE0 + k - 1), B !== t && (e.activeTexture(t), B = t)
      }, this.bindTexture = function(t, i) {
        void(0) === B && r.activeTexture();
        var n = F[B];
        void(0) === n && (n = {
          type: void(0),
          texture: void(0)
        }, F[B] = n), (n.type !== t || n.texture !== i) && (e.bindTexture(t, i), n.type = t, n.texture = i)
      }, this.compressedTexImage2D = function() {
        try {
          e.compressedTexImage2D.apply(e, arguments)
        } catch (t) {
          console.error(t)
        }
      }, this.texImage2D = function() {
        try {
          e.texImage2D.apply(e, arguments)
        } catch (t) {
          console.error(t)
        }
      }, this.clearColor = function(t, i, n, r) {
        o["set"](t, i, n, r), N.equals(o) === !1 && (e.clearColor(t, i, n, r), N.copy(o))
      }, this.clearDepth = function(t) {
        U !== t && (e.clearDepth(t), U = t)
      }, this.clearStencil = function(t) {
        V !== t && (e.clearStencil(t), V = t)
      }, this.scissor = function(t) {
        z.equals(t) === !1 && (e.scissor(t.x, t.y, t.z, t.w), z.copy(t))
      }, this.viewport = function(t) {
        G.equals(t) === !1 && (e.viewport(t.x, t.y, t.z, t.w), G.copy(t))
      }, this.reset = function() {
        for (var t = 0; t < h.length; t++) {
          1 === h[t] && (e.disableVertexAttribArray(t), h[t] = 0)
        };
        c = {}, u = null, B = void(0), F = {}, d = null, x = null, _ = null, M = null, C = null
      }
    }
  }

  function _$af270112(e, t, i) {
    (function(i, n) {
      "use strict";

      function r(e) {
        this.urls = e;
        var t = i("bWVzc2FnZSBiaW5hcnlfbWVzaCB7CglyZXBlYXRlZCBjaHVua19zaW1wbGUgY2h1bmsgPSAxOwoJcmVwZWF0ZWQgY2h1bmtfcXVhbnRpemVkIHF1YW50aXplZF9jaHVuayA9IDI7Cn0KCi8vIERlZmluaXRpb24gb2YgdmVydGljZXM6IDNEIGNvb3JkaW5hdGVzLCBhbmQgMkQgdGV4dHVyZSBjb29yZGluYXRlcy4KbWVzc2FnZSB2ZXJ0aWNlc19zaW1wbGUgewoJcmVwZWF0ZWQgZmxvYXQgeHl6ID0gMSBbcGFja2VkPXRydWVdOyAgLy8geF8wLHlfMCx6XzAsIHhfMSx5XzEsel8xLCAuLi4KCXJlcGVhdGVkIGZsb2F0IHV2ID0gMiBbcGFja2VkPXRydWVdOyAgLy8gdV8wLHZfMCwgdV8xLHZfMSwgLi4uCn0KCi8vIEluZGV4ZXMgb2YgdmVydGljZXMgb2YgZmFjZXMKbWVzc2FnZSBmYWNlc19zaW1wbGUgewoJcmVwZWF0ZWQgdWludDMyIGZhY2VzID0gMSBbcGFja2VkPXRydWVdOyAvLyBpMDAsaTAxLGkwMiwgaTEwLGkxMSxpMTIsIC4uLgp9CgovLyBBIHNpbXBseSBlbmNvZGVkIGNodW5rLgovLyBUT0RPOiBhZGQgY2h1bmsgcHJvcGVyaXRlcyAoc3VjaCBhcyAicmVmbGVjdGl2ZSIpCm1lc3NhZ2UgY2h1bmtfc2ltcGxlIHsKCW9wdGlvbmFsIHZlcnRpY2VzX3NpbXBsZSB2ZXJ0aWNlcyA9IDE7CglvcHRpb25hbCBmYWNlc19zaW1wbGUgZmFjZXMgPSAyOwoJb3B0aW9uYWwgc3RyaW5nIGNodW5rX25hbWUgPSAzOwoJb3B0aW9uYWwgc3RyaW5nIG1hdGVyaWFsX25hbWUgPSA0Owp9CgovLyBRdWFudGl6ZWQgdmVyc2lvbnMgZm9sbG93OgptZXNzYWdlIHZlcnRpY2VzX3F1YW50aXplZCB7CglvcHRpb25hbCBmbG9hdCBxdWFudGl6YXRpb24gPSAxOwoJcmVwZWF0ZWQgZmxvYXQgdHJhbnNsYXRpb24gPSAyOwoJcmVwZWF0ZWQgc2ludDMyIHggPSAzIFtwYWNrZWQ9dHJ1ZV07CglyZXBlYXRlZCBzaW50MzIgeSA9IDQgW3BhY2tlZD10cnVlXTsKCXJlcGVhdGVkIHNpbnQzMiB6ID0gNSBbcGFja2VkPXRydWVdOwp9CgptZXNzYWdlIHV2X3F1YW50aXplZCB7CglvcHRpb25hbCBzdHJpbmcgbmFtZSA9IDE7CglvcHRpb25hbCBmbG9hdCBxdWFudGl6YXRpb24gPSAyOwoJcmVwZWF0ZWQgc2ludDMyIHUgPSAzIFtwYWNrZWQ9dHJ1ZV07CglyZXBlYXRlZCBzaW50MzIgdiA9IDQgW3BhY2tlZD10cnVlXTsKfQoKLy8gSW5kZXhlcyBvZiB2ZXJ0aWNlcyBvZiBmYWNlcwptZXNzYWdlIGZhY2VzX2NvbXByZXNzZWQgewoJcmVwZWF0ZWQgc2ludDMyIGZhY2VzID0gMSBbcGFja2VkPXRydWVdOyAvLyBpMDAsaTAxLGkwMiwgaTEwLGkxMSxpMTIsIC4uLgp9CgptZXNzYWdlIGNodW5rX3F1YW50aXplZCB7CglvcHRpb25hbCBzdHJpbmcgY2h1bmtfbmFtZSA9IDE7CglvcHRpb25hbCBzdHJpbmcgbWF0ZXJpYWxfbmFtZSA9IDI7CglvcHRpb25hbCB2ZXJ0aWNlc19xdWFudGl6ZWQgdmVydGljZXMgPSAzOwoJcmVwZWF0ZWQgdXZfcXVhbnRpemVkIHV2cyA9IDQ7CglvcHRpb25hbCBmYWNlc19zaW1wbGUgZmFjZXMgPSA1Owp9Cg==", "base64");
        this.builder = a.loadProto(t), this.decoder = this.builder.build("binary_mesh")
      }
      var o = e("three"),
        a = e("protobufjs"),
        s = e("../util/logger"),
        h = (e("../util/common"), e("../util/ajax")),
        l = e("../util/texture"),
        c = new s(n);
      r.prototype = {
        constructor: r,
        load: function(e, t, i, n, r, o, a) {
          c.time("download"), h["get"](e, {
            responseType: "arraybuffer"
          }).done(function(e) {
            c.timeEnd("download"), this.parse(e, t, r, o, a)
          }.bind(this)).fail(a)
        },
        parse: function(e, t, i, n, r) {
          var o = this.readProtobuf(e);
          if (!o) {
            return r()
          };
          try {
            c.time("convert to webgl"), this.convertProtobufToSceneObject(o, t, i, n, r), c.timeEnd("convert to webgl")
          } catch (a) {
            return c.error("failed parsing .dam"), c.error(a.message), r()
          }
        },
        readProtobuf: function(e) {
          var t;
          try {
            c.time("parse proto"), t = this.decoder.decode(e), c.timeEnd("parse proto")
          } catch (i) {
            return c.error("failed parsing proto for .dam"), c.error(i.message), null
          };
          return t
        },
        countUniqueTexturesInChunk: function(e, t) {
          var i = 0,
            n = {};
          return e.forEach(function(e, r, o) {
            var a = t + e.material_name;
            a in n || (n[a] = 1, i++)
          }), i
        },
        convertProtobufToSceneObject: function(e, t, i, n, r) {
          function a(e) {
            e in g || (g[e] = new o.MeshBasicMaterial({
              map: l.load(m.urls["get"](e), h)
            }));
            return g[e]
          }

          function s(e) {
            var i = new o.BufferGeometry;
            i.addAttribute("position", new o.BufferAttribute(new Float32Array(e.vertices.xyz, 0, 3), 3)), e.vertices.uv.length > 0 && i.addAttribute("uv", new o.BufferAttribute(new Float32Array(e.vertices.uv, 0, 2), 2)), i.setIndex(new o.BufferAttribute(new Uint32Array(e.faces.faces, 0, 1), 1)), i.applyMatrix(f), i.computeBoundingBox();
            i.computeVertexNormals();
            var n = new o.Mesh(i, a(t + e.material_name));
            return n.name = e.chunk_name, n
          }

          function h() {
            return v++, p++, n(p, d), v === Object.keys(g).length ? i(y) : void(0)
          }
          if (0 === e.chunk.length) {
            return c.warn("No chunks in damfile..."), i([])
          };
          var u = this.countUniqueTexturesInChunk(e.chunk, t),
            d = u + 1,
            p = 1;
          n(p, d);
          var f = new o.Matrix4;
          f["set"](1, 0, 0, 0, 0, 0, 1, 0, 0, -1, 0, 0, 0, 0, 0, 1);
          var m = this,
            g = {},
            v = 0,
            y = e.chunk.map(s);
          return y ? void(0) : (c.error(".dam protobuf came out with no chunks..."), r())
        }
      }, t.exports = r
    }).call(this, e("buffer").Buffer, "/js/loaders/DamLoader.js")
  }

  function _$af270125(e, t, i) {
    (function(i) {
      "use strict";

      function n(e) {
        o.call(this, e)
      }
      var r = (e("three"), e("../lib/lzma-purejs")),
        o = e("./DamLoader"),
        a = e("../util/logger"),
        s = new a(i);
      n.prototype = Object.create(o.prototype), n.prototype.constructor = n, n.prototype.parse = function(e, t, i, n) {
        var a;
        try {
          s.time("lzma"), a = r.decompressFile(new Uint8Array(e)), s.timeEnd("lzma")
        } catch (h) {
          s.timeEnd("lzma"), console.error("LZMA failed parsing..."), console.error(h.message), n()
        };
        return o.prototype.parse.call(this, a, t, i, n)
      }, t.exports = n
    }).call(this, "/js/loaders/LZMADamLoader.js")
  }

  function _$af270129(e, t, i) {
    (function(i) {
      "use strict";
      var n = (e("three"), e("../settings")),
        r = e("../util/browser"),
        o = e("./LZMADamLoader"),
        a = e("./DamLoader"),
        s = e("../util/logger"),
        h = new s(i),
        l = [
          ["_50k", ".dam.lzma", "high", o],
          ["_50k", ".dam", "high", a],
          ["", ".dam.lzma", "low", o],
          ["", ".dam", "low", a]
        ];
      t.exports = {
        load: function(e, t, i, o, a, s) {
          s = s || 0;
          var c = l[s];
          if (!c) {
            return void((a && a("no suitable model file found...")))
          };
          var u = c[0],
            d = c[1],
            p = c[2],
            f = new c[3](t),
            m = t["get"](e + u + d);
          if (m) {
            var g = e + u + "_texture_jpg_" + p + "/";
            if (r.isMobile() && "high" == p) {
              if (r.detectSamsungS6()) {
                h.warn("Galaxy S6\u4e0d\u80fd\u5904\u7406\u9ad8\u6e05\u8d34\u56fe,\u8bf7\u8c03\u4f4e\u8d28\u91cf.");
                p = "low";
                g = e + u + "_texture_jpg_" + p + "/"
              } else {
                if (t.count(g) > n.maxMobileTextures) {
                  h.warn("\u5bf9\u4e8e\u624b\u673a\u6765\u8bf4\uff0c\u6a21\u578b\u53ef\u80fd\u592a\u5927, \u8bf7\u8c03\u4f4e\u6a21\u578b\u8d28\u91cf.");
                  p = "low";
                  g = e + u + "_texture_jpg_" + p + "/"
                }
              }
            };
            f.load(m, g, e + u, d, i, o, function() {
              this.load(e, t, i, o, a, ++s)
            }.bind(this))
          } else {
            this.load(e, t, i, o, a, ++s)
          }
        }
      }
    }).call(this, "/js/loaders/ModelLoader.js")
  }

  function _$af270133(e, t, i) {
    (function(i, n) {
      "use strict";

      function r(e) {
        this.model = e, this.modelDataPath = this.model.urls["get"]("vision.modeldata"), this.sweepLocationsPath = this.model.urls["get"]("sweep_locations.csv");
        var t = i("Ly8KLy8gUHJvdG9jb2wgQnVmZmVyIGZvciBwdWNrIHZpc2liaWxpdHkgYW5kIHJlbGF0ZWQgZGF0YQovLwovL3BhY2thZ2UgZW9zLnN0b3JhZ2U7CgovLyBpbXBvcnQgImVvcy9pbmZyYS9jb21tb24ucHJvdG8iOwovLyBUaGUgZm9sbG93aW5nIHdlcmUgbWFudWFsbHkgZXh0cmFjdGVkIGhlcmUsIEpTIGRvZXMgbm90IGxpa2UgcHJvdG9idWYgaW1wb3J0cwoKbWVzc2FnZSBBZmZpbmUzZiB7CglvcHRpb25hbCBRdWF0ZXJuaW9uZiByb3RhdGlvbiA9IDE7CglvcHRpb25hbCBWZWN0b3IzZiB0cmFuc2xhdGlvbiA9IDI7Cn0KCm1lc3NhZ2UgUXVhdGVybmlvbmYgewoJb3B0aW9uYWwgZmxvYXQgdyA9IDE7CglvcHRpb25hbCBmbG9hdCB4ID0gMjsKCW9wdGlvbmFsIGZsb2F0IHkgPSAzOwoJb3B0aW9uYWwgZmxvYXQgeiA9IDQ7Cn0KCm1lc3NhZ2UgVmVjdG9yM2YgewoJb3B0aW9uYWwgZmxvYXQgeCA9IDE7CglvcHRpb25hbCBmbG9hdCB5ID0gMjsKCW9wdGlvbmFsIGZsb2F0IHogPSAzOwp9CgovLwovLyBPbmUgc3dlZXAgLyBwYW5vCi8vCm1lc3NhZ2UgU3dlZXBMb2NhdGlvbiB7CglvcHRpb25hbCBieXRlcyB1dWlkID0gMTsgIC8qIHV1aWQgKi8KCW9wdGlvbmFsIEFmZmluZTNmIHBvc2UgPSAyOyAgLyogY2FtZXJhIHBvc2UgKHgsIHkseikgaW4gbWV0ZXIgYW5kIGEgcXVhdGVybmlvbiovCglvcHRpb25hbCBWZWN0b3IzZiBwdWNrID0gMzsgIC8qIHB1Y2sgbG9jYXRpb24gLSB4IGFueSBpcyBnZW5lcmFsbHkgdGhlIHNhbWUgYXMgcG9zZSwgeiBpcyB0aGUgaGVpZ2h0IG9mIHRoZSBjbG9zZXN0IGZsb29yIHVuZGVyIHRoZSBjYW1lcmEgKi8KCW9wdGlvbmFsIGludDMyIGdyb3VwID0gNDsgIC8qIGZsb29yIGluZGV4ICovCglvcHRpb25hbCBpbnQzMiBzdWJncm91cCA9IDU7ICAvKiByb29tIGluZGV4ICovCglyZXBlYXRlZCBpbnQzMiB2aXNpYmxlcyA9IDY7ICAvKiBsaXN0IG9mIGluZGljZXMgdG8gYWxsIHB1Y2tzIHZpc2libGUgZnJvbSB0aGlzIHB1Y2sgKi8KCXJlcGVhdGVkIGZsb2F0IHNjb3JlcyA9IDc7IC8qIHVzZWQgYXMgcGFydCBvZiBzY29yaW5nIGZ1bmN0aW9uIGZvciBkZXRlcm1pbmluZyB3aGljaCBwdWNrIHRvIGdvIHRvIG5leHQgKi8KfQoKLy8KLy8gQWxsIHB1Y2tzIGluIGEgbW9kZWwuIFB1Y2tzIGFyZSBzdG9yZWQgaW4gc2Nhbm5pbmcgb3JkZXIuCi8vCm1lc3NhZ2UgTmF2aWdhdGlvbkluZm8gewoJcmVwZWF0ZWQgU3dlZXBMb2NhdGlvbiBzd2VlcExvY2F0aW9ucyA9IDE7Cn0K", "base64"),
          n = o.loadProto(t);
        this.decoder = n.build("NavigationInfo")
      }
      var o = (e("three"), e("protobufjs")),
        a = e("../util/ajax"),
        s = (e("../util/common"), e("../util/math")),
        h = e("../util/logger"),
        l = new h(n);
      r.prototype.load = function() {
        var e = $.Deferred();
        return this.modelDataPath ? this.loadVisionModelData(e) : this.sweepLocationsPath ? this.loadSweepLocationsCSV(e) : e.resolve([]), e
      };
      r.prototype.loadVisionModelData = function(e) {
        a["get"](this.modelDataPath, {
          responseType: "arraybuffer"
        }).done(function(t) {
          var i;
          try {
            i = this.decoder.decode(t)
          } catch (n) {
            return l.warn("\u4e0d\u80fd\u89e3\u7801vision.modeldata\u6570\u636e, \u8bf7\u4f7f\u7528sweep_locations.csv"), this.loadSweepLocationsCSV(e)
          };
          var r = i.sweepLocations.map(function(e) {
            return {
              uuid: e.uuid.toUTF8().replace(/-/g, ""),
              position: {
                x: e.pose.translation.x,
                y: e.pose.translation.y,
                z: e.pose.translation.z
              },
              quaternion: {
                x: e.pose.rotation.x,
                y: e.pose.rotation.y,
                z: e.pose.rotation.z,
                w: e.pose.rotation.w
              },
              puck: {
                x: e.puck.x,
                y: e.puck.y,
                z: e.puck.z
              },
              floor: e.group,
              neighbours: e.visibles
            }
          }).map(function(e) {
            return e.position = s.convertVisionVector(e.position), e.quaternion = s.convertVisionQuaternion(e.quaternion), e.puck = s.convertVisionVector(e.puck), e
          });
          r.forEach(function(e) {
            e.neighbours = e.neighbours.map(function(e) {
              return r[e].uuid
            })
          }), e.resolve(r)
        }.bind(this)).fail(function() {
          l.warn("\u4e0d\u80fd\u89e3\u7801vision.modeldata\u6570\u636e, \u8bf7\u4f7f\u7528sweep_locations.csv"), this.loadSweepLocationsCSV(e)
        }.bind(this))
      };
      r.prototype.loadSweepLocationsCSV = function(e) {
        a["get"](this.sweepLocationsPath).done(function(t) {
          var i = t.split("\x0A").map(function(e) {
            return e.split(", ")
          }).filter(function(e) {
            return e.length > 1
          }).map(function(e) {
            return {
              uuid: e[0],
              position: {
                x: parseFloat(e[1]),
                y: parseFloat(e[2]),
                z: parseFloat(e[3])
              },
              quaternion: {
                x: parseFloat(e[4]),
                y: parseFloat(e[5]),
                z: parseFloat(e[6]),
                w: parseFloat(e[7])
              }
            }
          }).map(function(e) {
            return e.position = s.convertVisionVector(e.position), e.quaternion = s.convertVisionQuaternion(e.quaternion), e
          });
          e.resolve(i)
        }).fail(function() {
          l.warn("\u4e0d\u80fd\u52a0\u8f7dsweep_locations.csv"), e.resolve([])
        })
      };
      t.exports = r
    }).call(this, e("buffer").Buffer, "/js/loaders/SweepDataLoader.js")
  }

  function _$af270151(e, t, i) {
    (function(t) {
      "use strict";

      function i() {
        var e = R.valueFromHash("title");
        ("0" === e || 0 === e) && $(document).ready(function() {
          var e = $(".model-title");
          e.hide()
        })
      }

      function n() {
        ee.addEventListener("dragenter", E, !1), ee.addEventListener("dragover", E, !1)
      }

      function r() {
        return R.valueFromHash("model") || R.valueFromHash("m")
      }

      function o() {
        return R.valueFromHash("play", !1) ? "autoplay" : R.inIframe() ? "click" : "fullpage"
      }

      function a(e) {
        return j.loadFeatureFlags(e).done(function(e) {
          j.updateDependentSettings(e)
        })
      }

      function xst_createTextMesh() {
        if (g_Text != null) {
          for (var o in g_Text) {
            var m_textMesh2 = new S.Mesh(new S.PlaneBufferGeometry(0.1, 0.1, 1, 1), new S.MeshPhongMaterial({
              map: S.ImageUtils.loadTexture(g_TextIcon)
            }));
            m_textMesh2.position["set"](g_Text[o].iconPosition.x, g_Text[o].iconPosition.y, g_Text[o].iconPosition.z);
            m_textMesh2.rotation["set"](g_Text[o].rotation.x, g_Text[o].rotation.y, g_Text[o].rotation.z);
            m_textMesh2.groupIndex = o.replace("Text", "");
            g_TextIconMesh.push(m_textMesh2);
            Q.add(m_textMesh2)
          }
        }
      }

      function xst_createHot() {
        for (var key in g_Hots) {
          var geometry = new S.PlaneBufferGeometry(g_HotMeshWidth, g_HotMeshHeight, 1, 1);
          var shaderMaterial = new S.ShaderMaterial({
            uniforms: xsto.hot.uniforms,
            vertexShader: xsto.hot.vertexShader,
            fragmentShader: xsto.hot.fragmentShader
          });
          shaderMaterial.transparent = true;
          var sprite = new S.Mesh(geometry, shaderMaterial);
          sprite.dynamic = true;
          sprite.position["set"](g_Hots[key].position.x, g_Hots[key].position.y, g_Hots[key].position.z);
          sprite.rotation["set"](g_Hots[key].rotation.x, g_Hots[key].rotation.y, g_Hots[key].rotation.z);
          sprite.name = key;
          if (g_Hots[key].hasOwnProperty("link")) {
            sprite.hotLink = g_Hots[key].link
          };
          g_HotMeshes.push(sprite);
          Q.add(sprite)
        };
        var timeAll = 1000;
        var v = 25;
        var time = timeAll / v;
        var flag = 1;
        refreshHot();

        function refreshHot() {
          time--;
          if (time <= 0) {
            time = timeAll / v;
            flag *= -1
          };
          xsto.hot.uniforms.opac.value += (v * flag) / timeAll;
          setTimeout(refreshHot, v)
        }
      }

      function xst_createOther() {
        if (g_weixinTitle != null && typeof(g_weixinTitle) != "undefined" && typeof(g_weixinTitle[g_index]) != "undefined") {}
      }

      function xst_create() {
        xst_createHot();
        xst_createTextMesh();
        xst_createOther()
      }

      function xst_loadModeldata(url) {
        var e = $.Deferred(),
          t = url;
        return xst["get"](t, {
          responseType: "json",
          auth: m.authorizationHeader
        }).done(function(t) {
          g_modeldata = t;
          g_modeldata.model.image = g_Prefix + g_modeldata.model.image;
          if ("undefined" != typeof g_modeldata.model.normalTexture) {
            g_NormalTexture = g_modeldata.model.normalTexture
          };
          if ("undefined" != typeof g_modeldata.model.specularTexture) {
            g_SpecularTexture = g_modeldata.model.specularTexture
          };
          e.resolve()
        }.bind(this)).fail(function() {
          e.resolve()
        }), e
      }

      function xst_loaddata2(url) {
        var e = $.Deferred(),
          t = url;
        return xst["get"](t, {
          responseType: "json",
          auth: m.authorizationHeader
        }).done(function(t) {
          g_Hots = t.hots;
          g_audio = t.audio;
          g_Text = t.texts;
          g_TextShow = t.showText;
          g_weixinTitle = t.weixintitle;
          if ("undefined" != typeof(t.roof)) {
            g_roof = t.roof
          };
          if ("undefined" != typeof(t.dollhouseminDistance)) {
            I.dollhouseDefault.minDistance = t.dollhouseminDistance
          };
          e.resolve()
        }.bind(this)).fail(function() {
          e.resolve()
        }), e
      }

      function s() {
        var e = g_modeldata || {},
          t = C.parseSidUrl(ae);
        var n = C.getModel({
          url: ae,
          floors: R.valueFromHash("f", !0),
          autoload: !1,
          data: e.model || null
        });
        n.done(l).fail(b)
      }

      function h() {
        if (window.location.hash) {
          var e = window.location.href.replace(/#model/i, "?m");
          return e = e.replace(/#m/i, "?m"), window.location.href = e, !0
        };
        return !1
      }

      function l(e, t, i) {
        var n = o();
        var r = R.valueFromHash("_cdn"),
          a = {};
        r && (a.cdn = r), H.init(i, a), D.coverScreen(e, function(t) {
          re.progressCallback = t, B.sessionStart({
            model: e,
            startSource: n
          }), e.load(v, c, b)
        })
      }

      function c(e, t) {
        p(t), d()
      }

      function u(e, t) {
        re.panoElementsToLoad = t, d()
      }

      function d() {
        re.totalElementsLoaded++, re.totalPercentageLoaded = re.totalElementsLoaded / re.totalElementsToLoad, re.progressCallback && re.progressCallback(100 * re.totalPercentageLoaded)
      }

      function p(e) {
        re.modelElementsToLoad = e, re.totalElementsToLoad = re.modelElementsToLoad + re.panoElementsToLoad
      }

      function f(e) {
        K = new S.PerspectiveCamera, Q = new S.Scene;
        var i = new S.AmbientLight(16777215);
        Q.add(i), g_DirectionalLight = new S.DirectionalLight(0xffffff, 1);
        g_DirectionalLight.position["set"](0, 13, 10);
        Q.add(g_DirectionalLight), q.autoClear = !1, q.setPixelRatio(window.devicePixelRatio ? window.devicePixelRatio : 1), q.setSize(window.innerWidth, window.innerHeight), Q.skybox = new U, Q.add(Q.skybox), Y = new T(e, K, ee, Q, q), Q.add(Y.reticule), X = new P(Y), Y.director = X, Z = new S.EffectComposer(q), Z.addPass(new S.RenderPass(Q, K)), N.init(Z, Y), ee.appendChild(q.domElement), e.constrained = R.isMobile(), W.init(X, Y)
      }

      function m(e) {
        var t = {},
          i = R.valueFromHash("start", "");
        if ("" !== i && (t = Y.optionsFromString(i) || {}, t.tag = R.valueFromHash("tag", null)), 0 === Object.keys(t).length || !e.outsideAllowed() && t.mode !== A.PANORAMA) {
          var n = g(e);
          if (!n) {
            n = {}, n.mode = A.PANORAMA;
            var r = e.findPanoramicHero();
            r ? (n.pano = e.panos.dict[r.scan_id], n.position = r.position, n.quaternion = r.quaternion) : (n.pano = e.panos.list[0], n.position = n.pano.position)
          };
          t = n
        };
        return t.mode = t.mode || A.PANORAMA, t.pano || (t.pano = e.panos.findClosest(t.position || Y.position)), t
      }

      function g(e) {
        if (!e.heroImage || !e.heroImage.metadata.camera_position) {
          return null
        };
        var t = {},
          i = e.heroImage.metadata;
        if (t.position = V.convertWorkshopVector(i.camera_position), t.quaternion = V.convertWorkshopQuaternion(i.camera_quaternion), 0 === i.camera_mode) {
          t.mode = A.PANORAMA, t.pano = e.panos["get"](i.scan_id)
        } else {
          if (!e.outsideAllowed()) {
            return null
          };
          1 === i.camera_mode ? t.mode = A.FLOORPLAN : 2 === i.camera_mode ? t.mode = A.DOLLHOUSE : (t.mode = null, t.pano = null)
        };
        return t
      }

      function v(e) {
        f(e), xst_create(), D.init(e, X, Y);
        if (e.panos.list.length > 0) {
          var t = m(e);
          t.pano ? (t.pano.loadCube("high", function() {
            new z(e, Y).start(), y(e, t)
          }, b, u)) : (y(e, t))
        } else {
          y(e, t)
        }
      }

      function y(e, t) {
        if ("undefined" != typeof t) {
          t.pano
        };
        J = e, B.modelLoaded(e, Y), Q.add(e), Q.plane = new S.Mesh(new S.PlaneBufferGeometry(1e5, 1e5), new S.MeshBasicMaterial({
          side: S.DoubleSide
        })), Q.plane.position.y = 0, Q.plane.rotateX(-Math.PI / 2), Q.plane.material.visible = !1, Q.add(Q.plane), Q.updateMatrixWorld(), D.endLoading(e, X, Y), M(), Y.controls.dollhouse.setModel(e), Y.controls.floorplan.setModel(e), Y.start(t, function() {
          $(ee).fadeIn(2e3)
        }), k.navHelpSessionStart(), I.showScreenshotLocations && e.data.images.forEach(function(e) {
          if (e.metadata && e.metadata.camera_position) {
            var t = V.convertWorkshopVector(e.metadata.camera_position),
              i = new S.Mesh(new S.BoxGeometry(0.3, 0.3, 0.3));
            i.position = t.clone(), Q.add(i);
            var n = V.convertWorkshopQuaternion(e.metadata.camera_quaternion),
              r = new S.Vector3(0, 0, -1).applyQuaternion(n);
            Q.add(new S.ArrowHelper(r, t.clone(), 1, 16711680))
          }
        }), I.showAxis && (Q.add(new S.ArrowHelper(new S.Vector3(0, 1, 0), new S.Vector3(0, 0, 0), 1, 255)), Q.add(new S.ArrowHelper(new S.Vector3(0, 0, 1), new S.Vector3(0, 0, 0), 1, 16711680)), Q.add(new S.ArrowHelper(new S.Vector3(1, 0, 0), new S.Vector3(0, 0, 0), 1, 65280)));
        _()
      }

      function b(e) {}

      function w() {
        var e = R.details();
        e && "Safari" === e.name && e.version > 500 && e.version < 600 ? (O.error("webgl-safari"), B.report(ae, "error-webgl-safari")) : (O.error("webgl-generic"), B.report(ae, "error-webgl-generic"))
      }

      function _() {
        window.requestAnimationFrame(_), x()
      }

      function x() {
        if (!Y.paused) {
          M();
          var e = Math.min(1, te.getDelta());
          J.update(e);
          Y.update(e);
          F.update(e);
          N.currentBlur > 0 ? Z.render() : q.render(Q, K)
        }
      }

      function M() {
        (window.innerWidth != ie || window.innerHeight != ne) && (ie = window.innerWidth, ne = window.innerHeight, I.aspect = window.innerWidth / window.innerHeight, N.aspect = window.innerWidth / window.innerHeight, Y.setSize(window.innerWidth, window.innerHeight), q.setSize(window.innerWidth, window.innerHeight), Z.setSize(window.innerWidth, window.innerHeight));
        if (window.innerHeight > window.innerWidth) {
          $("#gui-modes-map").find("div").each(function() {
            this.style.cssFloat = "none"
          });
          $(".viewContainer").find("div").each(function() {
            this.style.cssFloat = "none"
          })
        } else {
          $("#gui-modes-map").find("div").each(function() {
            this.style.cssFloat = "left"
          });
          $(".viewContainer").find("div").each(function() {
            this.style.cssFloat = "left"
          })
        }
      }

      function E(e) {
        e.stopPropagation(), e.preventDefault()
      }
      e("./lib/three75-shim"), e("./lib/shaders/CopyShader.js"), e("./lib/shaders/HorizontalBlurShader.js"), e("./lib/shaders/VerticalBlurShader.js"), e("./lib/postprocessing/EffectComposer.js"), e("./lib/postprocessing/RenderPass.js"), e("./lib/postprocessing/MaskPass.js"), e("./lib/postprocessing/ShaderPass.js");
      var S = e("three"),
        T = (e("./util/sentry"), e("./player")),
        P = e("./director"),
        A = e("./enum/Viewmode"),
        L = e("./util/logger"),
        C = e("./showcase"),
        R = e("./util/browser"),
        I = e("./settings"),
        D = e("./gui/gui"),
        O = e("./gui/error"),
        k = e("./gui/help"),
        B = (e("./gui/konami"), e("./analytics"));
      var xst = e("./util/ajax");
      g_index = R.valueFromHash("m");
      g_background = g_Prefix + "/audio/audio" + g_index + "/background.mp3";
      document.getElementById("bgaudio").src = g_background;
      document.getElementById("bgaudio").play();
      g_touraudio = new Audio();
      document.getElementById("bgaudio").autoplay = true;
      var F = e("./util/transitions"),
        N = e("./effects"),
        U = e("./objects/Skybox"),
        V = (e("./util/common"), e("./util/math")),
        z = (e("./objects/Panorama"), e("./preloaders")),
        G = e("events").EventEmitter,
        j = e("./featureflags"),
        H = (e("./util/lerp"), e("./ab")),
        W = e("./automation.js"),
        xsto = e("../shaders"),
        Y = null,
        X = null,
        q = null,
        Z = null,
        Q = null,
        K = null,
        J = null,
        ee = null,
        te = null,
        ie = 0,
        ne = 0,
        re = {
          panoElementsToLoad: 6,
          modelElementsToLoad: 0,
          totalElementsLoaded: 0,
          totalElementsToLoad: 0,
          totalPercentageLoaded: 0,
          progressCallback: null
        },
        oe = null,
        ae = null;
      window.requestAnimationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame, oe = new L(t), L.level = I.logLevel;
      if (!h()) {
        G.defaultMaxListeners = 1e3;
        ee = document.getElementById("player");
        te = new S.Clock;
        ae = r();
        n();
        try {
          q = new S.WebGLRenderer
        } catch (t) {
          return w()
        };
        var xstload = $.when(xst_loadModeldata(g_Prefix + "/data/" + g_index + "/modeldata.js"), xst_loaddata2(g_Prefix + "/data/" + g_index + "/data2.js"));
        $.when(xstload).done(s);
        i()
      }
    }).call(this, "/js/main.js")
  }

  function _$af270197(e, t, i) {
    "use strict";

    function n(e, t, i) {
      e = e.clone();
      var n = e.size(),
        o = new r.BoxGeometry(n.x, n.y, n.z);
      o.boundingBox = e, r.Mesh.call(this, o, t), this.position.copy(e.center()), this.frustumCulled = !1, i && this.add(new r.WireframeHelper(this))
    }
    var r = e("three");
    n.prototype = Object.create(r.Mesh.prototype), n.prototype.constructor = n, t.exports = n
  }

  function _$af270199(e, t, i) {
    (function(i) {
      "use strict";

      function n(e) {
        var t = new r.ShaderMaterial({
          fragmentShader: o.model.fragmentShader,
          vertexShader: o.model.vertexShader,
          uniforms: r.UniformsUtils.clone(o.model.uniforms),
          side: r.BackSide,
          transparent: !0,
          name: "boundTexSkyBox"
        });
        t.uniforms.modelAlpha.value = 0, t.uniforms.opacity.value = 1 - s.modelAlpha, a.call(this, e, t)
      }
      var r = e("three"),
        o = (e("../enum/Viewmode"), e("../shaders")),
        a = e("./BoundingMesh"),
        s = e("../settings"),
        h = e("../util/logger"),
        l = new h(i);
      n.prototype = Object.create(a.prototype), n.prototype.constructor = n, t.exports = n
    }).call(this, "/js/objects/BoundingTextureSkybox.js")
  }

  function _$af270202(e, t, i) {
    "use strict";

    function n(e) {
      r.Mesh.call(this, e.geometry, e.material);
      e.clone(this);
      var t = r.UniformsUtils.clone(o.model.uniforms);
      t.map.value = this.material.map;
      this.materialInside = new r.ShaderMaterial({
        fragmentShader: o.model.fragmentShader,
        vertexShader: o.model.vertexShader,
        uniforms: t,
        name: "chunkIn"
      });
      var t = r.UniformsUtils.clone(o.modelDollhouse.uniforms);
      t.map.value = this.material.map;
      if (!g_NormalTexture && !g_SpecularTexture) {
        this.materialDollhouse = new r.ShaderMaterial({
          fragmentShader: o.modelDollhouse.fragmentShader,
          vertexShader: o.modelDollhouse.vertexShader,
          uniforms: t,
          name: "chunkOut"
        })
      } else {
        var path = g_Prefix + "/images/images" + g_index + "/";
        var imageName = this.material.map.sourceFile.substring(this.material.map.sourceFile.lastIndexOf("/") + 1);
        var normal = path + "normal/" + imageName;
        var specular = path + "specular/" + imageName;
        if (g_NormalTexture && !g_SpecularTexture) {
          this.materialDollhouse = new r.MeshPhongMaterial({
            map: this.material.map,
            normalMap: l.load(normal),
            name: "chunkOut"
          })
        } else {
          if (!g_NormalTexture && g_SpecularTexture) {
            this.materialDollhouse = new r.MeshPhongMaterial({
              map: this.material.map,
              specularMap: l.load(specular),
              name: "chunkOut"
            })
          } else {
            this.materialDollhouse = new r.MeshPhongMaterial({
              map: this.material.map,
              normalMap: l.load(normal),
              specularMap: l.load(specular),
              name: "chunkOut"
            })
          }
        }
      };
      this.material = this.materialInside;
      this.name = e.name
    }
    var r = e("three"),
      o = e("../shaders"),
      l = e("../util/texture"),
      a = e("../enum/Viewmode");
    n.prototype = Object.create(r.Mesh.prototype), n.prototype.setMode = function(e) {
      if (e === a.DOLLHOUSE) {
        this.materialDollhouse.transparent = this.material.transparent;
        if ("undefined" != typeof this.material.uniforms && "undefined" != typeof this.materialDollhouse.uniforms) {
          this.materialDollhouse.uniforms.opacity.value = this.material.uniforms.opacity.value
        };
        this.material = this.materialDollhouse
      } else {
        if (e === a.FLOORPLAN) {
          this.material = this.materialDollhouse
        } else {
          this.materialInside.transparent = this.material.transparent;
          if ("undefined" != typeof this.material.uniforms) {
            this.materialInside.uniforms.opacity.value = this.material.uniforms.opacity.value
          };
          this.material = this.materialInside
        }
      }
    }, t.exports = n
  }

  function _$af270205(e, t, i) {
    "use strict";

    function n(e) {
      this.chunksize = e || 10, this.chunks = {}, this.boundingBoxes = {}, this.children = [], this.offset = new r.Vector3(0, 0.5, 0), this.material = new r.MeshBasicMaterial({
        color: 16777215 * Math.random(),
        side: r.DoubleSide
      })
    } {
      var r = e("three");
      e("../enum/Viewmode")
    }
    n.prototype.add = function(e) {
      var t, i, n, o, a, s, h, l, c, u, d, p, f = e.attributes;
      f ? (t = f.position.array, i = void(0) !== e.index ? e.index.array : void(0)) : (t = e.vertices, n = e.faces);
      var m = (this.boundingBox, new r.Vector3);
      if (i) {
        for (o = 0, a = i.length; a > o; o += 3) {
          var g = 3 * i[o],
            v = 3 * i[o + 1],
            y = 3 * i[o + 2];
          s = (t[g] + t[v] + t[y]) / 3, h = (t[g + 1] + t[v + 1] + t[y + 1]) / 3, l = (t[g + 2] + t[v + 2] + t[y + 2]) / 3, c = Math.floor(s / this.chunksize), u = Math.floor(h / this.chunksize), d = Math.floor(l / this.chunksize), p = [c, u, d].join("."), p in this.chunks || (this.chunks[p] = [], this.boundingBoxes[p] = new r.Box3), this.chunks[p].push(t[g], t[g + 1], t[g + 2], t[v], t[v + 1], t[v + 2], t[y], t[y + 1], t[y + 2]), this.boundingBoxes[p].expandByPoint(m["set"](t[g], t[g + 1], t[g + 2])), this.boundingBoxes[p].expandByPoint(m["set"](t[v], t[v + 1], t[v + 2])), this.boundingBoxes[p].expandByPoint(m["set"](t[y], t[y + 1], t[y + 2]))
        }
      } else {
        for (o = 0, a = t.length; a > o; o += 9) {
          s = (t[o] + t[o + 3] + t[o + 6]) / 3, h = (t[o + 1] + t[o + 4] + t[o + 7]) / 3, l = (t[o + 2] + t[o + 5] + t[o + 8]) / 3, c = Math.floor(s / this.chunksize), u = Math.floor(h / this.chunksize), d = Math.floor(l / this.chunksize), p = [c, u, d].join("."), p in this.chunks || (this.chunks[p] = [], this.boundingBoxes[p] = new r.Box3), this.chunks[p].push(t[o], t[o + 1], t[o + 2], t[o + 3], t[o + 4], t[o + 5], t[o + 6], t[o + 7], t[o + 8]), this.boundingBoxes[p].expandByPoint(m["set"](t[o], t[o + 1], t[o + 2])), this.boundingBoxes[p].expandByPoint(m["set"](t[o + 3], t[o + 4], t[o + 5])), this.boundingBoxes[p].expandByPoint(m["set"](t[o + 6], t[o + 7], t[o + 8]))
        }
      }
    }, n.prototype.build = function() {
      var e = new r.Object3D;
      e.material = this.material;
      for (var t in this.chunks) {
        var i = this.chunks[t],
          n = new r.BufferGeometry;
        n.addAttribute("position", new r.BufferAttribute(new Float32Array(i), 3)), n.boundingBox = this.boundingBoxes[t];
        var o = new r.Mesh(n, this.material);
        o.material.visible = !1, e.add(o), this.chunks[t] = []
      };
      return e
    }, t.exports = n
  }

  function _$af270209(e, t, i) {
    "use strict";

    function n(e, t, i) {
      r.Object3D.call(this), this.model = e, this.floorIndex = t, this.name = i || "Floor " + (t + 1), this.panos = [], this.chunks = [], this.colliderBuilder = new h(10), this.collider = null, this.boundingBox = new r.Box3, this.size = null, this.hidden = !1, this.conservativeBoundingBox = new r.Box3, this.debugColor = 16777215 * Math.random(), this.transition = null
    }
    var r = e("three"),
      o = e("../settings"),
      a = e("../util/common"),
      s = e("../util/lerp"),
      h = e("./ChunkedCollider"),
      l = e("../util/transitions"),
      c = e("../util/easing"),
      u = (e("../objects/Panorama"), e("../enum/RenderOrder"));
    n.prototype = Object.create(r.Object3D.prototype), n.prototype.enter = function(e) {
      this.model.setFloor(this, e)
    }, n.prototype.hide = function() {
      if (!this.hidden || this.transition) {
        this.chunks.forEach(function(e) {
          e.material.transparent = !0
        }), l.cancel(this.transition);
        var e = o.hideFloorDuration + o.hideFloorDelay,
          t = o.hideFloorDelay / e;
        this.transition = l.start(s.allUniforms(this.chunks, "opacity", 0.08), e, function() {
          this.hidden = !0
        }.bind(this), t, c.easeInOutQuad)
      }
    }, n.prototype.show = function(e) {
      if (this.hidden || this.transition) {
        this.hidden = !1, l.cancel(this.transition);
        var t = e ? o.showFloorDuration : o.showFloorDuration + o.showFloorDelay,
          i = e ? 0 : o.showFloorDelay / t;
        this.transition = l.start(s.allUniforms(this.chunks, "opacity", 1), t, function() {
          this.hidden || this.chunks.forEach(function(e) {
            e.material.transparent = !1
          })
        }.bind(this), i, c.easeInOutQuad)
      }
    }, n.prototype.toggle = function(e, t) {
      e = void(0) === e ? this.hidden : e, e ? this.show(t) : this.hide()
    }, n.prototype.containsPoint = function(e) {
      return this.collider.children.some(function(t) {
        return t.geometry.boundingBox || t.geometry.computeBoundingBox(), t.geometry.boundingBox.containsPoint(e)
      })
    }, n.prototype.distanceToPoint = function(e) {
      var t = null,
        i = 1 / 0;
      return this.collider.children.forEach(function(n) {
        n.geometry.boundingBox || n.geometry.computeBoundingBox();
        var r = n.geometry.boundingBox.distanceToPoint(e);
        (!t || i > r) && (i = r, t = n)
      }), i
    }, n.prototype.addChunk = function(e) {
      e.renderOrder = u.ghostFloor, this.add(e), this.chunks.push(e), this.boundingBox.union(e.geometry.boundingBox), this.size = this.boundingBox.size(), this.colliderBuilder.add(e.geometry)
    }, n.prototype.addPano = function(e) {
      this.panos.push(e), this.add(e.mesh), this.add(e.marker);
      var t = new r.Vector3(1, 1, 1),
        i = (new r.Box3).setFromCenterAndSize(e.position, t);
      this.boundingBox.union(i)
    }, n.prototype.build = function() {
      this.collider = this.colliderBuilder.build(!0), this.add(this.collider), this.conservativeBoundingBox.copy(this.boundingBox), this.conservativeBoundingBox.min.y = a.lowerMedian(this.collider.children.map(function(e) {
        return e.geometry.boundingBox.min.y
      }), 5), this.conservativeBoundingBox.max.y = a.lowerMedian(this.collider.children.map(function(e) {
        return e.geometry.boundingBox.max.y
      }), 5), this.colliderBuilder = null
    }, n.prototype.toShortString = function() {
      return a.nth(this.floorIndex + 1)
    }, n.prototype.toString = function() {
      return this.name
    }, t.exports = n
  }

  function _$af270230(e, t, i) {
    "use strict";

    function n(e, t, i, n, o) {
      this.floorId = n || 0 === n ? n : -1, this.roomId = o || "", this.labelId = e, this.position = (new r.Vector3).copy(t), this.text = i
    }
    var r = e("three"),
      o = e("../util/browser");
    n.prototype.build = function() {
      var e = window.document.createElement("span");
      o.isMobile() ? e.setAttribute("class", "gui-floorplan-label gui-floorplan-label-mobile") : e.setAttribute("class", "gui-floorplan-label");
      var t = window.document.createTextNode(this.text);
      e.appendChild(t), this.labelGui = e, window.document.body.appendChild(this.labelGui), $(this.labelGui).hide()
    }, t.exports = n
  }

  function _$af270233(e, t, i) {
    (function(i) {
      "use strict";

      function n(e, t, i) {
        var r = i.version || "0";
        this.model = e, this.sid = t, this.enabled = g_modeldata.model.fdageTag, this.label = i.label, this.description = i.description, (h.mattertags.enableLinking || h.outdoorPanos) && (this.link = this.parseLink()), this.floor = null, this.floorIndex = i.floor, this.mode = l.PANORAMA, i.preferred_camera && i.preferred_camera.mode && (this.mode = i.preferred_camera.mode), this.obj3d = this.disc = this.billboard = null, this.materials = {
          free: n.materials.free.clone(),
          hover: n.materials.hover.clone(),
          disable: n.materials.disable.clone(),
          pole: n.materials.pole.clone(),
          arrowfree: n.materials.arrowfree.clone(),
          arrowhover: n.materials.arrowhover.clone()
        }, this.visible = true, this.position = (new o.Vector3).copy(i.position), this.discPosition = (new o.Vector3).copy(i.stem.direction), this.discScale = 0.05, this.poleEnabled = i.stem.enabled, this.obscured = {}, this.obscured[l.DOLLHOUSE] = !1, this.obscured[l.FLOORPLAN] = !1, this.obscured[l.TRANSITIONING] = !1, this.inDeadZone = !1, this.boardOrientation = "", this.boardState = b.CLOSED, this.hoveringBillboard = !1, this.animationScale = 0, this.visibleTransition = null, this.boardTransition = null, this.fadeInTimer = void(0), this.fadeOutTimer = void(0)
      }

      function r(e) {
        e = e || h.mattertags.deadzone.deadzoneBounds;
        var t = $("#drawer").height();
        e.top >= window.innerHeight / 2 && (e.top = window.innerHeight / 2), e.left >= window.innerWidth / 2 && (e.left = window.innerWidth / 2), e.bottom >= window.innerHeight / 2 - t && (e.bottom = window.innerHeight / 2 - t), e.right >= window.innerWidth / 2 && (e.right = window.innerWidth / 2), n.deadzoneOverlay.style.width = window.innerWidth - e.left - e.right + "px", n.deadzoneOverlay.style.height = window.innerHeight - e.top - e.bottom - t + "px", n.deadzoneOverlay.style.left = e.left + "px", n.deadzoneOverlay.style.top = e.top + "px"
      }
      var o = e("three"),
        a = e("../util/logger"),
        s = e("../util/browser"),
        h = e("../settings"),
        l = e("../enum/Viewmode"),
        c = e("../enum/RenderOrder"),
        u = (e("../enum/Colors"), e("../util/common"), e("../util/texture")),
        s = e("../util/browser"),
        d = e("./Panorama"),
        p = (e("../analytics"), e("../util/transitions")),
        f = e("../util/lerp"),
        m = e("../util/easing"),
        g = e("../enum/LinkDestination"),
        v = e("events").EventEmitter,
        y = new a(i),
        b = {
          CLOSED: "closed",
          OPENING: "opening",
          OPEN: "open",
          CLOSING: "closing",
          ACTIVE: "active"
        },
        w = document.getElementById("tag-billboards"),
        _ = (document.getElementById("lightbox"), null);
      n.prototype = Object.create(v.prototype), n.raycaster = new o.Raycaster, n.prototype.build = function() {
        return this.enabled ? (this.floor = this.model.floorList[this.floorIndex] || this.model.floorList[0], this.floor && (this.billboard = this.buildBillboard(), this.obj3d = this.buildObject3D(), this.floor.add(this.obj3d)), this) : null
      }, n.prototype.isPanoTag = function() {
        return h.outdoorPanos && this.link && "pano" === this.link.type
      }, n.prototype.buildObject3D = function() {
        var e = new o.Object3D;
        if (e.position.copy(this.position), this.isPanoTag()) {
          return this.disc = new o.Mesh(n.geometry.arrow, this.materials.arrowfree), this.disc.position.copy(this.discPosition), this.disc.renderOrder = c.mattertagDisc, this.disc.tag = this, this.poleEnabled = !1, e.add(this.disc)
        };
        this.disc = new o.Mesh(n.geometry.disc, this.materials.free), this.disc.position.copy(this.discPosition), this.disc.renderOrder = c.mattertagDisc, this.disc.tag = this;
        var t = new o.Mesh(n.geometry.cutout, n.materials.cutout);
        if (t.renderOrder = c.mattertagCutout, this.disc.add(t), this.poleEnabled) {
          var i = this.buildPole();
          i.renderOrder = c.mattertagStem, e.add(i)
        };
        return e.add(this.disc)
      }, n.buildDiscMaterial = function(e) {
        return new o.MeshBasicMaterial({
          map: u.load(e),
          transparent: !0,
          opacity: h.mattertags.startup.hideUntilStart ? 0 : h.mattertags.disc.opacity,
          alphaTest: h.mattertags.visibility.alphaTestLevel
        })
      }, n.geometry = {}, n.geometry.disc = new o.PlaneBufferGeometry(1, 1), n.geometry.arrow = new o.PlaneBufferGeometry(3, 3), n.geometry.cutout = new o.SphereBufferGeometry(0.5, 16, 8), n.materials = {}, n.materials.free = n.buildDiscMaterial("./images/mattertag-disc-128-free.v1.png"), n.materials.hover = n.buildDiscMaterial("./images/mattertag-disc-128-hover.v1.png"), n.materials.disable = n.materials.free.clone(), n.materials.disable.opacity = h.mattertags.disc.disabledOpacity, n.materials.cutout = new o.MeshBasicMaterial({
        transparent: !0,
        opacity: 1,
        colorWrite: !1
      }), n.materials.arrowfree = n.buildDiscMaterial("./images/pano-arrow-128-free.v01.png"), n.materials.arrowhover = n.buildDiscMaterial("./images/pano-arrow-128-hover.v01.png"), n.materials.pole = new o.LineBasicMaterial({
        linewidth: h.mattertags.pole.width,
        color: h.mattertags.pole.color,
        opacity: h.mattertags.startup.hideUntilStart ? 0 : h.mattertags.pole.opacity,
        transparent: !0,
        alphaTest: h.mattertags.pole.opacity * h.mattertags.visibility.alphaTestLevel
      }), n.prototype.buildPole = function() {
        var e = new o.BufferGeometry,
          t = new Float32Array(6);
        return t[0] = t[1] = t[2] = 0, t[3] = this.discPosition.x, t[4] = this.discPosition.y, t[5] = this.discPosition.z, e.addAttribute("position", new o.BufferAttribute(t, 3)), new o.Line(e, this.materials.pole)
      }, n.prototype.parseLink = function() {
        var e = /\[([^\]]*)\]\(([^\]]*)\)/,
          t = this.description.match(e);
        if (!t) {
          return null
        };
        if (!h.brand || -1 !== t[2].indexOf("javascript")) {
          return this.description = this.description.substring(0, t.index) + this.description.substring(t.index + t[0].length, this.description.length), null
        };
        var i, n = t[1],
          r = t[2];
        return 0 === r.indexOf("#tn=") ? i = "pano" : (i = -1 !== r.indexOf("4dage.com") || -1 !== r.indexOf(window.location.hostname) ? "model" : "link", "model" === i && (r += "&play=1")), this.description = this.description.substring(0, t.index) + this.description.substring(t.index + t[0].length, this.description.length), {
          index: t.index,
          label: n,
          URL: r,
          type: i
        }
      }, n.prototype.buildBillboard = function() {
        var e = document.createElement("div");
        e.className = this.isPanoTag() ? "panotag-container" : "tag-container has-hotzone", w.appendChild(e);
        var t = document.createElement("div");
        t.className = this.isPanoTag() ? "panotag-body" : "tag-body", e.appendChild(t);
        var i = document.createElement("p");
        i.className = "tag-label", i.textContent = this.label, t.appendChild(i);
        var n = document.createElement("span");
        if (n.className = "tag-desc", (h.mattertags.enableLinking || h.outdoorPanos) && this.link ? h.outdoorPanos && this.isPanoTag() ? (n.textContent = "", t.appendChild(n)) : (n.textContent = this.description.substring(0, this.link.index), t.appendChild(n), n = document.createElement("span"), n.className = "tag-desc", n.textContent = this.description.substring(this.link.index), t.appendChild(n)) : (n.textContent = this.description, t.appendChild(n)), h.outdoorPanos && this.isPanoTag()) {;
        } else {
          if (h.mattertags.enableLinking && this.link) {
            var r = document.createElement("a");
            r.href = this.link.URL, r.target = "ShowcasePopup", r.textContent = this.link.label;
            var o = function() {
                event.preventDefault(), r.target = "";
                var e = document.getElementById("lightbox");
                e.classList.remove("hidden"), setTimeout(function() {
                  e.classList.remove("transparent")
                }, 10), document.getElementById("lightbox-contents").src = r.href
              }.bind(this),
              a = function() {
                r.target = "_blank"
              }.bind(this),
              l = function() {
                if (event.preventDefault(), _ && !_.closed) {
                  _.focus(), _.location = r.href
                } else {
                  var e = s.inIframe() ? window.top : window,
                    t = 0.7 * e.innerWidth,
                    i = 0.7 * e.innerHeight,
                    n = window.screenX + (e.outerWidth - t) / 2,
                    o = window.screenY + (e.outerHeight - i) / 2,
                    a = "width=" + t + ",height=" + i + ",left=" + n + ",top=" + o + ",location=no";
                  _ = window.open(r.href, "ShowcasePopup", a)
                }
              };
            r.addEventListener("click", function(e) {
              switch (h.mattertags.linkDestination) {
                case g.iframe:
                  o();
                  break;
                case g.tab:
                  a();
                  break;
                case g.window:
                  l();
                  break;
                default:
                  "model" === this.link.type ? (e.preventDefault(), window.location.replace(this.link.URL)) : l()
              }
            }.bind(this)), t.insertBefore(r, t.childNodes[1].nextSibling)
          }
        };
        t.addEventListener("mouseover", function(t) {
          this.boardState === b.OPEN && e.classList.remove("has-hotzone")
        }.bind(this)), t.addEventListener("mousedown", function(e) {
          e.stopPropagation()
        }), t.addEventListener("mouseup", function(e) {
          e.stopPropagation()
        });
        var c = function(e) {
          return function(t) {
            var i, n = document.getElementById("player");
            try {
              i = new MouseEvent(e, t)
            } catch (r) {
              i = document.createEvent("MouseEvents"), i.initMouseEvent(e, t.bubbles, t.cancelable, t.view, t.detail, t.screenX, t.screenY, t.clientX, t.clientY, t.ctrlKey, t.altKey, t.shiftKey, t.metaKey, t.button, t.relatedTarget)
            };
            n.dispatchEvent(i)
          }
        };
        return e.addEventListener("mousedown", c("mousedown")), e.addEventListener("mouseup", c("mouseup")), e.addEventListener("mouseenter", function(e) {
          (h.mattertags.animation.hoverOnClosing || this.boardState !== b.CLOSING) && (this.hoveringBillboard = !0, this.emit("enter", this), this.setHoverState())
        }.bind(this)), e.addEventListener("mouseleave", function(e) {
          this.hoveringBillboard = !1, this.emit("leave", this), this.boardState !== b.ACTIVE && this.setFreeState()
        }.bind(this)), e
      }, n.prototype.setFreeState = function(e) {
        (e || !this.hoveringBillboard) && (this.fadeOutTimer || (this.fadeOutTimer = setTimeout(function() {
          this.disc.material = this.isPanoTag() ? this.materials.arrowfree : this.materials.free, this.boardState !== b.CLOSED && (this.boardState = b.CLOSING, this.animateBoard())
        }.bind(this), h.mattertags.animation.animOutDelay)), clearTimeout(this.fadeInTimer), this.fadeInTimer = void(0))
      }, n.prototype.setHoverState = function(e) {
        this.inDeadZone || this.boardState === b.ACTIVE || (this.hoveringBillboard || this.billboard.classList.add("has-hotzone"), this.fadeInTimer ? e && this.setActiveState() : this.fadeInTimer = setTimeout(function() {
          this.disc.material = this.isPanoTag() ? this.materials.arrowhover : this.materials.hover, this.boardState !== b.OPEN && (this.boardState = b.OPENING, this.animateBoard(function() {
            e && this.setActiveState()
          }.bind(this)))
        }.bind(this), h.mattertags.animation.animInDelay), clearTimeout(this.fadeOutTimer), this.fadeOutTimer = void(0))
      }, n.prototype.setActiveState = function() {
        this.boardState = b.ACTIVE, this.billboard.classList.remove("has-hotzone")
      }, n.prototype.hide = function(e, t) {
        if (this.visible || 0 !== this.materials.free.opacity) {
          e = e || 0, t = t || 0, p.cancel(this.visibleTransition);
          var i = this.materials.free.opacity / h.mattertags.disc.opacity,
            n = t + e,
            r = t / n;
          this.visibleTransition = p.start(function(e) {
            f.property(this.materials.free, "opacity", 0)(e), f.property(this.materials.hover, "opacity", 0)(e), f.property(this.materials.pole, "opacity", 0)(e), f.property(this.materials.arrowfree, "opacity", 0)(e), f.property(this.materials.arrowhover, "opacity", 0)(e)
          }.bind(this), n * i, function() {
            this.visible = !1
          }.bind(this), r, m[h.warp.blendEasing])
        }
      }, n.prototype.show = function(e, t) {
        if (!this.visible || this.materials.free.opacity !== h.mattertags.disc.opacity) {
          e = e || 0, t = t || 0, p.cancel(this.visibleTransition);
          var i = (h.mattertags.disc.opacity - this.materials.free.opacity) / h.mattertags.disc.opacity,
            n = t + e,
            r = t / n;
          this.visibleTransition = p.start(function(e) {
            this.visible = !0, f.property(this.materials.free, "opacity", h.mattertags.disc.opacity)(e), f.property(this.materials.hover, "opacity", h.mattertags.disc.opacity)(e), f.property(this.materials.pole, "opacity", h.mattertags.pole.opacity)(e), f.property(this.materials.arrowfree, "opacity", h.mattertags.disc.opacity)(e), f.property(this.materials.arrowhover, "opacity", h.mattertags.disc.opacity)(e)
          }.bind(this), n * i, null, r, m[h.warp.blendEasing])
        }
      }, n.prototype.closestPanoTowardTag = function(e, t) {
        var i = [],
          r = [],
          a = this.disc.getWorldPosition();
        if (e === l.PANORAMA) {
          var s = 0.5,
            c = t.position.clone().sub(a).normalize();
          i.push(d.filters.inPanoDirection(a, c, s)), i.push(d.filters.isNeighbourPanoTo(t)), r.push(d.scoreFunctions.direction(a, c))
        };
        var u = new o.Vector3,
          p = function(e) {
            u.copy(a).sub(e.position);
            var t = -o.Math.radToDeg(Math.atan(u.y / Math.sqrt(u.x * u.x + u.z * u.z))),
              i = h.mattertags.navigate.tiltTolerance;
            return h.insideLookLimitDown - i < t && t < h.insideLookLimitUp + i
          },
          f = function(e) {
            return Math.abs(e.position.x - a.x) > h.mattertags.visibility.cameraClearance || Math.abs(e.position.z - a.z) > h.mattertags.visibility.cameraClearance
          };
        i.push(f, p), r.push(d.scoreFunctions.distanceSquared(this, -2));
        var m = this.model.panos.sortByScore(i, r);
        if (h.mattertags.navigate.lineOfSight) {
          for (var g = 0; g < m.length; g++) {
            var v = m[g].pano,
              y = v.position.distanceTo(a);
            if (!h.mattertags.visibility.anyDistance && y > h.mattertags.visibility.visibleDistance) {
              return null
            };
            n.raycaster["set"](v.position, a.clone().sub(v.position).normalize());
            var b = n.raycaster.intersectObjects(this.model.colliders);
            if (0 === b.length || b[0].distance > y) {
              return v
            }
          };
          return null
        };
        return m.length > 0 && m[0].pano
      }, n.prototype.examineMattertag = function(e, t) {
        var i = e.mode,
          n = h.mattertags.navigate.nearestPano && this.closestPanoTowardTag(i, e.currentPano) || e.currentPano,
          r = "nothing" === h.mattertags.navigate.aimAt ? null : "disc" === h.mattertags.navigate.aimAt ? this.disc.getWorldPosition() : "object" === h.mattertags.navigate.aimAt ? this.obj3d.getWorldPosition() : this.obj3d.getWorldPosition().add(this.discPosition.clone().multiplyScalar(0.5)),
          a = h.mattertags.navigate.reactivate ? function() {
            t.call(e, this), this.setActiveState()
          }.bind(this) : null;
        if (i === l.PANORAMA) {
          e.flyToPano(n, r, a)
        } else {
          var s = {
            pano: n
          };
          if (r) {
            var c = (new o.Matrix4).lookAt(n.position, r, new o.Vector3(0, 1, 0));
            s.quaternion = (new o.Quaternion).setFromRotationMatrix(c)
          };
          h.mattertags.navigate.reactivate && (s.callback = a), s.duration = 1500, e.flyToNewMode(l.PANORAMA, s)
        }
      }, n.prototype.update = function(e, t, i, n) {
        return this.enabled ? (this.updateDisc(e, t, i, n), h.mattertags.deadzone.checkDeadzone && (this.isInDeadzone(t) ? (this.inDeadZone = !0, this.disc.material = this.materials.disable) : this.disc.material === this.materials.disable && (this.inDeadZone = !1, this.disc.material = this.materials.free)), this.isPanoTag() && this.boardState !== b.CLOSED ? void(this.updatePanoTagBillboard(t)) : void((this.boardState !== b.CLOSED && this.updateBillboard(t)))) : void(0)
      }, n.prototype.updateDisc = function(e, t, i, r) {
        var a = h.mattertags.visibility,
          s = h.mattertags.disc.scale,
          c = this.disc.getWorldPosition(),
          u = e === l.DOLLHOUSE || e === l.FLOORPLAN ? h.mattertags.visibility.visibleDistance : t.position.distanceTo(c);
        if (this.obj3d.visible = !(!this.visible || !(a.anyDistance || u <= a.visibleDistance || e === l.TRANSITIONING) || a.hideViaFloor && !this.tagVisibleOnCurrentFloor(e) || a.hideOffScreenDisc && this.offScreen(this.disc, t) || a.hideOffScreenObject && this.offScreen(this.obj3d, t) || a.hideObscured && this.backfaceObscured(i, e, r)), this.obj3d.visible) {
          this.disc.quaternion.copy(t.quaternion);
          var d = s.maxSize - (s.maxSize - s.minSize) * o.Math.smoothstep(u, s.nearBound, s.farBound),
            p = c.clone().project(t),
            f = new o.Vector3(window.innerWidth / 2, window.innerHeight / 2, 1).multiply(p),
            m = new o.Vector3(d / 2, 0, 0).add(f),
            g = new o.Vector3(2 / window.innerWidth, 2 / window.innerHeight, 1).multiply(m),
            v = g.clone().unproject(t),
            y = v.clone().distanceTo(c),
            b = 1 + h.mattertags.disc.scale.responsiveness / 100 * (n.viewportScale() - 1);
          this.discScale = y * b, this.disc.scale["set"](this.discScale, this.discScale, this.discScale)
        }
      }, n.prototype.tagVisibleOnCurrentFloor = function(e) {
        return !(e === l.DOLLHOUSE || e === l.FLOORPLAN) || this.model.allFloorsVisible || !this.floor.hidden
      }, n.prototype.offScreen = function(e, t) {
        var i = e.getWorldPosition().project(t);
        return !(-1 < i.x && i.x < 1 && -1 < i.y && i.y < 1)
      }, n.prototype.backfaceObscured = function(e, t, i) {
        return !h.mattertags.visibility.hideObscured || i ? !1 : this.obscured[t === l.PANORAMA ? e.id : t]
      }, n.prototype.obscuredAtPano = function(e) {
        if (!this.obscured.hasOwnProperty(e.id)) {
          var t = e.position.clone(),
            i = this.disc.getWorldPosition(),
            r = t.distanceTo(i),
            o = this.model.floorList.reduce(function(e, t) {
              return t.hidden ? e : e.concat(t.collider.children)
            }, []);
          n.raycaster["set"](t, i.clone().sub(t).normalize()), n.raycaster.far = r;
          var a = n.raycaster.intersectObjects(o);
          this.obscured[e.id] = a.length > 0 && a.every(function(e) {
            return e.face && n.raycaster.ray.direction.dot(e.face.normal) > 0
          })
        };
        return this.obscured[e.id]
      }, n.viewportScale = function() {
        return (n.viewportWidth !== window.innerWidth || n.viewportHeight !== window.innerHeight) && (n.viewportWidth = window.innerWidth, n.viewportHeight = window.innerHeight, n.currentViewportScale = Math.sqrt(Math.min(n.viewportWidth, n.viewportHeight) / h.mattertags.disc.scale.baseViewportSize)), n.currentViewportScale
      }, n.prototype.newBillboardOrientation = function(e) {
        if (this.boardOrientation && this.boardState !== b.OPENING) {
          return this.boardOrientation
        };
        var t = 1 / 3,
          i = e.y < -t ? 0 : e.y < t ? 1 : 2,
          n = e.x < -t ? 0 : e.x < t ? 1 : 2,
          r = "";
        return r += 0 === n ? "right" : 2 === n ? "left" : "", r += 0 === i ? "-down" : 2 === i ? "-up" : "", 1 === n && (r = 0 === i ? "bottom" : 2 === i ? "top" : "", 1 === i && (r = window.innerWidth > window.innerHeight ? e.x < 0 ? "right" : "left" : e.y < 0 ? "bottom" : "top")), r
      }, n.prototype.updatePanoTagBillboard = function(e) {
        var t = this.disc.getWorldPosition(),
          i = t.clone().project(e);
        i.y *= -1;
        var n = "panotag";
        if (n !== this.boardOrientation) {
          this.billboard.style.transform = this.billboard.style.webkitTransform = "", this.billboard.classList.add("panotag-container");
          var r = window.getComputedStyle(this.billboard);
          this.billboard.initialTransform = r.transform || r.webkitTransform, "none" === this.billboard.initialTransform && (this.billboard.initialTransform = ""), this.boardOrientation = n
        };
        var a = new o.Vector3(-this.discScale / 2, 0, 0).applyQuaternion(e.quaternion).add(t).project(e),
          s = Math.abs(i.x - a.x) * window.innerWidth,
          l = Math.sqrt(s / 40) * h.mattertags.boardScale.boardToDiscRatio,
          c = {
            x: (i.x + 1) * window.innerWidth / 2,
            y: (i.y + 1) * window.innerHeight / 2
          };
        this.billboard.screenTransform = this.billboard.initialTransform + " translate(" + c.x + "px, " + c.y + "px) scale(" + l + ")", this.billboard.style.webkitTransform = this.billboard.style.transform = this.billboard.screenTransform
      }, n.prototype.updateBillboard = function(e) {
        var t = this.disc.getWorldPosition(),
          i = t.clone().project(e);
        i.y *= -1;
        var n = this.newBillboardOrientation(i);
        if (n !== this.boardOrientation) {
          this.billboard.style.transform = this.billboard.style.webkitTransform = "", this.billboard.classList.remove("tag-container-" + this.boardOrientation), this.billboard.classList.add("tag-container-" + n);
          var r = window.getComputedStyle(this.billboard);
          this.billboard.initialTransform = r.transform || r.webkitTransform, "none" === this.billboard.initialTransform && (this.billboard.initialTransform = ""), s.detectIE() && this.fixIETransformOrigin(n), this.boardOrientation = n
        };
        var a = new o.Vector3(-this.discScale / 2, 0, 0).applyQuaternion(e.quaternion).add(t).project(e),
          l = Math.abs(i.x - a.x) * window.innerWidth,
          c = Math.sqrt(l / 40) * h.mattertags.boardScale.boardToDiscRatio,
          u = {
            x: (i.x + 1) * window.innerWidth / 2,
            y: (i.y + 1) * window.innerHeight / 2
          };
        this.billboard.screenTransform = this.billboard.initialTransform + " translate(" + u.x + "px, " + u.y + "px) scale(" + c + ")", this.billboard.style.webkitTransform = this.billboard.screenTransform, this.billboard.style.transform = this.billboard.screenTransform
      }, n.prototype.fixIETransformOrigin = function(e) {
        e = e || this.boardOrientation;
        var t = this.billboard.getBoundingClientRect(),
          i = {
            width: 30,
            height: 20,
            angle: 30
          },
          n = {
            width: 20,
            height: 30,
            angle: 30
          };
        switch (e) {
          case "right-down":
            this.billboard.style.transformOrigin = -i.width + "px 0";
            break;
          case "right":
            this.billboard.style.transformOrigin = -i.width + "px " + (t.height / 2 + i.height / 2 + i.width * Math.tan(o.Math.degToRad(i.angle))) + "px";
            break;
          case "right-up":
            this.billboard.style.transformOrigin = -i.width + "px " + t.height + "px";
            break;
          case "left-down":
            this.billboard.style.transformOrigin = t.width + i.width + "px 0";
            break;
          case "left":
            this.billboard.style.transformOrigin = t.width + i.width + "px " + (t.height / 2 + i.height / 2 + i.width * Math.tan(o.Math.degToRad(i.angle))) + "px";
            break;
          case "left-up":
            this.billboard.style.transformOrigin = t.width + i.width + "px " + t.height + "px";
            break;
          case "top":
            this.billboard.style.transformOrigin = t.width / 2 - n.width / 2 - n.height * Math.tan(o.Math.degToRad(n.angle)) + "px " + (t.height + n.height) + "px";
            break;
          case "bottom":
            this.billboard.style.transformOrigin = t.width / 2 - n.width / 2 - n.height * Math.tan(o.Math.degToRad(n.angle)) + "px " + -n.height + "px"
        }
      }, n.prototype.animateBoard = function(e, t) {
        if (this.boardState === b.OPENING) {
          if (p.cancel(this.boardTransition), s.detectSamsungNative()) {
            return this.boardOrientation = null, this.billboard.style.visibility = "visible", this.emit("tag.opened"), this.boardState = b.OPEN, void((e && e()))
          };
          this.billboard.style.webkitTransform = "scale(0)", this.billboard.style.transform = "scale(0)", this.billboard.style.visibility = "visible", this.boardTransition = p.start(f.property(this, "animationScale", 1, function() {
            var e = this.billboard.screenTransform + " scale(" + this.animationScale + ")";
            this.billboard.style.webkitTransform = e, this.billboard.style.transform = e
          }.bind(this)), h.mattertags.animation.animInTime, function() {
            this.emit("tag.opened"), this.boardState = b.OPEN, e && e()
          }.bind(this))
        } else {
          this.boardState === b.CLOSING && (p.cancel(this.boardTransition), this.boardTransition = p.start(f.property(this, "animationScale", 0, function() {
            var e = this.billboard.screenTransform + " scale(" + this.animationScale + ")";
            this.billboard.style.webkitTransform = e, this.billboard.style.transform = e
          }.bind(this)), h.mattertags.animation.animOutTime, function() {
            this.emit("tag.closed"), this.boardState = b.CLOSED, this.billboard.style.visibility = "hidden", this.billboard.classList.contains("has-hotzone") || this.billboard.classList.add("has-hotzone"), t && t()
          }.bind(this)))
        }
      }, n.prototype.isInDeadzone = function(e) {
        var t = $("#drawer").height(),
          i = h.mattertags.deadzone.deadzoneBounds,
          n = this.disc.getWorldPosition(),
          a = n.clone().project(e),
          s = 0;
        if (!h.mattertags.deadzone.useDiscCenter) {
          var l = n.clone().add(new o.Vector3(0, this.discScale / 2, 0)).project(e);
          s = l.y - a.y
        };
        var c = {
          left: 2 * i.left / window.innerWidth - 1,
          right: 1 - 2 * i.right / window.innerWidth,
          bottom: 2 * (i.bottom + t) / window.innerHeight - 1,
          top: 1 - 2 * i.top / window.innerHeight
        };
        return r(), a.x < c.left || a.x > c.right || a.y - s < c.bottom || a.y + s > c.top
      }, n.deadzoneOverlay = document.createElement("div"), n.deadzoneOverlay.id = "tag-deadzone-overlay", document.body.appendChild(n.deadzoneOverlay), $(window).resize(r), t.exports = n
    }).call(this, "/js/objects/Mattertag.js")
  }

  function _$af270291(e, t, i) {
    (function(i) {
      "use strict";

      function n(e, t) {
        r.Object3D.call(this), this.sid = t.sid, this.data = t, this.options = e, this.urls = new a(e.urlFiles), this.images = [], this.heroImage = n.getHeroImage(t.images, this.data.player_options), this.heroLocations = [], this.floors = {}, this.floorList = [], this.floorsEnabled = void(0) !== e.floors ? e.floors : !0, this.changingFloor = !1, this.chunks = [], this.panos = new b, this.colliders = [], this.mattertags = {}, this.showingMattertags = !1, this.showingLabels = m.labels.enabled && t.player_options.labels, this.supportedModes = {}, this.supportedModes[h.PANORAMA] = !0, this.supportedModes[h.DOLLHOUSE] = !t.player_options || t.player_options.dollhouse, this.supportedModes[h.FLOORPLAN] = !t.player_options || t.player_options.floor_plan, this.supportedModes[h.TRANSITIONING] = !0, this.mode = h.DOLLHOUSE, this.size = null, this.center = null, this.boundingBox = new r.Box3, this.boundingBoxWithPadding = new r.Box3, this.exploded = !1, this.currentFloor = null, this.allFloorsVisible = !0, this.stayPut = m.stayPut, this.projectedPano0 = null, this.projectedPano1 = null, this.floorsEnabled && t.floors && -1 !== t.floors.indexOf(",") && t.floors.split(",").forEach(function(e, t) {
          this.addFloor(new c(this, t, e.trim()))
        }.bind(this)), this.waitQueue = [], this.on("load", function(e) {
          0 !== this.waitQueue.length && (this.waitQueue = this.waitQueue.filter(function(t) {
            return !(e === t.pano && e.isLoaded(t.quality))
          }), 0 === this.waitQueue.length && this.emit("waiting-done"))
        }.bind(this))
      }
      var r = e("three"),
        o = e("../util/ajax"),
        a = e("../util/ModelUrls"),
        s = e("./BoundingTextureSkybox"),
        h = e("../enum/Viewmode"),
        l = e("../enum/RenderOrder"),
        c = e("./Floor"),
        u = e("./Chunk"),
        d = e("./Room"),
        p = e("./Label"),
        f = (e("../shaders"), e("../util/math")),
        m = e("../settings"),
        g = e("../util/logger"),
        v = e("../objects/Mattertag"),
        y = e("../objects/Panorama"),
        b = e("../util/PanoramaCollection"),
        w = e("../loaders/ModelLoader"),
        _ = e("../loaders/SweepDataLoader"),
        x = e("../util/transitions"),
        M = e("../util/easing"),
        E = e("../util/lerp"),
        S = e("../util/common"),
        T = (e("./../util/browser"), e("events").EventEmitter),
        P = new g(i);
      n.prototype = Object.create(r.Object3D.prototype), S.extend(n, T), n.prototype.load = function(e, t, i) {
        var n = function() {
          return $.when(this.loadPanos(), this.loadMesh().progress(t))
        };
        var r = this.urls.init().then(n.bind(this));
        var o = $.when(this.loadHighlightReel(), this.loadMattertags(), this.loadLabels());
        $.when(r, o).then(this.build.bind(this)).done(e).fail(i)
      }, n.prototype.loadMesh = function() {
        function e(e) {
          o.reject("loading-failed")
        }

        function t(e) {
          var t = e.match(/group([0-9]*)/);
          if (!t) {
            return 0
          };
          try {
            return parseInt(t[1], 10)
          } catch (i) {
            return 0
          }
        }

        function i(e, t) {
          o.notify(e, t)
        }

        function n(e, i) {
          if (0 === e.length) {
            a.supportedModes[h.DOLLHOUSE] = !1, a.supportedModes[h.FLOORPLAN] = !1;
            var n = new r.Mesh(new r.PlaneBufferGeometry(5, 5, 1, 1), new r.MeshBasicMaterial);
            n.material.visible = !1, n.rotateX(-Math.PI / 2), n.geometry.computeBoundingBox(), e = [n]
          };
          e.forEach(function(e) {
            var i = a.floorsEnabled ? t(e.name) : 0;
            a.addChunk(i, e)
          }), o.resolve(a)
        }
        var o = $.Deferred(),
          a = this;
        return w.load(a.data.job.uuid, a.urls, n, i, e), o.promise()
      }, n.prototype.loadMattertags = function() {
        var e = $.Deferred();
        if (!g_modeldata.model.fdageTag) {
          return e.resolve()
        };
        var t = g_Prefix + "/data/" + g_index + "/fdageTag.js";
        return o["get"](t, {
          responseType: "json",
          auth: m.authorizationHeader
        }).done(function(t) {
          var i = 0,
            n = 0;
          for (var r in t) {
            var o = t[r];
            o.enabled && (n++, (o.label.length || o.description.length) && (this.mattertags[r] = new v(this, r, o), i++))
          };
          e.resolve()
        }.bind(this)).fail(function() {
          e.resolve()
        }), e
      }, n.prototype.loadPanos = function() {
        var e = new _(this);
        return e.load().then(function(e) {
          this.data.sweeps && Object.keys(this.data.sweeps).length > 0 && (e = e.filter(function(e) {
            return this.data.sweeps[e.uuid].enabled
          }.bind(this)));
          this.panos.extend(e.map(function(e) {
            return new y(this, e.uuid, e)
          }.bind(this)));
          this.panos.forEach(function(e) {
            e.neighbourUUIDs && (e.neighbourUUIDs.forEach(function(t) {
              var i = this.panos["get"](t);
              i && this.panos.setNeighbour(e, i, !0)
            }.bind(this)), e.neighbourPanos = this.panos.getNeighbours(e) || this.panos.setNeighbour(e, e, !0))
          }.bind(this));
          return 0 === this.panos.length && (this.supportedModes[h.PANORAMA] = !1), $.when(this)
        }.bind(this))
      }, n.prototype.loadHighlightReel = function() {
        var e = $.Deferred(),
          t = this.options.urlBase + "/data/" + g_index + "/active_reel.js";
        return o["get"](t, {
          responseType: "json",
          auth: m.authorizationHeader
        }).done(function(t) {
          if (t.reel) {
            this.images = this.validateHighlights(this.data.images, t.reel)
          };
          e.resolve()
        }.bind(this)).fail(function() {
          e.resolve()
        }), e
      }, n.prototype.waitForPanoLoad = function(e, t, i) {
        i = void(0) !== i ? i : !0, e.isLoaded(t) || (this.waitQueue.push({
          pano: e,
          quality: t
        }), 1 === this.waitQueue.length && i && this.emit("waiting"))
      }, n.prototype.update = function(e) {
        this.panos.forEach(function(t) {
          t.update(e)
        })
      }, n.prototype.hide = function() {
        this.floorList.forEach(function(e) {
          e.hide()
        })
      }, n.prototype.show = function() {
        this.floorList.forEach(function(e) {
          e.show()
        })
      }, n.prototype.floorNames = function() {
        return this.floorList.reduce(function(e, t) {
          return e.concat(t.name)
        }, [])
      }, n.prototype.warpDestFloors = function(e) {
        if (this.stayPut = !0, !e) {
          return this.toggleAllFloors(!0), void((this.stayPut = m.stayPut))
        };
        var t = e.floor_visibility;
        if (void(0) === t || t.length < 2) {
          this.toggleAllFloors(!0)
        } else {
          this.toggleAllFloors(!1);
          for (var i = null, n = 0, r = 0; r < t.length; r += 1) {
            if (t[r]) {
              if (r < this.floorList.length) {
                i = this.floorList[r];
                n += 1
              }
            }
          };
          if (n > 1) {
            this.toggleAllFloors(!0)
          } else {
            if (i) {
              this._setFloor(i)
            }
          }
        };
        this.stayPut = m.stayPut
      }, n.prototype.toggleStartFloors = function() {
        var e = 0,
          t = null;
        if (this.heroImage && this.heroImage.metadata && this.heroImage.metadata.floor_visibility) {
          var i = this.heroImage.metadata.floor_visibility;
          if (i.length > 1) {
            this.toggleAllFloors(!1);
            for (var n = 0; n < i.length; n += 1) {
              if (i[n]) {
                if (n < this.floorList.length) {
                  t = this.floorList[n];
                  e += 1
                }
              }
            }
          }
        };
        e > 1 || 1 > e ? this.toggleAllFloors(!0) : this._setFloor(t)
      }, n.prototype.setFloor = function(e, t) {
        this.allFloorsVisible = !1, this._setFloor(e, t)
      }, n.prototype.toggleAllFloors = function(e) {
        this.allFloorsVisible = void(0) !== e ? e : !this.allFloorsVisible, this._setFloor(this.currentFloor)
      }, n.prototype._setFloor = function(e, t) {
        t = t || this.mode, this.currentFloor = e, this.emit("floor.changed", this.currentFloor, t);
        var i;
        if (t === h.PANORAMA) {
          if (this.show(), this.showingMattertags) {
            for (i in this.mattertags) {
              this.mattertags[i].show(m.showFloorDuration)
            }
          }
        } else {
          if (t === h.FLOORPLAN || t === h.DOLLHOUSE) {
            if (this.floorList.forEach(function(e, t) {
                e.toggle(e === this.currentFloor || this.allFloorsVisible, this.allFloorsVisible)
              }.bind(this)), this.showingMattertags) {
              for (i in this.mattertags) {
                var n = this.mattertags[i];
                this.allFloorsVisible ? n.show(m.showFloorDuration) : n.floor === this.currentFloor ? n.show(m.showFloorDuration, m.showFloorDelay) : n.hide(m.hideFloorDuration, m.hideFloorDelay)
              }
            };
            if (!this.stayPut) {
              var o = new r.Vector3(0, -e.conservativeBoundingBox.min.y, 0),
                a = m.showFloorDuration + m.showFloorDelay;
              x.start(E.vector(this.position, o), a, null, 0, M.easeInOutQuad)
            }
          }
        };
        var s = this,
          c = e;
        x.start(function() {}, m.showFloorDelay, function() {
          s.floorList.forEach(function(e) {
            e.chunks.forEach(function(t) {
              t.renderOrder = e === c ? l.visibleFloor : l.ghostFloor
            })
          })
        }.bind(this))
      }, n.prototype.toggleExplode = function() {
        function e(e, t) {
          e.position.x = i[e.floorIndex] * t, e.position.y = 1 * e.floorIndex * t
        }
        var t, i = [],
          n = 0;
        this.floorList.forEach(function(e, r, o) {
          t = r > 0 ? Math.max(o[r - 1].boundingBox.max.x - e.boundingBox.min.x, e.boundingBox.size().x / 2) : 0, n += t, i[r] = n
        }), i = i.map(function(e) {
          return e - n / 2
        }), this.floorList.forEach(this.exploded ? function(t) {
          x.start(function(i) {
            e(t, 1 - i)
          }.bind(this), 1500, null, 0, M.easeOutExpo)
        }.bind(this) : function(t) {
          x.start(function(i) {
            e(t, i)
          }.bind(this), 1500, null, 0, M.easeOutExpo)
        }.bind(this)), this.exploded = !this.exploded
      }, n.prototype.toggleExplodeUp = function() {
        function e(e, i) {
          e.position.y = (5 * e.floorIndex - t.y / 2) * i, e.panos.forEach(function(t) {
            t.position.y = t.origin.y + e.position.y, t.mesh.position.y = t.origin.y + e.position.y
          })
        }
        var t = this.size;
        this.floorList.forEach(this.exploded ? function(t) {
          x.start(function(i) {
            e(t, 1 - i)
          }, 1500, null, 0, M.easeOutExpo)
        } : function(t) {
          x.start(function(i) {
            e(t, i)
          }, 1500, null, 0, M.easeOutExpo)
        }), this.exploded = !this.exploded
      }, n.prototype.nextFloor = function(e) {
        return this.floors[this.currentFloor.floorIndex + e] || null
      }, n.prototype.addFloor = function(e) {
        this.add(e), this.floors[e.floorIndex] = this.floorList[e.floorIndex] = e
      }, n.prototype.getOrMakeFloor = function(e) {
        var t = this.floors[e];
        return t || (t = new c(this, e), this.addFloor(t)), t
      }, n.prototype.getFloorAtPoint = function(e) {
        for (var t = null, i = 1 / 0, n = 0; n < this.floorList.length; n++) {
          var r = this.floorList[n],
            o = r.distanceToPoint(e);
          (!t || i > o) && (i = o, t = r)
        };
        return t
      }, n.prototype.getTagBySid = function(e) {
        return this.mattertags[e]
      }, n.prototype.addChunk = function(e, t) {
        t = new u(t), this.getOrMakeFloor(e).addChunk(t), this.chunks.push(t)
      }, n.prototype.setMode = function(e) {
        this.mode = e, this.chunks.forEach(function(t) {
          t.setMode(e)
        })
      }, n.prototype.build = function() {
        this.heroLocations = n.getHeroLocations(this.images);
        this.currentFloor = this.floors[this.floorList.length - 1], this.floorList.forEach(function(e) {
          e.build()
        }.bind(this)), this.colliders = this.floorList.reduce(function(e, t) {
          return e.concat(t.collider.children)
        }, []), this.panos.forEach(function(e) {
          e.build1(), e.on("enter", function() {
            e.floor !== this.currentFloor && this.setFloor(e.floor)
          }.bind(this))
        }.bind(this)), this.panos.forEach(function(e) {
          e.build2()
        }), this.floorList.forEach(function(e) {
          this.boundingBox.union(e.boundingBox)
        }.bind(this)), this.size = this.boundingBox.size(), this.center = this.boundingBox.center(), this.boundingBoxWithPadding.copy(this.boundingBox).expandByScalar(5), this.panos.populate_path_graph(), this.skybox = new s(this.boundingBox), this.skybox.matrixWorldNeedsUpdate = !0, this.add(this.skybox);
        for (var e in this.mattertags) {
          this.mattertags[e].build()
        };
        return this.buildLabels(), this.buildRooms(), this.associateLabelsWithRooms(), $.when(this)
      }, n.prototype.buildLabels = function() {
        for (var e = 0; e < this.labels.length; e++) {
          var t = this.labels[e],
            i = this.parseRoomIndexFromWorkshopRoomId(t.roomId);
          i = this.generateRoomId(t.floorId, i);
          var n = new p(t.sid, t.position || t.positions[0], t.text, t.floorId, i);
          n.position = f.convertWorkshopVector(n.position), this.labels[e] = n, n.build()
        }
      }, n.prototype.loadLabels = function() {
        var e = $.Deferred();
        if (this.labels = [], !this.showingLabels) {
          return e.resolve()
        };
        var t = this.options.urlBase + "/api/v1/jsonstore/model/labels/" + this.sid;
        return o["get"](t, {
          responseType: "json",
          auth: m.authorizationHeader
        }).done(function(t) {
          for (var i in t) {
            if (t.hasOwnProperty(i)) {
              var n = t[i];
              this.labels.push(n)
            }
          };
          e.resolve()
        }.bind(this)).fail(function(t) {
          e.resolve()
        }), e.promise()
      }, n.prototype.associateLabelsWithRooms = function() {
        for (var e = 0; e < this.labels.length; e++) {
          for (var t = this.labels[e], i = 0; i < this.rooms.length; i++) {
            var n = this.rooms[i];
            n.roomId === t.roomId && (t.room = n)
          }
        }
      }, n.prototype.calcRoomBoundaries = function() {
        var e = new r.Vector3;
        return function() {
          for (var t = 0; t < this.rooms.length; t++) {
            for (var i = this.rooms[t], n = new r.Vector3(0, 0, 0), o = new r.Vector3(0, 0, 0), a = new r.Vector3(0, 0, 0), s = 0, h = 0; h < i.chunks.length; h++) {
              var l = i.chunks[h],
                c = l.geometry.attributes.position;
              if (c) {
                for (var u = 0; u < c.array.length; u += 3) {
                  e["set"](c.array[u], c.array[u + 1], c.array[u + 2]), n.add(e), 0 === u ? (o.copy(e), a.copy(e)) : (o.max(e), a.min(e)), s++
                }
              }
            };
            s > 0 ? (n.multiplyScalar(1 / s), i.average = n) : i.average = null, i.boundsMax = o, i.boundsMin = a, i.center = new r.Vector3, i.center.copy(o).sub(a).multiplyScalar(0.5).add(a)
          }
        }
      }(), n.prototype.buildRooms = function() {
        var e = this,
          t = {},
          i = {
            floorId: -1,
            roomId: -1
          };
        this.rooms = [], this.chunks.forEach(function(n) {
          this.parseIdsFromChunkName(n.name, i);
          var r = t[i.roomId];
          if (!r) {
            var o = e.generateRoomId(i.floorId, i.roomId);
            r = new d(i.floorId, o), t[i.roomId] = r, this.rooms.push(r)
          };
          r.addChunk(n)
        }.bind(this)), this.calcRoomBoundaries()
      }, n.prototype.generateRoomId = function(e, t) {
        return e + "_" + t
      }, n.prototype.parseRoomIndexFromWorkshopRoomId = function(e) {
        var t = -1;
        if (e) {
          var i = e.split("_");
          t = parseInt(i[0])
        };
        return t
      }, n.prototype.parseIdsFromChunkName = function(e, t) {
        var i = function(e) {
          for (var t = -1, i = 0; i < e.length; i++) {
            var n = e.charCodeAt(i);
            if (n >= "0".charCodeAt(0) && n <= "9".charCodeAt(0)) {
              t = i;
              break
            }
          };
          return t >= 0 ? e.substring(t, e.length) : null
        };
        if (t.floorId = -1, t.roomId = -1, e) {
          var n = e.split("_"),
            r = n.length > 1 ? n[1] : null,
            o = n.length > 2 ? n[2] : null;
          try {
            r && (t.floorId = parseInt(i(r))), o && (t.roomId = parseInt(i(o)))
          } catch (a) {}
        }
      }, n.prototype.setProjectedPanos = function(e, t) {
        function i(i) {
          i.material.uniforms.progress.value = 0, e.skybox.loaded || (e.skybox.needsUpdate = !0), e.skybox.loaded = !0, i.material.uniforms.pano0Map.value = e.skybox, i.material.uniforms.pano0Position.value.copy(e.position), i.material.uniforms.pano0Matrix.value.makeRotationFromQuaternion(n.clone().multiply(e.quaternion)), t.skybox.loaded || (t.skybox.needsUpdate = !0), t.skybox.loaded = !0, i.material.uniforms.pano1Map.value = t.skybox, i.material.uniforms.pano1Position.value.copy(t.position), i.material.uniforms.pano1Matrix.value.makeRotationFromQuaternion(n.clone().multiply(t.quaternion))
        }
        var n = this.parent.quaternion.clone();
        this.projectedPano0 = e, this.projectedPano1 = t, i(this.skybox), this.chunks.forEach(i)
      }, n.prototype.changeModelAlpha = function(e) {
        this.chunks.forEach(function(t) {
          t.material && t.material.uniforms && t.material.uniforms.modelAlpha && (t.material.uniforms.modelAlpha.value = e)
        })
      }, n.prototype.setSide = function(e) {
        this.floorList.forEach(function(t) {
          t.collider.material.side = e
        })
      }, n.prototype.validateHighlights = function(e, t) {
        var i, n, r = {};
        for (i = 0; i < e.length; i++) {
          n = e[i], r[n.sid] = n
        };
        var o = [];
        for (i = 0; i < t.length; i += 1) {
          var a = t[i];
          n = r[a.sid], n && o.push(n)
        };
        var s = this.supportedModes[h.DOLLHOUSE],
          l = this.supportedModes[h.FLOORPLAN];
        return o = o.filter(function(e) {
          if (!e.metadata) {
            return !0
          };
          if (void(0) === e.metadata.camera_mode) {
            return !0
          };
          var t = h.convertWorkshopModeInt(e.metadata.camera_mode);
          return t === h.PANORAMA || t === h.FLOORPLAN && l || t === h.DOLLHOUSE && s
        }), o
      }, n.getHeroImage = function(e) {
        for (var t = 0; t < e.length; t++) {
          if (e[t].is_hero) {
            return e[t]
          }
        };
        return null
      }, n.getHeroLocations = function(e) {
        if (e.length > 0) {
          for (var t = [], i = !1, r = 0; r < e.length; r += 1) {
            var o = e[r],
              a = o.thumbnail_signed_src,
              s = o.name;
            if (o.metadata && void(0) !== o.metadata.camera_quaternion) {
              var l = (o.metadata.camera_quaternion, {
                position: f.convertWorkshopVector(o.metadata.camera_position),
                quaternion: f.convertWorkshopQuaternion(o.metadata.camera_quaternion),
                scan_id: o.metadata.scan_id,
                camera_mode: h.convertWorkshopModeInt(o.metadata.camera_mode),
                ortho_zoom: o.metadata.ortho_zoom,
                floor_visibility: void(0) !== o.metadata.floor_visibility ? o.metadata.floor_visibility.slice(0) : [],
                thumb: a,
                name: o.name,
                is_hero: o.is_hero
              });
              if ("undefined" != typeof o.metadata.noface) {
                l.noface = o.metadata.noface
              };
              if ("undefined" != typeof o.metadata.final_angle) {
                l.finalangle = o.metadata.final_angle
              };
              t.push(l), i = i || o.is_hero
            }
          };
          return t.length > 0 && !i && (t[0].is_hero = !0), t
        };
        return []
      }, n.prototype.findPanoramicHero = function() {
        for (var e in this.heroLocations) {
          if (this.heroLocations[e].camera_mode === h.PANORAMA) {
            return this.heroLocations[e]
          }
        };
        return null
      }, n.prototype.fadePanoMarkers = function(e, t) {
        var i = void(0) === e ? m.panorama.markerOpacity : e;
        if (this.panos.list[0]) {
          var n = this.panos.list[0].marker.material.opacity;
          if (n !== e) {
            var r = i - n;
            x.trigger({
              func: function(e, t) {
                for (var i = n + e * r, o = 0; o < this.panos.length; o += 1) {
                  this.panos.list[o].marker.material.opacity = i
                }
              }.bind(this),
              duration: void(0) === t ? m.markerOpacityTransitionTime : t,
              name: "_fpm"
            })
          }
        }
      }, n.prototype.setSweepVisibility = function(e) {
        this.panos.forEach(function(t) {
          t.marker.visible = e
        })
      }, n.prototype.outsideAllowed = function() {
        return this.supportedModes[h.DOLLHOUSE] && this.supportedModes[h.FLOORPLAN]
      }, n.filterImageName = function(e) {
        return "" === e || e.match(/^[0-9.]+_[0-9.]+$/) ? null : e
      }, t.exports = n
    }).call(this, "/js/objects/Model.js")
  }

  function _$af270396(e, t, i) {
    "use strict";

    function n(e) {
      this.player = e, this.obj3d = null, this.UP = new r.Vector3(0, 1, 0)
    }
    var r = e("three"),
      o = e("../settings");
    n.prototype.prefs = {
      linewidth: 3,
      height: 0.07,
      opacity: 0.45,
      endScale: 0.05
    }, n.prototype.discard = function() {
      if (this.obj3d) {
        var e = this.obj3d.parent;
        e && e.remove(this.obj3d)
      };
      this.obj3d = null
    }, n.prototype.draw = function() {
      if (this.discard(), o.showNeighbors) {
        var e = this.player.currentPano.floor;
        this.obj3d = new r.Object3D;
        var t = this.player.model.panos.getNeighbours(this.player.currentPano),
          i = this.player.currentPano.floorPosition.clone().sub(this.player.model.position);
        i.y += this.prefs.height;
        var n = 0.1525,
          a = 0.127,
          s = 0.0127,
          h = 0.1,
          l = 0.19,
          c = 0.2032,
          u = 0.2286,
          d = 0.255,
          p = new r.Matrix4;
        for (var f in t) {
          if (t[f]) {
            var m = this.player.model.panos.dict[f],
              g = (m.position.clone().sub(this.player.model.position), m.position.clone().sub(m.floorPosition)),
              v = m.floorPosition.clone().sub(this.player.model.position);
            v.y += this.prefs.height;
            var y = new r.Geometry;
            y.vertices.push(new r.Vector3(0, -s, 0), new r.Vector3(-s, 0, 0), new r.Vector3(0, s, 0), new r.Vector3(s, 0, 0), new r.Vector3(0, -s, 0)), y.vertices.push(new r.Vector3(0, -d, 0), new r.Vector3(d, -d, 0), new r.Vector3(d, n, 0), new r.Vector3(-n, n, 0), new r.Vector3(-n, a, 0), new r.Vector3(-l, h, 0), new r.Vector3(-l, -c, 0), new r.Vector3(-n, -u, 0), new r.Vector3(-n, -d, 0), new r.Vector3(0, -d, 0)), p.identity().setPosition(g), y.applyMatrix(p), y.vertices.push(new r.Vector3(0, -this.prefs.endScale, 0)), y.vertices.push(new r.Vector3(-this.prefs.endScale, -this.prefs.endScale, 0), new r.Vector3(-this.prefs.endScale, this.prefs.endScale, 0), new r.Vector3(this.prefs.endScale, this.prefs.endScale, 0), new r.Vector3(this.prefs.endScale, -this.prefs.endScale, 0)), p.lookAt(v, i, this.UP).setPosition(v), y.applyMatrix(p), y.vertices.push(v, i);
            var b = new r.Line(y, new r.LineBasicMaterial({
              color: m.debugColor.getHex(),
              transparent: !0,
              opacity: this.prefs.opacity,
              depthWrite: !1,
              name: "sLine" + f,
              linewidth: this.prefs.linewidth
            }));
            this.obj3d.add(b)
          }
        };
        e.add(this.obj3d)
      }
    }, n.prototype.update = function() {
      o.showNeighbors && this.obj3d && this.obj3d.updateMatrixWorld()
    }, t.exports = n
  }

  function _$af270401(e, t, i) {
    (function(i) {
      "use strict";

      function n(e, t, i) {
        this.model = e, this.id = t, this.neighbourUUIDs = i.neighbours || null, this.neighbourPanos = null, this.floor = null, this.failedLoadingAt = 0, this.maxLoadRetries = 4, this.origin = i.position.clone(), this.position = i.position.clone(), this.quaternion = i.quaternion.clone(), this.mesh = new r.Mesh(p), this.mesh.position.copy(this.position), this.mesh.quaternion.copy(this.quaternion), this.mesh.name = "skybox", this.mesh.material.visible = !1, this.mesh.updateMatrix(), this.marker = new r.Mesh(f, new r.MeshBasicMaterial({
          map: c.load("./images/marker-256x256.png"),
          opacity: 0,
          transparent: !0,
          depthWrite: !0
        })), this.marker.name = "marker", this.marker.pano = this, this.debugColor = (new r.Color).setHSL(0.06 + 0.53 * Math.random(), 0.8 + 0.2 * Math.random(), 0.5 + 0.2 * Math.random()), this.floorPosition = i.puck ? i.puck.clone() : null, this.skybox = new r.Texture([null, null, null, null, null, null]), this.skybox.flipY = !1, a.colorMarkerOnLoad && this.on("load", function() {
          this.marker.material.color["set"](65280)
        })
      }
      var r = e("three"),
        o = e("../util/logger"),
        a = e("../settings"),
        s = (e("../enum/Viewmode"), e("../util/common"), e("../util/transitions")),
        h = e("../util/lerp"),
        l = e("../util/ajax"),
        c = e("../util/texture"),
        u = e("events").EventEmitter,
        d = new o(i),
        p = new r.SphereBufferGeometry(0.1),
        f = new r.PlaneBufferGeometry(0.4, 0.4, 1, 1);
      n.prototype = Object.create(u.prototype), n.prototype.enter = function() {
        this.emit("enter")
      }, n.prototype.exit = function() {
        this.skybox.dispose(), this.skybox.loaded = !1, this.skybox.version = 0, this.emit("exit")
      }, n.prototype.hoverOn = function(e) {
        s.start(h.property(this.marker.material, "opacity", a[e].markerOpacityOnHover), 250), a.navigation.panoScores & a.navigation.mouseDirection && this.addTextSprite("HIT", 12525854)
      }, n.prototype.hoverOff = function(e) {
        s.start(h.property(this.marker.material, "opacity", a[e].markerOpacity), 250)
      }, n.prototype.build1 = function() {
        this.floor = this.floor || this.raycastToFindFloor() || this.model.getFloorAtPoint(this.position), this.floor.addPano(this), this.floorPosition = this.floorPosition || this.raycastFloorPosition(), this.neighbourPanos = this.neighbourPanos || this.findNeighourPanos(), a.colorMarkerByFloor && this.marker.material.color["set"](this.floor.debugColor)
      }, n.prototype.build2 = function() {
        this.floorPosition = this.floorPosition || this.interpolateFloorPosition(), this.height = this.position.distanceTo(this.floorPosition), this.placeMarker()
      }, n.prototype.update = function(e) {
        this.mesh.updateMatrixWorld(), this.marker.updateMatrixWorld(), this.position.setFromMatrixPosition(this.mesh.matrixWorld), this.floorPosition.setFromMatrixPosition(this.marker.matrixWorld)
      }, n.prototype.interpolateFloorPosition = function() {
        var e = this.model.panos.filter(n.filters.isNeighbourPanoTo(this)).filter(function(e) {
            return !!e.floorPosition
          }).sort(function(e, t) {
            return e.position.distanceTo(this.position) - t.position.distanceTo(this.position)
          }.bind(this)),
          t = this.position.clone();
        return e.length >= 2 ? t.y = (e[0].floorPosition.y + e[1].floorPosition.y) / 2 : t.add(a.noMeshFloorPositionOffset), t
      }, n.prototype.raycastFloorPosition = function() {
        var e = new r.Raycaster(this.position, new r.Vector3(0, -1, 0)),
          t = e.intersectObjects(this.model.colliders);
        return t.length ? t[0].point : null
      }, n.prototype.raycastToFindFloor = function() {
        var e = [new r.Vector3(0, -1, 0), new r.Vector3(1, -1, 0), new r.Vector3(0, -1, 1), new r.Vector3(-1, -1, 0), new r.Vector3(0, -1, -1), new r.Vector3(1, 0, 0), new r.Vector3(0, 0, 1), new r.Vector3(-1, 0, 0), new r.Vector3(0, 0, -1)];
        return function() {
          for (var t = 0; t < e.length; t++) {
            var i = new r.Raycaster(this.position.clone(), e[t].clone()),
              n = i.intersectObjects(this.model.colliders);
            if (n.length) {
              return n[0].object.parent.parent
            }
          };
          return null
        }
      }(), n.prototype.placeMarker = function() {
        this.marker.position.copy(this.floorPosition), this.marker.position.y += 0.05, this.marker.lookAt(new r.Vector3(0, 1, 0).add(this.marker.position))
      }, n.prototype.findClosestMidtpointPanoTo = function(e) {
        (new r.Vector3).addVectors(this.position, e.position).divideScalar(2);
        return this.model.panos.find([n.filters.notIn([this, e])], [n.sortFunctions.distanceToPoint(point)])
      }, n.prototype.loadCube = function(e, t, i, n) {
        this.emit("loading", e), this.model.emit("loading", this);
        var r = this.getCubemapUrls(e),
          o = r.filter(function(e) {
            return !e
          });
        "low" === e && o.length > 0 && (e = "high", r = this.getCubemapUrls(e));
        var a = 0,
          s = [0, 1, 2, 3, 4, 5].map(function(e, t, i) {
            return l.getImage(r[t]).done(function() {
              n && n(++a, 6)
            })
          }.bind(this));
        $.when(s[0], s[1], s[2], s[3], s[4], s[5]).done(function(i, n, r, o, a, s) {
          this.skybox[e] = [i, n, r, o, a, s], "high" !== e && this.skybox.high || (this.skybox.image = this.skybox[e], this.skybox.low = null), this.skybox.needsUpdate = !0, this.emit("load", e), this.model.emit("load", this), t && t()
        }.bind(this)).fail(function() {
          this.failedLoadingAt = Date.now(), i && i()
        }.bind(this))
      }, n.prototype.getCubemapUrls = function(e, t) {
        return [2, 4, 0, 5, 1, 3].map(function(t, i) {
          return this.model.urls["get"]("pan/" + e + "/" + this.id + "_skybox" + t + ".jpg")
        }.bind(this))
      }, n.prototype.isLoaded = function(e) {
        return this.skybox.high ? !0 : e in this.skybox
      }, n.raycastsSkipped = 0, n.raycastsDone = 0, n.prototype.findNeighourPanos = function() {
        return this.model.panos.setNeighbour(this.id, this.id, !1), this.model.panos.forEach(function(e) {
          if (e !== this && (!this.model.panos.neighbourMap[this.id] || void(0) === this.model.panos.neighbourMap[this.id][e.id])) {
            var t = this.position.distanceTo(e.position);
            if (t > a.panoramaNeighbourMaxDistance) {
              return this.model.panos.setNeighbour(this, e, !1), void(n.raycastsSkipped) ++
            };
            var i = e.position.clone().sub(this.position).normalize(),
              o = new r.Raycaster(this.position, i.clone(), 0, t),
              s = o.intersectObjects(this.model.colliders);
            n.raycastsDone++, this.model.panos.setNeighbour(this, e, 0 === s.length), a.showNeighbourRaycasts && this.floor.model.add(s.length ? new r.ArrowHelper(i, this.position, s[0].distance, 16711680) : new r.ArrowHelper(i, this.position, t, 16777215, 0, 0))
          }
        }.bind(this)), this.model.panos.neighbourMap[this.id]
      }, n.prototype.worldPosition = function() {
        return this.position
      }, n.prototype.addTextSprite = function(e, t) {
        this.removeTextSprite();
        var i = document.createElement("canvas"),
          n = i.getContext("2d");
        i.width = 256, i.height = 256;
        var o = "Arial",
          a = 60;
        n.font = "bold " + a + "px " + o, n.fillStyle = "white";
        var s = n.measureText(e).width;
        n.fillText(e, (i.width - s) / 2, (i.height + a) / 2);
        var h = new r.Texture(i);
        h.needsUpdate = !0;
        var l = new r.SpriteMaterial({
          map: h,
          color: t || 16428055
        });
        this.text3d = new r.Sprite(l), this.text3d.position.copy(this.mesh.position), this.floor.add(this.text3d)
      }, n.prototype.removeTextSprite = function() {
        this.text3d && (this.floor.remove(this.text3d), this.text3d = null)
      }, n.filters = {
        inDirection: function(e, t, i) {
          return function(n) {
            var r = n.position.clone().sub(e).normalize();
            return r.dot(t) > i
          }
        },
        inFloorDirection: function(e, t, i) {
          return function(n) {
            var r = n.floorPosition.clone().sub(e).normalize();
            return r.dot(t) > i
          }
        },
        inPanoDirection: function(e, t, i) {
          return i = a.navigation.panoScores ? a.navigation.filterStrictness : i,
            function(n) {
              var r = n.floorPosition.clone().sub(e).normalize(),
                o = n.position.clone().sub(e).normalize();
              return r.dot(t) > i || o.dot(t) > i
            }
        },
        atFloor: function(e) {
          return function(t) {
            return e ? t.floor === e : !0
          }
        },
        not: function(e) {
          return function(t) {
            return t != e
          }
        },
        notIn: function(e) {
          return function(t) {
            return -1 === e.indexOf(t)
          }
        },
        isLoaded: function() {
          return function(e) {
            return e.isLoaded()
          }
        },
        isNotLoaded: function() {
          return function(e) {
            return !e.isLoaded()
          }
        },
        isCloseEnoughTo: function(e, t) {
          return function(i) {
            return e.distanceTo(i.floorPosition) < t
          }
        },
        hasMinimumHeightDifferenceTo: function(e, t) {
          return function(i) {
            return Math.abs(i.position.y - e.y) > t
          }
        },
        isNotBehindNormal: function(e, t) {
          var i = new r.Vector3;
          return t = t.clone(),
            function(n) {
              var r = i.copy(n.position).sub(e).normalize();
              return r.dot(t) > 0
            }
        },
        isNeighbourPanoTo: function(e) {
          return function(t) {
            return e && e.neighbourPanos ? !!e.neighbourPanos[t.id] : !0
          }
        },
        isNeighbourOfNeighbourTo: function(e) {
          return function(t) {
            return e.neighbourPanos[t.id] ? !0 : e.neighbourUUIDs.some(function(i) {
              var n = e.model.panos["get"](i);
              return n ? n.neighbourPanos[t.id] : !1
            })
          }
        },
        isNotRecentlyFailed: function(e) {
          return function(t) {
            return Date.now() - t.failedLoadingAt > e
          }
        },
        isOnVisibleFloor: function() {
          return function(e) {
            return !e.floor.hidden
          }
        }
      }, n.sortFunctions = {
        distanceToPoint: function(e) {
          return function(t, i) {
            return t.position.distanceTo(e) - i.position.distanceTo(e)
          }
        },
        floorDistanceToPoint: function(e) {
          return function(t, i) {
            return t.floorPosition.distanceTo(e) - i.floorPosition.distanceTo(e)
          }
        },
        choose: function(e) {
          return function(t, i) {
            return e.id === t.id ? -1 : e.id === i.id ? 1 : 0
          }
        }
      }, n.scoreFunctions = {
        distance: function(e, t) {
          return t = t || a.navigation.distanceFactor,
            function(i) {
              return e ? e.position.distanceTo(i.position) * t : 0
            }
        },
        distanceSquared: function(e, t) {
          return t = t || a.navigation.distanceFactor,
            function(i) {
              return e ? e.position.distanceToSquared(i.position) * t : 0
            }
        },
        direction: function(e, t) {
          return function(i) {
            var n = i.position.clone().sub(e).normalize();
            return n.dot(t) * a.navigation.directionFactor
          }
        },
        angle: function(e, t) {
          return function(i) {
            var n = i.position.clone().sub(e).normalize();
            return n.angleTo(t) * a.navigation.angleFactor
          }
        },
        inFieldOfView: function(e, t) {
          return function(i) {
            var n = i.position.clone().sub(e).normalize();
            return n.dot(t) > 0.75 ? 10 : -1
          }
        },
        penalizeHeightDifferenceUnder: function(e, t) {
          return function(i) {
            return e.y - i.position.y < t ? -20 : 0
          }
        }
      }, t.exports = n
    }).call(this, "/js/objects/Panorama.js")
  }

  function _$af270483(e, t, i) {
    "use strict";

    function n(e) {
      var t = r.UniformsUtils.clone(l.waypoint.uniforms);
      t.map.value = s.load("./images/reticule-256x256.png"), t.opacity.value = 0, t.color.value["set"](o.reticuleColor), r.Mesh.call(this, new r.PlaneBufferGeometry(0.4, 0.4, 1, 1), new r.ShaderMaterial({
        side: r.DoubleSide,
        depthWrite: !0,
        depthTest: !1,
        transparent: !0,
        vertexShader: l.waypoint.vertexShader,
        fragmentShader: l.waypoint.fragmentShader,
        uniforms: t,
        name: "waypoint",
        opacity: 0
      })), this.player = e, this.direction = new r.Vector3, this.hidden = !0, this.mouseLastMoveTime = Date.now()
    }
    var r = e("three"),
      o = e("../settings"),
      a = e("../util/transitions"),
      s = e("../util/texture"),
      h = e("../util/lerp"),
      l = e("../shaders");
    n.prototype = Object.create(r.Mesh.prototype), n.prototype.move = function(e, t, i) {
      this.hidden = i, this.mouseLastMoveTime = Date.now()
    }, n.prototype.hide = function() {
      this.hidden || (this.hidden = !0, a.start(h.property(this.material.uniforms.opacity, "value", 0), o.reticuleOpacityTransitionTime))
    }, n.prototype.show = function() {
      this.hidden = !1, this.material.opacity <= 0 && a.start(h.property(this.material.uniforms.opacity, "value", o[this.player.mode].reticuleOpacity), o.reticuleOpacityTransitionTime)
    }, n.prototype.update = function() {
      Date.now() - this.mouseLastMoveTime > o.hideReticuleTimeout && !this.hidden && this.hide()
    }, n.prototype.updatePosition = function(e, t) {
      if (!this.hidden) {
        if (!t) {
          return this.hide()
        };
        var i = t.point,
          n = e.distanceTo(i),
          r = 1 + 0.01 * n;
        1 > n && (r -= 1 - n), this.show(), this.scale["set"](r, r, r), this.direction = this.direction.multiplyScalar(0.8), this.direction.add(t.face.normal.clone().multiplyScalar(0.2)), this.position.copy(i).add(t.face.normal.clone().multiplyScalar(0.01)), this.lookAt(this.position.clone().add(this.direction))
      }
    }, n.prototype.writeAsMattertag = function() {
      var e = Math.floor(4294967296 * (1 + Math.random())).toString(16) + Math.floor(16 * (1 + Math.random())).toString(16),
        t = new Date;
      this.tagCount = "undefined" == typeof this.tagCount ? 1 : this.tagCount + 1;
      var i = {
        enabled: !0,
        version: "0",
        created: t.toISOString(),
        created_by: "APITest",
        position: this.position.clone(),
        stem: {
          enabled: o.mattertags.pole.enabled,
          direction: this.direction.multiplyScalar(o.mattertags.pole.height)
        },
        label: "Mattertag " + this.tagCount,
        description: "Description " + e,
        floor: function(e) {
          if (e.currentFloor) {
            for (var t = 0; t < e.floorList.length; t += 1) {
              if (e.floorList[t] == e.currentFloor) {
                return t
              }
            }
          };
          return void(0)
        }(this.player.model),
        type: "info",
        metadata: {
          preferred_camera: {
            mode: this.player.mode
          }
        }
      };
      var n = this.player.model.addMattertag(e, i).build();
      n && (n.disc && this.player.mattertagDiscs.push(n.disc), n.visible || n.show(o.mattertags.startup.fadeInDuration))
    }, t.exports = n
  }

  function _$af270492(e, t, i) {
    "use strict";

    function n(e, t) {
      this.chunks = [], this.floorId = e, this.roomId = t, this.position = new r.Vector3
    }
    var r = e("three");
    n.prototype.addChunk = function(e) {
      this.chunks.push(e)
    }, t.exports = n
  }

  function _$af270495(e, t, i) {
    (function(i) {
      "use strict";

      function n(e) {
        this.obj3d = null;
        var t = "ribbon.png";
        "chevron" === l.path.style && (t = "pathTile.png"), this.texture = this.loadTileTexture("./images/" + t), this.endTex = this.loadTileTexture("./images/End.png"), this.startTex = this.loadTileTexture("./images/Start.png"), this.nodes = [], this.colorHull = [], this.shortPaths = {}, this.floorHull = null, this.cameraHull = null, this.floorPathDistance = 0, this.floorCurvePoints = null, this.floorCurveColors = null, this.camCurvePoints = null, this.warpDestHeroLoc = null, this.warpDestPano = null, this.warpPathPoints = null, this.warpPathLengths = [0], this.warpLength = 0, this.closeWarpDistance = 4, this.player = e, this.createCpm(this.player.scene), this.bunnyObj = new r.AxisHelper(0.1), this.bunnyObj.visible = l.warp.showBunny, this.player.scene.add(this.bunnyObj), this.UP = m.UP.clone(), this.longestStep = 0, this.transType = null, this.canSeePath = !1, this.burnsDir = 1, this.hasBeenIndoors = !1, this.updateDefaultsFromModelData(), this.prevNextDist = 0, this.nextI = 0
      }
      var r = e("three"),
        o = e("../util/logger"),
        a = e("../enum/Viewmode"),
        s = e("../enum/RenderOrder"),
        h = e("../enum/WarpStyle"),
        l = e("../settings"),
        c = (e("../util/math"), e("../util/lerp")),
        u = e("../util/easing"),
        d = e("../util/transitions"),
        p = e("../effects"),
        f = e("../shaders"),
        m = (e("../gui/gui"), e("../enum/Vectors")),
        g = new o(i);
      n.textureLoader = new r.TextureLoader, n.prototype.updateDefaultsFromModelData = function() {
        var e = this.player.model.data;
        this.defaultWarpType = e.hasOwnProperty("player_options") && e.player_options && e.player_options.fast_transitions === !1 ? h.STD : l.path.typ
      }, n.prototype.pointPathDistance = function(e) {
        for (var t = 0, i = 1; i < e.length; i += 1) {
          t += e[i - 1].distanceTo(e[i])
        };
        return t
      }, n.prototype.pointPathLengths = function(e) {
        for (var t = [0], i = 1; i < e.length; i += 1) {
          t.push(t[i - 1] + e[i - 1].distanceTo(e[i]))
        };
        return t
      }, n.prototype.interpAlongPath = function(e, t, i) {
        var n, o = new r.Vector3,
          a = t[t.length - 1];
        if (1 > i) {
          n = i * a;
          for (var s = 1; s < t.length; s += 1) {
            if (t[s] > n) {
              var h = (n - t[s - 1]) / (t[s] - t[s - 1]);
              return o.copy(e[s]), o.sub(e[s - 1]), o.multiplyScalar(h), o.add(e[s - 1]), o
            }
          }
        } else {
          o.copy(e[e.length - 1])
        };
        return o
      }, n.prototype.pathHeight = function() {
        return this.player.mode !== a.FLOORPLAN ? l.path.height : l.path.outsideHeight
      }, n.prototype.createCpm = function(e) {
        this.currentPanoMarker = this.makeWaypointObj(this.endTex, "Current"), this.currentPanoMarker.material.uniforms.opacity.value = 0, this.placeCpm(), e.add(this.currentPanoMarker)
      }, n.prototype.placeCpm = function() {
        l.path.mapGuides && this.hasBeenIndoors && this.player.currentPano ? (this.currentPanoMarker.parent != this.player.currentPano.floor && (this.currentPanoMarker.parent && this.currentPanoMarker.parent.remove(this.currentPanoMarker), this.player.currentPano.floor.add(this.currentPanoMarker)), this.currentPanoMarker.position.copy(this.player.currentPano.floorPosition).sub(this.player.model.position), this.currentPanoMarker.position.y += this.pathHeight()) : this.popOutCpm()
      }, n.prototype.fadeInCpm = function(e) {
        l.path.mapGuides && this.hasBeenIndoors && d.start(c.property(this.currentPanoMarker.material.uniforms.opacity, "value", 1), e)
      }, n.prototype.fadeOutCpm = function(e) {
        d.start(c.property(this.currentPanoMarker.material.uniforms.opacity, "value", 0), e)
      }, n.prototype.popInCpm = function() {
        l.path.mapGuides && this.hasBeenIndoors && this.fadeInCpm(2)
      }, n.prototype.popOutCpm = function() {
        this.fadeOutCpm(2)
      }, n.prototype.brushPrefs = {
        linewidth: 7,
        strokeWidth: 15,
        cvSegments: 48,
        paveStep: 0.1,
        paveWidth: 0.2,
        lookBlendDist: 3,
        maxTurn: r.Math.degToRad(2)
      }, n.prototype.panoPathDistance = function(e) {
        var t = this.player.model.panos;
        if (!e || e.length < 2) {
          return 0
        };
        for (var i = [], n = 0; n < e.length; n += 1) {
          i.push(t.dict[e[n]].floorPosition)
        };
        return this.pointPathDistance(i)
      }, n.prototype.loadTileTexture = function(e) {
        var t = n.textureLoader.load(e, function(t) {
          t.wrapS = r.RepeatWrapping, t.wrapT = r.RepeatWrapping, t.needsUpdate = !0
        }, void(0), function() {});
        return t.mapping = r.UVMapping, t
      }, n.prototype.warpToArbitraryPano = function(e, t) {
        if (!e) {
          return !1
        };
        t = t || new r.Quaternion;
        var i = {
          camera_mode: "panorama",
          floor_visibility: [],
          is_hero: !1,
          name: null,
          ortho_zoom: -1,
          position: e.position,
          quaternion: t,
          scan_id: e.id
        };
        return this.warpDestHeroLoc = i, this.transType = h.BLACK, this.brushToWarpPano(), this.warpToPano(), this.discardPathObject(), !0
      }, n.prototype.getHeroData = function(e) {
        var t = this.player.model.heroLocations.length;
        if (1 > t) {
          return null
        };
        if (2 > t) {
          return this.player.model.heroLocations[0]
        };
        var i = this.player.model.heroLocations[e];
        return void(0) === i ? null : i
      }, n.prototype.getWarpHeroLocation = function(e) {
        var t = this.player.model.heroLocations.length;
        if (1 > t) {
          return null
        };
        if (null !== this.warpDestHeroLoc && 2 > t) {
          return this.player.model.heroLocations[0]
        };
        var i = this.player.model.heroLocations[e];
        return void(0) === i ? null : i
      }, n.prototype.selectWarpHeroLocation = function(e) {
        var t = this.getWarpHeroLocation(e);
        return null === t ? !1 : (this.warpDestHeroLoc = t, !0)
      }, n.prototype.getHeroPano = function(e) {
        if (null === e) {
          return null
        };
        var t = e.scan_id || e.id,
          i = this.player.model.panos.dict[t];
        return void(0) === i && (i = null), i
      }, n.prototype.setWarpDestPano = function() {
        return this.warpDestPano = this.getHeroPano(this.warpDestHeroLoc), this.warpDestPano
      }, n.prototype.determinePathVisibility = function() {
        return this.canSeePath = !1, this.canSeePath = this.canSeePath || this.defaultWarpType === h.STD, this.canSeePath = this.canSeePath || l.path.alwaysShow, this.canSeePath = this.canSeePath && l.path.mapGuides, this.canSeePath
      }, n.prototype.brushToWarpPano = function() {
        if (this.discardPathObject(), this.setWarpDestPano()) {
          if (!this.warpDestPano) {
            return void(g.info(""))
          };
          if (!this.player.currentPano) {
            return void(g.debug(""))
          };
          if (!this.warpDestPano) {
            return void(g.info(""))
          };
          if (this.player.currentPano.id === this.warpDestPano.id) {
            g.debug("")
          } else {
            this.nodes = this.findShortestPath(this.player.currentPano, this.warpDestPano);
            var e = void(0) === this.nodes || null === this.nodes || this.nodes.length < 1;
            this.obj3d = new r.Object3D, e ? (this.transType = h.BLACK) : (this.setPathHulls(this.nodes), this.setFloorCurves(), this.determinePathVisibility() && ("chevron" === l.path.style ? this.obj3d.add(this.drawPathPavement(this.floorCurvePoints)) : "ribbon" === l.path.style && this.obj3d.add(this.drawPathRibbon(this.floorCurvePoints, this.floorCurveColors)))), this.player.currentPano.floor.add(this.obj3d);
            var t = this.player.mode === a.DOLLHOUSE || this.player.mode === a.FLOORPLAN,
              i = l.path.mapGuides && !this.player.director.tourIsPlaying && t;
            if (i = i || this.transType === h.STD, this.canSeePath || i) {
              if (t) {
                var n = this.makeStartMarker(this.floorHull[0], this.floorCurvePoints);
                this.obj3d.add(n)
              };
              if (!e) {
                var o = this.makeEndMarker(this.floorHull[this.floorHull.length - 1], i && l.path.pulseMarkers);
                this.obj3d.add(o)
              }
            };
            this.appearSlow()
          }
        }
      }, n.prototype.findShortestPath = function(e, t) {
        if (!e || !t) {
          return null
        };
        var i = e.id + ":" + t.id;
        if (this.shortPaths.hasOwnProperty(i)) {
          return this.shortPaths[i] ? this.shortPaths[i].slice() : null
        };
        var n = t.id + ":" + e.id;
        if (this.shortPaths.hasOwnProperty(n)) {
          return this.shortPaths[n] ? this.shortPaths[n].slice().reverse() : null
        };
        var r = this.player.model.panos.aStarSearch(e, t);
        return this.shortPaths[i] = r ? r.slice() : null, r
      }, n.prototype.makePathHulls = function(e) {
        var t, i, n, r, o, a = 0,
          s = [],
          h = [],
          c = [],
          u = this.player.model.panos;
        t = u.dict[e[0]], r = t.floor.floorIndex;
        for (var d = 0; d < e.length; d += 1) {
          t = u.dict[e[d]], i = t.floorPosition.clone().sub(this.player.model.position), i.y += this.pathHeight(), s.push(i), h.push(t.position.clone()), n = t.floor.floorIndex, c.push(n > r ? l.path.colorUp : r > n ? l.path.colorDown : l.path.color), d > 0 && (o = h[d].distanceTo(h[d - 1]), o > a && (a = o))
        };
        return a > this.longestStep && (this.longestStep = a, g.debug("path contains " + a + " meter segment")), {
          floor: s,
          camera: h,
          color: c
        }
      }, n.prototype.makeFloorCurves = function(e, t, i) {
        var n = this.player.mode === a.PANORAMA ? l.path.waypointIndoorRadius : l.path.waypointRadius,
          o = this.pointPathDistance(e) - 2 * n,
          s = e.slice(0),
          h = s[1].clone().sub(s[0]);
        h.y = 0, h.normalize().multiplyScalar(n), s[0] = (new r.Vector3).copy(s[0]).add(h), h = s[s.length - 2].clone().sub(s[s.length - 1]), h.y = 0, h.normalize().multiplyScalar(n), s[s.length - 1] = (new r.Vector3).copy(s[s.length - 1]).add(h);
        var c = new r.CatmullRomCurve3(s),
          u = Math.floor(o / i);
        u = 4 * Math.floor(u / 4), u = Math.max(4, u);
        for (var d, p, f, m = c.getSpacedPoints(u), g = [], v = new r.Vector3, y = 0; y < m.length; y += 1) {
          f = 0, d = m[y].distanceTo(e[0]);
          for (var b = 1; b < e.length; b += 1) {
            v.copy(m[y]).sub(e[b]), v.y *= 4, p = v.length(), d > p && (f = b)
          };
          g.push(t[f])
        };
        return {
          distance: o,
          points: m,
          colors: g
        }
      }, n.prototype.makeCameraCurvePoints = function(e, t) {
        var i = this.pointPathDistance(e),
          n = new r.CatmullRomCurve3(e);
        return n.getSpacedPoints(Math.max(2, Math.floor(i / t)))
      }, n.prototype.makeCameraCurveTangents = function(e, t) {
        var i = this.pointPathDistance(e),
          n = new r.CatmullRomCurve3(e),
          o = Math.max(2, Math.floor(i / t));
        o || (o = 5);
        for (var a = [], s = 0; o >= s; s++) {
          a.push(n.getTangentAt(s / o))
        };
        return a
      }, n.prototype.setPathHulls = function(e) {
        var t = this.makePathHulls(e);
        this.floorHull = t.floor, this.cameraHull = t.camera, this.colorHull = t.color
      }, n.prototype.setFloorCurves = function() {
        var e = this.makeFloorCurves(this.floorHull, this.colorHull, this.brushPrefs.paveStep);
        this.floorPathDistance = e.distance, this.floorCurvePoints = e.points, this.floorCurveColors = e.colors
      }, n.prototype.setCameraCurvePoints = function() {
        this.camCurvePoints = this.makeCameraCurvePoints(this.cameraHull, this.brushPrefs.paveStep)
      }, n.prototype.chooseWarpPath = function(e) {
        var t, i, n, o = this.player.cameras[a.PANORAMA];
        if (this.player.currentPano === this.warpDestPano || !e) {
          return this.warpPathPoints = null, this.warpLength = 0, !1
        };
        this.nodes = this.findShortestPath(this.player.currentPano, this.warpDestPano), void(0) === this.nodes || null === this.nodes || this.nodes.length < 1 ? (t = this.warpDestPano.position.clone().sub(o.position), i = t.clone().negate(), t.multiplyScalar(0.15).add(o.position), i.multiplyScalar(0.15).add(this.warpDestPano.position), t.y = o.position.y, i.y = this.warpDestPano.position.y, n = new r.CubicBezierCurve3(o.position.clone(), t, i, this.warpDestPano.position.clone()), this.warpPathPoints = n.getSpacedPoints(this.brushPrefs.cvSegments)) : (this.setCameraCurvePoints(), this.warpPathPoints = this.camCurvePoints.slice(0)), this.warpLength = 0, this.warpPathLengths = [0];
        for (var s = new r.Vector3, h = new r.Vector3, l = 1; l < this.warpPathPoints.length; l += 1) {
          s.copy(this.warpPathPoints[l - 1]), s.y *= 4, h.copy(this.warpPathPoints[l]), h.y *= 4, this.warpLength += s.distanceTo(h), this.warpPathLengths[l] = this.warpLength
        };
        return !0
      }, n.prototype.drawPathRibbon = function(e, t) {
        this.bunnyObj.visible = l.warp.showBunny;
        for (var i = 0.6 * l.path.ribbonWidth * 0.5, n = new r.Vector3, o = new r.Vector3(0, this.pathHeight(), 0), h = new r.Geometry, c = new r.Vector3, u = 0; u < e.length; u += 1) {
          c.copy(e[u]), 0 === u ? c.sub(e[u + 1]) : c.sub(e[u - 1]).negate(), c.normalize(), n.crossVectors(c, this.UP), n.multiplyScalar(i);
          var d = (new r.Vector3).copy(e[u]).add(o);
          d.sub(n), h.vertices.push(d), d = (new r.Vector3).copy(e[u]).add(o), d.add(n), h.vertices.push(d)
        };
        var p, m = 0;
        for (u = 0; u < e.length - 1; u += 1) {
          var g = 2 * u,
            v = m;
          m += e[u + 1].distanceTo(e[u]);
          var y = m,
            b = t[u],
            w = t[u + 1];
          p = new r.Face3(g, g + 1, g + 2), p.vertexColors = [new r.Color(b), new r.Color(b), new r.Color(w)], h.faces.push(p), h.faceVertexUvs[0].push([new r.Vector2(0, v), new r.Vector2(1, v), new r.Vector2(0, y)]), p = new r.Face3(g + 2, g + 1, g + 3), p.vertexColors = [new r.Color(w), new r.Color(b), new r.Color(w)], h.faces.push(p), h.faceVertexUvs[0].push([new r.Vector2(0, y), new r.Vector2(1, v), new r.Vector2(1, y)])
        };
        var _, x;
        this.player.mode === a.PANORAMA ? (x = r.UniformsUtils.clone(f.ribbon.uniforms), x.map.value = this.texture, x.opacity.value = 0, x.color.value["set"](l.path.color), _ = new r.ShaderMaterial({
          side: r.DoubleSide,
          depthWrite: !1,
          transparent: !0,
          vertexShader: f.ribbon.vertexShader,
          fragmentShader: f.ribbon.fragmentShader,
          uniforms: x,
          name: "ribbonT",
          opacity: 0
        })) : _ = new r.MeshBasicMaterial({
          color: 16777215,
          side: r.DoubleSide,
          name: "ribbonOut",
          vertexColors: r.VertexColors
        });
        var M = new r.Mesh(h, _);
        return M.name = "ribbon", this.player.mode === a.PANORAMA && (M.renderOrder = s.ribbon), M
      }, n.prototype.drawPathPavement = function(e) {
        for (var t, i = 0.25, n = new r.Vector3, o = new r.Geometry, s = new r.Vector3, h = 0; h < e.length; h += 1) {
          s.copy(e[h]), 0 === h ? s.sub(e[h + 1]).negate() : s.sub(e[h - 1]), s.normalize(), n.crossVectors(s, this.UP), n.multiplyScalar(this.brushPrefs.paveWidth), t = (new r.Vector3).copy(e[h]), t.sub(n), o.vertices.push(t), o.vertices.push((new r.Vector3).copy(e[h])), t = (new r.Vector3).copy(e[h]), t.add(n), o.vertices.push(t)
        };
        var c, u, d;
        for (h = 0; h < e.length - 1; h += 1) {
          c = 3 * h + 1, u = h * i, d = u + i, o.faces.push(new r.Face3(c - 1, c, c + 3)), o.faceVertexUvs[0].push([new r.Vector2(0, u), new r.Vector2(0.5, u), new r.Vector2(0.5, d)]), o.faces.push(new r.Face3(c + 3, c + 2, c - 1)), o.faceVertexUvs[0].push([new r.Vector2(0.5, d), new r.Vector2(0, d), new r.Vector2(0, u)]), o.faces.push(new r.Face3(c + 3, c, c + 1)), o.faceVertexUvs[0].push([new r.Vector2(0.5, d), new r.Vector2(0.5, u), new r.Vector2(1, u)]), o.faces.push(new r.Face3(c + 3, c + 1, c + 4)), o.faceVertexUvs[0].push([new r.Vector2(0.5, d), new r.Vector2(1, u), new r.Vector2(1, d)])
        };
        var p = new r.MeshBasicMaterial(this.player.mode === a.PANORAMA ? {
          color: l.path.color,
          side: r.DoubleSide,
          transparent: !0,
          depthWrite: !1,
          opacity: 0,
          name: "paveT",
          map: this.texture
        } : {
          color: l.path.color,
          side: r.DoubleSide,
          transparent: !0,
          depthWrite: !1,
          opacity: 1,
          name: "paveO",
          map: this.texture
        });
        return new r.Mesh(o, p)
      }, n.prototype.hintPrefs = {
        rad: 0.18,
        width: 0.0125,
        depth: 0.0625,
        setBack: -0.04,
        markRad: 0.25,
        markInnerRad: 0.16
      }, n.prototype.makeWaypointObj = function(e, t) {
        var i = new r.Geometry,
          n = this.player.mode === a.PANORAMA ? l.path.waypointIndoorRadius : l.path.waypointRadius,
          o = this.pathHeight();
        i.vertices.push(new r.Vector3(-n, o, n), new r.Vector3(-n, o, -n), new r.Vector3(n, o, -n), new r.Vector3(n, o, n)), i.faces.push(new r.Face3(0, 1, 2), new r.Face3(2, 3, 0)), i.faceVertexUvs[0].push([new r.Vector2(0, 0), new r.Vector2(1, 0), new r.Vector2(1, 1)]), i.faceVertexUvs[0].push([new r.Vector2(1, 1), new r.Vector2(0, 1), new r.Vector2(0, 0)]);
        var s = r.UniformsUtils.clone(f.waypoint.uniforms);
        s.map.value = e, s.opacity.value = 0, s.color.value["set"](l.path.color);
        var h = {
          side: r.DoubleSide,
          depthWrite: !1,
          transparent: !0,
          vertexShader: f.waypoint.vertexShader,
          fragmentShader: f.waypoint.fragmentShader,
          uniforms: s,
          name: "waypoint",
          opacity: 0
        };
        this.player.mode !== a.PANORAMA && (h.depthTest = !1, h.name = "wayPtOut");
        var c = new r.ShaderMaterial(h),
          u = new r.Mesh(i, c);
        return u.name = t, u
      }, n.prototype.makeStartMarker = function(e, t) {
        var i = (new r.Vector3).copy(t[1]).sub(t[0]);
        i.y = 0, i.normalize();
        var n = Math.acos(i.x),
          o = this.makeWaypointObj(this.startTex, "Start");
        return o.rotateOnAxis(new r.Vector3(0, 1, 0), n), o.position.copy(e), o
      }, n.prototype.makeEndMarker = function(e, t) {
        var i = this.makeWaypointObj(this.endTex, "End"),
          n = this.player.model.panos.dict[this.nodes[0]].floor.floorIndex,
          r = this.player.model.panos.dict[this.nodes[this.nodes.length - 1]].floor.floorIndex;
        return t && d.start(function(e, t) {
          if (!this.obj3d) {
            return !0
          };
          var n = Math.pow(Math.abs(0.5 - e), 2);
          i.material.uniforms.pulse.value = 1 - 0.7 * n;
          var r = 1.5 - 0.5 * n;
          i.scale["set"](r, 1, r)
        }.bind(this), -l.path.waypointPulse), r > n ? i.material.uniforms.color.value["set"](l.path.colorUp) : n > r && i.material.uniforms.color.value["set"](l.path.colorDown), i.position.copy(e), i
      }, n.prototype.pathClean = function(e) {
        if (e) {
          for (var t in e.children) {
            this.pathClean(e.children[t])
          };
          e.geometry && e.geometry.dispose(), e.material && e.material.dispose()
        }
      }, n.prototype.discardPathObject = function() {
        if (this.obj3d) {
          var e = this.obj3d.parent;
          e && e.remove(this.obj3d), this.pathClean(this.obj3d)
        };
        this.obj3d = null, this.popInCpm()
      }, n.prototype.discardSlow = function() {
        if (this.obj3d) {
          if (this.player.mode !== a.PANORAMA) {
            return void(this.discardPathObject())
          };
          for (var e, t = this, i = 0, n = function() {
              this.discardPathObject()
            }.bind(this), r = 0; r < t.obj3d.children.length; r += 1) {
            e = t.obj3d.children[r], void(0) !== e.material && e.material.transparent === !0 && (void(0) !== e.material.uniforms ? d.start(c.property(e.material.uniforms.opacity, "value", 0), l.path.fadeOutTime, n, 0, u[l.warp.blendEasing]) : d.start(c.property(e.material, "opacity", 0), l.path.fadeOutTime, n, 0, u[l.warp.blendEasing]), i += 1, n = null)
          };
          0 === i && this.discardPathObject(), this.player.mode !== a.PANORAMA && this.fadeInCpm(l.path.fadeInTime - 3)
        }
      }, n.prototype.appearSlow = function() {
        var e, t = this;
        this.fadeOutCpm(l.path.fadeInTime);
        for (var i = this.player.mode === a.PANORAMA ? l.path.opacity : 1, n = 0; n < t.obj3d.children.length; n += 1) {
          e = t.obj3d.children[n], void(0) !== e.material && e.material.transparent === !0 && (void(0) !== e.material.uniforms ? d.start(c.property(e.material.uniforms.opacity, "value", i), l.path.fadeInTime, null, 0, u[l.warp.blendEasing]) : d.start(c.property(e.material, "opacity", i), l.path.fadeInTime, null, 0, u[l.warp.blendEasing]))
        }
      }, n.prototype.update = function() {
        this.obj3d && this.obj3d.updateMatrixWorld()
      }, n.prototype.calcBurnsAmount = function(e) {
        if (this.player.mode === a.PANORAMA) {
          var t = this.burnsDir * r.Math.degToRad(l.warp.burnsAngle);
          if (this.defaultWarpType === h.BLACK) {
            return t
          };
          var i = this.player.director,
            n = i.nextItem(i.currentItem);
          if (null === n) {
            return t
          };
          var o = this.getWarpHeroLocation(n);
          if (null === o) {
            return t
          };
          if ("" === o.scan_id) {
            return t
          };
          var s, c, u, d = this.getHeroPano(o),
            p = this.player.cameras[a.PANORAMA],
            f = m.FORWARD.clone().applyQuaternion(p.quaternion).setY(0).normalize();
          if (d == this.player.currentPano) {
            return s = m.FORWARD.clone().applyQuaternion(o.quaternion).setY(0).normalize(), c = Math.acos(s.dot(f)), u = (new r.Vector3).crossVectors(f, s), t = Math.min(Math.abs(c), r.Math.degToRad(l.warp.burnsAngle)) * Math.sign(c) * Math.sign(u.y), t
          };
          var v = this.findShortestPath(this.player.currentPano, d);
          if (void(0) === v || null === v || v.length < 1) {
            return t
          };
          var y = this.makePathHulls(v),
            b = this.makeCameraCurveTangents(y.camera, this.brushPrefs.paveStep);
          return s = b[0].clone().setY(0).normalize(), c = Math.acos(s.dot(f)), u = (new r.Vector3).crossVectors(f, s), t = Math.min(Math.abs(c), r.Math.degToRad(l.warp.burnsAngle)) * Math.sign(c) * Math.sign(u.y), t
        };
        if (this.player.mode === a.DOLLHOUSE) {
          var w = this.player.cameras[a.DOLLHOUSE];
          return this.burnsDir * Math.min(w.controls.rotationAcceleration.x + 0.05, 0.02)
        };
        return this.burnsDir
      }, n.prototype.waitNextStep = function(e) {
        var t = new r.Euler,
          i = new r.Vector3;
        var n = this.calcBurnsAmount(),
          o = function() {
            this.player.mode === a.DOLLHOUSE && (this.player.cameras[a.DOLLHOUSE].controls.rotationAcceleration.x = 0), e && e()
          }.bind(this),
          s = function(e, r) {
            if (this.player.director.pendingHalt) {
              return o(), !0
            };
            var s = r || 1e3 / 60;
            if (l.warp.doBurns) {
              if (this.player.mode === a.PANORAMA) {
                var h = this.player.cameras[a.PANORAMA];
                t.setFromQuaternion(h.quaternion, l.warp.eOrder);
                if ("undefined" != typeof this.warpDestHeroLoc.finalangle) {
                  s = this.warpDestHeroLoc.finalangle
                };
                var m_time = l.warp.tourStepDelay;
                if ("undefined" != typeof(g_audio[this.nodes[this.nodes.length - 1]])) {
                  m_time = g_audio[this.nodes[this.nodes.length - 1]]["time"]
                };
                var c = s * n / m_time;
                t.y += c;
                i["set"](0, 0, -1);
                i.applyEuler(t);
                i.add(h.position);
                h.controls.lookAt(i);
                h.controls.lookVector.copy(i);
                h.lookAt(i)
              } else {
                if (this.player.mode === a.DOLLHOUSE) {
                  var u = this.player.cameras[a.DOLLHOUSE];
                  u.controls.rotationAcceleration.x = n
                } else {
                  this.player.controls[a.FLOORPLAN].absoluteScale *= 0.9996
                }
              }
            }
          }.bind(this);
        var time = l.warp.tourStepDelay;
        if (this.nodes.length > 0) {
          if ("undefined" != typeof(g_audio[this.nodes[this.nodes.length - 1]])) {
            time = g_audio[this.nodes[this.nodes.length - 1]]["time"]
          }
        };
        d.start(s, time, o, 0, u.easeInOutQuad, "wait")
      }, n.prototype.warpToNonPano = function(e) {
        this.discardPathObject(), this.warpDestHeroLoc.camera_mode === a.DOLLHOUSE || this.warpDestHeroLoc.camera_mode === a.FLOORPLAN ? this.player.flyToNewMode(this.warpDestHeroLoc.camera_mode, {
          duration: l.warp.outsideTime,
          warpDest: this.warpDestHeroLoc,
          callback: e,
          force: !0
        }) : (e && e())
      }, n.prototype._resetWarpShaderParams = function(e) {
        this.player.mode === a.PANORAMA && (void(0) !== e.material.uniforms.blackout && (e.material.uniforms.blackout.value = 0), void(0) !== e.material.uniforms.stasis && (e.material.uniforms.stasis.value = 0), void(0) !== e.material.uniforms.modelAlpha && (e.material.uniforms.modelAlpha.value = 0))
      }, n.prototype._clearWarpShading = function() {
        for (var e = this.player.model.chunks, t = 0; t < e.length; t += 1) {
          this._resetWarpShaderParams(e[t]), e[t].visible = !0
        };
        this._resetWarpShaderParams(this.player.model.skybox)
      }, n.prototype._warpStopFlying = function() {
        this.player.flying = !1, this.placeCpm()
      }, n.prototype._wrapupTravelOnlyBits = function() {
        this._warpStopFlying(), this.warpPathPoints && (this.player.currentPano.exit(), this.warpDestPano.enter(), this.player.currentPano = this.warpDestPano);
        this.player.spider.draw(), this.placeCpm()
      }, n.prototype._wrapupTravel = function(e) {
        this._wrapupTravelOnlyBits(), this.warpCameraAim(e)
      }, n.prototype._wrapupWarpShading = function(e) {
        this._clearWarpShading(), this._wrapupTravel(e)
      }, n.prototype.wrapupWarpShadingOnly = function(e) {
        this._clearWarpShading(), this.player.flying = !1, this._wrapupTravelOnlyBits(), this.transType = null, e && e()
      }, n.prototype._warpCameraAim = function(e, t, i) {
        var n = this.warpDestHeroLoc.quaternion,
          o = this.player.cameras[a.PANORAMA],
          s = new r.Vector3(0, 0, 1).applyQuaternion(n).normalize(),
          h = new r.Vector3(0, 0, 1).applyQuaternion(o.quaternion).normalize(),
          c = h.dot(s),
          p = r.Math.radToDeg(Math.acos(c)),
          f = new r.Euler(0, 0, 0, l.warp.eOrder).setFromQuaternion(n, l.warp.eOrder),
          m = (new r.Euler).setFromQuaternion(o.quaternion, l.warp.eOrder),
          v = new r.Euler(f.x - m.x, f.y - m.y, f.z - m.z, l.warp.eOrder);
        v.y = v.y > Math.PI ? v.y -= 2 * Math.PI : v.y < -Math.PI ? v.y += 2 * Math.PI : v.y, this.burnsDir = Math.sign(v.y);
        var y = new r.Euler(0, 0, 0, l.warp.eOrder),
          b = new r.Vector3,
          w = function(e, t) {
            return this.player.director.pendingHalt ? !0 : (y.x = m.x + e * v.x, y.y = m.y + e * v.y, y.z = m.z + e * v.z, b["set"](0, 0, -1), b.applyEuler(y), b.add(o.position), o.controls.lookAt(b), o.controls.lookVector.copy(b), void(o.lookAt(b)))
          }.bind(this);
        return p > l.warp.minRotation ? d.start(w, t, i, 0, u[l.warp.movementEasing]) : void((i && i()))
      }, n.prototype._warpBendAim = function(e, t, i, n) {
        var o = n || 0,
          s = this.player.cameras[a.PANORAMA],
          h = new r.Euler(0, 0, 0, l.warp.eOrder).setFromQuaternion(this.warpDestHeroLoc.quaternion, l.warp.eOrder),
          c = (new r.Euler).setFromQuaternion(s.quaternion, l.warp.eOrder),
          p = new r.Euler(h.x - c.x, h.y - c.y, h.z - c.z, l.warp.eOrder);
        p.y = p.y > Math.PI ? p.y -= 2 * Math.PI : p.y < -Math.PI ? p.y += 2 * Math.PI : p.y;
        var f = Math.min(r.Math.degToRad(l.warp.softBendTilt), Math.abs(p.x));
        p.x = f * Math.sign(p.x), f = Math.min(r.Math.degToRad(Math.max(0, l.warp.softBendAngle)), f), this.burnsDir = Math.sign(p.y), f *= Math.sign(p.y), p.y = f;
        var m = new r.Euler(0, 0, 0, l.warp.eOrder),
          g = new r.Vector3,
          v = function(e, t) {
            if (0.5 > e) {
              m.x = c.x + e * p.x, m.y = c.y + e * p.y, m.z = c.z + e * p.z
            } else {
              var i = (1 - e) * l.warp.softBendEnd;
              m.x = h.x - i * p.x, m.y = h.y - i * p.y, m.z = h.z - i * p.z
            };
            g["set"](0, 0, -1), g.applyEuler(m), g.add(s.position), s.controls.lookAt(g), s.controls.lookVector.copy(g), s.lookAt(g)
          }.bind(this);
        return d.start(v, t, i, o, u[l.warp.movementEasing])
      }, n.prototype._warpStepCameraAim = function(e, t, i) {
        var n = this.player.cameras[a.PANORAMA],
          o = new r.Euler(0, 0, 0, l.warp.eOrder).setFromQuaternion(this.warpDestHeroLoc.quaternion, l.warp.eOrder),
          s = (new r.Euler).setFromQuaternion(n.quaternion, l.warp.eOrder),
          h = new r.Euler(o.x - s.x, o.y - s.y, o.z - s.z, l.warp.eOrder);
        h.y = h.y > Math.PI ? h.y -= 2 * Math.PI : h.y < -Math.PI ? h.y += 2 * Math.PI : h.y, this.burnsDir = Math.sign(h.y);
        var c = new r.Euler(0, 0, 0, l.warp.eOrder),
          p = new r.Vector3,
          f = function(e, t) {
            c.copy(0.5 > e ? s : o), p["set"](0, 0, -1), p.applyEuler(c), p.add(n.position), n.controls.lookAt(p), n.controls.lookVector.copy(p), n.lookAt(p)
          }.bind(this);
        return d.start(f, t, i, 0, u[l.warp.movementEasing])
      }, n.prototype.setBurnsDir = function() {
        var e = this.player.cameras[a.PANORAMA],
          t = new r.Euler(0, 0, 0, l.warp.eOrder).setFromQuaternion(this.warpDestHeroLoc.quaternion, l.warp.eOrder),
          i = (new r.Euler).setFromQuaternion(e.quaternion, l.warp.eOrder),
          n = new r.Euler(t.x - i.x, t.y - i.y, t.z - i.z, l.warp.eOrder);
        n.y = n.y > Math.PI ? n.y -= 2 * Math.PI : n.y < -Math.PI ? n.y += 2 * Math.PI : n.y, this.burnsDir = Math.sign(n.y)
      }, n.prototype.stepWarpPath = function(e, t) {
        var i = this.player.cameras[a.PANORAMA];
        if (!this.warpPathPoints) {
          return i.position.copy(this.warpDestPano.position), !0
        };
        var n = this.warpPathPoints[0],
          o = this.warpDestPano.position;
        if (null !== this.nodes && this.cameraHull.length > 1) {
          var s = new r.Vector3;
          0.5 > e ? s.copy(this.cameraHull[1]).sub(n).normalize().multiplyScalar(l.warp.softPushDist * e).add(n) : s.copy(this.cameraHull[this.cameraHull.length - 2]).sub(o).normalize().multiplyScalar(l.warp.softPushDist * l.warp.softPushEnd * (1 - e)).add(o), i.position.copy(s)
        } else {
          i.position.copy(0.5 > e ? n : o)
        }
      }, n.prototype.haltWarp = function() {
        var e, t, i, n = 5e5,
          o = this.player.model.panos,
          s = this.player.cameras[a.PANORAMA].position,
          l = new r.Vector3,
          c = this.player;
        if (!this.player.director.tourIsPlaying) {
          return void(g.info(""))
        };
        if (this.player.flying && this.transType !== h.STD || c.mode !== a.PANORAMA) {
          return void((this.player.director.pendingHalt && g.warn("")))
        };
        var u = this.player.director.tourIsPlaying,
          p = this.player.flying;
        if (this.player.director.tourIsPlaying = !1, this.player.flying = !1, this.player.cameras[a.DOLLHOUSE].controls.rotationAcceleration.x = 0, this.player.director.pendingHalt) {
          g.warn("")
        } else {
          if (p && u) {
            if (this.transType === h.STD) {
              for (e = 0; e < o.length; e += 1) {
                o.list[e] !== this.player.currentPano && (i = l.copy(o.list[e].position).sub(s).lengthSq(), n > i && (t = o.list[e], n = i))
              }
            } else {
              g.warn("")
            }
          }
        };
        u && this._clearWarpShading(), this.discardSlow(), this.player.mode === a.PANORAMA && p && u && t && this.player.flyToPano(t)
      }, n.prototype.warpCameraAim = function(e) {
        var t = l.warp.minWarpTime;
        if (this.transType === h.BLACK) {
          t = l.warp.teleportTime
        } else {
          var i = this.player.cameras[a.PANORAMA],
            n = new r.Euler(0, 0, 0, l.warp.eOrder).setFromQuaternion(this.warpDestHeroLoc.quaternion, l.warp.eOrder),
            o = (new r.Euler).setFromQuaternion(i.quaternion, l.warp.eOrder),
            s = new r.Euler(n.x - o.x, n.y - o.y, n.z - o.z, l.warp.eOrder);
          s.y = s.y > Math.PI ? s.y -= 2 * Math.PI : s.y < -Math.PI ? s.y += 2 * Math.PI : s.y;
          var c = 1e3 * Math.abs(s.y) / r.Math.degToRad(l.warp.maxAimPerSec);
          t = Math.max(t, c)
        };
        var u = function() {
          this._warpStopFlying(), this.discardSlow(), e && e()
        }.bind(this);
        this._warpCameraAim(e, t, u)
      }, n.prototype.warpCommonParameters = function(e, t, i) {
        this.player.model.skybox.material.uniforms.blackout.value = 0, this.player.model.skybox.material.uniforms.stasis.value = 0;
        var n = c.uniform(this.player.model.skybox, "progress", 1),
          r = c.allUniforms(this.player.model.chunks, "progress", 1),
          o = !1,
          a = function() {
            return this.player.director.pendingHalt ? (o = !0, !0) : void(0)
          }.bind(this),
          s = function(e, t) {
            return i && o ? (this.player.model.skybox.material.uniforms.progress.value = 0, !0) : void(n(e, t))
          }.bind(this),
          h = function(e, t) {
            return i && o ? (r(0), !0) : void(r(e, t))
          }.bind(this);
        d.start(a, e, null, t, null, "safeHaltWatch"), d.start(s, e, null, t, u[l.warp.blendEasing], "skyboxProgress"), d.start(h, e, null, t, u[l.warp.blendEasing], "chunkProgress")
      }, n.prototype.half_warp = function() {
        return this.discardSlow(), this.setWarpDestPano() ? (this.transType = h.BLACK, void(this.warpTravel_BLACK(function() {
          this._clearWarpShading()
        }.bind(this), -0.5))) : (this.transType = null, void(this.warpToNonPano()))
      }, n.prototype.warpTravel_STD = function(e) {
        var t, i = Math.min(0.1, l.warp.lookAheadDist / this.warpLength),
          n = this.player.cameras[a.PANORAMA],
          o = (Math.min(0.25, 3 / this.warpLength), Math.min(0.35, 7 / this.warpLength)),
          s = new r.Euler(0, 0, 0, l.warp.eOrder),
          f = new r.Vector3,
          m = (new r.Euler).setFromQuaternion(n.quaternion, l.warp.eOrder),
          v = (new r.Euler).copy(m),
          y = n.position.clone(),
          b = l.warp.minWarpTime,
          w = !1;
        b += this.warpLength * l.warp.timePerMeter, l.warp.flySpeed > 0.01 && (b = 1e3 * this.warpLength / l.warp.flySpeed), b += l.warp.moveDelay;
        var _ = l.warp.moveDelay / b,
          x = this.warpDestHeroLoc.quaternion,
          M = new r.Vector3(0, 0, -1).applyQuaternion(x).normalize(),
          E = this.warpPathPoints[this.warpPathPoints.length - 1].clone().sub(this.warpPathPoints[this.warpPathPoints.length - 2]).normalize(),
          S = E.dot(M),
          T = r.Math.radToDeg(Math.acos(S)),
          P = function(e) {
            var t = o,
              i = r.Math.smoothstep(e, 0, t) * (1 - r.Math.smoothstep(e, 1 - t, 1));
            return i
          };
        this.warpCommonParameters(b, _, !0);
        var A = function() {
            w ? (this.discardSlow(), d.start(function() {}, 100, function() {
              this.transType = h.BLACK, this.warpTravel_BLACK(function() {
                this._clearWarpShading(), this.player.director.onTheBus = !0, this.player.director.detourComplete("_scoot")
              }.bind(this), -0.5);
              if ("undefined" != typeof(g_audio[this.nodes[this.nodes.length - 1]])) {
                g_touraudio.src = g_Prefix + g_audio[this.nodes[this.nodes.length - 1]]["music"];
                g_touraudio.pause()
              }
            }.bind(this), 0, null, "_jump2end")) : this._wrapupWarpShading(e)
          }.bind(this),
          L = function() {
            return this.player.director.pendingHalt ? (w = !0, !0) : void(0)
          }.bind(this),
          C = function(e, n) {
            return this.warpPathPoints ? w ? !0 : void((t = this.interpAlongPath(this.warpPathPoints, this.warpPathLengths, Math.min(e + i, 1)))) : !0
          }.bind(this),
          R = function(e, o) {
            if (w) {
              return !0
            };
            if (!this.warpPathPoints) {
              return !0
            };
            var a = this.warpLength * e,
              h = r.Math.smoothstep(a, 0, this.brushPrefs.lookBlendDist),
              c = r.Math.smoothstep(a, this.warpLength - this.brushPrefs.lookBlendDist, this.warpLength);
            l.warp.matchCam && (h *= 1 - c);
            var u = (new r.Matrix4).lookAt(y, t, this.UP);
            s.setFromRotationMatrix(u, l.warp.eOrder), m.setFromQuaternion(n.quaternion, l.warp.eOrder);
            var d = new r.Euler(s.x - m.x, s.y - m.y, s.z - m.z, l.warp.eOrder);
            d.y = d.y % (2 * Math.PI), d.y = d.y > Math.PI ? d.y -= 2 * Math.PI : d.y < -Math.PI ? d.y += 2 * Math.PI : d.y, s.x = m.x + h * d.x, s.y = m.y + h * d.y, s.z = m.z + h * d.z, d = new r.Euler(s.x - v.x, s.y - v.y, s.z - v.z, l.warp.eOrder), d.y = d.y % (2 * Math.PI), d.y = d.y > Math.PI ? d.y -= 2 * Math.PI : d.y < -Math.PI ? d.y += 2 * Math.PI : d.y;
            var p = r.Math.degToRad(l.warp.maxTurnPerSec) * o / 1e3;
            d.y = Math.sign(d.y) * Math.min(p, Math.abs(d.y)), v.x = v.x + d.x * l.warp.turnFriction, v.y = v.y + d.y * l.warp.turnFriction, v.z = v.z + d.z * l.warp.turnFriction;
            var b = t.clone().sub(y).normalize();
            if (T < l.warp.maxAimRotation && c > 0) {
              var _ = 1 - c;
              b.x = b.x * _ + c * E.x, b.y = b.y * _ + c * E.y, b.z = b.z * _ + c * E.z, b.normalize()
            };
            this.bunnyObj.position.copy(n.position).add(b), f["set"](0, 0, -1).applyEuler(v).normalize(), f.multiplyScalar(8), f.add(n.position), e > 1 - i && l.warp.matchCam || (n.controls.lookAt(f), n.controls.lookVector.copy(f), n.lookAt(f))
          }.bind(this),
          I = function(e, t) {
            if (!this.warpPathPoints) {
              return n.position.copy(this.warpDestPano.position), !0
            };
            if (w) {
              return !0
            };
            var i = this.interpAlongPath(this.warpPathPoints, this.warpPathLengths, e);
            n.position.copy(i), y = this.interpAlongPath(this.warpPathPoints, this.warpPathLengths, 0.99 * e)
          }.bind(this),
          D = function(e, t) {
            return w || !this.warpPathPoints ? (p.blur(0), !0) : void(p.blur(e))
          }.bind(this),
          O = c.allUniforms(this.player.model.chunks, "modelAlpha", 1),
          k = function(e, t) {
            return w || !this.warpPathPoints ? (O(0), !0) : void(O(e, t))
          }.bind(this);
        d.start(L, b, null, 0, null, "_haltWatcher"), l.warp.blur > 0 && (p.blurStrength = l.warp.blur, d.start(D, b, null, _, P, "blurring")), d.start(k, b, null, _, P, "modelAlpha"), d.start(I, b, null, _, u[l.warp.blendEasing], "followPath"), C(0), d.start(C, b, null, _, u[l.warp.blendEasing], "goBunny"), d.start(R, b, A, 0, u[l.warp.blendEasing], "lookAtBunny")
      }, n.prototype.warpTravel_BLACK = function(e, t) {
        var i = t || 0,
          n = (this.player.cameras[a.PANORAMA], l.warp.teleportTime);
        this.warpCommonParameters(n, i, !1), this.player.model.chunks.forEach(function(e) {
          e.material.uniforms.blackout.value = 1
        }), this.player.model.skybox.material.uniforms.blackout.value = 1;
        var r = n / 2,
          o = this.player.director.pendingHalt ? 0 : r;
        this.player.hideAllMattertags(o), setTimeout(function() {
          this.player.showAllMattertags(r)
        }.bind(this), o), this._warpBendAim(null, n, null, i);
        var s = function() {
          this.wrapupWarpShadingOnly(e)
        }.bind(this);
        d.start(this.stepWarpPath.bind(this), n, s, i, u[l.warp.blendEasing], "stepMotion")
      }, n.prototype.warpCameraTravel = function(e, t) {
        var i = this.transType;
        if (this.transType = null, !e) {
          this.player.flying = !1;
          var n = function() {
            this._wrapupTravel(t), t && t()
          }.bind(this);
          return void(this.player.flyToPano(this.warpDestPano, null, n))
        };
        i == h.BLACK ? this.warpTravel_BLACK(t) : this.warpTravel_STD(t)
      }, n.prototype.warpToPano = function(e) {
        if (this.player.flying) {
          return void(g.warn(""))
        };
        if (this.transType || (this.transType = this.defaultWarpType), !this.setWarpDestPano()) {
          return this.transType = null, void(this.warpToNonPano(e))
        };
        if (this.player.mode !== a.PANORAMA) {
          return this.transType = null, this.discardSlow(), void(this.player.flyToNewMode(a.PANORAMA, {
            pano: this.warpDestPano,
            duration: l.warp.outsideTime,
            warpDest: this.warpDestHeroLoc,
            callback: e,
            force: !0
          }))
        };
        if (this.hasBeenIndoors = !0, !this.warpDestPano) {
          return g.warn(""), void((this.transType = null))
        };
        var t = !(this.player.model.panos.isNeighbour(this.player.currentPano, this.warpDestPano) && this.warpDestPano !== this.player.currentPano && this.warpDestPano.position.distanceTo(this.player.currentPano.position) < l.warp.nearPanoDist),
          i = this.chooseWarpPath(t);
        return i && !this.warpDestPano.isLoaded("low") ? (this.player.model.waitForPanoLoad(this.warpDestPano, "low"), void(this.warpDestPano.loadCube("low", function() {
          this.warpToPano(e)
        }.bind(this)))) : (this.player.currentPano || (this.player.currentPano = this.warpDestPano, this.placeCpm(), this.fadeOutCpm(l.path.fadeOutTime), this.player.spider.draw()), this.player.flying = !0, this.player.emit("pano.chosen", this.warpDestPano, this.player.currentPano), this.player.model.setProjectedPanos(this.player.currentPano, this.warpDestPano), this.player.activeTag && this.player.dismissActiveTag(), void((i ? this.warpCameraTravel(t, e) : this.warpCameraAim(e))))
      }, t.exports = n
    }).call(this, "/js/objects/ShowPath.js")
  }

  function _$af270591(e, t, i) {
    "use strict";

    function n() {
      var e = new r.SphereBufferGeometry(250, 20, 5),
        t = new r.ShaderMaterial({
          fragmentShader: o.skysphere.fragmentShader,
          vertexShader: o.skysphere.vertexShader,
          uniforms: r.UniformsUtils.clone(o.skysphere.uniforms),
          side: r.BackSide,
          name: "skysphere"
        });
      t.uniforms.radius.value = e.parameters.radius, r.Mesh.call(this, e, t)
    }
    var r = e("three"),
      o = e("../shaders");
    n.prototype = Object.create(r.Mesh.prototype), n.prototype.constructor = n, t.exports = n
  }

  function _$af270593(e, t, i) {
    (function(i) {
      "use strict";

      function n(e, t, i, n, o) {
        this.model = e, this.currentPano = null, this.scene = n, this.renderer = o, this.domElement = i, this.paused = !1, this.flying = !1, this.camera = t, this.target = new r.Vector3, this.mouse = new r.Vector3(1.1, 1.1, 0.5), this.mouseAtMouseDown = new r.Vector2, this.mouseCouldBeClickToMove = !1, this.mouseLastMoveTime = Date.now(), this.mouseDown = !1, this.containsMouse = !0, this.isTouchEvent = !1, this.reticule = new a(this), this.panoMarkers = [], this.lookTransition = null, this.tagState = f.IDLE, this.intersectTag = null, this.hoveredTag = null, this.activeTag = null, this.mattertagDiscs = [], this.path = new u(this), this.spider = new d(this), this.cameras = {
          panorama: new E(this),
          dollhouse: new S(this),
          floorplan: new T(this)
        };
        var c = new s(this, this.cameras.panorama, i, n);
        c.enabled = !1;
        var m = new h(this, this.cameras.dollhouse, i, n);
        m.enabled = !1;
        var g = new l(this, this.cameras.floorplan, i, n);
        g.enabled = !1, this.control = m, this.controls = {}, this.controls[p.PANORAMA] = c, this.controls[p.DOLLHOUSE] = m, this.controls[p.FLOORPLAN] = g, this.quaternion = new r.Quaternion, this.position = new r.Vector3(15, 10, 15), this.previousState = null, this.raycaster = new r.Raycaster, this.intersect = null, this.lastChangeTime = Date.now(), this.bindEvents(), c.bindEvents(), m.bindEvents(), g.bindEvents();
        var v = p.DOLLHOUSE;
        Object.defineProperty(this, "mode", {
          get: function() {
            return v
          },
          set: function(e) {
            this.controls[v] && (this.controls[v].reset(), this.controls[v].enabled = !1), this.controls[e] && (this.controls[e].enabled = !0), this.control = this.controls[e], this.emit("mode.changed", v, e), v = e
          }.bind(this)
        }), this.updateLabelVisibility()
      }
      var r = e("three"),
        o = e("./util/logger"),
        a = e("./objects/Reticule"),
        s = e("./controls/PanoramaControls"),
        h = e("./controls/DollhouseControls"),
        l = e("./controls/FloorplanControls"),
        c = e("./objects/Panorama"),
        u = e("./objects/ShowPath"),
        d = e("./objects/NSpider"),
        p = e("./enum/Viewmode"),
        f = e("./enum/TagStates"),
        m = e("./enum/Vectors"),
        g = e("./settings"),
        v = e("./util/common"),
        y = e("./util/browser"),
        b = e("./util/math"),
        w = e("./util/lerp"),
        _ = e("./util/easing"),
        x = e("./util/transitions"),
        M = e("events").EventEmitter,
        E = e("./cameras/PanoramaCamera"),
        S = e("./cameras/DollhouseCamera"),
        T = e("./cameras/FloorplanCamera"),
        P = (e("./shaders"), new o(i));
      n.prototype = Object.create(M.prototype), n.prototype.getLabelsForFloor = function(e, t) {
        t = t || [], t.length = 0;
        for (var i = 0; i < this.model.labels.length; i++) {
          var n = this.model.labels[i];
          this.labelVisibleForFloor(n, e) && t.push(n)
        };
        return t
      }, n.prototype.getLabelsForCurrentFloor = function(e) {
        return this.getLabelsForFloor(this.model.currentFloor.floorIndex, e)
      }, n.prototype.labelVisibleForFloor = function(e, t) {
        return (e.room && e.room.floorId === t || this.model.allFloorsVisible) && this.model.showingLabels && e.labelGui && (y.isMobile() && this.getZoom() < g.labels.zoomHideThreshhold.mobile || !y.isMobile() && this.getZoom() < g.labels.zoomHideThreshhold.desktop)
      }, n.prototype.updateLabelVisibility = function(e) {
        for (var t = 0; t < this.model.labels.length; t++) {
          var i = this.model.labels[t];
          this.mode === p.FLOORPLAN && this.labelVisibleForFloor(i, this.model.currentFloor.floorIndex) ? this.showLabel(i, g.labels.fadeInDelay, g.labels.fadeInDuration) : this.hideLabel(i, g.labels.fadeOutDelay, g.labels.fadeOutDuration)
        }
      }, n.prototype.showAllLabels = function(e, t) {
        for (var i = 0; i < this.model.labels.length; i++) {
          var n = this.model.labels[i];
          this.showLabel(n, e, t)
        }
      }, n.prototype.hideAllLabels = function(e, t) {
        for (var i = 0; i < this.model.labels.length; i++) {
          var n = this.model.labels[i];
          this.hideLabel(n, e, t)
        }
      }, n.prototype.showLabel = function(e, t, i) {
        this.model.showingLabels && (e.visible || (e.visible = !0, $(e.labelGui).delay(t).fadeIn(i)))
      }, n.prototype.hideLabel = function(e, t, i) {
        e.visible && (e.visible = !1, y.isMobile() ? $(e.labelGui).hide() : $(e.labelGui).delay(t).fadeOut(i))
      }, n.prototype.updateLabelDisplay = function() {
        var e = (new r.Vector3, new r.Vector3, []);
        return function() {
          var t = this.getZoom(),
            i = 0.6,
            n = 1.2,
            r = (1 - t) * n + i,
            o = y.isMobile() ? g.labels.zoomTruncateThreshhold.mobile : g.labels.zoomTruncateThreshhold.desktop;
          this.getLabelsForCurrentFloor(e);
          for (var a = 0; a < e.length; a++) {
            var s = e[a];
            this.mode === p.FLOORPLAN && s.labelGui && (this.updateProjectedGuiElement(s.labelGui, s.position, r), s.labelGui.innerHTML = t >= o && s.text.length >= g.labels.minLengthForTruncate ? s.text.substring(0, g.labels.truncateLength) + g.labels.truncateSuffix : s.text)
          }
        }
      }(), n.prototype.updateProjectedGuiElement = function() {
        {
          var e = new r.Vector3;
          new r.Vector3
        }
        return function(t, i, n) {
          t.style.transform = "scale(" + n + ")";
          var r = window.innerWidth,
            o = window.innerHeight,
            a = 0.5 * r,
            s = 0.5 * o;
          e.copy(i), e.project(this.camera);
          var h = e.x * a + a,
            l = -(e.y * s) + s;
          h -= t.offsetWidth / 2, l -= t.offsetHeight / 2, t.style.left = h + "px", t.style.top = l + "px"
        }
      }(), n.prototype.getZoom = function() {
        if (this.mode == p.FLOORPLAN || this.mode == p.DOLLHOUSE) {
          var e = 10,
            t = Math.sqrt(this.controls[p.FLOORPLAN].absoluteScale / e);
          return t
        };
        return 0.5
      }, n.prototype.bindEvents = function() {
        this.domElement.addEventListener("mousedown", function(e) {
          0 === e.button && (this.handleTouchStart.call(this, e.clientX, e.clientY, !1), this.updateIntersect())
        }.bind(this)), this.domElement.addEventListener("touchstart", function(e) {
          if (!this.mouseDown) {
            var t = v.average(e.changedTouches, "clientX"),
              i = v.average(e.changedTouches, "clientY");
            this.handleTouchStart.call(this, t, i, !0)
          }
        }.bind(this)), this.domElement.addEventListener("pointerdown", function(e) {
          this.mouseDown || this.handleTouchStart.call(this, e.clientX, e.clientY, !0)
        }.bind(this)), this.domElement.addEventListener("mousemove", function(e) {
          this.isTouchEvent = !1, this.handleTouchMove.call(this, e.clientX, e.clientY, !1)
        }.bind(this), !1), this.domElement.addEventListener("touchmove", function(e) {
          var t = v.average(e.changedTouches, "clientX"),
            i = v.average(e.changedTouches, "clientY");
          this.handleTouchMove.call(this, t, i, !0)
        }.bind(this), !1), this.domElement.addEventListener("pointermove", function(e) {
          this.handleTouchMove.call(this, e.clientX, e.clientY, !0)
        }.bind(this)), this.domElement.addEventListener("mouseover", function(e) {
          this.containsMouse = !0, !this.mouseDown || 0 !== e.which && 0 !== e.buttons || (this.mouseDown = !1)
        }.bind(this)), this.domElement.addEventListener("mouseout", function(e) {
          this.containsMouse = !1, this.activeTag && this.tagState !== f.EXAMINE && (this.activeTag = null, this.intersectTag = null)
        }.bind(this)), this.domElement.addEventListener("mouseup", function(e) {
          this.handleTouchEnd.call(this, e.clientX, e.clientY, !1)
        }.bind(this)), this.domElement.addEventListener("touchend", function(e) {
          this.updateIntersect();
          var t = v.average(e.changedTouches, "clientX"),
            i = v.average(e.changedTouches, "clientY");
          this.handleTouchEnd.call(this, t, i, !0)
        }.bind(this)), this.domElement.addEventListener("pointerup", function(e) {
          this.updateIntersect(), this.handleTouchEnd.call(this, e.clientX, e.clientY, !0)
        }.bind(this)), this.domElement.addEventListener("pointerout", function(e) {
          this.mouseDown = !1
        }.bind(this)), this.domElement.addEventListener("pointercancel", function(e) {
          this.mouseDown = !1
        }.bind(this)), this.on("mode.changed", function(e, t) {
          var i = t === p.PANORAMA ? r.DoubleSide : r.FrontSide;
          this.model.setSide(i), this.model.setMode(t)
        }.bind(this)), this.on("mode.changing", function(e, t) {
          var i = this.director.describe().tourIsPlaying ? 0 : g[t].markerOpacity;
          this.model.fadePanoMarkers(i), this.model.setMode(t)
        }.bind(this))
      }, n.prototype.handleTouchStart = function(e, t, i) {
        this.isTouchEvent = i, this.mouse.x = e / window.innerWidth * 2 - 1, this.mouse.y = 2 * -(t / window.innerHeight) + 1, this.mouseAtMouseDown.x = e / window.innerWidth * 2 - 1, this.mouseAtMouseDown.y = 2 * -(t / window.innerHeight) + 1, this.mouseCouldBeClickToMove = !0, this.mouseDown = !0;
        var vector = new r.Vector3(this.mouse.x, this.mouse.y, this.mouse.z);
        var raycaster = new r.Raycaster();
        vector.unproject(this.camera);
        raycaster["set"](this.camera.position, vector.sub(this.camera.position).normalize());
        var intersects = raycaster.intersectObjects(g_HotMeshes);
        if (g_HotStatus == "add") {
          var sprite = new r.Mesh(new r.PlaneBufferGeometry(g_HotMeshWidth, g_HotMeshHeight, 1, 1), new r.MeshBasicMaterial({
            map: r.ImageUtils.loadTexture(g_HotImage),
            side: r.DoubleSide,
            transparent: !0,
            depthWrite: !1
          }));
          sprite.position.copy(this.reticule.position);
          sprite.lookAt(sprite.position.clone().add(this.reticule.direction));
          sprite.name = "sprite_" + g_HotMeshes.length;
          g_HotMeshes.push(sprite);
          this.scene.add(sprite);
          this.mouseCouldBeClickToMove = false;
          g_saveHot = false;
          alert("\u6dfb\u52a0\u70ed\u70b9\uff0cposition:" + sprite.position.x + "," + sprite.position.y + "," + sprite.position.z + ";rotation:" + sprite.rotation.x + "," + sprite.rotation.y + "," + sprite.rotation.z)
        } else {
          if (g_HotStatus == "delete") {
            if (intersects.length > 0) {
              for (var i = 0; i < g_HotMeshes.length; ++i) {
                if (g_HotMeshes[i].name == intersects[0].object.name) {
                  this.scene.remove(g_HotMeshes[i]);
                  g_HotMeshes[i].visible = false;
                  alert("\u5220\u9664\u70ed\u70b9\uff0c" + g_HotMeshes[i].name);
                  g_HotMeshes.splice(i, 1);
                  delete g_Hots[intersects[0].object.name];
                  break
                }
              };
              g_saveHot = false;
              this.mouseCouldBeClickToMove = false
            }
          } else {
            if (g_TextIconMesh.length > 0) {
              var intersects2 = raycaster.intersectObjects(g_TextIconMesh);
              if (intersects2.length > 0) {
                g_SelectTextIndex = intersects2[0].object.groupIndex;
                $("#text")[0].innerText = g_TextShow[parseInt(g_SelectTextIndex)];
                $("#sideimg")[0].src = g_Prefix + g_Text["Text" + g_SelectTextIndex].imgsrc;
                $(".sidecontent").animate({
                  left: "0",
                  opacity: "show"
                }, 800);
                this.mouseCouldBeClickToMove = false;
                return
              }
            };
            if (g_HotMeshes.length > 0) {
              if (intersects.length > 0) {
                for (var i = 0; i < g_HotMeshes.length; ++i) {
                  if (g_HotMeshes[i].name == intersects[0].object.name) {
                    if (g_HotMeshes[i].hasOwnProperty("hotLink")) {
                      g_touraudio.pause();
                      g_bgaudio = false;
                      document.getElementById("bgaudio").pause();
                      var sWidth = document.body.scrollWidth;
                      var sHeight = document.body.scrollHeight;
                      var pop1 = document.getElementById("popup");
                      pop1.style.display = "block";
                      var myElement = document.createElement("iframe");
                      myElement.src = g_HotMeshes[i].hotLink;
                      myElement.id = "id1";
                      myElement.allowTransparency = "true";
                      myElement.style.width = "100%";
                      myElement.style.height = "100%";
                      myElement.scrolling = "no";
                      var element = document.getElementById("id1");
                      if (typeof(element) == "undefined" || element == null) {
                        document.getElementById("popup").appendChild(myElement)
                      };
                      var oClose = document.getElementById("closepop");
                      oClose.onclick = function() {
                        pop1.style.display = "none";
                        document.getElementById("popup").removeChild(document.getElementById("id1"));
                        $("#popup iframe:last").remove();
                        document.getElementById("bgaudio").play()
                      }
                    };
                    break
                  }
                };
                this.mouseCouldBeClickToMove = false;
                return
              }
            }
          }
        }
      }, n.prototype.handleTouchMove = function(e, t, i) {
        this.isTouchEvent = i, this.mouse.x = e / window.innerWidth * 2 - 1, this.mouse.y = 2 * -(t / window.innerHeight) + 1, this.mouseAtMouseDown.distanceTo(this.mouse) > 0.02 && (this.mouseCouldBeClickToMove = !1), this.mouseLastMoveTime = Date.now(), this.reticule.move(e, t, i)
      }, n.prototype.handleTouchEnd = function(e, t, i) {
        if (this.isTouchEvent = i, this.mouseDown = !1, this.controls[p.PANORAMA].emit("interaction.direct"), this.mouseCouldBeClickToMove) {
          if (this.intersectTag) {
            return this.clickedOnTag()
          };
          if (this.activeTag && this.dismissActiveTag(), this.control && this.control.emit("move", this.isTouchEvent ? "touch" : "mouse"), this.director.history.invalidate(), this.intersect) {
            return this.flyToPanoClosestToMouse()
          };
          if (this.mode === p.PANORAMA) {
            var n = this.closestPanoInDirection(this.getMouseDirection());
            return n ? this.flyToPano(n) : this.bump(this.getMouseDirection())
          }
        }
      }, n.prototype.start = function(e, t) {
        if ("undefined" == typeof e) {
          t && t();
          var s = this.controls[p.DOLLHOUSE];
          s.maxDistance = s.calculateMaxDistance(this.model), this.dollhouseMode(r, o), this.path.unseenHero = !1, this.startAllMattertags()
        } else {
          var i = e.mode,
            n = e.pano,
            r = e.position,
            o = e.quaternion,
            a = e.tag;
          if (this.model.outsideAllowed()) {
            t && t();
            var s = this.controls[p.DOLLHOUSE];
            s.maxDistance = s.calculateMaxDistance(this.model), i === p.PANORAMA ? this.insideModeWithFlyIn(n, r, o, a) : i === p.FLOORPLAN ? (this.floorplanMode(), this.path.unseenHero = !1, this.startAllMattertags()) : i === p.DOLLHOUSE ? (this.dollhouseMode(r, o), this.path.unseenHero = !1, this.startAllMattertags()) : (n = this.model.panos.findClosest(r), this.insideModeWithFlyIn(n, r, o))
          } else {
            this.startInside(n, r, o, a, t), this.path.unseenHero = !1
          };
          this.panoMarkers = this.model.panos.list.reduce(function(e, t) {
            return e.concat(t.marker)
          }, []);
          for (var h in this.model.mattertags) {
            var l = this.model.mattertags[h].disc;
            l && this.mattertagDiscs.push(l)
          }
        };
        var c = function() {
          this.activeTag && this.tagState === f.EXAMINE && this.dismissActiveTag(), this.hoveredTag && (this.hoveredTag.setFreeState(!0), this.hoveredTag = null), x.cancel(this.lookTransition)
        }.bind(this);
        this.controls[p.PANORAMA].on("move", c), this.controls[p.DOLLHOUSE].on("move", c), this.controls[p.FLOORPLAN].on("move", c), this.on("mode.changing", c)
      }, n.prototype.startInside = function(e, t, i, n, o) {
        this.mode = p.PANORAMA, this.currentPano = e, t = t || e.position, i = i || e.quaternion;
        var a = g[p.PANORAMA],
          s = g.panorama.transitionTime,
          h = new r.Vector3(0, 0, -1).applyQuaternion(i),
          l = h.clone().add(e.position);
        return e && !e.isLoaded("low") ? (this.model.waitForPanoLoad(e, "low", !1), void(e.loadCube("low", function() {
          this.startInside(e, t, i, n, o)
        }.bind(this)))) : (this.control.object["set"](e), this.control.object.position.copy(t), this.control.object.quaternion.copy(i), this.control.lookAt(l), this.path.hasBeenIndoors = !0, this.update(0), o && o(), g.modelAlpha = 0, this.model.changeModelAlpha(0), this.model.skybox.material.uniforms.opacity.value = 0, e.floor.enter(p.PANORAMA), x.start(w.uniform(this.model.skybox, "opacity", a.skyboxOpacity), s * a.skyboxOpacityLength, null, a.skyboxOpacityDelay, null, "skyReOpac"), this.model.fadePanoMarkers(a.markerOpacity), x.start(w.property(this.reticule.material, "opacity", 0), s, null, 0, null, "retReOpac"), x.start(function() {}, s, function() {
          this.mode = p.PANORAMA, this.startAllMattertags(n)
        }.bind(this), 0, null, "waitModeFlip"), void((this.mode = p.TRANSITIONING)))
      }, n.prototype.pause = function() {
        this.paused = !0
      }, n.prototype.play = function() {
        this.paused = !1
      }, n.prototype.updateAspect = function(e) {
        var t = this.controls[p.FLOORPLAN].object;
        t.top = t.right / e, t.bottom = t.left / e;
        for (var i in this.controls) {
          this.controls[i].object.aspect = e, this.controls[i].object.updateProjectionMatrix()
        };
        if (this.control) {
          var n = this.control.object;
          this.camera.projectionMatrix.copy(n.projectionMatrix)
        }
      }, n.prototype.update = function(e) {
        var t = this.control;
        t && (t.update(e), this.quaternion.copy(t.object.quaternion), this.position.copy(t.object.position), this.target.copy(t.target), t.object.updateProjectionMatrix(), this.camera.projectionMatrix.copy(t.object.projectionMatrix)), this.camera.position.copy(this.position), this.camera.quaternion.copy(this.quaternion), this.hasChanged() && (this.lastChangeTime = Date.now(), !this.mouseDown && this.containsMouse && this.updateIntersect()), this.updateLabelDisplay(), this.updateLabelVisibility(), this.reticule.update(), this.path.update(), this.spider.update();
        for (var i in this.model.mattertags) {
          this.model.mattertags[i].update(this.mode, this.camera, this.currentPano, this.flying)
        }
      }, n.prototype.hasChanged = function() {
        if (!this.previousState) {
          return this.previousState = {
            position: this.position.clone(),
            quaternion: this.quaternion.clone(),
            mouse: this.mouse.clone()
          }, !0
        };
        var e = this.position.equals(this.previousState.position) && this.quaternion.equals(this.previousState.quaternion) && this.mouse.equals(this.previousState.mouse);
        return this.previousState.position.copy(this.position), this.previousState.quaternion.copy(this.quaternion), this.previousState.mouse.copy(this.mouse), !e
      }, n.prototype.startAllMattertags = function(e) {
        this.model.showingMattertags = g_modeldata.model.fdageTag, this.showAllMattertags(g.mattertags.startup.fadeInDuration, g.mattertags.startup.fadeInDelay), e && setTimeout(function() {
          this.activateTag(this.model.getTagBySid(e))
        }.bind(this), g.mattertags.startup.fadeInDuration / 2), this.director.autoTour()
      }, n.prototype.showAllMattertags = function(e, t) {
        if (this.model.showingMattertags) {
          for (var i in this.model.mattertags) {
            var n = this.model.mattertags[i];
            n.show(e || 0, t || 0)
          }
        }
      }, n.prototype.hideAllMattertags = function(e, t) {
        for (var i in this.model.mattertags) {
          var n = this.model.mattertags[i];
          n.hide(e || 0, t || 0), n === this.activeTag && this.dismissActiveTag()
        }
      }, n.prototype.toggleObscuredMattertags = function(e, t, i, n) {
        if (g.mattertags.visibility.hideObscured) {
          for (var r in this.model.mattertags) {
            var o = this.model.mattertags[r];
            o.obscured[e] && !o.obscured[t] ? o.show(i || 0, n || 0) : !o.obscured[e] && o.obscured[t] && (o.hide(i || 0, n || 0), o === this.activeTag && this.dismissActiveTag())
          }
        }
      }, n.prototype.activateTag = function(e, t) {
        t = t || f.EXAMINE, this.activeTag = e, this.activeTag.setHoverState(t === f.EXAMINE), this.tagState = t, this.reticule.hide()
      }, n.prototype.dismissActiveTag = function() {
        this.activeTag.setFreeState(!0), this.activeTag = null, this.tagState = f.IDLE
      }, n.prototype.clickedOnTag = function() {
        var e = this.isTouchEvent ? this.intersectTag : this.activeTag;
        if (e.isPanoTag()) {
          var t = this.optionsFromString(e.link.URL.substr(4));
          return void((t && t.mode === p.PANORAMA && this.path.warpToArbitraryPano(t.pano, t.quaternion)))
        };
        this.isTouchEvent ? this.tagState === f.IDLE ? this.activateTag(this.intersectTag, f.EXAMINE) : this.tagState === f.EXAMINE && (this.intersectTag !== this.activeTag ? (this.dismissActiveTag(), this.activateTag(this.intersectTag, f.EXAMINE)) : this.dismissActiveTag()) : this.tagState !== f.EXAMINE ? (this.intersectTag.setHoverState(!0), this.reticule.hide(), this.activeTag = this.intersectTag, this.activeTag.examineMattertag(this, this.activateTag), this.tagState = f.EXAMINE) : (x.cancel(this.lookTransition), this.dismissActiveTag())
      }, n.prototype.intersectMattertag = function(e) {
        var t = e || this.mouse,
          i = null,
          n = this.mattertagDiscs.filter(function(e) {
            return e.parent.visible
          });
        if (n.length > 0) {
          var o = this.model.floorList.reduce(function(e, t) {
              return t.hidden ? e : e.concat(t.collider.children)
            }, n),
            a = new r.Vector3(t.x, t.y, -1).unproject(this.camera);
          this.raycaster["set"](a, this.getMouseDirection(t));
          var s = this.raycaster.intersectObjects(o);
          s.length > 0 && -1 !== n.indexOf(s[0].object) && (i = s[0].object.tag)
        };
        return i === this.intersectTag ? i : (this.intersectTag = i, this.isTouchEvent || x.isRunning(this.lookTransition) || (this.activeTag && i !== this.activeTag && (this.tagState === f.BROWSE || this.tagState === f.EXAMINE && i) && this.dismissActiveTag(), i && i !== this.activeTag && (i.listeners("enter").length < 1 && (i.on("enter", function(e) {
          this.hoveredTag = e
        }.bind(this)), i.on("leave", function(e) {
          this.hoveredTag = null
        }.bind(this))), this.activateTag(i, f.BROWSE))), i)
      }, n.prototype.closestMattertagInDirection = function(e) {
        return this.rankedMattertagInDirection(e)
      }, n.prototype.rankedMattertagInDirection = function() {
        var e = [],
          t = [],
          i = new r.Vector3,
          n = new r.Vector3,
          o = new r.Vector3;
        return function(r, a) {
          var s = 0;
          t.length = 0;
          for (var h = 0; h < this.closestMattertags.length; h++) {
            var l = this.closestMattertags[h];
            n.copy(l.position), n.add(l.discPosition), i.copy(this.position), i.sub(n).negate(), i.normalize();
            var c = i.dot(a);
            if (c >= 0) {
              o.copy(n), o.project(this.camera);
              var u = this.intersectMattertag(o);
              if (u) {
                if (s >= e.length) {
                  for (var d = 0; 64 > d; d++) {
                    e.push({
                      tag: l,
                      dot: c
                    })
                  }
                };
                var p = e[s];
                p.tag = l, p.dot = c, p.position = b.projectPositionToCanvas(n, this.camera), t.push(p), s++
              }
            }
          };
          return t.sort(function(e, t) {
            return e.dot > t.dot ? -1 : e.dot < t.dot ? 1 : 0
          }), r < t.length ? t[r].tag : null
        }
      }(), n.prototype.updateClosestTags = function() {
        var e = new r.Vector3,
          t = 30;
        return function() {
          this.closestMattertags || (this.closestMattertags = []), this.closestMattertags.length = 0;
          var i = this.model.mattertags;
          if (i) {
            for (var n in i) {
              if (i.hasOwnProperty(n)) {
                var r = i[n],
                  o = r.position;
                e.copy(this.position), e.sub(o).negate();
                var a = e.lengthSq();
                t > a && this.closestMattertags.push(r)
              }
            }
          }
        }
      }(), n.prototype.updateIntersect = function() {
        this.intersectMattertag() || (this.intersect = this.getMouseIntersect(), this.intersect && this.updateClosestPano(this.intersect), this.closestPano || this.closestPanoInDirection(this.getMouseDirection()) ? (this.reticule.updatePosition(this.position, this.intersect), g.navigation.panoScores && !g.navigation.mouseDirection && this.closestPanoInDirection(this.getDirection())) : this.reticule.hide())
      }, n.prototype.getMouseDirection = function(e) {
        e = e || this.mouse;
        var t = new r.Vector3(e.x, e.y, -1).unproject(this.camera),
          i = new r.Vector3(e.x, e.y, 1).unproject(this.camera);
        return i.sub(t).normalize()
      }, n.prototype.getMouseIntersect = function(e, t) {
        e = e || this.mouse.clone(), t = t || this.model.floorList.reduce(function(e, t) {
          return t.hidden ? e : e.concat(t.collider.children)
        }, this.mode === p.PANORAMA ? this.panoMarkers : []);
        var i = new r.Vector3(e.x, e.y, -1).unproject(this.camera);
        this.raycaster["set"](i, this.getMouseDirection(e));
        var n = this.raycaster.intersectObjects(t);
        if (0 === n.length) {
          return null
        };
        var o = n[0];
        if (o.face) {
          o.normal = o.face.normal.applyQuaternion(o.object.quaternion);
          var a = this.position.clone().sub(o.point);
          a.dot(o.normal) < 0 && o.normal.negate(), o.onFloor = this.currentPano ? o.point.y < this.position.y - 0.5 * this.currentPano.height : o.point.y < this.position.y - 0.5, o.horizontal = o.normal.y > 0.8
        };
        return o
      }, n.prototype.updateClosestPano = function(e) {
        var t = [];
        this.mode === p.PANORAMA ? (t.push(c.filters.not(this.currentPano)), t.push(c.filters.inFloorDirection(this.currentPano.floorPosition, this.getDirection(), 0.25)), t.push(c.filters.isNeighbourPanoTo(this.currentPano)), t.push(c.filters.isCloseEnoughTo(e.point, g.panoFloorClickRadius)), t.push(c.filters.isNotBehindNormal(e.point, e.normal))) : (t.push(c.filters.isOnVisibleFloor()), this.mode !== p.FLOORPLAN && t.push(c.filters.inDirection(this.position, this.getDirection(), 0.25)));
        var i = this.model.panos.find(t, [c.sortFunctions.floorDistanceToPoint(e.point)]),
          n = !this.director.describe().tourIsPlaying;
        i != this.closestPano && (this.mode !== p.TRANSITIONING && (this.closestPano && n && this.closestPano.hoverOff(this.mode), i && n && i.hoverOn(this.mode)), this.closestPano = i)
      }, n.prototype.dollhouseMode = function(e, t) {
        this.emit("mode.changing", this.mode, p.DOLLHOUSE), this.mode = p.DOLLHOUSE, this.controls[p.DOLLHOUSE].reset();
        var i = new r.Vector3(this.model.center.x, 0, this.model.center.z),
          n = new r.Vector3(15, 10, 15);
        if (e && t) {
          var o = new r.Vector3(0, 0, -1).applyQuaternion(t);
          this.raycaster["set"](e.clone(), o.clone());
          var a = this.raycaster.intersectObjects([this.scene.plane]);
          if (a.length) {
            i.copy(a[0].point);
            n.copy(e)
          }
        };
        this.controls[p.DOLLHOUSE].resetRanges(0, !0), this.controls[p.DOLLHOUSE].target.copy(i), this.cameras[p.DOLLHOUSE].position.copy(n), g.modelAlpha = 1, this.model.skybox.material.uniforms.opacity.value = 0, this.model.changeModelAlpha(1)
      }, n.prototype.insideMode = function(e, t) {
        var i = t || null;
        if (this.mode !== p.PANORAMA && this.mode !== p.TRANSITIONING) {
          var n = this.model.currentFloor ? [c.filters.atFloor(this.model.currentFloor)] : [];
          e = e || this.currentPano || this.model.panos.find(n, [c.sortFunctions.distanceToPoint(this.control.target)]), this.flyToNewMode(p.PANORAMA, {
            pano: e,
            callback: i
          })
        }
      }, n.prototype.insideModeWithFlyIn = function(e, t, i, n) {
        if (this.dollhouseMode(), this.update(0), e) {
          t || (t = e.position);
          var rr = this.control.maxDistance;
          this.fitDollhouse(e, t, i || this.control.object.quaternion), setTimeout(function() {
            this.control && (this.control.maxDistance = rr);
            var t = {
                pano: e,
                quaternion: i,
                callback: function() {
                  this.startAllMattertags(n)
                }.bind(this)
              },
              o = this.flyToNewMode(p.PANORAMA, t);
            Array.isArray(o) && 0 !== o.length || this.startAllMattertags()
          }.bind(this), 3e3)
        }
      }, n.prototype.fitDollhouse = function(e, t, i) {
        var n = new r.Vector3(0, 0, -1).applyQuaternion(i),
          o = n.clone().add(e.position);
        this.control.target.copy(o);
        var a = new r.Vector3(1, 0, 0).applyQuaternion(i),
          s = new r.Vector3(0, 1, 0),
          h = a.clone().applyAxisAngle(s, Math.PI / 2),
          l = this.model.boundingBox.max.clone(),
          c = this.model.boundingBox.min.clone(),
          u = [new r.Vector3(l.x, 0, l.z).sub(e.position), new r.Vector3(l.x, 0, c.z).sub(e.position), new r.Vector3(c.x, 0, l.z).sub(e.position), new r.Vector3(c.x, 0, c.z).sub(e.position)],
          d = 0,
          p = 0,
          f = 0;
        u.forEach(function(e, t, i) {
          var n = Math.abs(e.dot(a)),
            r = e.dot(h);
          n > d && (d = n, p = r), r > f && (f = r)
        });
        var m = Math.max(Math.abs(new r.Vector3(0, l.y, 0).sub(e.position).dot(s)), Math.abs(new r.Vector3(0, c.y, 0).sub(e.position).dot(s))),
          g = t.clone().add(h.clone().multiplyScalar(p)),
          v = t.clone().add(h.clone().multiplyScalar(f));
        p = d / Math.tan(this.control.object.fov / 2 * this.control.object.aspect * (Math.PI / 180)), f = m / Math.tan(this.control.object.fov / 2 * (Math.PI / 180)), p = Math.max(p, 10), f = Math.max(f, 10);
        var y = t.clone().sub(g.clone().add(n.clone().multiplyScalar(-p))).length(),
          b = t.clone().sub(g.clone().add(n.clone().multiplyScalar(-f))).length();
        this.control.maxDistance = this.scene.skybox.geometry.boundingSphere.radius - 1, y >= b ? this.control.object.position["set"](0, 6, 0).add(g).add(n.multiplyScalar(1.1 * -p)) : this.control.object.position["set"](0, 6, 0).add(v).add(n.multiplyScalar(1.1 * -f))
      }, n.prototype.floorplanMode = function() {
        this.emit("mode.changing", this.mode, p.FLOORPLAN), this.mode = p.FLOORPLAN;
        var e = this.cameras[p.FLOORPLAN],
          t = this.controls[p.FLOORPLAN];
        if (t.reset(), this.model.heroImage && this.model.heroImage.metadata) {
          var i = e.position.clone().sub(t.target),
            n = b.convertWorkshopQuaternion(this.model.heroImage.metadata.camera_quaternion),
            o = b.convertWorkshopVector(this.model.heroImage.metadata.camera_position),
            a = this.model.heroImage.metadata.ortho_zoom,
            s = new r.Vector3(-1, 0, 0).applyQuaternion(n).normalize(),
            h = Math.atan2(s.x, s.z);
          t.target.copy(o);
          var l = i.length();
          t.offset.x = l * Math.sin(h), t.offset.y = 0, t.offset.z = l * Math.cos(h), e.position.copy(t.target).add(t.offset), e.quaternion.copy(n), t.currentScale = a / 4 / (window.innerWidth / window.innerHeight), t.absoluteScale = t.currentScale, t.update()
        } else {
          var c = new r.Vector3(this.model.center.x, 0, this.model.center.z),
            u = new r.Vector3(this.model.center.x, 10, this.model.center.z);
          t.target.copy(c), e.position.copy(u)
        };
        g.modelAlpha = 1, this.model.skybox.material.uniforms.opacity.value = 0, this.model.changeModelAlpha(1), this.model.toggleStartFloors()
      }, n.prototype.flyToPano = function(e, t, i) {
        if (this.mode !== p.PANORAMA) {
          return void(this.flyToNewMode(p.PANORAMA, {
            pano: e
          }))
        };
        if (this.model.waitForPanoLoad(e, "high"), !e.isLoaded("low")) {
          return void(e.loadCube("low", function() {
            this.flyToPano(e, t, i)
          }.bind(this)))
        };
        var n = function() {
          this.updateClosestTags(), i && i()
        }.bind(this);
        this.currentPano || (this.currentPano = e, this.path.placeCpm(), this.path.fadeOutCpm(g.path.fadeOutTime), this.spider.draw());
        var o = Math.min(this.currentPano.position.distanceTo(e.position), g.transition.flytimeMaxDistanceThreshold) * g.transition.flytimeDistanceMultiplier + g.transition.flyTime;
        if (g.transition.flySpeed > 0.01 && (f = 1e3 * this.currentPano.position.distanceTo(e.position) / g.transition.flySpeed), t) {
          x.cancel(this.lookTransition), o *= g.transition.aimSlowFactor;
          var a = this.control.object.quaternion.clone(),
            s = (new r.Matrix4).lookAt(e.position, t, new r.Vector3(0, 1, 0)),
            h = (new r.Quaternion).setFromRotationMatrix(s),
            l = m.FORWARD.clone().applyQuaternion(a),
            c = m.FORWARD.clone().applyQuaternion(h),
            u = l.angleTo(c),
            d = 1 * Math.sqrt(u) / g.mattertags.navigate.rotateSpeedFactor * 1e3,
            f = e === this.currentPano ? d : o,
            v = a.clone(),
            y = new r.Vector3;
          this.lookTransition = x.start(function(e) {
            v.copy(a), w.quaternion(v, h)(e), y["set"](0, 0, -1).applyQuaternion(v).add(this.control.object.position), this.control.lookAt(y)
          }.bind(this), f, n, 0, _[g.transition.movementEasing])
        };
        if (e !== this.currentPano && !this.flying) {
          if (this.flying = !0, this.emit("pano.chosen", e, this.currentPano), this.model.setProjectedPanos(this.currentPano, e), g.mattertags.visibility.hideObscured) {
            for (var b in this.model.mattertags) {
              this.model.mattertags[b].obscuredAtPano(e)
            };
            this.toggleObscuredMattertags(this.currentPano.id, e.id, o)
          };
          x.start(w.uniform(this.model.skybox, "progress", 1), o, null, 0, _[g.transition.blendEasing], "skyFly"), x.start(w.allUniforms(this.model.chunks, "progress", 1), o, null, 0, _[g.transition.blendEasing], "chunkFly"), x.start(w.vector(this.cameras[p.PANORAMA].position, e.position), o, function() {
            this.flying = !1, this.currentPano.exit(), e.enter(), this.currentPano = e, this.path.hasBeenIndoors = !0, this.path.placeCpm(), this.path.fadeOutCpm(g.path.fadeOutTime), this.spider.draw(), t || n()
          }.bind(this), 0, _[g.transition.movementEasing], "camFly")
        }
      }, n.prototype.flyToPanoClosestToMouse = function() {
        if (Date.now() - this.mouseLastMoveTime > 50 && (this.intersect = this.getMouseIntersect(), this.intersect && this.updateClosestPano(this.intersect)), this.closestPano) {
          return this.flyToPano(this.closestPano)
        };
        var e = this.getMouseDirection();
        this.flyDirection(e) || this.flyToPano(this.currentPano)
      }, n.prototype.flyDirection = function(e, t, i) {
        var n = this.closestPanoInDirection(e, t, i);
        return n ? (this.flyToPano(n), !0) : (this.bump(e), !1)
      }, n.prototype.closestPanoInDirection = function(e, t, i) {
        t = void(0) !== t ? t : 0.75;
        var n = i ? "angle" : "direction",
          r = this.model.panos.findByScore([c.filters.inPanoDirection(this.position, e, t), c.filters.isNeighbourPanoTo(this.currentPano), c.filters.not(this.currentPano)], [c.scoreFunctions.distanceSquared(this.currentPano), c.scoreFunctions[n](this.position, e)]);
        return r
      }, n.prototype.rankedPanoInDirection = function(e, t, i, n) {
        e || (e = 0), i = void(0) !== i ? i : 0.75;
        var r = n ? "angle" : "direction",
          o = this.model.panos.findRankedByScore(e, [c.filters.inPanoDirection(this.position, t, i), c.filters.isNeighbourPanoTo(this.currentPano), c.filters.not(this.currentPano)], [c.scoreFunctions.distanceSquared(this.currentPano), c.scoreFunctions[r](this.position, t)]);
        return o
      }, n.prototype.bump = function(e) {
        if (this.mode === p.PANORAMA && !this.flying) {
          var t, i, n, r = g.transition,
            o = (r.flytimeMaxDistanceThreshold * r.flytimeDistanceMultiplier + r.flyTime) / 8,
            a = this.camera.getWorldDirection().dot(e),
            s = Math.abs(a) > 0.5;
          if (s) {
            t = function() {
              x.start(w.property(this.cameras[p.PANORAMA], "zoom", a > 0 ? 1.04 : 0.96), o, i, 0, _.easeInOutSine, "bumpZStart")
            }.bind(this), i = function() {
              x.start(w.property(this.cameras[p.PANORAMA], "zoom", 1), 5 * o, n, 0, _.easeInOutSine, "bumpZRelax")
            }.bind(this)
          } else {
            var h = this.camera.position.clone(),
              l = e.clone();
            this.raycaster["set"](h, l);
            var c = this.model.floorList.reduce(function(e, t) {
                return e.concat(t.collider.children)
              }, []),
              u = this.raycaster.intersectObjects(c),
              d = u.length > 0 ? u[0].distance / 25 : 0.04,
              f = h.clone().add(l.multiplyScalar(d));
            t = function() {
              x.start(w.vector(this.cameras[p.PANORAMA].position, f), o, i, 0, _.easeInOutSine, "bumpTStart")
            }.bind(this), i = function() {
              x.start(w.vector(this.cameras[p.PANORAMA].position, h), 5 * o, n, 0, _.easeInOutSine, "bumpTRelax")
            }.bind(this)
          };
          n = function() {
            this.flying = !1
          }.bind(this), this.flying = !0, t()
        }
      }, n.prototype.changeFloor = function(e) {
        if (this.mode === p.PANORAMA) {
          var t = this.director.history.reversePano(e);
          t ? this.flyToPano(t) : this.changeFloorByScore(e)
        } else {
          this.model.setFloor(this.model.nextFloor(e) || this.model.currentFloor)
        }
      }, n.prototype.changeFloorByScore = function(e) {
        var t = this.model.nextFloor(e);
        if (!t) {
          return void(P.debug(""))
        };
        var i = this.model.panos.findByScore([c.filters.atFloor(t)], [c.scoreFunctions.distance(this.currentPano), c.scoreFunctions.direction(this.position, new r.Vector3(0, e, 0)), c.scoreFunctions.penalizeHeightDifferenceUnder(this.position, 0.5)]);
        if (i) {
          this.director.history.push(e, this.currentPano);
          this.flyToPano(i)
        }
      }, n.prototype.gotoFloor = function(e) {
        var t = e - this.model.currentFloor.floorIndex;
        this.changeFloor(t)
      }, n.prototype.getDirection = function(e) {
        return e = e ? e : (new r.Vector3).copy(m.FORWARD), e.applyQuaternion(this.camera.quaternion)
      }, n.prototype.flyToSameMode = function(e, t, i, n) {
        var o = [];
        if (this.mode === p.TRANSITIONING) {
          return o
        };
        var a = i || !1;
        if (e && !e.isLoaded("low")) {
          return this.model.waitForPanoLoad(e, "high"), e.loadCube("low", function() {
            o = this.flyToSameMode(e, t, i, n)
          }.bind(this)), o
        };
        var s = function() {
            this.updateClosestTags(), n && n()
          }.bind(this),
          h = g[this.mode],
          l = void(0) !== t ? t : h.transitionTime,
          c = new r.Vector3,
          u = new r.Vector3;
        if (this.mode === p.PANORAMA) {
          o.push(x.start(function() {}, l, function() {
            this.mode = p.PANORAMA, s()
          }.bind(this), 0, null, "waitPanoDone"))
        } else {
          if (this.mode === p.DOLLHOUSE) {
            if (a) {
              var d = new r.Vector3(0, 1, 0);
              this.controls[p.DOLLHOUSE].resetRanges(1, !0), this.model.warpDestFloors(i), u.copy(i.position);
              var f = new r.Vector3(0, 0, -1).applyQuaternion(i.quaternion),
                m = new r.Raycaster(u.clone(), f.clone(), 0, 1 / 0),
                v = m.intersectObjects(this.model.colliders),
                y = 3;
              v.length ? (c.copy(v[0].point), y = 0.75 * u.distanceTo(c)) : (c.copy(f).multiplyScalar(3).add(u));
              var b = (new r.Matrix4).lookAt(u, c, d),
                M = (new r.Euler).setFromRotationMatrix(b, g.warp.eOrder),
                E = c.distanceTo(u),
                S = (new r.Matrix4).lookAt(this.cameras[p.DOLLHOUSE].position, this.controls[p.DOLLHOUSE].target, d),
                T = (new r.Euler).setFromRotationMatrix(S, g.warp.eOrder),
                A = this.cameras[p.DOLLHOUSE].position.distanceTo(this.controls[p.DOLLHOUSE].target);
              this.controls[p.DOLLHOUSE].resetRanges(Math.min(A, y), !0);
              var L = new r.Euler(M.x - T.x, M.y - T.y, M.z - T.z, g.warp.eOrder);
              L.y = L.y > Math.PI ? L.y -= 2 * Math.PI : L.y < -Math.PI ? L.y += 2 * Math.PI : L.y, this.path.burnsDir = Math.sign(L.y);
              var C = new r.Euler(0, 0, 0, g.warp.eOrder),
                R = new r.Vector3;
              o.push(x.start(w.vector(this.controls[p.DOLLHOUSE].target, c), l, null, g.flydown.movementDelay, _[g.flydown.movementEasing])), o.push(x.start(function(e, t) {
                C.x = T.x + e * L.x, C.y = T.y + e * L.y, C.z = T.z + e * L.z;
                var i = A + e * (E - A);
                R["set"](0, 0, i).applyEuler(C).add(this.controls[p.DOLLHOUSE].target), this.cameras[p.DOLLHOUSE].position.copy(R).add(this.model.position)
              }.bind(this), l, null, g.flydown.movementDelay, _[g.flydown.movementEasing])), o.push(x.start(function(e, t) {
                this.controls[p.DOLLHOUSE].update(), this.quaternion.copy(this.cameras[p.DOLLHOUSE].quaternion), this.position.copy(this.cameras[p.DOLLHOUSE].position)
              }.bind(this), l, null, g.flydown.movementDelay, _[g.flydown.movementEasing])), o.push(x.start(function() {}, l, function() {
                this.mode = p.DOLLHOUSE, s()
              }.bind(this)))
            } else {
              if (this.path.placeCpm(), this.path.fadeInCpm(g.path.fadeInTime), i) {
                this.model.warpDestFloors(i);
                var I = this.cameras[p.FLOORPLAN],
                  D = this.controls[p.FLOORPLAN],
                  O = D.target.clone(),
                  k = i.position.clone().sub(O),
                  B = I.position.clone().sub(D.target),
                  F = B.length(),
                  N = new r.Vector3(-1, 0, 0).applyQuaternion(i.quaternion).normalize(),
                  U = Math.atan2(D.offset.x, D.offset.z),
                  V = Math.atan2(N.x, N.z),
                  z = D.absoluteScale,
                  G = i.ortho_zoom / 4 / (window.innerWidth / window.innerHeight);
                o.push(x.start(function(e, t) {
                  D.target.copy(k).multiplyScalar(e).add(O);
                  var i = U + (V - U) * e;
                  D.offset.x = F * Math.sin(i), D.offset.z = F * Math.cos(i), I.position.copy(D.target).add(D.offset), D.absoluteScale = z + e * (G - z), D.update(), this.quaternion.copy(I.quaternion), this.position.copy(I.position), this.target.copy(D.target), this.camera.projectionMatrix.copy(I.projectionMatrix)
                }.bind(this), l, null, 0, _[g.flydown.movementEasing])), o.push(x.start(function() {}, l, function() {
                  this.mode = p.FLOORPLAN, s()
                }.bind(this)))
              }
            }
          }
        };
        return this.mode = p.TRANSITIONING, o
      }, n.prototype.flyToNewMode = function(e, t) {
        t = t || {};
        var i = t.pano,
          n = t.duration,
          o = t.warpDest,
          a = t.callback,
          s = t.force,
          h = t.quaternion,
          l = [];

        function xst1(t) {
          if (g_roof.indexOf(t.name) > -1) {
            t.visible = false
          }
        }

        function xst2(t) {
          if (g_roof.indexOf(t.name) > -1) {
            t.visible = true
          }
        }
        if (g_roof != null && "undefined" != typeof t.warpDest) {
          if (t.warpDest.camera_mode == "dollhouse" && t.warpDest.noface) {
            this.model.chunks.map(xst1)
          } else {
            this.model.chunks.map(xst2)
          }
        };
        if (e === this.mode) {
          return s && (l = this.flyToSameMode(i, n, o, a)), l
        };
        if (this.mode === p.TRANSITIONING) {
          return l
        };
        var c = o || !1;
        if (i && this.model.waitForPanoLoad(i, "high"), i && !i.isLoaded("low")) {
          return i.loadCube("low", function() {
            l = this.flyToNewMode(e, t)
          }.bind(this)), l
        };
        var u = this.mode;
        var d = this.cameras[e];
        t = v.deepExtend({}, g[e], g[u + "-" + e]);
        var f = void(0) !== n ? n : t.transitionTime;
        if (this.emit("mode.changing", u, e), d["set"](i, h), e === p.PANORAMA) {
          if (g_TextIconMesh.length > 0) {
            for (var ii = 0; ii < g_TextIconMesh.length; ++ii) {
              g_TextIconMesh[ii].visible = true
            }
          };
          if (setTimeout(function() {
              i.floor.enter(e), this.toggleObscuredMattertags(this.mode, i.id, f)
            }.bind(this), f / 2), this.path.fadeOutCpm(g.path.fadeOutTime), g.mattertags.visibility.hideObscured) {
            this.model.setSide(r.DoubleSide), this.flying = !0;
            for (var m in this.model.mattertags) {
              this.model.mattertags[m].obscuredAtPano(i)
            };
            this.model.setSide(r.FrontSide)
          }
        } else {
          if (e === p.DOLLHOUSE) {
            if (g_TextIconMesh.length > 0) {
              for (var ii = 0; ii < g_TextIconMesh.length; ++ii) {
                g_TextIconMesh[ii].visible = false
              }
            };
            if (c && (this.model.stayPut = !0), o ? (this.controls[p.DOLLHOUSE].resetRanges(1, !0), this.model.warpDestFloors(o)) : this.model.toggleAllFloors(!0), this.path.placeCpm(), this.path.fadeInCpm(g.path.fadeInTime), c) {
              var y = new r.Vector3(this.model.center.x, 0, this.model.center.z),
                b = new r.Vector3(15, 10, 15),
                M = new r.Vector3(0, 0, -1).applyQuaternion(o.quaternion),
                E = new r.Raycaster(o.position.clone(), M.clone(), 0, 1 / 0),
                S = E.intersectObjects([this.scene.plane]);
              S.length ? (y.copy(S[0].point), b.copy(o.position), this.controls[p.DOLLHOUSE].resetRanges(0.75 * b.distanceTo(y), !0)) : (this.controls[p.DOLLHOUSE].resetRanges(3, !0)), this.controls[p.DOLLHOUSE].target.copy(y), d.position.copy(b).add(this.model.position), this.controls[p.DOLLHOUSE].update()
            }
          } else {
            if (g_TextIconMesh.length > 0) {
              for (var ii = 0; ii < g_TextIconMesh.length; ++ii) {
                g_TextIconMesh[ii].visible = false
              }
            };
            if (this.path.placeCpm(), this.path.fadeInCpm(g.path.fadeInTime), o) {
              this.model.warpDestFloors(o);
              var T = this.cameras[p.FLOORPLAN],
                A = this.controls[p.FLOORPLAN],
                L = T.position.clone().sub(A.target),
                C = new r.Vector3(-1, 0, 0).applyQuaternion(o.quaternion).normalize(),
                R = Math.atan2(C.x, C.z);
              A.target.copy(o.position);
              var I = L.length();
              A.offset.x = I * Math.sin(R);
              A.offset.y = 0;
              A.offset.z = I * Math.cos(R);
              T.position.copy(A.target).add(A.offset); {
                A.target.clone().sub(d.position)
              }
              d.quaternion.copy(o.quaternion);
              A.currentScale = o.ortho_zoom / 4 / (window.innerWidth / window.innerHeight);
              A.absoluteScale = A.currentScale;
              A.update()
            } else {
              this.model.currentFloor.enter(e)
            }
          }
        };
        return l.push(x.start(w.vector(this.position, d.position), f, null, g.flydown.movementDelay, _[g.flydown.movementEasing])), l.push(x.start(w.quaternion(this.quaternion, d.quaternion), f * t.rotationDuration, null, t.rotationDelay, _[g.flydown.rotationEasing])), l.push(x.start(w.matrix4(this.camera.projectionMatrix, d.projectionMatrix), f * t.cameraMatrixDuration, null, t.cameraMatrixDelay, t.cameraMatrixEase)), l.push(x.start(w.property(g, "modelAlpha", t.modelAlpha, this.model.changeModelAlpha.bind(this.model)), f * t.modelAlphaLength, null, t.modelAlphaDelay)), l.push(x.start(w.uniform(this.model.skybox, "opacity", t.skyboxOpacity), f * t.skyboxOpacityLength, null, t.skyboxOpacityDelay)), l.push(x.start(w.property(this.reticule.material.uniforms.opacity, "value", 0), f)), l.push(x.start(function() {}, f, function() {
          u === p.PANORAMA && e !== p.PANORAMA ? this.currentPano.exit() : u !== p.PANORAMA && e === p.PANORAMA && (this.currentPano.enter(), this.path.hasBeenIndoors = !0, this.path.placeCpm(), this.path.fadeOutCpm(g.path.fadeOutTime), this.spider.draw(), this.flying = !1), u === p.DOLLHOUSE && this.controls[p.DOLLHOUSE].resetRanges(), this.mode = e, c && u !== p.PANORAMA && e === p.PANORAMA ? this.path.warpToPano(a) : a && (this.updateClosestTags(), a())
        }.bind(this))), this.mode = p.TRANSITIONING, l
      }, n.prototype.warpTo = function(e) {
        return this.path.selectWarpHeroLocation(e) ? this.flying ? (void(this.director.actionComplete())) : (this.path.brushToWarpPano(), void(this.path.warpToPano(function() {
          this.path.discardSlow(), this.director.actionComplete("_wtpDel")
        }.bind(this)))) : (void(this.director.actionComplete()))
      }, n.prototype.aimTourCamera = function(e) {
        this.warpTo(e)
      }, n.prototype.tourInterlude = function() {
        this.path.discardSlow();
        this.path.waitNextStep(function() {
          this.director.describe().pendingHalt ? this.director.detourComplete("_intDel") : this.director.actionComplete("_intDel")
        }.bind(this))
      }, n.prototype.isInMode = function() {
        for (var e = 0; e < arguments.length; e++) {
          if (this.mode === arguments[e]) {
            return !0
          }
        };
        return !1
      }, n.prototype.serialize = function() {
        return [p.toInt(this.mode), this.currentPano ? this.currentPano.id : "", this.position.x.toFixed(4), this.position.y.toFixed(4), this.position.z.toFixed(4), this.quaternion.x.toFixed(4), this.quaternion.y.toFixed(4), this.quaternion.z.toFixed(4), this.quaternion.w.toFixed(4)].join(",")
      }, n.prototype.optionsFromString = function(e) {
        var t = e.split(",");
        try {
          var i = {
            mode: p.fromInt(t[0]),
            pano: this.model.panos["get"](t[1]),
            position: new r.Vector3(parseFloat(t[2]), parseFloat(t[3]), parseFloat(t[4])),
            quaternion: new r.Quaternion(parseFloat(t[5]), parseFloat(t[6]), parseFloat(t[7]), parseFloat(t[8]))
          };
          return i
        } catch (n) {
          return null
        }
      }, n.prototype.setSize = function(e, t) {
        this.aspect = e / t, this.cameras.dollhouse.aspect = this.aspect, this.cameras.dollhouse.updateProjectionMatrix(), this.cameras.panorama.aspect = this.aspect, this.cameras.panorama.updateProjectionMatrix(), this.cameras.floorplan.top = g.orthoBase / this.aspect, this.cameras.floorplan.bottom = -g.orthoBase / this.aspect, this.cameras.floorplan.updateProjectionMatrix()
      }, t.exports = n
    }).call(this, "/js/player.js")
  }

  function _$af270723(e, t, i) {
    "use strict";
    ! function() {
      if ("performance" in window == !1 && (window.performance = {}), Date.now = Date.now || function() {
          return (new Date).getTime()
        }, "now" in window.performance == !1) {
        var e = Date.now();
        performance.timing && performance.timing.navigationStart && (e = performance.timing.navigationStart), window.performance.now = function() {
          return Date.now() - e
        }
      }
    }();
    var n = n || {};
    ! function(e) {
      var t = 0,
        i = {
          Message: 0,
          Response: 1
        },
        n = function(t) {
          var i = t.origin || t.originalEvent.origin;
          e.receiveMessage(i, t.data, t.source)
        },
        r = function(e, t, i, n) {
          var r = {
            uid: e,
            message: t,
            type: i,
            waitForResponse: n
          };
          return r
        },
        o = {},
        a = {},
        s = null;
      window.addEventListener("message", n, !1), e.setReceiver = function(e) {
        s = e
      }, e.sendMessage = function(e, n, a, s) {
        var h = t++;
        if (s) {
          var l = {
            targetWindow: e,
            uid: h,
            timestamp: performance.now(),
            onResponse: s
          };
          o[h] = l
        };
        var c = r(h, a, i.Message, s ? !0 : !1);
        e.postMessage(c, n)
      }, e.receiveMessage = function(e, t, n) {
        if (t) {
          if (t.type === i.Message && t.waitForResponse) {
            var r = {
              uid: t.uid,
              timestamp: performance.now(),
              sourceWindow: n
            };
            a[t.uid] = r
          };
          if (t.type === i.Response) {
            var h = t.uid,
              l = o[h];
            o[h] = null, l.onResponse && l.onResponse(t.message)
          }
        };
        s && s(e, t.message, t.uid)
      }, e.respondToMessage = function(e, t) {
        var n = a[e];
        if (n && n.sourceWindow) {
          var o = r(e, t, i.Response, !1);
          n.sourceWindow.postMessage(o, "*"), a[o.uid] = null
        }
      }
    }(n), "undefined" != typeof t && (t.exports = n)
  }

  function _$af270734(e, t, i) {
    (function(i) {
      "use strict";

      function n(e, t) {
        this.model = e, this.panos = e.panos, this.player = t, this.imagePanos = this.listImagePanos(), this.retryMinimumTime = 1e4
      }
      var r = (e("three"), e("./enum/Viewmode")),
        o = (e("./settings"), e("./objects/Panorama")),
        a = e("./util/logger"),
        s = new a(i);
      n.prototype.start = function() {
        this.loadNextPano(function(e) {
          e ? this.start() : (setTimeout(function() {
            this.start()
          }.bind(this), 1e3))
        }.bind(this))
      }, n.prototype.validLoadTarget = function(e) {
        return e && !e.isLoaded("high") && Date.now() - e.failedLoadingAt > this.retryMinimumTime
      }, n.prototype.listImagePanos = function() {
        for (var e = [], t = 0; t < this.model.images.length; t++) {
          var i = this.model.images[t];
          if (i.metadata && i.metadata.scan_id) {
            var n = this.model.panos["get"](i.metadata.scan_id);
            n && !n.isLoaded("high") && e.push(n)
          }
        };
        return e
      }, n.prototype.nextNotLoadedImage = function() {
        for (; this.imagePanos.length > 0;) {
          var e = this.imagePanos[0];
          if (!e.isLoaded("high")) {
            return e
          };
          this.imagePanos.shift()
        };
        return null
      }, n.prototype.loadNextPano = function(e) {
        var t, i;
        this.model.waitQueue.length > 0 ? (t = this.model.waitQueue[0].pano) : this.validLoadTarget(this.player.currentPano) ? (t = this.player.currentPano) : this.validLoadTarget(this.player.closestPano) ? (t = this.player.closestPano) : this.validLoadTarget(this.nextNotLoadedImage()) ? (i = "high", t = this.imagePanos[0]) : this.player.mode === r.PANORAMA && (t = this.panos.findByScore([this.validLoadTarget.bind(this), o.filters.isNeighbourPanoTo(this.player.currentPano)], [o.scoreFunctions.distance(this.player.currentPano), o.scoreFunctions.direction(this.player.position, this.player.getDirection()), o.scoreFunctions.inFieldOfView(this.player.position, this.player.getDirection())]), t ? s.debug("") : (t = this.panos.findByScore([this.validLoadTarget.bind(this), o.filters.isNeighbourOfNeighbourTo(this.player.currentPano)], [o.scoreFunctions.distance(this.player.currentPano), o.scoreFunctions.direction(this.player.position, this.player.getDirection()), o.scoreFunctions.inFieldOfView(this.player.position, this.player.getDirection())]), t && (i = "high"))), t ? (i = i || t.isLoaded("low") ? "high" : "low", t.loadCube(i, function() {
          e(t)
        }, function() {
          e()
        })) : e && e(null)
      }, t.exports = n
    }).call(this, "/js/preloaders.js")
  }

  function _$af270746(e, t, i) {
    "use strict";

    function n() {
      var e = o.valueFromHash("auth");
      if (e) {
        return e.replace(",", " ")
      };
      var t = o.valueFromCookie("token");
      return t ? "Token " + t : null
    }
    var r = e("three"),
      o = e("./util/browser"),
      a = e("./enum/Viewmode"),
      s = e("./enum/Colors"),
      h = e("./enum/WarpStyle"),
      l = e("./util/easing"),
      c = e("./util/common"),
      u = {
        brand: o.valueFromHash("brand", !0),
        debug: !1,
        pageTitle: "\u56db\u7ef4\u865a\u62df\u6f2b\u6e38",
        authorizationHeader: n(),
        autoplay: o.valueFromHash("play", 1),
        autohelp: o.valueFromHash("help", null),
        logLevel: o.valueFromHash("log", 2),
        showNeighbors: !1,
        startHighlights: o.valueFromHash("hl", !1),
        specialEdition: o.valueFromHash("bn", 0),
        useWheel: o.valueFromHash("wh", !0),
        outdoorPanos: o.valueFromHash("op", !1),
        crossOrigin: "anonymous",
        fancierTransition: !1,
        wireframe: !1,
        skyboxWireframe: !1,
        modelAlpha: 1,
        highlightPanoSelection: !1,
        showSweeps: !0,
        showSkyboxes: !1,
        showMesh: !0,
        showFloors: !1,
        showFloorDuration: 300,
        showFloorDelay: 300,
        hideFloorDuration: 300,
        hideFloorDelay: 0,
        stayPut: !0,
        reticuleOpacityTransitionTime: 250,
        reticuleColor: s.newBlue,
        markerOpacityTransitionTime: 500,
        captureErrors: !1,
        maxMobileTextures: 12,
        dollhouseFOV: 70,
        dollhouseDefault: {
          minDistance: 15,
          maxDistance: 50,
          minPolarAngle: r.Math.degToRad(25),
          maxPolarAngle: r.Math.degToRad(65)
        },
        insideFOV: 70,
        insideLookSpeed: 0.12,
        insideLookLimitUp: 40,
        insideLookLimitDown: -40,
        orthoBase: 10,
        aspect: window.innerWidth / window.innerHeight,
        hideReticuleTimeout: 1e3,
        signedUrlRefreshRate: 240,
        analytics: {
          inactivityThreshold: 30,
          sessionTrackingRate: o.valueFromHash("sessionTrackingRate", 0.15),
          maxTrackedErrors: 20,
          sessionDurationPingFrequency: 10,
          sessionDurationTimeout: 15
        },
        flydown: {
          movementEasing: "easeInOutQuad",
          movementDelay: 0.001,
          rotationEasing: "easeInOutQuad",
          rotationDelay: 0.5,
          modelTextureDelay: 0.75,
          skyboxDelay: 0.75
        },
        transition: {
          flySpeed: 0.01,
          flyTime: 750,
          flytimeMaxDistanceThreshold: 5,
          flytimeDistanceMultiplier: 150,
          aimTime: 1500,
          aimSlowFactor: 1.5,
          blur: 0.8,
          movementEasing: "easeInOutQuad",
          blendEasing: "easeInOutQuad"
        },
        labels: {
          enabled: !1,
          hideUntilStart: !0,
          fadeInDuration: 250,
          fadeInDelay: 250,
          fadeOutDuration: 250,
          fadeOutDelay: 0,
          zoomHideThreshhold: {
            mobile: o.isSmallScreen() ? 0.35 : 0.55,
            desktop: 2
          },
          zoomTruncateThreshhold: {
            mobile: o.isSmallScreen() ? 0.25 : 0.45,
            desktop: 0.85
          },
          minLengthForTruncate: 16,
          truncateLength: 12,
          truncateSuffix: "..."
        },
        mattertags: {
          enabled: !1,
          enableLinking: !1,
          linkDestination: o.valueFromHash("nt", ""),
          startup: {
            hideUntilStart: !0,
            fadeInDuration: 500,
            fadeInDelay: 100
          },
          visibility: {
            anyDistance: !0,
            visibleDistance: 8,
            cameraClearance: 0.1,
            alphaTestLevel: 0.05,
            hideViaFloor: !0,
            hideObscured: o.valueFromHash("backfaces", !1),
            hideOffScreenDisc: !1,
            hideOffScreenObject: !1
          },
          disc: {
            opacity: 0.9,
            disabledOpacity: 0.5,
            scale: {
              nearBound: 1.5,
              farBound: 4.8,
              linkFarBound: !1,
              linkPercent: 40,
              maxSize: 80,
              minSize: 40,
              baseViewportSize: 800,
              responsiveness: 100
            }
          },
          pole: {
            enabled: !0,
            height: 0.5,
            width: 2,
            opacity: 0.5,
            color: "white"
          },
          deadzone: {
            checkDeadzone: !1,
            showDeadZone: !1,
            useDiscCenter: !0,
            deadzoneBounds: {
              top: 70,
              left: 0,
              bottom: 40,
              right: 0
            }
          },
          animation: {
            hoverOnClosing: !1,
            animInDelay: 100,
            animOutDelay: 50,
            animInTime: 200,
            animOutTime: 100
          },
          boardScale: {
            billboardScale: 1,
            scaleToDisc: !0,
            boardToDiscRatio: 1.2
          },
          navigate: {
            nearestPano: !0,
            lineOfSight: !0,
            reactivate: !0,
            aimAt: "disc",
            tiltTolerance: 25,
            rotateSpeedFactor: 0.6
          }
        },
        path: {
          color: s.newBlue,
          colorUp: s._desat(s.newBlue, 0.5),
          colorDown: s._darken(s.newBlue, 0.35),
          opacity: 0.5,
          style: "ribbon",
          height: 0.025,
          ribbonWidth: 0.24,
          outsideHeight: 0.5,
          waypointRadius: 0.5,
          waypointIndoorRadius: 0.24,
          pulseMarkers: o.valueFromHash("ppm", !0),
          waypointPulse: 1e3,
          preferShort: o.valueFromHash("shortStep", !1),
          typ: h.BLACK,
          mapGuides: o.valueFromHash("guides", !0),
          alwaysShow: o.valueFromHash("paths", !1),
          fadeInTime: 400,
          fadeOutTime: 300
        },
        warp: {
          nearPanoDist: 0.1,
          matchCam: !1,
          blur: 0.33,
          fastTime: 1500,
          teleportTime: Math.min(Math.max(o.valueFromHash("st", 1500), 500), 2e3),
          outsideTime: 2e3,
          lookAheadDist: 1.55,
          softPushDist: 0.37,
          softPushEnd: 0.3,
          softBendAngle: 8,
          softBendTilt: 4,
          softBendEnd: 0.3,
          doBurns: o.valueFromHash("kb", !0),
          burnsAngle: o.valueFromHash("bdeg", 15),
          maxTurnPerSec: 500,
          maxAimPerSec: 60,
          minRotation: 12,
          maxAimRotation: 33.2,
          turnFriction: 0.2,
          flySpeed: 0.01,
          minWarpTime: 1200,
          moveDelay: 1e3,
          tourStepDelay: 6e3,
          timePerMeter: 800,
          movementEasing: "easeInOutQuad",
          blendEasing: "easeInOutQuad",
          showBunny: !1,
          loop: o.valueFromHash("lp", !1),
          auto: o.valueFromHash("ts", -1),
          eOrder: "YXZ"
        },
        rotationFriction: 0.09,
        rotationAccelerationInside: 4.5,
        rotationAccelerationOutside: 2.5,
        rotationAfterMoveMultiplier: 30,
        rotationAfterMoveHistoryCount: 5,
        panFriction: 0.09,
        panAccelerationOutside: 1,
        startMode: o.valueFromHash("startMode", a.DOLLHOUSE),
        onload: o.valueFromHash("onload", a.PANORAMA),
        zoomNearLimit: 0.1,
        zoomFarLimit: 10,
        navigation: {
          panoScores: !1,
          mouseDirection: !0,
          filterStrictness: 0.75,
          angleFactor: -30,
          directionFactor: 10,
          distanceFactor: -1
        },
        secretPanelWord: [38, 38, 40, 40, 37, 39, 37, 39, 66, 65],
        console: o.valueFromHash("console", !1),
        noMeshFloorPositionOffset: new r.Vector3(0, -1.2, 0),
        panoramaNeighbourMaxDistance: 5,
        panoFloorClickRadius: 0.35,
        showScreenshotLocations: !1,
        showAxis: !1,
        showNeighbourRaycasts: !1,
        colorMarkerOnLoad: !1,
        colorMarkerByFloor: !1
      };
    u = c.deepExtend(u, {
      panorama: {
        transitionTime: 1e3,
        modelAlpha: 0,
        modelAlphaDelay: u.flydown.modelTextureDelay,
        modelAlphaLength: 1,
        skyboxOpacity: 1,
        skyboxOpacityDelay: u.flydown.skyboxDelay,
        skyboxOpacityLength: 0.9,
        fovLength: 1,
        fovDelay: 0,
        cameraMatrixDuration: 0.8,
        cameraMatrixDelay: 0,
        cameraMatrixEase: l.easeInCubic,
        reticuleOpacity: 1,
        markerOpacity: 0.3,
        markerOpacityOnHover: 1
      },
      dollhouse: {
        transitionTime: 1e3,
        modelAlpha: 1,
        modelAlphaDelay: 0,
        modelAlphaLength: 1 - u.flydown.modelTextureDelay,
        skyboxOpacity: 0,
        skyboxOpacityDelay: 0,
        skyboxOpacityLength: 1 - u.flydown.skyboxDelay,
        fovLength: 1,
        fovDelay: 0,
        cameraMatrixDuration: 0.8,
        cameraMatrixDelay: 0.3,
        cameraMatrixEase: l.easeInCubic,
        reticuleOpacity: 1,
        markerOpacity: 0,
        markerOpacityOnHover: 0
      },
      floorplan: {
        transitionTime: 1e3,
        modelAlpha: 1,
        modelAlphaDelay: 0,
        modelAlphaLength: 1 - u.flydown.modelTextureDelay,
        skyboxOpacity: 0,
        skyboxOpacityDelay: 0,
        skyboxOpacityLength: 1 - u.flydown.skyboxDelay,
        fovLength: 1,
        fovDelay: 0,
        cameraMatrixDuration: 0.5,
        cameraMatrixDelay: 0,
        cameraMatrixEase: l.easeOutCubic,
        reticuleOpacity: 1,
        markerOpacity: 0,
        markerOpacityOnHover: 0
      },
      transitioning: {
        reticuleOpacity: 0
      },
      "floorplan-dollhouse": {
        rotationDelay: 0,
        rotationDuration: 1
      },
      "floorplan-panorama": {
        rotationDelay: 0.5,
        rotationDuration: 1
      },
      "dollhouse-panorama": {
        rotationDelay: 0.5,
        rotationDuration: 1
      },
      "dollhouse-floorplan": {
        rotationDelay: 0,
        rotationDuration: 1,
        cameraMatrixDuration: 1.05,
        cameraMatrixDelay: 0.5
      },
      "panorama-dollhouse": {
        rotationDelay: 0,
        rotationDuration: 0.5
      },
      "panorama-floorplan": {
        transitionTime: 1500,
        rotationDelay: 0,
        rotationDuration: 0.5
      }
    }), u.warp.auto >= 0 && (u.autohelp = 0), t.exports = u
  }

  function _$af270748(e, t, i) {
    "use strict";
    var n = e("three"),
      r = e("./settings");
    t.exports = {
      cube: {
        uniforms: {
          tCube: {
            type: "t",
            value: null
          },
          opacity: {
            type: "f",
            value: 1
          }
        },
        vertexShader: "varying vec3 vWorldPosition;\x0A\x0Avoid main() {\x0A  vWorldPosition = position;\x0A  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\x0A}\x0A",
        fragmentShader: "uniform samplerCube tCube;\x0Auniform float opacity;\x0A\x0Avarying vec3 vWorldPosition;\x0A\x0Avoid main() {\x0A  vec4 tColor = textureCube( tCube, vec3( -vWorldPosition.x, vWorldPosition.yz ) );\x0A  gl_FragColor = vec4(tColor.rgb, opacity);\x0A}\x0A"
      },
      model: {
        uniforms: {
          map: {
            type: "t",
            value: null
          },
          modelAlpha: {
            type: "f",
            value: r.modelAlpha
          },
          opacity: {
            type: "f",
            value: 1
          },
          progress: {
            type: "f",
            value: 0
          },
          stasis: {
            type: "i",
            value: 0
          },
          blackout: {
            type: "i",
            value: 0
          },
          pano0Map: {
            type: "t",
            value: null
          },
          pano0Position: {
            type: "v3",
            value: new n.Vector3
          },
          pano0Matrix: {
            type: "m4",
            value: new n.Matrix4
          },
          pano1Map: {
            type: "t",
            value: null
          },
          pano1Position: {
            type: "v3",
            value: new n.Vector3
          },
          pano1Matrix: {
            type: "m4",
            value: new n.Matrix4
          }
        },
        vertexShader: "uniform vec3 pano0Position;\x0Auniform mat4 pano0Matrix;\x0A\x0Auniform vec3 pano1Position;\x0Auniform mat4 pano1Matrix;\x0A\x0Avarying vec2 vUv;\x0Avarying vec3 vWorldPosition0;\x0Avarying vec3 vWorldPosition1;\x0A\x0Avoid main() {\x0A\x0A  vUv = uv;\x0A  vec4 worldPosition = modelMatrix * vec4(position, 1.0);\x0A\x0A  vec3 positionLocalToPanoCenter0 = worldPosition.xyz - pano0Position;\x0A  vWorldPosition0 = (vec4(positionLocalToPanoCenter0, 1.0) * pano0Matrix).xyz;\x0A  vWorldPosition0.x *= -1.0;\x0A\x0A  vec3 positionLocalToPanoCenter1 = worldPosition.xyz - pano1Position;\x0A  vWorldPosition1 = (vec4(positionLocalToPanoCenter1, 1.0) * pano1Matrix).xyz;\x0A  vWorldPosition1.x *= -1.0;\x0A\x0A  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\x0A\x0A}\x0A",
        fragmentShader: "uniform sampler2D map;\x0Auniform float modelAlpha;\x0Auniform float opacity;\x0Auniform float progress;\x0Auniform int stasis;\x0Auniform int blackout;\x0A\x0Auniform vec3 pano0Position;\x0Auniform samplerCube pano0Map;\x0A\x0Auniform vec3 pano1Position;\x0Auniform samplerCube pano1Map;\x0A\x0Avarying vec2 vUv;\x0Avarying vec3 vWorldPosition0;\x0Avarying vec3 vWorldPosition1;\x0A\x0Avoid main() {\x0A\x09vec3 cp0 = vWorldPosition0.xyz;\x0A\x09vec3 cp1 = vWorldPosition1.xyz;\x0A\x09if (stasis!=0) {\x0A\x09\x09cp0 = mix(cp0,cp1,progress);\x0A\x09\x09cp1 = cp0;\x0A\x09}\x0A\x09vec4 colorFromPano0 = textureCube( pano0Map, cp0);\x0A\x09vec4 colorFromPano1 = textureCube( pano1Map, cp1);\x0A\x0A\x09const vec4 BLACK = vec4(0.0, 0.0, 0.0, 1.0);\x0A\x09vec4 colorFromPanos;\x0A\x09if (blackout!=0) {\x0A\x09\x09colorFromPanos = mix(colorFromPano0, BLACK, min(1.0,progress*2.0));\x0A\x09\x09colorFromPanos = mix(colorFromPanos, colorFromPano1, max(0.0,progress*2.0-1.0));\x0A\x09} else {\x0A\x09\x09colorFromPanos = mix(colorFromPano0, colorFromPano1, progress);\x0A\x09}\x0A\x0A\x09vec4 colorFromTexture = texture2D( map, vUv );\x0A\x09colorFromPanos = mix(colorFromPanos, colorFromTexture, modelAlpha);\x0A\x0A\x09float whiteness = 1.0 - smoothstep(0.1, 0.2, opacity);\x0A\x09colorFromPanos = mix(colorFromPanos, vec4(0.5, 0.5, 0.5, 1.0), whiteness);\x0A\x09gl_FragColor = vec4(colorFromPanos.rgb, opacity);\x0A}\x0A"
      },
      modelDollhouse: {
        uniforms: {
          map: {
            type: "t",
            value: null
          },
          opacity: {
            type: "f",
            value: 1
          }
        },
        vertexShader: "varying vec2 vUv;\x0A\x0Avoid main() {\x0A\x0A  vUv = uv;\x0A  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\x0A\x0A}\x0A",
        fragmentShader: "uniform sampler2D map;\x0Auniform float opacity;\x0Avarying vec2 vUv;\x0A\x0Avec4 white = vec4(0.5, 0.5, 0.5, 1.0);\x0A\x0Avoid main() {\x0A\x0A  vec4 colorFromTexture = texture2D( map, vUv );\x0A  float whiteness = 1.0 - smoothstep(0.1, 0.2, opacity);\x0A  colorFromTexture = mix(colorFromTexture, white, whiteness);\x0A  gl_FragColor = vec4(colorFromTexture.rgb, opacity);\x0A\x0A}\x0A"
      },
      ribbon: {
        uniforms: {
          map: {
            type: "t",
            value: null
          },
          opacity: {
            type: "f",
            value: 1
          },
          color: {
            type: "c",
            value: new n.Color(r.path.color)
          }
        },
        vertexShader: "varying vec2 vUv;\x0A\x0Avoid main() {\x0A\x0A  vUv = uv;\x0A  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\x0A\x0A}\x0A",
        fragmentShader: "uniform sampler2D map;\x0Auniform float opacity;\x0Avarying vec2 vUv;\x0Auniform vec3 color;\x0A\x0Avoid main() {\x0A\x09// TODO add scroll-in and pulsing behaviors\x0A  vec4 colorFromTexture = texture2D( map, vUv );\x0A  gl_FragColor = vec4((color.rgb*colorFromTexture.rgb),\x0A  \x09\x09\x09\x09\x09\x09(opacity*colorFromTexture.a));\x0A}\x0A"
      },
      waypoint: {
        uniforms: {
          map: {
            type: "t",
            value: null
          },
          opacity: {
            type: "f",
            value: 1
          },
          pulse: {
            type: "f",
            value: 1
          },
          color: {
            type: "c",
            value: new n.Color(r.reticuleColor)
          }
        },
        vertexShader: "varying vec2 vUv;\x0A\x0Avoid main() {\x0A\x0A  vUv = uv;\x0A  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\x0A\x0A}\x0A",
        fragmentShader: "uniform sampler2D map;\x0Auniform float opacity;\x0Auniform float pulse; // another opacity, with a different clock\x0Avarying vec2 vUv;\x0Auniform vec3 color;\x0A\x0Avoid main() {\x0A\x09// TODO add scroll-in and pulsing behaviors\x0A  vec4 colorFromTexture = texture2D( map, vUv );\x09\x09// we only use the alpha!\x0A  gl_FragColor = vec4(color.rgb,\x0A  \x09\x09\x09\x09\x09\x09(pulse*opacity*colorFromTexture.a));\x0A}\x0A"
      },
      modelDebug: {
        uniforms: {
          map: {
            type: "t",
            value: null
          },
          modelAlpha: {
            type: "f",
            value: r.modelAlpha
          },
          depthmapRatio: {
            type: "f",
            value: 0
          },
          opacity: {
            type: "f",
            value: 1
          },
          progress: {
            type: "f",
            value: 0
          },
          considerOcclusion: {
            type: "i",
            value: r.fancierTransition
          },
          highlightPanoSelection: {
            type: "i",
            value: 0
          },
          useThirdPano: {
            type: "i",
            value: r.useThirdPano
          },
          pano0Map: {
            type: "t",
            value: null
          },
          pano0Depth: {
            type: "t",
            value: null
          },
          pano0Position: {
            type: "v3",
            value: new n.Vector3
          },
          pano0Matrix: {
            type: "m4",
            value: new n.Matrix4
          },
          pano0Weight: {
            type: "f",
            value: r.transition.pano0Weight
          },
          pano1Map: {
            type: "t",
            value: null
          },
          pano1Depth: {
            type: "t",
            value: null
          },
          pano1Position: {
            type: "v3",
            value: new n.Vector3
          },
          pano1Matrix: {
            type: "m4",
            value: new n.Matrix4
          },
          pano1Weight: {
            type: "f",
            value: r.transition.pano1Weight
          },
          pano2Map: {
            type: "t",
            value: null
          },
          pano2Depth: {
            type: "t",
            value: null
          },
          pano2Position: {
            type: "v3",
            value: new n.Vector3
          },
          pano2Matrix: {
            type: "m4",
            value: new n.Matrix4
          },
          pano2Weight: {
            type: "f",
            value: r.transition.pano2Weight
          }
        },
        vertexShader: "uniform vec3 pano0Position;\x0Auniform mat4 pano0Matrix;\x0A\x0Auniform vec3 pano1Position;\x0Auniform mat4 pano1Matrix;\x0A\x0Auniform vec3 pano2Position;\x0Auniform mat4 pano2Matrix;\x0A\x0Avarying vec2 vUv;\x0Avarying vec3 vWorldPosition0;\x0Avarying vec3 vWorldPosition1;\x0Avarying vec3 vWorldPosition2;\x0A\x0Avarying vec4 worldPosition;\x0A\x0Avoid main() {\x0A\x0A  vUv = uv;\x0A  worldPosition = modelMatrix * vec4(position, 1.0);\x0A\x0A  vec3 positionLocalToPanoCenter0 = worldPosition.xyz - pano0Position;\x0A  vWorldPosition0 = (vec4(positionLocalToPanoCenter0, 1.0) * pano0Matrix).xyz;\x0A  vWorldPosition0.x *= -1.0;\x0A\x0A  vec3 positionLocalToPanoCenter1 = worldPosition.xyz - pano1Position;\x0A  vWorldPosition1 = (vec4(positionLocalToPanoCenter1, 1.0) * pano1Matrix).xyz;\x0A  vWorldPosition1.x *= -1.0;\x0A\x0A  vec3 positionLocalToPanoCenter2 = worldPosition.xyz - pano2Position;\x0A  vWorldPosition2 = (vec4(positionLocalToPanoCenter2, 2.0) * pano2Matrix).xyz;\x0A  vWorldPosition2.x *= -1.0;\x0A\x0A  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\x0A\x0A}\x0A",
        fragmentShader: "uniform sampler2D map;\x0Auniform float depthmapRatio;\x0Auniform float modelAlpha;\x0Auniform float opacity;\x0Auniform float progress;\x0Auniform int considerOcclusion;\x0Auniform int highlightPanoSelection;\x0Auniform int useThirdPano;\x0A\x0Auniform vec3 pano0Position;\x0Auniform samplerCube pano0Map;\x0Auniform samplerCube pano0Depth;\x0Auniform float pano0Weight;\x0A\x0Auniform vec3 pano1Position;\x0Auniform samplerCube pano1Map;\x0Auniform samplerCube pano1Depth;\x0Auniform float pano1Weight;\x0A\x0Auniform vec3 pano2Position;\x0Auniform samplerCube pano2Map;\x0Auniform samplerCube pano2Depth;\x0Auniform float pano2Weight;\x0A\x0Avarying vec2 vUv;\x0Avarying vec3 vWorldPosition0;\x0Avarying vec3 vWorldPosition1;\x0Avarying vec3 vWorldPosition2;\x0A\x0Avarying vec4 worldPosition;\x0A\x0Avoid main() {\x0A\x0A  vec4 depthFromPano0 = textureCube( pano0Depth, vWorldPosition0.xyz );\x0A  vec4 depthFromPano1 = textureCube( pano1Depth, vWorldPosition1.xyz );\x0A  vec4 depthFromPano2 = textureCube( pano2Depth, vWorldPosition2.xyz );\x0A\x0A  vec4 colorFromPano0 = textureCube( pano0Map, vWorldPosition0.xyz );\x0A  vec4 colorFromPano1 = textureCube( pano1Map, vWorldPosition1.xyz );\x0A  vec4 colorFromPano2 = textureCube( pano2Map, vWorldPosition2.xyz );\x0A\x0A  float distanceToPano0 = distance(worldPosition.xyz, pano0Position);\x0A  float distanceToPano1 = distance(worldPosition.xyz, pano1Position);\x0A  float distanceToPano2 = distance(worldPosition.xyz, pano2Position);\x0A\x0A  float cameraToPano0 = distance(cameraPosition.xyz, pano0Position);\x0A  float cameraToPano1 = distance(cameraPosition.xyz, pano1Position);\x0A  float cameraToPano2 = distance(cameraPosition.xyz, pano2Position);\x0A\x0A  float contributionFromPano0 = cameraToPano0 == 0.0 ? 1000.0 : pano0Weight / cameraToPano0;\x0A  float contributionFromPano1 = cameraToPano1 == 0.0 ? 1000.0 : pano1Weight / cameraToPano1;\x0A  float contributionFromPano2 = cameraToPano2 == 0.0 ? 1000.0 : pano2Weight / cameraToPano2;\x0A\x0A  contributionFromPano0 *= 1.0 / distanceToPano0;\x0A  contributionFromPano1 *= 1.0 / distanceToPano1;\x0A  contributionFromPano2 *= 1.0 / distanceToPano2;\x0A\x0A  if(considerOcclusion == 1) {\x0A    bool occludedFromPano0 = distanceToPano0 / 10.0 > 1.01 - depthFromPano0.x;\x0A    bool occludedFromPano1 = distanceToPano1 / 10.0 > 1.01 - depthFromPano1.x;\x0A    bool occludedFromPano2 = distanceToPano2 / 10.0 > 1.01 - depthFromPano2.x;\x0A\x0A    if(occludedFromPano0){contributionFromPano0 *= 0.1;}\x0A    if(occludedFromPano1){contributionFromPano1 *= 0.1;}\x0A    if(occludedFromPano2){contributionFromPano2 *= 0.1;}\x0A    //if(occludedFromPano0 && occludedFromPano1 && !occludedFromPano2) { contributionFromPano2 += 0.5; }\x0A  }\x0A\x0A  float contributionSum = contributionFromPano0 + contributionFromPano1 + contributionFromPano2;\x0A  contributionFromPano0 /= contributionSum;\x0A  contributionFromPano1 /= contributionSum;\x0A  contributionFromPano2 /= contributionSum;\x0A\x0A  vec4 colorFromPanos = colorFromPano0 * contributionFromPano0;\x0A  colorFromPanos += colorFromPano1 * contributionFromPano1;\x0A  colorFromPanos += colorFromPano2 * contributionFromPano2;\x0A\x0A  vec4 depthFromPanos = depthFromPano0 * contributionFromPano0;\x0A  depthFromPanos += depthFromPano1 * contributionFromPano1;\x0A  depthFromPanos += depthFromPano2 * contributionFromPano2;\x0A\x0A  vec4 colorFromTexture = texture2D( map, vUv );\x0A  colorFromPanos = mix(colorFromPanos, colorFromTexture, modelAlpha);\x0A\x0A  if(highlightPanoSelection == 1) {\x0A    colorFromPanos.r = contributionFromPano0;\x0A    colorFromPanos.g = contributionFromPano1;\x0A    colorFromPanos.b = contributionFromPano2;\x0A  }\x0A\x0A  gl_FragColor = vec4(mix(colorFromPanos, depthFromPanos, depthmapRatio).rgb, opacity);\x0A\x0A}\x0A"
      },
      customDepth: {
        uniforms: {
          panoPosition: {
            type: "v3",
            value: new n.Vector3
          }
        },
        vertexShader: "varying vec4 worldPosition;\x0A\x0Avoid main() {\x0A\x0A  worldPosition = modelMatrix * vec4(position, 1.0);\x0A  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\x0A\x0A}\x0A",
        fragmentShader: "uniform vec3 panoPosition;\x0Avarying vec4 worldPosition;\x0A\x0Avoid main() {\x0A\x0A  float depth = distance(worldPosition.xyz, panoPosition);\x0A  float color = 1.0 - depth / 10.0;\x0A  gl_FragColor = vec4(color, color, color, 1.0);\x0A\x0A}\x0A"
      },
      skysphere: {
        uniforms: {
          radius: {
            type: "f",
            value: 0
          }
        },
        vertexShader: "varying vec4 worldPosition;\x0A\x0Avoid main() {\x0A\x0A  worldPosition = modelMatrix * vec4(position, 1.0);\x0A  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\x0A\x0A}\x0A",
        fragmentShader: "varying vec4 worldPosition;\x0Auniform float radius;\x0A\x0Avoid main() {\x0A\x0A  vec4 topColor = vec4(0.094, 0.102, 0.11, 1.0);\x0A  vec4 bottomColor = vec4(0.2, 0.216, 0.235, 1.0);\x0A  float normalizedHeight = (worldPosition.y + radius) / (radius * 2.0);\x0A  float ratio = smoothstep(0.0, 0.5, normalizedHeight);\x0A  gl_FragColor = mix(bottomColor, topColor, ratio);\x0A\x0A}\x0A"
      },
      hot: {
        uniforms: {
          color: {
            type: "c",
            value: new n.Color(0xff2200)
          },
          opac: {
            type: "f",
            value: 0
          },
          texture1: {
            type: "t",
            value: n.ImageUtils.loadTexture("./images/point2.png")
          },
          texture2: {
            type: "t",
            value: n.ImageUtils.loadTexture("./images/point2_light.png")
          }
        },
        vertexShader: "varying vec2 vUv;\x0A\x0Avoid main() {\x0A\x0A vUv =  uv ;\x0A gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\x0A\x0A}\x0A",
        fragmentShader: "varying vec3 vNormal;\x0A\x0Avarying vec2 vUv;\x0A\x0Auniform float opac;\x0A\x0Auniform vec3 color;\x0A\x0Auniform sampler2D texture1;\x0A\x0Auniform sampler2D texture2;\x0A\x0Avoid main() {\x0A\x0Avec4 tcolor1 = texture2D( texture1, vUv );\x0A\x0Avec4 tcolor2 = texture2D( texture2, vUv );\x0A\x0Agl_FragColor = tcolor1+ vec4(opac)*tcolor2;}\x0A"
      }
    }
  }

  function _$af270749(e, t, i) {
    (function(i) {
      "use strict";
      var n = e("three"),
        r = e("url"),
        o = e("./util/ajax"),
        a = e("./settings"),
        s = e("./util/logger"),
        h = e("./objects/Panorama"),
        l = new s(i),
        c = e("./objects/Model"),
        u = e("./shaders"),
        d = e("./util/transitions"),
        p = e("./objects/Chunk"),
        f = e("./objects/Reticule"),
        m = e("./objects/Skybox"),
        g = e("./objects/Floor"),
        v = e("./cameras/DollhouseCamera"),
        y = e("./cameras/FloorplanCamera"),
        b = e("./cameras/PanoramaCamera"),
        w = e("./controls/DollhouseControls"),
        _ = e("./controls/FloorplanControls"),
        x = e("./controls/PanoramaControls");
      n.ImageUtils.crossOrigin = a.crossOrigin, t.exports = {
        shaders: u,
        transitions: d,
        Model: c,
        Chunk: p,
        Floor: g,
        Skybox: m,
        Reticule: f,
        Panorama: h,
        DollhouseCamera: v,
        FloorplanCamera: y,
        PanoramaCamera: b,
        DollhouseControls: w,
        FloorplanControls: _,
        PanoramaControls: x,
        parseSidUrl: function(e) {
          var t, i;
          t = g_Prefix;
          if (e.match(/^https?/)) {
            var n = r.parse(e);
            i = e
          } else {
            i = t + "/data/" + g_index + "/modeldata.js"
          };
          return {
            urlBase: t,
            urlModel: i
          }
        },
        getModel: function(e) {
          if (!e.url) {
            throw "getModel(): missing parameter \"url\""
          };
          e.autoload = void(0) !== e.autoload ? e.autoload : !0;
          var t = this.parseSidUrl(e.url);
          e.urlBase = t.urlBase, e.urlModel = t.urlModel, e.urlFiles = t.urlBase + "/data/" + g_index + "/models.js";
          var i = this._getPlatformError();
          if (i) {
            return $.Deferred().reject(i).promise()
          } else {
            this.options = e;
            return this._loadModel().then(this._buildModel.bind(this))
          }
        },
        _getPlatformError: function() {
          if ("IE" === $.ua.browser.name && parseInt($.ua.browser.major) < 11) {
            return "webgl-unsupported"
          } else {
            if ("iOS" === $.ua.os.name) {
              return null
            } else {
              if (Modernizr.webgl) {
                return null
              } else {
                return "webgl-unsupported"
              }
            }
          }
        },
        _loadModel: function() {
          var e = $.Deferred();
          if (this.options.data) {
            return e.resolve(this.options.data).promise()
          } else {
            o["get"](this.options.urlModel, {
              responseType: "json",
              auth: a.authorizationHeader
            }).done(function(t) {
              e.resolve(t["model"])
            }).fail(function() {
              e.reject("loading-failed")
            });
            return e.promise()
          }
        },
        _buildModel: function(e) {
          var t = $.Deferred();
          e.images.forEach(function(e) {
            if (e.metadata && "string" == typeof e.metadata) {
              try {
                e.metadata = JSON.parse(e.metadata)
              } catch (t) {
                e.metadata = null
              }
            }
          });
          var i = new c(this.options, e);
          return this.options.autoload ? i.load(function() {
            t.resolve(i)
          }, function(e) {
            t.reject(e)
          }) : t.resolve(i), t
        }
      }
    }).call(this, "/js/showcase.js")
  }

  function _$af270761(e, t, i) {
    (function(i) {
      "use strict";

      function n(e) {
        this.cache = null, this.pathList = null
      }

      function r() {
        this.baseUrl = null, this.cache = null, this.pathList = null
      }

      function o() {
        this.baseUrl = null, this.pathList = null
      }

      function a(e) {
        this.endpoint = e + "?type=3", this.urlContainer = null, this.containerClasses = [o, r, n]
      }
      var s = e("../ab"),
        h = e("./ajax"),
        l = e("./logger"),
        c = e("../settings"),
        xstmobile = e("../util/browser"),
        u = new l(i);
      n.prototype = {
        version: 1,
        validate: function(e) {
          return Object.keys(e).length > 0
        },
        update: function(e) {
          return this.cache = e, this.pathList = Object.keys(this.cache), $.when()
        },
        get: function(e) {
          return this.cache[e]
        }
      }, r.prototype = {
        version: 2,
        validate: function(e) {
          return "base.url" in e && Object.keys(e).length > 1
        },
        update: function(e) {
          return this.baseUrl = e["base.url"], this.cache = e, this.pathList = Object.keys(this.cache), $.when()
        },
        get: function(e) {
          var t = this.cache[e];
          return t ? this.baseUrl.replace("{{filename}}", e) + t : null
        }
      }, o.prototype = {
        version: 3,
        validate: function(e) {
          return e.templates && e.catalog_file
        },
        update: function(e) {
          if (xstmobile.isMobile() && g_modeldata.model.mobile) {
            this.baseUrl = g_Prefix + "/images/images" + g_index + "/mobile/{{filename}}"
          } else {
            this.baseUrl = g_Prefix + "/images/images" + g_index + "/{{filename}}"
          };
          if (null === this.pathList) {
            var n = $.Deferred();
            return this._getCacheFromCatalog(e.catalog_file).done(function(e) {
              this.pathList = e.files, n.resolve()
            }.bind(this)).fail(function() {
              n.reject("missing-urls")
            }), n
          };
          return $.when()
        },
        get: function(e) {
          if (e == "catalog.json") {
            return g_Prefix + "/data/" + g_index + "/data.js"
          } else {
            return this.baseUrl.replace("{{filename}}", e)
          }
        },
        _getCacheFromCatalog: function(e) {
          return h["get"](this["get"](e), {
            responseType: "json"
          })
        }
      }, a.prototype = {
        init: function() {
          return setInterval(function() {
            this.refresh().done(function() {}).fail(function() {})
          }.bind(this), 1e3 * c.signedUrlRefreshRate), this.refresh()
        },
        refresh: function() {
          var e = $.Deferred(),
            t = e.resolve.bind(e),
            i = e.reject.bind(e);
          for (var n = 0; n < this.containerClasses.length; n++) {
            var r = this.containerClasses[n];
            var o = new r;
            this.urlContainer = o;
            return this.urlContainer.update({
              "catalog_file": "catalog.json"
            }).done(t).fail(i)
          };
          i("missing-urls");
          return e.promise()
        },
        get: function(e) {
          return this.urlContainer["get"](e)
        },
        count: function(e) {
          for (var t = this.urlContainer.pathList, i = 0, n = 0; n < t.length; n++) {
            -1 !== t[n].indexOf(e) && i++
          };
          return i
        }
      }, t.exports = a
    }).call(this, "/js/util/ModelUrls.js")
  }

  function _$af270786(e, t, i) {
    (function(i) {
      "use strict";

      function n() {
        this.list = [], this.dict = {}, this.length = 0, this.neighbourMap = {}, this.map = null
      }
      var r = e("three"),
        o = e("./common"),
        a = e("../settings"),
        s = e("../objects/Panorama"),
        a = e("../settings"),
        h = e("./aStar"),
        l = e("./logger"),
        c = new l(i);
      n.prototype.forEach = function(e) {
        for (var t = 0; t < this.list.length; t++) {
          e(this.list[t])
        }
      }, n.prototype.add = function(e) {
        this.list.push(e), this.dict[e.id] = e, this.length++
      }, n.prototype.extend = function(e) {
        for (var t = 0; t < e.length; t++) {
          this.add(e[t])
        }
      }, n.prototype["get"] = function(e) {
        return this.dict[e]
      }, n.prototype.filter = function(e) {
        return this.list.filter(e)
      }, n.prototype.find = function(e, t) {
        var i = o.filterAll(this.list, e);
        return 0 === i.length ? null : (t && t.forEach(function(e) {
          i = o.stableSort(i, e)
        }), i[0])
      }, n.prototype.sortByScore = function(e, t) {
        var i = o.filterAll(this.list, e);
        return 0 === i.length ? null : i = i.map(function(e) {
          return {
            pano: e,
            score: t.reduce(function(t, i) {
              return t + i(e)
            }, 0)
          }
        }).sort(function(e, t) {
          return t.score - e.score
        })
      }, n.prototype.findByScore = function(e, t) {
        var i = this.sortByScore(e, t);
        return i && 0 !== i.length ? (a.navigation.panoScores && this.showPanoScores(i), i[0].pano) : null
      }, n.prototype.findRankedByScore = function(e, t, i) {
        e || (e = 0);
        var n = this.sortByScore(t, i);
        return !n || 0 === n.length || e >= n.length ? null : n[e].pano
      }, n.prototype.showPanoScores = function(e) {
        this.list.forEach(function(e) {
          e.removeTextSprite()
        });
        var t = 6344768;
        e.forEach(function(e) {
          e.pano.addTextSprite(e.score.toFixed(2), t), t = 16428055
        })
      }, n.prototype.isNeighbour = function(e, t) {
        return this.neighbourMap[e.id][t.id]
      }, n.prototype.getNeighbours = function(e) {
        return this.neighbourMap[e.id]
      }, n.prototype.setNeighbour = function(e, t, i) {
        return this.neighbourMap[e.id] || (this.neighbourMap[e.id] = {}), this.neighbourMap[t.id] || (this.neighbourMap[t.id] = {}), this.neighbourMap[e.id][e.id] = !0, this.neighbourMap[t.id][t.id] = !0, this.neighbourMap[e.id][t.id] = i, this.neighbourMap[t.id][e.id] = i, this.neighbourMap[e.id]
      }, n.prototype.findClosest = function(e, t) {
        var i = t ? [s.filters.inDirection(e, t, 0.75)] : [];
        return this.find(i, [s.sortFunctions.distanceToPoint(e)])
      }, n.prototype.dualNeighbors = function(e, t) {
        var i, n = [];
        for (i in this.neighbourMap[e.id]) {
          this.neighbourMap[t.id][i] && n.push(i)
        };
        return n
      }, n.prototype.populate_path_graph = function() {
        var e, t, i, n, o, a, s, h, l = Date.now(),
          u = {},
          d = 0,
          p = new r.Vector3(0, 0, 0),
          f = 0,
          m = 0;
        for (e = 0; e < this.list.length; e += 1) {
          o = this.list[e], s = {}, h = !1, i = o.neighbourPanos || o.findNeighourPanos();
          for (t in i) {
            if (i[t]) {
              a = this.dict[t], p.copy(o.floorPosition), p.sub(a.floorPosition);
              var g = Math.sqrt(p.x * p.x + p.z * p.z),
                v = (Math.abs(p.y) / Math.max(g, 0.01), Math.max(0, Math.abs(p.y) - 0.2));
              v > 0 ? (f += 1, v = Math.pow(4 * v, 2), g = Math.pow(g, 2), n = Math.sqrt(v * v + g * g)) : (m += 1, n = p.length()), s[a.id] = n, h = !0
            }
          };
          h ? u[o.id] = s : d += 1
        };
        this.map = u
      }, n.prototype.aStarSearch = function(e, t) {
        var i = Date.now(),
          n = new h({
            start: e,
            isEnd: function(e) {
              return e === t
            },
            neighbor: function(e) {
              var t = e.neighbourPanos || e.findNeighourPanos(),
                i = [];
              for (var n in t) {
                i.push(this.dict[n])
              };
              return i
            }.bind(this),
            distance: function(e, t) {
              var i = this.map[e.id],
                n = i[t.id];
              return n
            }.bind(this),
            heuristic: function(e, t) {
              return 1
            }.bind(this),
            hash: function(e) {
              return e.id
            },
            timeout: 5e3
          });
        if ("success" !== n.status) {
          return null
        };
        var r = [];
        for (var o in n.path) {
          r.push(n.path[o].id)
        };
        return r
      }, t.exports = n
    }).call(this, "/js/util/PanoramaCollection.js")
  }

  function _$af270817(e, t, i) {
    "use strict";

    function n(e) {
      void(0) === e.timeout && (e.timeout = 1 / 0);
      var t = e.hash || o,
        i = {
          data: e.start,
          g: 0,
          h: e.heuristic(e.start)
        },
        n = i;
      i.f = i.h;
      var c = new s,
        u = new h(a),
        d = l();
      u.push(i), d["set"](t(i.data), i);
      for (var p = new Date; u.size();) {
        if (new Date - p > e.timeout) {
          return {
            status: "timeout",
            cost: n.g,
            path: r(n)
          }
        };
        var f = u.pop();
        if (d["delete"](t(f.data)), e.isEnd(f.data)) {
          return {
            status: "success",
            cost: f.g,
            path: r(f)
          }
        };
        c.add(t(f.data));
        for (var m = e.neighbor(f.data), g = 0; g < m.length; g++) {
          var v = m[g];
          if (!c.contains(t(v))) {
            var y = f.g + e.distance(f.data, v),
              b = d["get"](t(v)),
              w = !1;
            if (void(0) === b) {
              b = {
                data: v
              }, d["set"](t(v), b)
            } else {
              if (b.g < y) {
                continue
              };
              w = !0
            };
            b.parent = f, b.g = y, b.h = e.heuristic(v), b.f = y + b.h, b.h < n.h && (n = b), w ? u.heapify() : u.push(b)
          }
        }
      };
      return {
        status: "noPath",
        cost: n.g,
        path: r(n)
      }
    }

    function r(e) {
      if (void(0) !== e.parent) {
        var t = r(e.parent);
        return t.push(e.data), t
      };
      return [e.data]
    }

    function o(e) {
      return e.toString()
    }

    function a(e, t) {
      return e.f - t.f
    }
    var s = e("Set"),
      h = e("heap"),
      l = e("dict");
    t.exports = n
  }

  function _$af270822(e, t, i) {
    (function(i) {
      "use strict";

      function n(e, t, i) {
        var n = new XMLHttpRequest;
        if (i && "withCredentials" in n) {
          n.open(e, t, i)
        } else {
          if ("undefined" != typeof XDomainRequest) {
            n = new XDomainRequest, n.open(e, t)
          } else {
            if (i) {
              throw "\u6d4f\u89c8\u5668\u4e0d\u652f\u6301CORS!"
            };
            n.open(e, t)
          }
        };
        return n
      }

      function r(e, t, i) {
        function o() {
          r(e, t, i).done(l.resolve.bind(l)).progress(l.notify.bind(l)).fail(l.reject.bind(l))
        }

        function s(e, t) {
          var i = e.response;
          if ("json" === t && "object" != typeof i) {
            try {
              i = JSON.parse(e.responseText)
            } catch (n) {
              return void(l.reject({
                error: "Failed parsing JSON"
              }))
            }
          } else {
            if ("image/jpeg" === t) {
              var r = new Uint8Array(e.response),
                o = new Blob([r], {
                  type: "image/jpeg"
                }),
                a = URL.createObjectURL(o);
              i = new Image, i.src = a, i.crossOrigin = "Anonymous", i.onload = function() {
                URL.revokeObjectURL(a)
              }
            }
          };
          return i
        }
        var h = n(e, t, !1);
        if (i = i || {}, i.retries = void(0) !== i.retries ? i.retries : 0, i.retry = void(0) !== i.retry ? i.retry : "get" === e.toLowerCase(), i.responseType) {
          if (["arraybuffer", "text", "json"].indexOf(i.responseType) > -1) {
            h.responseType = i.responseType
          } else {
            if ("image/jpeg" !== i.responseType) {
              throw new Error("reponseType can only be one of \"arraybuffer\", \"text\" or \"json\", \"image/jpeg\"")
            };
            h.responseType = "arraybuffer"
          }
        };
        "json" === i.responseType && h.setRequestHeader("Accept", "application/json"), i.auth && h.setRequestHeader("Authorization", i.auth);
        var l = $.Deferred();
        h.onreadystatechange = function(e) {
          if (4 == this.readyState) {
            if (this.status >= 500 && this.status <= 600 && i.retry && i.retries < 3) {
              i.retries++, setTimeout(o, 1e3)
            } else {
              if (200 == this.status) {
                var t = s(this, i.responseType);
                l.resolve(t)
              } else {
                l.reject(this)
              }
            }
          }
        };
        h.onprogress = function(e) {
          l.notify(e)
        };
        h.send(i.data);
        return l.promise()
      }
      var o = e("./logger"),
        a = new o(i);
      window.URL = window.URL || window.webkitURL, t.exports = {
        get: function(e, t) {
          return r("get", e, t)
        },
        post: function(e, t) {
          return r("post", e, t)
        },
        getImage: function(e, t) {
          function i() {
            a.warn("Retrying ", e), o.getImage(e, t + 1).done(n.resolve.bind(n)).progress(n.notify.bind(n)).fail(n.reject.bind(n))
          }
          var n = $.Deferred(),
            r = new Image,
            o = this;
          return t = t || 0, r.onerror = function() {
            3 > t ? setTimeout(i, 1e3) : n.reject()
          }, r.onload = function() {
            n.resolve(r)
          }, r.crossOrigin = "anonymous", r.src = e, n
        }
      }
    }).call(this, "/js/util/ajax.js")
  }

  function _$af270837(e, t, i) {
    "use strict";
    t.exports = {
      isFullscreen: function() {
        return document.fullscreenElement || document.mozFullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement || document.msFullscreenElement
      },
      supportsFullscreen: function() {
        return document.fullscreenEnabled || document.mozFullscreenEnabled || document.mozFullScreenEnabled || document.webkitFullscreenEnabled || document.msFullscreenEnabled
      },
      isPointerLocked: function() {
        return document.pointerLockElement || document.mozPointerLockElement || document.webkitPointerLockElement
      },
      requestFullscreen: function(e, t) {
        e.requestFullscreen ? e.requestFullscreen() : e.mozRequestFullScreen ? e.mozRequestFullScreen() : e.webkitRequestFullscreen ? e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT) : e.msRequestFullscreen && e.msRequestFullscreen(), t && $(document).on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange", browser.requestPointerLock)
      },
      requestPointerLock: function() {
        var e;
        if (document.fullscreenElement) {
          e = document.fullscreenElement()
        } else {
          if (document.mozFullscreenElement) {
            e = document.mozFullscreenElement()
          } else {
            if (document.mozFullScreenElement) {
              e = document.mozFullScreenElement()
            } else {
              if (!document.webkitFullscreenElement) {
                return
              };
              e = document.webkitFullscreenElement()
            }
          }
        };
        e.requestPointerLock = e.requestPointerLock || e.mozRequestPointerLock || e.webkitRequestPointerLock, e.requestPointerLock(), $(document).off("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange", this)
      },
      exitPointerLock: function() {
        document.exitPointerLock = document.exitPointerLock || document.mozExitPointerLock || document.webkitExitPointerLock, document.exitPointerLock()
      },
      exitFullscreen: function() {
        document.exitFullscreen ? document.exitFullscreen() : document.msExitFullscreen ? document.msExitFullscreen() : document.mozCancelFullScreen ? document.mozCancelFullScreen() : document.webkitExitFullscreen && document.webkitExitFullscreen()
      },
      details: function() {
        var e = navigator.userAgent.match("(Firefox|Chrome|Safari)/([\\d]+)");
        return e ? {
          name: e[1],
          version: parseInt(e[2]),
          platform: navigator.platform
        } : {}
      },
      is: function(e) {
        return this.details() && this.details().name === e
      },
      inIframe: function() {
        return window.parent !== window
      },
      aspectRatio: function() {
        var e = window.innerWidth / window.innerHeight;
        return isFinite(e) ? e : 0
      },
      userAgent: function() {
        return window.navigator.userAgent
      },
      isMobile: function() {
        var e = navigator.userAgent || navigator.vendor || window.opera;
        return /(android|bb\d+|meego).+mobile|android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0, 4))
      },
      isSmallScreen: function() {
        var e = screen.width / window.devicePixelRatio;
        return 240 > e
      },
      detectIE: function() {
        var e = window.navigator.userAgent,
          t = e.indexOf("MSIE ");
        return t > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)
      },
      detectSafari: function() {
        var e = window.navigator.userAgent,
          t = e.indexOf("Safari"),
          i = e.indexOf("Chrome");
        return t > 0 && 0 > i
      },
      detectSamsungNative: function() {
        var e = window.navigator.userAgent;
        return e.indexOf("SM-G900H") > 0 || e.indexOf("GT-I9500") > 0 || e.indexOf("SM-N900") > 0
      },
      detectSamsungS6: function() {
        var e = window.navigator.userAgent,
          t = e.indexOf("SM-G92");
        return t > 0
      },
      valueFromCookie: function(e, t) {
        var i = new RegExp(e + "=([0-9a-f]+)(; ?|$)").exec(document.cookie);
        if (!i) {
          return t
        };
        var n = i[1];
        return "boolean" == typeof t ? "true" === n || "1" === n : "number" == typeof t ? parseFloat(n) : n
      },
      valueFromHash: function(e, t) {
        var i = new RegExp("[#&?]" + e + "=([^#&?]*)"),
          n = i.exec(window.location.href);
        if (!n) {
          return t
        };
        var r = n[1];
        return "boolean" == typeof t ? "true" === r || "1" === r : "number" == typeof t ? parseFloat(r) : window.decodeURIComponent(r)
      }
    }
  }

  function _$af270858(e, t, i) {
    "use strict";
    var n = e("three");
    t.exports = {
      domainFromUrl: function(e) {
        var t = /^([^:]*:\/\/)?([^/]+)/.exec(e);
        return t ? t[2] : e
      },
      average: function(e, t) {
        if (0 === e.length) {
          return null
        };
        for (var i = 0, n = 0, r = 0; r < e.length; r++) {
          var o = t ? e[r][t] : e[r];
          i += o, n++
        };
        return i / n
      },
      averageVectors: function(e, t) {
        var i = new n.Vector3;
        if (0 === e.length) {
          return i
        };
        for (var r = 0, o = 0; o < e.length; o++) {
          var a = t ? e[o][t] : e[o];
          i.add(a), r++
        };
        return i.divideScalar(r)
      },
      equalLists: function(e, t) {
        if (e.length !== t.length) {
          return !1
        };
        for (var i = 0; i < e.length; i++) {
          if (e[i] !== t[i]) {
            return !1
          }
        };
        return !0
      },
      lowerMedian: function(e, t) {
        if (0 === e.length) {
          return null
        };
        t = t || 2, e.sort(function(e, t) {
          return e - t
        });
        var i = Math.floor(e.length / t);
        return e[i]
      },
      stableSort: function(e, t) {
        return e.map(function(e, t) {
          return {
            value: e,
            index: t
          }
        }).sort(function(e, i) {
          var n = t(e.value, i.value);
          return 0 !== n ? n : e.index - i.index
        }).map(function(e) {
          return e.value
        })
      },
      filterAll: function(e, t) {
        return e.filter(function(e) {
          return t.every(function(t) {
            return t(e)
          })
        })
      },
      formatDate: function(e) {
        return [e.getFullYear(), e.getMonth() + 1, e.getDate()].join("-")
      },
      formatDatetime: function(e) {
        return [e.getFullYear(), e.getMonth() + 1, e.getDate(), e.getHours(), e.getMinutes()].join("-")
      },
      randomString: function(e) {
        for (var t = "", i = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789", n = 0; e > n; n++) {
          t += i.charAt(Math.floor(Math.random() * i.length))
        };
        return t
      },
      nth: function(e) {
        return e %= 10, 1 == e ? e + "st" : 2 == e ? e + "nd" : 3 == e ? e + "rd" : e + "th"
      },
      deepExtend: function r(e) {
        e = e || {};
        for (var t = 1; t < arguments.length; t++) {
          var i = arguments[t];
          if (i) {
            for (var n in i) {
              i.hasOwnProperty(n) && (e[n] = "object" == typeof i[n] ? r(e[n], i[n]) : i[n])
            }
          }
        };
        return e
      },
      extend: function(e, t) {
        for (var i in t.prototype) {
          e.prototype[i] = t.prototype[i]
        }
      }
    }, Math.sign = function(e) {
      return 0 > e ? -1 : 1
    }
  }

  function _$af270879(e, t, i) {
    "use strict";
    var n = {};
    n.linearTween = function(e, t, i, n) {
      return i * e / n + t
    }, n.easeInQuad = function(e, t, i, n) {
      return e /= n, i * e * e + t
    }, n.easeOutQuad = function(e, t, i, n) {
      return e /= n, -i * e * (e - 2) + t
    }, n.easeInOutQuad = function(e, t, i, n) {
      return e /= n / 2, 1 > e ? i / 2 * e * e + t : (e--, -i / 2 * (e * (e - 2) - 1) + t)
    }, n.easeInCubic = function(e, t, i, n) {
      return e /= n, i * e * e * e + t
    }, n.easeOutCubic = function(e, t, i, n) {
      return e /= n, e--, i * (e * e * e + 1) + t
    }, n.easeInOutCubic = function(e, t, i, n) {
      return e /= n / 2, 1 > e ? i / 2 * e * e * e + t : (e -= 2, i / 2 * (e * e * e + 2) + t)
    }, n.easeInQuart = function(e, t, i, n) {
      return e /= n, i * e * e * e * e + t
    }, n.easeOutQuart = function(e, t, i, n) {
      return e /= n, e--, -i * (e * e * e * e - 1) + t
    }, n.easeInOutQuart = function(e, t, i, n) {
      return e /= n / 2, 1 > e ? i / 2 * e * e * e * e + t : (e -= 2, -i / 2 * (e * e * e * e - 2) + t)
    }, n.easeInQuint = function(e, t, i, n) {
      return e /= n, i * e * e * e * e * e + t
    }, n.easeOutQuint = function(e, t, i, n) {
      return e /= n, e--, i * (e * e * e * e * e + 1) + t
    }, n.easeInOutQuint = function(e, t, i, n) {
      return e /= n / 2, 1 > e ? i / 2 * e * e * e * e * e + t : (e -= 2, i / 2 * (e * e * e * e * e + 2) + t)
    }, n.easeInSine = function(e, t, i, n) {
      return -i * Math.cos(e / n * (Math.PI / 2)) + i + t
    }, n.easeOutSine = function(e, t, i, n) {
      return i * Math.sin(e / n * (Math.PI / 2)) + t
    }, n.easeInOutSine = function(e, t, i, n) {
      return -i / 2 * (Math.cos(Math.PI * e / n) - 1) + t
    }, n.easeInExpo = function(e, t, i, n) {
      return i * Math.pow(2, 10 * (e / n - 1)) + t
    }, n.easeOutExpo = function(e, t, i, n) {
      return i * (-Math.pow(2, -10 * e / n) + 1) + t
    }, n.easeInOutExpo = function(e, t, i, n) {
      return e /= n / 2, 1 > e ? i / 2 * Math.pow(2, 10 * (e - 1)) + t : (e--, i / 2 * (-Math.pow(2, -10 * e) + 2) + t)
    }, n.easeInCirc = function(e, t, i, n) {
      return e /= n, -i * (Math.sqrt(1 - e * e) - 1) + t
    }, n.easeOutCirc = function(e, t, i, n) {
      return e /= n, e--, i * Math.sqrt(1 - e * e) + t
    }, n.easeInOutCirc = function(e, t, i, n) {
      return e /= n / 2, 1 > e ? -i / 2 * (Math.sqrt(1 - e * e) - 1) + t : (e -= 2, i / 2 * (Math.sqrt(1 - e * e) + 1) + t)
    }, n.easeInElastic = function(e, t, i, n) {
      var r = 1.70158,
        o = 0,
        a = i;
      return 0 === e ? t : 1 === (e /= n) ? t + i : (o || (o = 0.3 * n), a < Math.abs(i) ? (a = i, r = o / 4) : r = o / (2 * Math.PI) * Math.asin(i / a), -(a * Math.pow(2, 10 * (e -= 1)) * Math.sin(2 * (e * n - r) * Math.PI / o)) + t)
    }, n.easeOutElastic = function(e, t, i, n) {
      var r = 1.70158,
        o = 0,
        a = i;
      return 0 === e ? t : 1 === (e /= n) ? t + i : (o || (o = 0.3 * n), a < Math.abs(i) ? (a = i, r = o / 4) : r = o / (2 * Math.PI) * Math.asin(i / a), a * Math.pow(2, -10 * e) * Math.sin(2 * (e * n - r) * Math.PI / o) + i + t)
    }, n.easeInOutElastic = function(e, t, i, n) {
      var r = 1.70158,
        o = 0,
        a = i;
      return 0 === e ? t : 2 === (e /= n / 2) ? t + i : (o || (o = 0.3 * n * 1.5), a < Math.abs(i) ? (a = i, r = o / 4) : r = o / (2 * Math.PI) * Math.asin(i / a), 1 > e ? -0.5 * a * Math.pow(2, 10 * (e -= 1)) * Math.sin(2 * (e * n - r) * Math.PI / o) + t : a * Math.pow(2, -10 * (e -= 1)) * Math.sin(2 * (e * n - r) * Math.PI / o) * 0.5 + i + t)
    }, n.easeInBack = function(e, t, i, n, r) {
      return void(0) === r && (r = 1.70158), i * (e /= n) * e * ((r + 1) * e - r) + t
    }, n.easeOutBack = function(e, t, i, n, r) {
      return void(0) === r && (r = 1.70158), i * ((e = e / n - 1) * e * ((r + 1) * e + r) + 1) + t
    }, n.easeInOutBack = function(e, t, i, n, r) {
      return void(0) === r && (r = 1.70158), (e /= n / 2) < 1 ? i / 2 * e * e * (((r *= 1.525) + 1) * e - r) + t : i / 2 * ((e -= 2) * e * (((r *= 1.525) + 1) * e + r) + 2) + t
    }, n.easeOutBounce = function(e, t, i, n) {
      return (e /= n) < 1 / 2.75 ? 7.5625 * i * e * e + t : 2 / 2.75 > e ? i * (7.5625 * (e -= 1.5 / 2.75) * e + 0.75) + t : 2.5 / 2.75 > e ? i * (7.5625 * (e -= 2.25 / 2.75) * e + 0.9375) + t : i * (7.5625 * (e -= 2.625 / 2.75) * e + 0.984375) + t
    }, n.easeInBounce = function(e, t, i, r) {
      return i - n.easeOutBounce(r - e, 0, i, r) + t
    }, n.easeInOutBounce = function(e, t, i, r) {
      return r / 2 > e ? 0.5 * n.easeInBounce(2 * e, 0, i, r) + t : 0.5 * n.easeOutBounce(x, 2 * e - r, 0, i, r) + 0.5 * i + t
    }, t.exports = n
  }

  function _$af270911(e, t, i) {
    "use strict";

    function n() {
      this.events = [], this.valid = !1
    }
    var r = e("../enum/Joystick");
    n.prototype.push = function(e, t) {
      this.events.push({
        direction: e,
        pano: t
      }), this.valid = !0
    }, n.prototype.pop = function(e) {
      var t = this.events.pop();
      return this.events.length < 1 && (this.valid = !1), t
    }, n.prototype.peek = function() {
      return this.events.length ? this.events[this.events.length - 1] : {
        direction: null,
        pano: null
      }
    }, n.prototype.invalidate = function() {
      this.events = [], this.valid = !1
    }, n.prototype.reversePano = function(e) {
      if (!this.valid) {
        return null
      };
      var t = this.peek();
      return r.opposite(e) === t.direction ? (this.pop(), t.pano) : null
    }, t.exports = n
  }

  function _$af270918(e, t, i) {
    "use strict";
    t.exports = {
      vector: function(e, t) {
        var i = e.clone();
        return t = t.clone(),
          function(n) {
            e["set"](i.x * (1 - n) + t.x * n, i.y * (1 - n) + t.y * n, i.z * (1 - n) + t.z * n)
          }
      },
      quaternion: function(e, t) {
        var i = e.clone();
        return function(n) {
          e.copy(i).slerp(t, n)
        }
      },
      property: function(e, t, i, n) {
        var r = e[t];
        return function(o) {
          e[t] = r * (1 - o) + i * o, n && n(e[t])
        }
      },
      uniform: function(e, t, i) {
        var n = e.material.uniforms[t].value;
        return function(r) {
          e.material.uniforms[t] && (e.material.uniforms[t].value = n * (1 - r) + i * r)
        }
      },
      matrix4: function(e, t) {
        var i = e.clone();
        return function(n) {
          for (var r = e.elements, o = i.elements, a = t.elements, s = 0; 16 > s; s++) {
            r[s] = o[s] * (1 - n) + a[s] * n
          }
        }
      },
      allUniforms: function(e, t, i) {
        var n = e.map(function(e) {
          return this.uniform(e, t, i)
        }.bind(this));
        return function(e) {
          n.forEach(function(t) {
            t(e)
          })
        }
      }
    }
  }

  function _$af270933(e, t, i) {
    "use strict";

    function n(e) {
      var t = e.split("/"),
        i = "[" + t[t.length - 1].replace(".js", "") + "]",
        a = {};
      n.startTime || (n.startTime = Date.now());
      var s, h, l, c;
      if (r.console) {
        var u = function(e) {
          $("#debug-console").append("<p>" + e + "</p>"), $("#debug-console")[0].scrollTop = $("#debug-console")[0].scrollHeight
        };
        s = function(e) {
          u(Array.prototype.slice.call(arguments).join(" "))
        }, h = function(e) {
          u(Array.prototype.slice.call(arguments).join(" "))
        }, l = function(e) {
          u("WARN: " + Array.prototype.slice.call(arguments).join(" "))
        }, c = function(e) {
          u("ERROR: " + Array.prototype.slice.call(arguments).join(" "))
        }
      } else {
        console.log ? (s = console.log, h = console.info ? console.info : console.log, l = console.warn ? console.warn : console.log, c = console.error ? console.error : console.log) : s = h = l = c = function() {}
      };
      var d = function(e) {
          return [i, n.timestamp()].concat(Array.prototype.slice.call(e))
        },
        p = function(t, i) {
          if (o) {
            var r = Array.prototype.slice.call(t).join(" ");
            o.captureMessage(r, {
              level: i,
              path: e,
              timestamp: n.timestamp()
            })
          }
        },
        f = function(t, i) {
          if (o) {
            var r = Array.prototype.slice.call(t).join(" ");
            o.captureException(new Error(r), {
              level: i,
              path: e,
              timestamp: n.timestamp()
            })
          }
        };
      return {
        debug: function() {
          n.level >= n.levels.debug && s.apply(console, d(arguments))
        },
        info: function() {
          n.level >= n.levels.info && h.apply(console, d(arguments))
        },
        warn: function() {
          p(arguments, "warn"), n.level >= n.levels.warn && l.apply(console, d(arguments))
        },
        error: function() {
          f(arguments, "error"), n.level >= n.levels.error && c.apply(console, d(arguments))
        },
        v3str: function(e) {
          return "(" + e.x.toPrecision(2) + ", " + e.y.toPrecision(2) + ", " + e.z.toPrecision(2) + ")"
        },
        time: function(e) {
          n.level >= n.levels.debug && (a[e] = Date.now())
        },
        timeEnd: function(e) {
          if (n.level >= n.levels.debug) {
            var t = a[e];
            if (!t) {
              return
            };
            var i = (Date.now() - t) / 1e3
          }
        }
      }
    }
    var r = e("../settings"),
      o = window.Raven;
    n.timestamp = function() {
      return n.startTime ? (Date.now() - n.startTime) / 1e3 + "s" : ""
    }, n.levels = {
      debug: 3,
      info: 2,
      warn: 1,
      error: 0
    }, n.level = n.levels.info, t.exports = n
  }

  function _$af270952(e, t, i) {
    "use strict";
    var n = e("three");
    t.exports = {
      convertVisionVector: function(e) {
        return new n.Vector3(e.x, e.z, -e.y)
      },
      convertVisionQuaternion: function(e) {
        return new n.Quaternion(e.x, e.z, -e.y, e.w).multiply((new n.Quaternion).setFromAxisAngle(new n.Vector3(0, 1, 0), n.Math.degToRad(90)))
      },
      convertWorkshopVector: function(e) {
        return new n.Vector3(-e.x, e.y, e.z)
      },
      convertWorkshopQuaternion: function(e) {
        return new n.Quaternion(-e.x, e.y, e.z, -e.w).multiply(new n.Quaternion(Math.sqrt(2) / 2, Math.sqrt(2) / 2, 0, 0))
      },
      projectPositionToCanvas: function(e, t, i) {
        i = i || new n.Vector3, i.copy(e);
        var r = window.innerWidth,
          o = window.innerHeight,
          a = 0.5 * r,
          s = 0.5 * o;
        return i.project(t), i.x = i.x * a + a, i.y = -(i.y * s) + s, i
      },
      convertScreenPositionToNDC: function(e, t, i) {
        i = i || new n.Vector3, i.copy(e);
        window.innerWidth, window.innerHeight;
        return i.x = x / window.innerWidth * 2 - 1, i.y = 2 * -(y / window.innerHeight) + 1, i.z = t, i
      }
    }
  }

  function _$af270959(e, t, i) {
    "use strict";
    t.exports = {
      captureErrors: function(e, t, i) {
        if ("Raven" in window) {
          Raven.config(e, t).install(), i && Raven.setTagsContext(i);
          var n = console.warn,
            r = console.error;
          console.warn = function() {
            var e = Array.prototype.slice.call(arguments);
            Raven.captureMessage(e.join(" "), {
              level: "warning"
            }), n.apply(console, e)
          }, console.error = function() {
            var e = Array.prototype.slice.call(arguments);
            Raven.captureException(new Error(e.join(" ")), {
              level: "error"
            }), r.apply(console, e)
          }
        }
      }
    }
  }

  function _$af270963(e, t, i) {
    "use strict";
    var n = e("../util/ajax"),
      r = e("three"),
      o = {};
    t.exports = {
      load: function(e, t, i) {
        if (o[e]) {
          return o[e]
        };
        var a = new r.Texture;
        return a.sourceFile = e, o[e] = a, n.getImage(e).then(function(e) {
          a.image = e, a.needsUpdate = !0, t && t(a)
        }).fail(i), a
      }
    }
  }

  function _$af270966(e, t, i) {
    "use strict";
    var n = e("./easing");
    t.exports = {
      globalDone: null,
      funcs: [],
      counter: 0,
      start: function(e, t, i, r, o, a) {
        return r = r || 0, this.funcs.push({
          func: e,
          current: -r * Math.abs(t),
          duration: (1 - Math.max(r, 0)) * Math.abs(t),
          done: i,
          easing: o || n.linearTween,
          cycling: 0 > t,
          running: !0,
          debug: 0 > r,
          name: a || "T" + this.counter
        }), e(0, 16), this.counter += 1, e
      },
      trigger: function(e) {
        var t = void(0) === e.delayRatio ? 0 : e.delayRatio,
          i = e.func || function() {},
          r = void(0) === e.duration ? 0 : e.duration;
        void(0) !== e.cycling && e.cycling && (r = -Math.abs(r));
        var o = e.done || null,
          a = e.easing || n.linearTween,
          s = e.name || "R" + this.counter;
        return this.start(i, r, o, t, a, s)
      },
      update: function(e) {
        this.funcs.forEach(function(t) {
          if (t.current += 1e3 * e, !(t.current < 0)) {
            if (t.current >= t.duration && !t.cycling) {
              var i = t.easing(1, 0, 1, 1);
              t.func(i, 1e3 * e), t.done && t.done(), t.running = !1
            } else {
              var n = t.easing(t.current % t.duration / t.duration, 0, 1, 1),
                r = t.func(n, 1e3 * e) || !1;
              r && (t.done && t.done(), t.running = !1)
            }
          }
        });
        var t = this.funcs.length;
        this.funcs = this.funcs.filter(function(e) {
          return e.running
        });
        var i = this.funcs.length;
        if (t > 0 && 0 === i && this.globalDone) {
          var n = this.globalDone;
          this.globalDone = null, n()
        }
      },
      get: function(e) {
        for (var t = 0; t < this.funcs.length; t += 1) {
          if (this.funcs[t].func == e) {
            return this.funcs[t]
          }
        };
        return null
      },
      isRunning: function(e) {
        var t = this["get"](e);
        return null !== t && t.running
      },
      countActive: function() {
        for (var e = 0, t = 0; t < this.funcs.length; t += 1) {
          e += this.funcs[t].running
        };
        return e
      },
      listActive: function() {
        for (var e = [], t = 0; t < this.funcs.length; t += 1) {
          this.funcs[t].running && e.push(this.funcs[t].name)
        };
        return e
      },
      done: function(e) {
        this.globalDone = e
      },
      cancel: function(e) {
        this.funcs = this.funcs.filter(function(t) {
          return t.func !== e
        })
      }
    }
  }

  function _$af270980(e, t, i) {
    function n(e) {
      if (this["set"] = {}, this.infContains = function() {
          return !0
        }, "object" == typeof e) {
        if (e instanceof Array) {
          for (var t = 0; t < e.length; t++) {
            this["set"][e[t]] = !0
          }
        } else {
          this["set"] = e
        }
      } else {
        if ("function" == typeof e) {
          this.infContains = e
        } else {
          if ("undefined" != typeof e) {
            throw new Error("set must be either an array or an object.")
          }
        }
      }
    }
    t.exports = n, n.prototype.contains = function(e) {
      return this["set"][e] ? !0 : !1
    }, n.prototype.has = n.prototype.contains, n.prototype.add = function(e) {
      if (1 == arguments.length) {
        this["set"][e] = !0
      } else {
        for (var t = 0; t < arguments.length; t++) {
          this["set"][arguments[t]] = !0
        }
      }
    }, n.prototype.addAll = function(e) {
      if ("object" != typeof e && !(e instanceof Array)) {
        throw new Error("arr must be an array.")
      };
      for (var t = 0; t < e.length; t++) {
        this.add(e[t])
      }
    }, n.prototype.remove = function(e) {
      if (1 == arguments.length) {
        delete this["set"][e]
      } else {
        for (var t = 0; t < arguments.length; t++) {
          delete this["set"][arguments[t]]
        }
      }
    }, n.prototype["delete"] = n.prototype.remove, n.prototype.clear = function() {
      this["set"] = {}
    }, n.prototype.size = function() {
      return Object.keys(this["set"]).length
    }, n.prototype.toString = function() {
      return "{" + Object.keys(this["set"]).toString() + "}"
    }, n.prototype.toArray = function() {
      return "undefined" == typeof this["set"] ? [] : Object.keys(this["set"])
    }, n.prototype["*values"] = n.prototype.toArray
  }

  function _$af270991(e, t, i) {
    (function(i, n) {
      "use strict";

      function r(t, r) {
        function o(e) {
          var t, i;
          for (t = 0; e[t]; t += 1) {
            if (i = e[t], "." === i) {
              e.splice(t, 1), t -= 1
            } else {
              if (".." === i) {
                if (1 === t && (".." === e[2] || ".." === e[0])) {
                  break
                };
                t > 0 && (e.splice(t - 1, 2), t -= 2)
              }
            }
          }
        }

        function a(e, t) {
          var i;
          return e && "." === e.charAt(0) && t && (i = t.split("/"), i = i.slice(0, i.length - 1), i = i.concat(e.split("/")), o(i), e = i.join("/")), e
        }

        function s(e) {
          return function(t) {
            return a(t, e)
          }
        }

        function h(e) {
          function t(t) {
            f[e] = t
          }
          return t.fromText = function(e, t) {
            throw new Error("amdefine does not implement load.fromText")
          }, t
        }

        function l(e, i, o) {
          var a, s, h, l;
          if (e) {
            s = f[e] = {}, h = {
              id: e,
              uri: n,
              exports: s
            }, a = u(r, s, h, e)
          } else {
            if (m) {
              throw new Error("amdefine with no module ID cannot be called more than once per file.")
            };
            m = !0, s = t.exports, h = t, a = u(r, s, h, t.id)
          };
          i && (i = i.map(function(e) {
            return a(e)
          })), l = "function" == typeof o ? o.apply(h.exports, i) : o, void(0) !== l && (h.exports = l, e && (f[e] = h.exports))
        }

        function c(e, t, i) {
          Array.isArray(e) ? (i = t, t = e, e = void(0)) : "string" != typeof e && (i = e, e = t = void(0)), t && !Array.isArray(t) && (i = t, t = void(0)), t || (t = ["require", "exports", "module"]), e ? p[e] = [e, t, i] : l(e, t, i)
        }
        var u, d, p = {},
          f = {},
          m = !1,
          g = e("path");
        return u = function(e, t, n, r) {
          function o(o, a) {
            return "string" == typeof o ? d(e, t, n, o, r) : (o = o.map(function(i) {
              return d(e, t, n, i, r)
            }), void((a && i.nextTick(function() {
              a.apply(null, o)
            }))))
          }
          return o.toUrl = function(e) {
            return 0 === e.indexOf(".") ? a(e, g.dirname(n.filename)) : e
          }, o
        }, r = r || function() {
          return t.require.apply(t, arguments)
        }, d = function(e, t, i, n, r) {
          var o, c, m = n.indexOf("!"),
            g = n;
          if (-1 === m) {
            if (n = a(n, r), "require" === n) {
              return u(e, t, i, r)
            };
            if ("exports" === n) {
              return t
            };
            if ("module" === n) {
              return i
            };
            if (f.hasOwnProperty(n)) {
              return f[n]
            };
            if (p[n]) {
              return l.apply(null, p[n]), f[n]
            };
            if (e) {
              return e(g)
            };
            throw new Error("No module with ID: " + n)
          };
          return o = n.substring(0, m), n = n.substring(m + 1, n.length), c = d(e, t, i, o, r), n = c.normalize ? c.normalize(n, s(r)) : a(n, r), f[n] ? f[n] : (c.load(n, u(e, t, i, r), h(n), {}), f[n])
        }, c.require = function(e) {
          return f[e] ? f[e] : p[e] ? (l.apply(null, p[e]), f[e]) : void(0)
        }, c.amd = {}, c
      }
      t.exports = r
    }).call(this, e("_process"), "/node_modules/amdefine/amdefine.js")
  }

  function _$af271012(e, t, i) {}

  function _$af271013(e, t, i) {
    function n(e) {
      return this instanceof n ? (this.length = 0, this.parent = void(0), "number" == typeof e ? r(this, e) : "string" == typeof e ? o(this, e, arguments.length > 1 ? arguments[1] : "utf8") : a(this, e)) : arguments.length > 1 ? new n(e, arguments[1]) : new n(e)
    }

    function r(e, t) {
      if (e = d(e, 0 > t ? 0 : 0 | p(t)), !n.TYPED_ARRAY_SUPPORT) {
        for (var i = 0; t > i; i++) {
          e[i] = 0
        }
      };
      return e
    }

    function o(e, t, i) {
      ("string" != typeof i || "" === i) && (i = "utf8");
      var n = 0 | m(t, i);
      return e = d(e, n), 0 | e.write(t, i), e
    }

    function a(e, t) {
      if (n.isBuffer(t)) {
        return s(e, t)
      };
      if (Y(t)) {
        return h(e, t)
      };
      if (null == t) {
        throw new TypeError("must start with number, buffer, array or string")
      };
      return "undefined" != typeof ArrayBuffer && t.buffer instanceof ArrayBuffer ? l(e, t) : t.length ? c(e, t) : u(e, t)
    }

    function s(e, t) {
      var i = 0 | p(t.length);
      return e = d(e, i), t.copy(e, 0, 0, i), e
    }

    function h(e, t) {
      var i = 0 | p(t.length);
      e = d(e, i);
      for (var n = 0; i > n; n += 1) {
        e[n] = 255 & t[n]
      };
      return e
    }

    function l(e, t) {
      var i = 0 | p(t.length);
      e = d(e, i);
      for (var n = 0; i > n; n += 1) {
        e[n] = 255 & t[n]
      };
      return e
    }

    function c(e, t) {
      var i = 0 | p(t.length);
      e = d(e, i);
      for (var n = 0; i > n; n += 1) {
        e[n] = 255 & t[n]
      };
      return e
    }

    function u(e, t) {
      var i, n = 0;
      "Buffer" === t.type && Y(t.data) && (i = t.data, n = 0 | p(i.length)), e = d(e, n);
      for (var r = 0; n > r; r += 1) {
        e[r] = 255 & i[r]
      };
      return e
    }

    function d(e, t) {
      n.TYPED_ARRAY_SUPPORT ? e = n._augment(new Uint8Array(t)) : (e.length = t, e._isBuffer = !0);
      var i = 0 !== t && t <= n.poolSize >>> 1;
      return i && (e.parent = q), e
    }

    function p(e) {
      if (e >= X) {
        throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x" + X.toString(16) + " bytes")
      };
      return e >>> 0
    }

    function f(e, t) {
      if (!(this instanceof f)) {
        return new f(e, t)
      };
      var i = new n(e, t);
      return delete i.parent, i
    }

    function m(e, t) {
      if ("string" != typeof e && (e = String(e)), 0 === e.length) {
        return 0
      };
      switch (t || "utf8") {
        case "ascii":
          ;
        case "binary":
          ;
        case "raw":
          return e.length;
        case "ucs2":
          ;
        case "ucs-2":
          ;
        case "utf16le":
          ;
        case "utf-16le":
          return 2 * e.length;
        case "hex":
          return e.length >>> 1;
        case "utf8":
          ;
        case "utf-8":
          return N(e).length;
        case "base64":
          return z(e).length;
        default:
          return e.length
      }
    }

    function g(e, t, i, n) {
      i = Number(i) || 0;
      var r = e.length - i;
      n ? (n = Number(n), n > r && (n = r)) : n = r;
      var o = t.length;
      if (o % 2 !== 0) {
        throw new Error("Invalid hex string")
      };
      n > o / 2 && (n = o / 2);
      for (var a = 0; n > a; a++) {
        var s = parseInt(t.substr(2 * a, 2), 16);
        if (isNaN(s)) {
          throw new Error("Invalid hex string")
        };
        e[i + a] = s
      };
      return a
    }

    function v(e, t, i, n) {
      return G(N(t, e.length - i), e, i, n)
    }

    function y(e, t, i, n) {
      return G(U(t), e, i, n)
    }

    function b(e, t, i, n) {
      return y(e, t, i, n)
    }

    function w(e, t, i, n) {
      return G(z(t), e, i, n)
    }

    function _(e, t, i, n) {
      return G(V(t, e.length - i), e, i, n)
    }

    function x(e, t, i) {
      return H.fromByteArray(0 === t && i === e.length ? e : e.slice(t, i))
    }

    function M(e, t, i) {
      var n = "",
        r = "";
      i = Math.min(e.length, i);
      for (var o = t; i > o; o++) {
        e[o] <= 127 ? (n += j(r) + String.fromCharCode(e[o]), r = "") : r += "%" + e[o].toString(16)
      };
      return n + j(r)
    }

    function E(e, t, i) {
      var n = "";
      i = Math.min(e.length, i);
      for (var r = t; i > r; r++) {
        n += String.fromCharCode(127 & e[r])
      };
      return n
    }

    function S(e, t, i) {
      var n = "";
      i = Math.min(e.length, i);
      for (var r = t; i > r; r++) {
        n += String.fromCharCode(e[r])
      };
      return n
    }

    function T(e, t, i) {
      var n = e.length;
      (!t || 0 > t) && (t = 0), (!i || 0 > i || i > n) && (i = n);
      for (var r = "", o = t; i > o; o++) {
        r += F(e[o])
      };
      return r
    }

    function P(e, t, i) {
      for (var n = e.slice(t, i), r = "", o = 0; o < n.length; o += 2) {
        r += String.fromCharCode(n[o] + 256 * n[o + 1])
      };
      return r
    }

    function A(e, t, i) {
      if (e % 1 !== 0 || 0 > e) {
        throw new RangeError("offset is not uint")
      };
      if (e + t > i) {
        throw new RangeError("Trying to access beyond buffer length")
      }
    }

    function L(e, t, i, r, o, a) {
      if (!n.isBuffer(e)) {
        throw new TypeError("buffer must be a Buffer instance")
      };
      if (t > o || a > t) {
        throw new RangeError("value is out of bounds")
      };
      if (i + r > e.length) {
        throw new RangeError("index out of range")
      }
    }

    function C(e, t, i, n) {
      0 > t && (t = 65535 + t + 1);
      for (var r = 0, o = Math.min(e.length - i, 2); o > r; r++) {
        e[i + r] = (t & 255 << 8 * (n ? r : 1 - r)) >>> 8 * (n ? r : 1 - r)
      }
    }

    function R(e, t, i, n) {
      0 > t && (t = 4294967295 + t + 1);
      for (var r = 0, o = Math.min(e.length - i, 4); o > r; r++) {
        e[i + r] = t >>> 8 * (n ? r : 3 - r) & 255
      }
    }

    function I(e, t, i, n, r, o) {
      if (t > r || o > t) {
        throw new RangeError("value is out of bounds")
      };
      if (i + n > e.length) {
        throw new RangeError("index out of range")
      };
      if (0 > i) {
        throw new RangeError("index out of range")
      }
    }

    function D(e, t, i, n, r) {
      return r || I(e, t, i, 4, 3.4028234663852886e38, -3.4028234663852886e38), W.write(e, t, i, n, 23, 4), i + 4
    }

    function O(e, t, i, n, r) {
      return r || I(e, t, i, 8, 1.7976931348623157e308, -1.7976931348623157e308), W.write(e, t, i, n, 52, 8), i + 8
    }

    function k(e) {
      if (e = B(e).replace($, ""), e.length < 2) {
        return ""
      };
      for (; e.length % 4 !== 0;) {
        e += "="
      };
      return e
    }

    function B(e) {
      return e.trim ? e.trim() : e.replace(/^\s+|\s+$/g, "")
    }

    function F(e) {
      return 16 > e ? "0" + e.toString(16) : e.toString(16)
    }

    function N(e, t) {
      t = t || 1 / 0;
      for (var i, n = e.length, r = null, o = [], a = 0; n > a; a++) {
        if (i = e.charCodeAt(a), i > 55295 && 57344 > i) {
          if (!r) {
            if (i > 56319) {
              (t -= 3) > -1 && o.push(239, 191, 189);
              continue
            };
            if (a + 1 === n) {
              (t -= 3) > -1 && o.push(239, 191, 189);
              continue
            };
            r = i;
            continue
          };
          if (56320 > i) {
            (t -= 3) > -1 && o.push(239, 191, 189), r = i;
            continue
          };
          i = r - 55296 << 10 | i - 56320 | 65536, r = null
        } else {
          r && ((t -= 3) > -1 && o.push(239, 191, 189), r = null)
        };
        if (128 > i) {
          if ((t -= 1) < 0) {
            break
          };
          o.push(i)
        } else {
          if (2048 > i) {
            if ((t -= 2) < 0) {
              break
            };
            o.push(i >> 6 | 192, 63 & i | 128)
          } else {
            if (65536 > i) {
              if ((t -= 3) < 0) {
                break
              };
              o.push(i >> 12 | 224, i >> 6 & 63 | 128, 63 & i | 128)
            } else {
              if (!(2097152 > i)) {
                throw new Error("Invalid code point")
              };
              if ((t -= 4) < 0) {
                break
              };
              o.push(i >> 18 | 240, i >> 12 & 63 | 128, i >> 6 & 63 | 128, 63 & i | 128)
            }
          }
        }
      };
      return o
    }

    function U(e) {
      for (var t = [], i = 0; i < e.length; i++) {
        t.push(255 & e.charCodeAt(i))
      };
      return t
    }

    function V(e, t) {
      for (var i, n, r, o = [], a = 0; a < e.length && !((t -= 2) < 0); a++) {
        i = e.charCodeAt(a), n = i >> 8, r = i % 256, o.push(r), o.push(n)
      };
      return o
    }

    function z(e) {
      return H.toByteArray(k(e))
    }

    function G(e, t, i, n) {
      for (var r = 0; n > r && !(r + i >= t.length || r >= e.length); r++) {
        t[r + i] = e[r]
      };
      return r
    }

    function j(e) {
      try {
        return decodeURIComponent(e)
      } catch (t) {
        return String.fromCharCode(65533)
      }
    }
    var H = e("base64-js"),
      W = e("ieee754"),
      Y = e("is-array");
    i.Buffer = n, i.SlowBuffer = f, i.INSPECT_MAX_BYTES = 50, n.poolSize = 8192;
    var X = 1073741823,
      q = {};
    n.TYPED_ARRAY_SUPPORT = function() {
      try {
        var e = new ArrayBuffer(0),
          t = new Uint8Array(e);
        return t.foo = function() {
          return 42
        }, 42 === t.foo() && "function" == typeof t.subarray && 0 === new Uint8Array(1).subarray(1, 1).byteLength
      } catch (i) {
        return !1
      }
    }(), n.isBuffer = function(e) {
      return !(null == e || !e._isBuffer)
    }, n.compare = function(e, t) {
      if (!n.isBuffer(e) || !n.isBuffer(t)) {
        throw new TypeError("Arguments must be Buffers")
      };
      if (e === t) {
        return 0
      };
      for (var i = e.length, r = t.length, o = 0, a = Math.min(i, r); a > o && e[o] === t[o]; o++) {;
      };
      return o !== a && (i = e[o], r = t[o]), r > i ? -1 : i > r ? 1 : 0
    }, n.isEncoding = function(e) {
      switch (String(e).toLowerCase()) {
        case "hex":
          ;
        case "utf8":
          ;
        case "utf-8":
          ;
        case "ascii":
          ;
        case "binary":
          ;
        case "base64":
          ;
        case "raw":
          ;
        case "ucs2":
          ;
        case "ucs-2":
          ;
        case "utf16le":
          ;
        case "utf-16le":
          return !0;
        default:
          return !1
      }
    }, n.concat = function(e, t) {
      if (!Y(e)) {
        throw new TypeError("list argument must be an Array of Buffers.")
      };
      if (0 === e.length) {
        return new n(0)
      };
      if (1 === e.length) {
        return e[0]
      };
      var i;
      if (void(0) === t) {
        for (t = 0, i = 0; i < e.length; i++) {
          t += e[i].length
        }
      };
      var r = new n(t),
        o = 0;
      for (i = 0; i < e.length; i++) {
        var a = e[i];
        a.copy(r, o), o += a.length
      };
      return r
    }, n.byteLength = m, n.prototype.length = void(0), n.prototype.parent = void(0), n.prototype.toString = function(e, t, i) {
      var n = !1;
      if (t >>>= 0, i = void(0) === i || i === 1 / 0 ? this.length : i >>> 0, e || (e = "utf8"), 0 > t && (t = 0), i > this.length && (i = this.length), t >= i) {
        return ""
      };
      for (;;) {
        switch (e) {
          case "hex":
            return T(this, t, i);
          case "utf8":
            ;
          case "utf-8":
            return M(this, t, i);
          case "ascii":
            return E(this, t, i);
          case "binary":
            return S(this, t, i);
          case "base64":
            return x(this, t, i);
          case "ucs2":
            ;
          case "ucs-2":
            ;
          case "utf16le":
            ;
          case "utf-16le":
            return P(this, t, i);
          default:
            if (n) {
              throw new TypeError("Unknown encoding: " + e)
            };
            e = (e + "").toLowerCase(), n = !0
        }
      }
    }, n.prototype.equals = function(e) {
      if (!n.isBuffer(e)) {
        throw new TypeError("Argument must be a Buffer")
      };
      return this === e ? !0 : 0 === n.compare(this, e)
    }, n.prototype.inspect = function() {
      var e = "",
        t = i.INSPECT_MAX_BYTES;
      return this.length > 0 && (e = this.toString("hex", 0, t).match(/.{2}/g).join(" "), this.length > t && (e += " ... ")), "<Buffer " + e + ">"
    }, n.prototype.compare = function(e) {
      if (!n.isBuffer(e)) {
        throw new TypeError("Argument must be a Buffer")
      };
      return this === e ? 0 : n.compare(this, e)
    }, n.prototype.indexOf = function(e, t) {
      function i(e, t, i) {
        for (var n = -1, r = 0; i + r < e.length; r++) {
          if (e[i + r] === t[-1 === n ? 0 : r - n]) {
            if (-1 === n && (n = r), r - n + 1 === t.length) {
              return i + n
            }
          } else {
            n = -1
          }
        };
        return -1
      }
      if (t > 2147483647 ? t = 2147483647 : -2147483648 > t && (t = -2147483648), t >>= 0, 0 === this.length) {
        return -1
      };
      if (t >= this.length) {
        return -1
      };
      if (0 > t && (t = Math.max(this.length + t, 0)), "string" == typeof e) {
        return 0 === e.length ? -1 : String.prototype.indexOf.call(this, e, t)
      };
      if (n.isBuffer(e)) {
        return i(this, e, t)
      };
      if ("number" == typeof e) {
        return n.TYPED_ARRAY_SUPPORT && "function" === Uint8Array.prototype.indexOf ? Uint8Array.prototype.indexOf.call(this, e, t) : i(this, [e], t)
      };
      throw new TypeError("val must be string, number or Buffer")
    }, n.prototype["get"] = function(e) {
      return console.log(".get() is deprecated. Access using array indexes instead."), this.readUInt8(e)
    }, n.prototype["set"] = function(e, t) {
      return console.log(".set() is deprecated. Access using array indexes instead."), this.writeUInt8(e, t)
    }, n.prototype.write = function(e, t, i, n) {
      if (void(0) === t) {
        n = "utf8", i = this.length, t = 0
      } else {
        if (void(0) === i && "string" == typeof t) {
          n = t, i = this.length, t = 0
        } else {
          if (isFinite(t)) {
            t >>>= 0, isFinite(i) ? (i >>>= 0, void(0) === n && (n = "utf8")) : (n = i, i = void(0))
          } else {
            var r = n;
            n = t, t = i >>> 0, i = r
          }
        }
      };
      var o = this.length - t;
      if ((void(0) === i || i > o) && (i = o), e.length > 0 && (0 > i || 0 > t) || t > this.length) {
        throw new RangeError("attempt to write outside buffer bounds")
      };
      n || (n = "utf8");
      for (var a = !1;;) {
        switch (n) {
          case "hex":
            return g(this, e, t, i);
          case "utf8":
            ;
          case "utf-8":
            return v(this, e, t, i);
          case "ascii":
            return y(this, e, t, i);
          case "binary":
            return b(this, e, t, i);
          case "base64":
            return w(this, e, t, i);
          case "ucs2":
            ;
          case "ucs-2":
            ;
          case "utf16le":
            ;
          case "utf-16le":
            return _(this, e, t, i);
          default:
            if (a) {
              throw new TypeError("Unknown encoding: " + n)
            };
            n = ("" + n).toLowerCase(), a = !0
        }
      }
    }, n.prototype.toJSON = function() {
      return {
        type: "Buffer",
        data: Array.prototype.slice.call(this._arr || this, 0)
      }
    }, n.prototype.slice = function(e, t) {
      var i = this.length;
      e = ~~e, t = void(0) === t ? i : ~~t, 0 > e ? (e += i, 0 > e && (e = 0)) : e > i && (e = i), 0 > t ? (t += i, 0 > t && (t = 0)) : t > i && (t = i), e > t && (t = e);
      var r;
      if (n.TYPED_ARRAY_SUPPORT) {
        r = n._augment(this.subarray(e, t))
      } else {
        var o = t - e;
        r = new n(o, void(0));
        for (var a = 0; o > a; a++) {
          r[a] = this[a + e]
        }
      };
      return r.length && (r.parent = this.parent || this), r
    }, n.prototype.readUIntLE = function(e, t, i) {
      e >>>= 0, t >>>= 0, i || A(e, t, this.length);
      for (var n = this[e], r = 1, o = 0; ++o < t && (r *= 256);) {
        n += this[e + o] * r
      };
      return n
    }, n.prototype.readUIntBE = function(e, t, i) {
      e >>>= 0, t >>>= 0, i || A(e, t, this.length);
      for (var n = this[e + --t], r = 1; t > 0 && (r *= 256);) {
        n += this[e + --t] * r
      };
      return n
    }, n.prototype.readUInt8 = function(e, t) {
      return t || A(e, 1, this.length), this[e]
    }, n.prototype.readUInt16LE = function(e, t) {
      return t || A(e, 2, this.length), this[e] | this[e + 1] << 8
    }, n.prototype.readUInt16BE = function(e, t) {
      return t || A(e, 2, this.length), this[e] << 8 | this[e + 1]
    }, n.prototype.readUInt32LE = function(e, t) {
      return t || A(e, 4, this.length), (this[e] | this[e + 1] << 8 | this[e + 2] << 16) + 16777216 * this[e + 3]
    }, n.prototype.readUInt32BE = function(e, t) {
      return t || A(e, 4, this.length), 16777216 * this[e] + (this[e + 1] << 16 | this[e + 2] << 8 | this[e + 3])
    }, n.prototype.readIntLE = function(e, t, i) {
      e >>>= 0, t >>>= 0, i || A(e, t, this.length);
      for (var n = this[e], r = 1, o = 0; ++o < t && (r *= 256);) {
        n += this[e + o] * r
      };
      return r *= 128, n >= r && (n -= Math.pow(2, 8 * t)), n
    }, n.prototype.readIntBE = function(e, t, i) {
      e >>>= 0, t >>>= 0, i || A(e, t, this.length);
      for (var n = t, r = 1, o = this[e + --n]; n > 0 && (r *= 256);) {
        o += this[e + --n] * r
      };
      return r *= 128, o >= r && (o -= Math.pow(2, 8 * t)), o
    }, n.prototype.readInt8 = function(e, t) {
      return t || A(e, 1, this.length), 128 & this[e] ? -1 * (255 - this[e] + 1) : this[e]
    }, n.prototype.readInt16LE = function(e, t) {
      t || A(e, 2, this.length);
      var i = this[e] | this[e + 1] << 8;
      return 32768 & i ? 4294901760 | i : i
    }, n.prototype.readInt16BE = function(e, t) {
      t || A(e, 2, this.length);
      var i = this[e + 1] | this[e] << 8;
      return 32768 & i ? 4294901760 | i : i
    }, n.prototype.readInt32LE = function(e, t) {
      return t || A(e, 4, this.length), this[e] | this[e + 1] << 8 | this[e + 2] << 16 | this[e + 3] << 24
    }, n.prototype.readInt32BE = function(e, t) {
      return t || A(e, 4, this.length), this[e] << 24 | this[e + 1] << 16 | this[e + 2] << 8 | this[e + 3]
    }, n.prototype.readFloatLE = function(e, t) {
      return t || A(e, 4, this.length), W.read(this, e, !0, 23, 4)
    }, n.prototype.readFloatBE = function(e, t) {
      return t || A(e, 4, this.length), W.read(this, e, !1, 23, 4)
    }, n.prototype.readDoubleLE = function(e, t) {
      return t || A(e, 8, this.length), W.read(this, e, !0, 52, 8)
    }, n.prototype.readDoubleBE = function(e, t) {
      return t || A(e, 8, this.length), W.read(this, e, !1, 52, 8)
    }, n.prototype.writeUIntLE = function(e, t, i, n) {
      e = +e, t >>>= 0, i >>>= 0, n || L(this, e, t, i, Math.pow(2, 8 * i), 0);
      var r = 1,
        o = 0;
      for (this[t] = 255 & e; ++o < i && (r *= 256);) {
        this[t + o] = e / r >>> 0 & 255
      };
      return t + i
    }, n.prototype.writeUIntBE = function(e, t, i, n) {
      e = +e, t >>>= 0, i >>>= 0, n || L(this, e, t, i, Math.pow(2, 8 * i), 0);
      var r = i - 1,
        o = 1;
      for (this[t + r] = 255 & e; --r >= 0 && (o *= 256);) {
        this[t + r] = e / o >>> 0 & 255
      };
      return t + i
    }, n.prototype.writeUInt8 = function(e, t, i) {
      return e = +e, t >>>= 0, i || L(this, e, t, 1, 255, 0), n.TYPED_ARRAY_SUPPORT || (e = Math.floor(e)), this[t] = e, t + 1
    }, n.prototype.writeUInt16LE = function(e, t, i) {
      return e = +e, t >>>= 0, i || L(this, e, t, 2, 65535, 0), n.TYPED_ARRAY_SUPPORT ? (this[t] = e, this[t + 1] = e >>> 8) : C(this, e, t, !0), t + 2
    }, n.prototype.writeUInt16BE = function(e, t, i) {
      return e = +e, t >>>= 0, i || L(this, e, t, 2, 65535, 0), n.TYPED_ARRAY_SUPPORT ? (this[t] = e >>> 8, this[t + 1] = e) : C(this, e, t, !1), t + 2
    }, n.prototype.writeUInt32LE = function(e, t, i) {
      return e = +e, t >>>= 0, i || L(this, e, t, 4, 4294967295, 0), n.TYPED_ARRAY_SUPPORT ? (this[t + 3] = e >>> 24, this[t + 2] = e >>> 16, this[t + 1] = e >>> 8, this[t] = e) : R(this, e, t, !0), t + 4
    }, n.prototype.writeUInt32BE = function(e, t, i) {
      return e = +e, t >>>= 0, i || L(this, e, t, 4, 4294967295, 0), n.TYPED_ARRAY_SUPPORT ? (this[t] = e >>> 24, this[t + 1] = e >>> 16, this[t + 2] = e >>> 8, this[t + 3] = e) : R(this, e, t, !1), t + 4
    }, n.prototype.writeIntLE = function(e, t, i, n) {
      e = +e, t >>>= 0, n || L(this, e, t, i, Math.pow(2, 8 * i - 1) - 1, -Math.pow(2, 8 * i - 1));
      var r = 0,
        o = 1,
        a = 0 > e ? 1 : 0;
      for (this[t] = 255 & e; ++r < i && (o *= 256);) {
        this[t + r] = (e / o >> 0) - a & 255
      };
      return t + i
    }, n.prototype.writeIntBE = function(e, t, i, n) {
      e = +e, t >>>= 0, n || L(this, e, t, i, Math.pow(2, 8 * i - 1) - 1, -Math.pow(2, 8 * i - 1));
      var r = i - 1,
        o = 1,
        a = 0 > e ? 1 : 0;
      for (this[t + r] = 255 & e; --r >= 0 && (o *= 256);) {
        this[t + r] = (e / o >> 0) - a & 255
      };
      return t + i
    }, n.prototype.writeInt8 = function(e, t, i) {
      return e = +e, t >>>= 0, i || L(this, e, t, 1, 127, -128), n.TYPED_ARRAY_SUPPORT || (e = Math.floor(e)), 0 > e && (e = 255 + e + 1), this[t] = e, t + 1
    }, n.prototype.writeInt16LE = function(e, t, i) {
      return e = +e, t >>>= 0, i || L(this, e, t, 2, 32767, -32768), n.TYPED_ARRAY_SUPPORT ? (this[t] = e, this[t + 1] = e >>> 8) : C(this, e, t, !0), t + 2
    }, n.prototype.writeInt16BE = function(e, t, i) {
      return e = +e, t >>>= 0, i || L(this, e, t, 2, 32767, -32768), n.TYPED_ARRAY_SUPPORT ? (this[t] = e >>> 8, this[t + 1] = e) : C(this, e, t, !1), t + 2
    }, n.prototype.writeInt32LE = function(e, t, i) {
      return e = +e, t >>>= 0, i || L(this, e, t, 4, 2147483647, -2147483648), n.TYPED_ARRAY_SUPPORT ? (this[t] = e, this[t + 1] = e >>> 8, this[t + 2] = e >>> 16, this[t + 3] = e >>> 24) : R(this, e, t, !0), t + 4
    }, n.prototype.writeInt32BE = function(e, t, i) {
      return e = +e, t >>>= 0, i || L(this, e, t, 4, 2147483647, -2147483648), 0 > e && (e = 4294967295 + e + 1), n.TYPED_ARRAY_SUPPORT ? (this[t] = e >>> 24, this[t + 1] = e >>> 16, this[t + 2] = e >>> 8, this[t + 3] = e) : R(this, e, t, !1), t + 4
    }, n.prototype.writeFloatLE = function(e, t, i) {
      return D(this, e, t, !0, i)
    }, n.prototype.writeFloatBE = function(e, t, i) {
      return D(this, e, t, !1, i)
    }, n.prototype.writeDoubleLE = function(e, t, i) {
      return O(this, e, t, !0, i)
    }, n.prototype.writeDoubleBE = function(e, t, i) {
      return O(this, e, t, !1, i)
    }, n.prototype.copy = function(e, t, i, r) {
      if (i || (i = 0), r || 0 === r || (r = this.length), t >= e.length && (t = e.length), t || (t = 0), r > 0 && i > r && (r = i), r === i) {
        return 0
      };
      if (0 === e.length || 0 === this.length) {
        return 0
      };
      if (0 > t) {
        throw new RangeError("targetStart out of bounds")
      };
      if (0 > i || i >= this.length) {
        throw new RangeError("sourceStart out of bounds")
      };
      if (0 > r) {
        throw new RangeError("sourceEnd out of bounds")
      };
      r > this.length && (r = this.length), e.length - t < r - i && (r = e.length - t + i);
      var o = r - i;
      if (1e3 > o || !n.TYPED_ARRAY_SUPPORT) {
        for (var a = 0; o > a; a++) {
          e[a + t] = this[a + i]
        }
      } else {
        e._set(this.subarray(i, i + o), t)
      };
      return o
    }, n.prototype.fill = function(e, t, i) {
      if (e || (e = 0), t || (t = 0), i || (i = this.length), t > i) {
        throw new RangeError("end < start")
      };
      if (i !== t && 0 !== this.length) {
        if (0 > t || t >= this.length) {
          throw new RangeError("start out of bounds")
        };
        if (0 > i || i > this.length) {
          throw new RangeError("end out of bounds")
        };
        var n;
        if ("number" == typeof e) {
          for (n = t; i > n; n++) {
            this[n] = e
          }
        } else {
          var r = N(e.toString()),
            o = r.length;
          for (n = t; i > n; n++) {
            this[n] = r[n % o]
          }
        };
        return this
      }
    }, n.prototype.toArrayBuffer = function() {
      if ("undefined" != typeof Uint8Array) {
        if (n.TYPED_ARRAY_SUPPORT) {
          return new n(this).buffer
        };
        for (var e = new Uint8Array(this.length), t = 0, i = e.length; i > t; t += 1) {
          e[t] = this[t]
        };
        return e.buffer
      };
      throw new TypeError("Buffer.toArrayBuffer not supported in this browser")
    };
    var Z = n.prototype;
    n._augment = function(e) {
      return e.constructor = n, e._isBuffer = !0, e._set = e["set"], e["get"] = Z["get"], e["set"] = Z["set"], e.write = Z.write, e.toString = Z.toString, e.toLocaleString = Z.toString, e.toJSON = Z.toJSON, e.equals = Z.equals, e.compare = Z.compare, e.indexOf = Z.indexOf, e.copy = Z.copy, e.slice = Z.slice, e.readUIntLE = Z.readUIntLE, e.readUIntBE = Z.readUIntBE, e.readUInt8 = Z.readUInt8, e.readUInt16LE = Z.readUInt16LE, e.readUInt16BE = Z.readUInt16BE, e.readUInt32LE = Z.readUInt32LE, e.readUInt32BE = Z.readUInt32BE, e.readIntLE = Z.readIntLE, e.readIntBE = Z.readIntBE, e.readInt8 = Z.readInt8, e.readInt16LE = Z.readInt16LE, e.readInt16BE = Z.readInt16BE, e.readInt32LE = Z.readInt32LE, e.readInt32BE = Z.readInt32BE, e.readFloatLE = Z.readFloatLE, e.readFloatBE = Z.readFloatBE, e.readDoubleLE = Z.readDoubleLE, e.readDoubleBE = Z.readDoubleBE, e.writeUInt8 = Z.writeUInt8, e.writeUIntLE = Z.writeUIntLE, e.writeUIntBE = Z.writeUIntBE, e.writeUInt16LE = Z.writeUInt16LE, e.writeUInt16BE = Z.writeUInt16BE, e.writeUInt32LE = Z.writeUInt32LE, e.writeUInt32BE = Z.writeUInt32BE, e.writeIntLE = Z.writeIntLE, e.writeIntBE = Z.writeIntBE, e.writeInt8 = Z.writeInt8, e.writeInt16LE = Z.writeInt16LE, e.writeInt16BE = Z.writeInt16BE, e.writeInt32LE = Z.writeInt32LE, e.writeInt32BE = Z.writeInt32BE, e.writeFloatLE = Z.writeFloatLE, e.writeFloatBE = Z.writeFloatBE, e.writeDoubleLE = Z.writeDoubleLE, e.writeDoubleBE = Z.writeDoubleBE, e.fill = Z.fill, e.inspect = Z.inspect, e.toArrayBuffer = Z.toArrayBuffer, e
    };
    var $ = /[^+\/0-9A-z\-]/g
  }

  function _$af271112(e, t, i) {
    var n = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
    ! function(e) {
      "use strict";

      function t(e) {
        var t = e.charCodeAt(0);
        return t === a || t === u ? 62 : t === s || t === d ? 63 : h > t ? -1 : h + 10 > t ? t - h + 26 + 26 : c + 26 > t ? t - c : l + 26 > t ? t - l + 26 : void(0)
      }

      function i(e) {
        function i(e) {
          l[u++] = e
        }
        var n, r, a, s, h, l;
        if (e.length % 4 > 0) {
          throw new Error("Invalid string. Length must be a multiple of 4")
        };
        var c = e.length;
        h = "=" === e.charAt(c - 2) ? 2 : "=" === e.charAt(c - 1) ? 1 : 0, l = new o(3 * e.length / 4 - h), a = h > 0 ? e.length - 4 : e.length;
        var u = 0;
        for (n = 0, r = 0; a > n; n += 4, r += 3) {
          s = t(e.charAt(n)) << 18 | t(e.charAt(n + 1)) << 12 | t(e.charAt(n + 2)) << 6 | t(e.charAt(n + 3)), i((16711680 & s) >> 16), i((65280 & s) >> 8), i(255 & s)
        };
        return 2 === h ? (s = t(e.charAt(n)) << 2 | t(e.charAt(n + 1)) >> 4, i(255 & s)) : 1 === h && (s = t(e.charAt(n)) << 10 | t(e.charAt(n + 1)) << 4 | t(e.charAt(n + 2)) >> 2, i(s >> 8 & 255), i(255 & s)), l
      }

      function r(e) {
        function t(e) {
          return n.charAt(e)
        }

        function i(e) {
          return t(e >> 18 & 63) + t(e >> 12 & 63) + t(e >> 6 & 63) + t(63 & e)
        }
        var r, o, a, s = e.length % 3,
          h = "";
        for (r = 0, a = e.length - s; a > r; r += 3) {
          o = (e[r] << 16) + (e[r + 1] << 8) + e[r + 2], h += i(o)
        };
        switch (s) {
          case 1:
            o = e[e.length - 1], h += t(o >> 2), h += t(o << 4 & 63), h += "==";
            break;
          case 2:
            o = (e[e.length - 2] << 8) + e[e.length - 1], h += t(o >> 10), h += t(o >> 4 & 63), h += t(o << 2 & 63), h += "="
        };
        return h
      }
      var o = "undefined" != typeof Uint8Array ? Uint8Array : Array,
        a = "+".charCodeAt(0),
        s = "/".charCodeAt(0),
        h = "0".charCodeAt(0),
        l = "a".charCodeAt(0),
        c = "A".charCodeAt(0),
        u = "-".charCodeAt(0),
        d = "_".charCodeAt(0);
      e.toByteArray = i, e.fromByteArray = r
    }("undefined" == typeof i ? this.base64js = {} : i)
  }

  function _$af271120(e, t, i) {
    i.read = function(e, t, i, n, r) {
      var o, a, s = 8 * r - n - 1,
        h = (1 << s) - 1,
        l = h >> 1,
        c = -7,
        u = i ? r - 1 : 0,
        d = i ? -1 : 1,
        p = e[t + u];
      for (u += d, o = p & (1 << -c) - 1, p >>= -c, c += s; c > 0; o = 256 * o + e[t + u], u += d, c -= 8) {;
      };
      for (a = o & (1 << -c) - 1, o >>= -c, c += n; c > 0; a = 256 * a + e[t + u], u += d, c -= 8) {;
      };
      if (0 === o) {
        o = 1 - l
      } else {
        if (o === h) {
          return a ? 0 / 0 : (p ? -1 : 1) * (1 / 0)
        };
        a += Math.pow(2, n), o -= l
      };
      return (p ? -1 : 1) * a * Math.pow(2, o - n)
    }, i.write = function(e, t, i, n, r, o) {
      var a, s, h, l = 8 * o - r - 1,
        c = (1 << l) - 1,
        u = c >> 1,
        d = 23 === r ? Math.pow(2, -24) - Math.pow(2, -77) : 0,
        p = n ? 0 : o - 1,
        f = n ? 1 : -1,
        m = 0 > t || 0 === t && 0 > 1 / t ? 1 : 0;
      for (t = Math.abs(t), isNaN(t) || t === 1 / 0 ? (s = isNaN(t) ? 1 : 0, a = c) : (a = Math.floor(Math.log(t) / Math.LN2), t * (h = Math.pow(2, -a)) < 1 && (a--, h *= 2), t += a + u >= 1 ? d / h : d * Math.pow(2, 1 - u), t * h >= 2 && (a++, h /= 2), a + u >= c ? (s = 0, a = c) : a + u >= 1 ? (s = (t * h - 1) * Math.pow(2, r), a += u) : (s = t * Math.pow(2, u - 1) * Math.pow(2, r), a = 0)); r >= 8; e[i + p] = 255 & s, p += f, s /= 256, r -= 8) {;
      };
      for (a = a << r | s, l += r; l > 0; e[i + p] = 255 & a, p += f, a /= 256, l -= 8) {;
      };
      e[i + p - f] |= 128 * m
    }
  }

  function _$af271123(e, t, i) {
    var n = Array.isArray,
      r = Object.prototype.toString;
    t.exports = n || function(e) {
      return !!e && "[object Array]" == r.call(e)
    }
  }

  function _$af271125(e, t, i) {
    function n() {
      this._events = this._events || {}, this._maxListeners = this._maxListeners || void(0)
    }

    function r(e) {
      return "function" == typeof e
    }

    function o(e) {
      return "number" == typeof e
    }

    function a(e) {
      return "object" == typeof e && null !== e
    }

    function s(e) {
      return void(0) === e
    }
    t.exports = n, n.EventEmitter = n, n.prototype._events = void(0), n.prototype._maxListeners = void(0), n.defaultMaxListeners = 10, n.prototype.setMaxListeners = function(e) {
      if (!o(e) || 0 > e || isNaN(e)) {
        throw TypeError("n must be a positive number")
      };
      return this._maxListeners = e, this
    }, n.prototype.emit = function(e) {
      var t, i, n, o, h, l;
      if (this._events || (this._events = {}), "error" === e && (!this._events.error || a(this._events.error) && !this._events.error.length)) {
        if (t = arguments[1], t instanceof Error) {
          throw t
        };
        throw TypeError("Uncaught, unspecified \"error\" event.")
      };
      if (i = this._events[e], s(i)) {
        return !1
      };
      if (r(i)) {
        switch (arguments.length) {
          case 1:
            i.call(this);
            break;
          case 2:
            i.call(this, arguments[1]);
            break;
          case 3:
            i.call(this, arguments[1], arguments[2]);
            break;
          default:
            for (n = arguments.length, o = new Array(n - 1), h = 1; n > h; h++) {
              o[h - 1] = arguments[h]
            };
            i.apply(this, o)
        }
      } else {
        if (a(i)) {
          for (n = arguments.length, o = new Array(n - 1), h = 1; n > h; h++) {
            o[h - 1] = arguments[h]
          };
          for (l = i.slice(), n = l.length, h = 0; n > h; h++) {
            l[h].apply(this, o)
          }
        }
      };
      return !0
    }, n.prototype.addListener = function(e, t) {
      var i;
      if (!r(t)) {
        throw TypeError("listener must be a function")
      };
      if (this._events || (this._events = {}), this._events.newListener && this.emit("newListener", e, r(t.listener) ? t.listener : t), this._events[e] ? a(this._events[e]) ? this._events[e].push(t) : this._events[e] = [this._events[e], t] : this._events[e] = t, a(this._events[e]) && !this._events[e].warned) {
        var i;
        i = s(this._maxListeners) ? n.defaultMaxListeners : this._maxListeners, i && i > 0 && this._events[e].length > i && (this._events[e].warned = !0, console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.", this._events[e].length), "function" == typeof console.trace && console.trace())
      };
      return this
    }, n.prototype.on = n.prototype.addListener, n.prototype.once = function(e, t) {
      function i() {
        this.removeListener(e, i), n || (n = !0, t.apply(this, arguments))
      }
      if (!r(t)) {
        throw TypeError("listener must be a function")
      };
      var n = !1;
      return i.listener = t, this.on(e, i), this
    }, n.prototype.removeListener = function(e, t) {
      var i, n, o, s;
      if (!r(t)) {
        throw TypeError("listener must be a function")
      };
      if (!this._events || !this._events[e]) {
        return this
      };
      if (i = this._events[e], o = i.length, n = -1, i === t || r(i.listener) && i.listener === t) {
        delete this._events[e], this._events.removeListener && this.emit("removeListener", e, t)
      } else {
        if (a(i)) {
          for (s = o; s-- > 0;) {
            if (i[s] === t || i[s].listener && i[s].listener === t) {
              n = s;
              break
            }
          };
          if (0 > n) {
            return this
          };
          1 === i.length ? (i.length = 0, delete this._events[e]) : i.splice(n, 1), this._events.removeListener && this.emit("removeListener", e, t)
        }
      };
      return this
    }, n.prototype.removeAllListeners = function(e) {
      var t, i;
      if (!this._events) {
        return this
      };
      if (!this._events.removeListener) {
        return 0 === arguments.length ? this._events = {} : this._events[e] && delete this._events[e], this
      };
      if (0 === arguments.length) {
        for (t in this._events) {
          "removeListener" !== t && this.removeAllListeners(t)
        };
        return this.removeAllListeners("removeListener"), this._events = {}, this
      };
      if (i = this._events[e], r(i)) {
        this.removeListener(e, i)
      } else {
        for (; i.length;) {
          this.removeListener(e, i[i.length - 1])
        }
      };
      return delete this._events[e], this
    }, n.prototype.listeners = function(e) {
      var t;
      return t = this._events && this._events[e] ? r(this._events[e]) ? [this._events[e]] : this._events[e].slice() : []
    }, n.listenerCount = function(e, t) {
      var i;
      return i = e._events && e._events[t] ? r(e._events[t]) ? 1 : e._events[t].length : 0
    }
  }

  function _$af271140(e, t, i) {
    (function(e) {
      function t(e, t) {
        for (var i = 0, n = e.length - 1; n >= 0; n--) {
          var r = e[n];
          "." === r ? e.splice(n, 1) : ".." === r ? (e.splice(n, 1), i++) : i && (e.splice(n, 1), i--)
        };
        if (t) {
          for (; i--; i) {
            e.unshift("..")
          }
        };
        return e
      }

      function n(e, t) {
        if (e.filter) {
          return e.filter(t)
        };
        for (var i = [], n = 0; n < e.length; n++) {
          t(e[n], n, e) && i.push(e[n])
        };
        return i
      }
      var r = /^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,
        o = function(e) {
          return r.exec(e).slice(1)
        };
      i.resolve = function() {
        for (var i = "", r = !1, o = arguments.length - 1; o >= -1 && !r; o--) {
          var a = o >= 0 ? arguments[o] : e.cwd();
          if ("string" != typeof a) {
            throw new TypeError("Arguments to path.resolve must be strings")
          };
          a && (i = a + "/" + i, r = "/" === a.charAt(0))
        };
        return i = t(n(i.split("/"), function(e) {
          return !!e
        }), !r).join("/"), (r ? "/" : "") + i || "."
      }, i.normalize = function(e) {
        var r = i.isAbsolute(e),
          o = "/" === a(e, -1);
        return e = t(n(e.split("/"), function(e) {
          return !!e
        }), !r).join("/"), e || r || (e = "."), e && o && (e += "/"), (r ? "/" : "") + e
      }, i.isAbsolute = function(e) {
        return "/" === e.charAt(0)
      }, i.join = function() {
        var e = Array.prototype.slice.call(arguments, 0);
        return i.normalize(n(e, function(e, t) {
          if ("string" != typeof e) {
            throw new TypeError("Arguments to path.join must be strings")
          };
          return e
        }).join("/"))
      }, i.relative = function(e, t) {
        function n(e) {
          for (var t = 0; t < e.length && "" === e[t]; t++) {;
          };
          for (var i = e.length - 1; i >= 0 && "" === e[i]; i--) {;
          };
          return t > i ? [] : e.slice(t, i - t + 1)
        }
        e = i.resolve(e).substr(1), t = i.resolve(t).substr(1);
        for (var r = n(e.split("/")), o = n(t.split("/")), a = Math.min(r.length, o.length), s = a, h = 0; a > h; h++) {
          if (r[h] !== o[h]) {
            s = h;
            break
          }
        };
        for (var l = [], h = s; h < r.length; h++) {
          l.push("..")
        };
        return l = l.concat(o.slice(s)), l.join("/")
      }, i.sep = "/", i.delimiter = ":", i.dirname = function(e) {
        var t = o(e),
          i = t[0],
          n = t[1];
        return i || n ? (n && (n = n.substr(0, n.length - 1)), i + n) : "."
      }, i.basename = function(e, t) {
        var i = o(e)[2];
        return t && i.substr(-1 * t.length) === t && (i = i.substr(0, i.length - t.length)), i
      }, i.extname = function(e) {
        return o(e)[3]
      };
      var a = "b" === "ab".substr(-1) ? function(e, t, i) {
        return e.substr(t, i)
      } : function(e, t, i) {
        return 0 > t && (t = e.length + t), e.substr(t, i)
      }
    }).call(this, e("_process"))
  }

  function _$af271159(e, t, i) {
    function n() {
      if (!s) {
        s = !0;
        for (var e, t = a.length; t;) {
          e = a, a = [];
          for (var i = -1; ++i < t;) {
            e[i]()
          };
          t = a.length
        };
        s = !1
      }
    }

    function r() {}
    var o = t.exports = {},
      a = [],
      s = !1;
    o.nextTick = function(e) {
      a.push(e), s || setTimeout(n, 0)
    }, o.title = "browser", o.browser = !0, o.env = {}, o.argv = [], o.version = "", o.versions = {}, o.on = r, o.addListener = r, o.once = r, o.off = r, o.removeListener = r, o.removeAllListeners = r, o.emit = r, o.binding = function(e) {
      throw new Error("process.binding is not supported")
    }, o.cwd = function() {
      return "/"
    }, o.chdir = function(e) {
      throw new Error("process.chdir is not supported")
    }, o.umask = function() {
      return 0
    }
  }

  function _$af271167(e, t, i) {
    (function(e) {
      ! function(n) {
        function r(e) {
          throw RangeError(D[e])
        }

        function o(e, t) {
          for (var i = e.length; i--;) {
            e[i] = t(e[i])
          };
          return e
        }

        function a(e, t) {
          return o(e.split(I), t).join(".")
        }

        function s(e) {
          for (var t, i, n = [], r = 0, o = e.length; o > r;) {
            t = e.charCodeAt(r++), t >= 55296 && 56319 >= t && o > r ? (i = e.charCodeAt(r++), 56320 == (64512 & i) ? n.push(((1023 & t) << 10) + (1023 & i) + 65536) : (n.push(t), r--)) : n.push(t)
          };
          return n
        }

        function h(e) {
          return o(e, function(e) {
            var t = "";
            return e > 65535 && (e -= 65536, t += B(e >>> 10 & 1023 | 55296), e = 56320 | 1023 & e), t += B(e)
          }).join("")
        }

        function l(e) {
          return 10 > e - 48 ? e - 22 : 26 > e - 65 ? e - 65 : 26 > e - 97 ? e - 97 : x
        }

        function c(e, t) {
          return e + 22 + 75 * (26 > e) - ((0 != t) << 5)
        }

        function u(e, t, i) {
          var n = 0;
          for (e = i ? k(e / T) : e >> 1, e += k(e / t); e > O * E >> 1; n += x) {
            e = k(e / O)
          };
          return k(n + (O + 1) * e / (e + S))
        }

        function d(e) {
          var t, i, n, o, a, s, c, d, p, f, m = [],
            g = e.length,
            v = 0,
            y = A,
            b = P;
          for (i = e.lastIndexOf(L), 0 > i && (i = 0), n = 0; i > n; ++n) {
            e.charCodeAt(n) >= 128 && r("not-basic"), m.push(e.charCodeAt(n))
          };
          for (o = i > 0 ? i + 1 : 0; g > o;) {
            for (a = v, s = 1, c = x; o >= g && r("invalid-input"), d = l(e.charCodeAt(o++)), (d >= x || d > k((_ - v) / s)) && r("overflow"), v += d * s, p = b >= c ? M : c >= b + E ? E : c - b, !(p > d); c += x) {
              f = x - p, s > k(_ / f) && r("overflow"), s *= f
            };
            t = m.length + 1, b = u(v - a, t, 0 == a), k(v / t) > _ - y && r("overflow"), y += k(v / t), v %= t, m.splice(v++, 0, y)
          };
          return h(m)
        }

        function p(e) {
          var t, i, n, o, a, h, l, d, p, f, m, g, v, y, b, w = [];
          for (e = s(e), g = e.length, t = A, i = 0, a = P, h = 0; g > h; ++h) {
            m = e[h], 128 > m && w.push(B(m))
          };
          for (n = o = w.length, o && w.push(L); g > n;) {
            for (l = _, h = 0; g > h; ++h) {
              m = e[h], m >= t && l > m && (l = m)
            };
            for (v = n + 1, l - t > k((_ - i) / v) && r("overflow"), i += (l - t) * v, t = l, h = 0; g > h; ++h) {
              if (m = e[h], t > m && ++i > _ && r("overflow"), m == t) {
                for (d = i, p = x; f = a >= p ? M : p >= a + E ? E : p - a, !(f > d); p += x) {
                  b = d - f, y = x - f, w.push(B(c(f + b % y, 0))), d = k(b / y)
                };
                w.push(B(c(d, 0))), a = u(i, v, n == o), i = 0, ++n
              }
            };
            ++i, ++t
          };
          return w.join("")
        }

        function f(e) {
          return a(e, function(e) {
            return C.test(e) ? d(e.slice(4).toLowerCase()) : e
          })
        }

        function m(e) {
          return a(e, function(e) {
            return R.test(e) ? "xn--" + p(e) : e
          })
        }
        var g = "object" == typeof i && i,
          v = "object" == typeof t && t && t.exports == g && t,
          y = "object" == typeof e && e;
        (y.global === y || y.window === y) && (n = y);
        var b, w, _ = 2147483647,
          x = 36,
          M = 1,
          E = 26,
          S = 38,
          T = 700,
          P = 72,
          A = 128,
          L = "-",
          C = /^xn--/,
          R = /[^ -~]/,
          I = /\x2E|\u3002|\uFF0E|\uFF61/g,
          D = {
            overflow: "Overflow: input needs wider integers to process",
            "not-basic": "Illegal input >= 0x80 (not a basic code point)",
            "invalid-input": "Invalid input"
          },
          O = x - M,
          k = Math.floor,
          B = String.fromCharCode;
        if (b = {
            version: "1.2.4",
            ucs2: {
              decode: s,
              encode: h
            },
            decode: d,
            encode: p,
            toASCII: m,
            toUnicode: f
          }, "function" == typeof define && "object" == typeof define.amd && define.amd) {
          define("punycode", function() {
            return b
          })
        } else {
          if (g && !g.nodeType) {
            if (v) {
              v.exports = b
            } else {
              for (w in b) {
                b.hasOwnProperty(w) && (g[w] = b[w])
              }
            }
          } else {
            n.punycode = b
          }
        }
      }(this)
    }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
  }

  function _$af271186(e, t, i) {
    "use strict";

    function n(e, t) {
      return Object.prototype.hasOwnProperty.call(e, t)
    }
    t.exports = function(e, t, i, o) {
      t = t || "&", i = i || "=";
      var a = {};
      if ("string" != typeof e || 0 === e.length) {
        return a
      };
      var s = /\+/g;
      e = e.split(t);
      var h = 1e3;
      o && "number" == typeof o.maxKeys && (h = o.maxKeys);
      var l = e.length;
      h > 0 && l > h && (l = h);
      for (var c = 0; l > c; ++c) {
        var u, d, p, f, m = e[c].replace(s, "%20"),
          g = m.indexOf(i);
        g >= 0 ? (u = m.substr(0, g), d = m.substr(g + 1)) : (u = m, d = ""), p = decodeURIComponent(u), f = decodeURIComponent(d), n(a, p) ? r(a[p]) ? a[p].push(f) : a[p] = [a[p], f] : a[p] = f
      };
      return a
    };
    var r = Array.isArray || function(e) {
      return "[object Array]" === Object.prototype.toString.call(e)
    }
  }

  function _$af271190(e, t, i) {
    "use strict";

    function n(e, t) {
      if (e.map) {
        return e.map(t)
      };
      for (var i = [], n = 0; n < e.length; n++) {
        i.push(t(e[n], n))
      };
      return i
    }
    var r = function(e) {
      switch (typeof e) {
        case "string":
          return e;
        case "boolean":
          return e ? "true" : "false";
        case "number":
          return isFinite(e) ? e : "";
        default:
          return ""
      }
    };
    t.exports = function(e, t, i, s) {
      return t = t || "&", i = i || "=", null === e && (e = void(0)), "object" == typeof e ? n(a(e), function(a) {
        var s = encodeURIComponent(r(a)) + i;
        return o(e[a]) ? n(e[a], function(e) {
          return s + encodeURIComponent(r(e))
        }).join(t) : s + encodeURIComponent(r(e[a]))
      }).join(t) : s ? encodeURIComponent(r(s)) + i + encodeURIComponent(r(e)) : ""
    };
    var o = Array.isArray || function(e) {
        return "[object Array]" === Object.prototype.toString.call(e)
      },
      a = Object.keys || function(e) {
        var t = [];
        for (var i in e) {
          Object.prototype.hasOwnProperty.call(e, i) && t.push(i)
        };
        return t
      }
  }

  function _$af271198(e, t, i) {
    "use strict";
    i.decode = i.parse = e("./decode"), i.encode = i.stringify = e("./encode")
  }

  function _$af271199(e, t, i) {
    function n() {
      this.protocol = null, this.slashes = null, this.auth = null, this.host = null, this.port = null, this.hostname = null, this.hash = null, this.search = null, this.query = null, this.pathname = null, this.path = null, this.href = null
    }

    function r(e, t, i) {
      if (e && l(e) && e instanceof n) {
        return e
      };
      var r = new n;
      return r.parse(e, t, i), r
    }

    function o(e) {
      return h(e) && (e = r(e)), e instanceof n ? e.format() : n.prototype.format.call(e)
    }

    function a(e, t) {
      return r(e, !1, !0).resolve(t)
    }

    function s(e, t) {
      return e ? r(e, !1, !0).resolveObject(t) : t
    }

    function h(e) {
      return "string" == typeof e
    }

    function l(e) {
      return "object" == typeof e && null !== e
    }

    function c(e) {
      return null === e
    }

    function u(e) {
      return null == e
    }
    var d = e("punycode");
    i.parse = r, i.resolve = a, i.resolveObject = s, i.format = o, i.Url = n;
    var p = /^([a-z0-9.+-]+:)/i,
      f = /:[0-9]*$/,
      m = ["<", ">", "\"", "`", " ", "\x0D", "\x0A", "\x09"],
      g = ["{", "}", "|", "\\", "^", "`"].concat(m),
      v = ["'"].concat(g),
      y = ["%", "/", "?", ";", "#"].concat(v),
      b = ["/", "?", "#"],
      w = 255,
      _ = /^[a-z0-9A-Z_-]{0,63}$/,
      x = /^([a-z0-9A-Z_-]{0,63})(.*)$/,
      M = {
        javascript: !0,
        "javascript:": !0
      },
      E = {
        javascript: !0,
        "javascript:": !0
      },
      S = {
        http: !0,
        https: !0,
        ftp: !0,
        gopher: !0,
        file: !0,
        "http:": !0,
        "https:": !0,
        "ftp:": !0,
        "gopher:": !0,
        "file:": !0
      },
      T = e("querystring");
    n.prototype.parse = function(e, t, i) {
      if (!h(e)) {
        throw new TypeError("Parameter 'url' must be a string, not " + typeof e)
      };
      var n = e;
      n = n.trim();
      var r = p.exec(n);
      if (r) {
        r = r[0];
        var o = r.toLowerCase();
        this.protocol = o, n = n.substr(r.length)
      };
      if (i || r || n.match(/^\/\/[^@\/]+@[^@\/]+/)) {
        var a = "//" === n.substr(0, 2);
        !a || r && E[r] || (n = n.substr(2), this.slashes = !0)
      };
      if (!E[r] && (a || r && !S[r])) {
        for (var s = -1, l = 0; l < b.length; l++) {
          var c = n.indexOf(b[l]); - 1 !== c && (-1 === s || s > c) && (s = c)
        };
        var u, f;
        f = -1 === s ? n.lastIndexOf("@") : n.lastIndexOf("@", s), -1 !== f && (u = n.slice(0, f), n = n.slice(f + 1), this.auth = decodeURIComponent(u)), s = -1;
        for (var l = 0; l < y.length; l++) {
          var c = n.indexOf(y[l]); - 1 !== c && (-1 === s || s > c) && (s = c)
        }; - 1 === s && (s = n.length), this.host = n.slice(0, s), n = n.slice(s), this.parseHost(), this.hostname = this.hostname || "";
        var m = "[" === this.hostname[0] && "]" === this.hostname[this.hostname.length - 1];
        if (!m) {
          for (var g = this.hostname.split(/\./), l = 0, P = g.length; P > l; l++) {
            var A = g[l];
            if (A && !A.match(_)) {
              for (var L = "", C = 0, R = A.length; R > C; C++) {
                L += A.charCodeAt(C) > 127 ? "x" : A[C]
              };
              if (!L.match(_)) {
                var I = g.slice(0, l),
                  D = g.slice(l + 1),
                  O = A.match(x);
                O && (I.push(O[1]), D.unshift(O[2])), D.length && (n = "/" + D.join(".") + n), this.hostname = I.join(".");
                break
              }
            }
          }
        };
        if (this.hostname = this.hostname.length > w ? "" : this.hostname.toLowerCase(), !m) {
          for (var k = this.hostname.split("."), B = [], l = 0; l < k.length; ++l) {
            var F = k[l];
            B.push(F.match(/[^A-Za-z0-9_-]/) ? "xn--" + d.encode(F) : F)
          };
          this.hostname = B.join(".")
        };
        var N = this.port ? ":" + this.port : "",
          U = this.hostname || "";
        this.host = U + N, this.href += this.host, m && (this.hostname = this.hostname.substr(1, this.hostname.length - 2), "/" !== n[0] && (n = "/" + n))
      };
      if (!M[o]) {
        for (var l = 0, P = v.length; P > l; l++) {
          var V = v[l],
            z = encodeURIComponent(V);
          z === V && (z = escape(V)), n = n.split(V).join(z)
        }
      };
      var G = n.indexOf("#"); - 1 !== G && (this.hash = n.substr(G), n = n.slice(0, G));
      var j = n.indexOf("?");
      if (-1 !== j ? (this.search = n.substr(j), this.query = n.substr(j + 1), t && (this.query = T.parse(this.query)), n = n.slice(0, j)) : t && (this.search = "", this.query = {}), n && (this.pathname = n), S[o] && this.hostname && !this.pathname && (this.pathname = "/"), this.pathname || this.search) {
        var N = this.pathname || "",
          F = this.search || "";
        this.path = N + F
      };
      return this.href = this.format(), this
    }, n.prototype.format = function() {
      var e = this.auth || "";
      e && (e = encodeURIComponent(e), e = e.replace(/%3A/i, ":"), e += "@");
      var t = this.protocol || "",
        i = this.pathname || "",
        n = this.hash || "",
        r = !1,
        o = "";
      this.host ? r = e + this.host : this.hostname && (r = e + (-1 === this.hostname.indexOf(":") ? this.hostname : "[" + this.hostname + "]"), this.port && (r += ":" + this.port)), this.query && l(this.query) && Object.keys(this.query).length && (o = T.stringify(this.query));
      var a = this.search || o && "?" + o || "";
      return t && ":" !== t.substr(-1) && (t += ":"), this.slashes || (!t || S[t]) && r !== !1 ? (r = "//" + (r || ""), i && "/" !== i.charAt(0) && (i = "/" + i)) : r || (r = ""), n && "#" !== n.charAt(0) && (n = "#" + n), a && "?" !== a.charAt(0) && (a = "?" + a), i = i.replace(/[?#]/g, function(e) {
        return encodeURIComponent(e)
      }), a = a.replace("#", "%23"), t + r + i + a + n
    }, n.prototype.resolve = function(e) {
      return this.resolveObject(r(e, !1, !0)).format()
    }, n.prototype.resolveObject = function(e) {
      if (h(e)) {
        var t = new n;
        t.parse(e, !1, !0), e = t
      };
      var i = new n;
      if (Object.keys(this).forEach(function(e) {
          i[e] = this[e]
        }, this), i.hash = e.hash, "" === e.href) {
        return i.href = i.format(), i
      };
      if (e.slashes && !e.protocol) {
        return Object.keys(e).forEach(function(t) {
          "protocol" !== t && (i[t] = e[t])
        }), S[i.protocol] && i.hostname && !i.pathname && (i.path = i.pathname = "/"), i.href = i.format(), i
      };
      if (e.protocol && e.protocol !== i.protocol) {
        if (!S[e.protocol]) {
          return Object.keys(e).forEach(function(t) {
            i[t] = e[t]
          }), i.href = i.format(), i
        };
        if (i.protocol = e.protocol, e.host || E[e.protocol]) {
          i.pathname = e.pathname
        } else {
          for (var r = (e.pathname || "").split("/"); r.length && !(e.host = r.shift());) {;
          };
          e.host || (e.host = ""), e.hostname || (e.hostname = ""), "" !== r[0] && r.unshift(""), r.length < 2 && r.unshift(""), i.pathname = r.join("/")
        };
        if (i.search = e.search, i.query = e.query, i.host = e.host || "", i.auth = e.auth, i.hostname = e.hostname || e.host, i.port = e.port, i.pathname || i.search) {
          var o = i.pathname || "",
            a = i.search || "";
          i.path = o + a
        };
        return i.slashes = i.slashes || e.slashes, i.href = i.format(), i
      };
      var s = i.pathname && "/" === i.pathname.charAt(0),
        l = e.host || e.pathname && "/" === e.pathname.charAt(0),
        d = l || s || i.host && e.pathname,
        p = d,
        f = i.pathname && i.pathname.split("/") || [],
        r = e.pathname && e.pathname.split("/") || [],
        m = i.protocol && !S[i.protocol];
      if (m && (i.hostname = "", i.port = null, i.host && ("" === f[0] ? f[0] = i.host : f.unshift(i.host)), i.host = "", e.protocol && (e.hostname = null, e.port = null, e.host && ("" === r[0] ? r[0] = e.host : r.unshift(e.host)), e.host = null), d = d && ("" === r[0] || "" === f[0])), l) {
        i.host = e.host || "" === e.host ? e.host : i.host, i.hostname = e.hostname || "" === e.hostname ? e.hostname : i.hostname, i.search = e.search, i.query = e.query, f = r
      } else {
        if (r.length) {
          f || (f = []), f.pop(), f = f.concat(r), i.search = e.search, i.query = e.query
        } else {
          if (!u(e.search)) {
            if (m) {
              i.hostname = i.host = f.shift();
              var g = i.host && i.host.indexOf("@") > 0 ? i.host.split("@") : !1;
              g && (i.auth = g.shift(), i.host = i.hostname = g.shift())
            };
            return i.search = e.search, i.query = e.query, c(i.pathname) && c(i.search) || (i.path = (i.pathname ? i.pathname : "") + (i.search ? i.search : "")), i.href = i.format(), i
          }
        }
      };
      if (!f.length) {
        return i.pathname = null, i.path = i.search ? "/" + i.search : null, i.href = i.format(), i
      };
      for (var v = f.slice(-1)[0], y = (i.host || e.host) && ("." === v || ".." === v) || "" === v, b = 0, w = f.length; w >= 0; w--) {
        v = f[w], "." == v ? f.splice(w, 1) : ".." === v ? (f.splice(w, 1), b++) : b && (f.splice(w, 1), b--)
      };
      if (!d && !p) {
        for (; b--; b) {
          f.unshift("..")
        }
      };
      !d || "" === f[0] || f[0] && "/" === f[0].charAt(0) || f.unshift(""), y && "/" !== f.join("/").substr(-1) && f.push("");
      var _ = "" === f[0] || f[0] && "/" === f[0].charAt(0);
      if (m) {
        i.hostname = i.host = _ ? "" : f.length ? f.shift() : "";
        var g = i.host && i.host.indexOf("@") > 0 ? i.host.split("@") : !1;
        g && (i.auth = g.shift(), i.host = i.hostname = g.shift())
      };
      return d = d || i.host && f.length, d && !_ && f.unshift(""), f.length ? i.pathname = f.join("/") : (i.pathname = null, i.path = null), c(i.pathname) && c(i.search) || (i.path = (i.pathname ? i.pathname : "") + (i.search ? i.search : "")), i.auth = e.auth || i.auth, i.slashes = i.slashes || e.slashes, i.href = i.format(), i
    }, n.prototype.parseHost = function() {
      var e = this.host,
        t = f.exec(e);
      t && (t = t[0], ":" !== t && (this.port = t.substr(1)), e = e.substr(0, e.length - t.length)), e && (this.hostname = e)
    }
  }

  function _$af271218(e, t, i) {
    "use strict";

    function n(e) {
      return h + e
    }

    function r(e) {
      return e.substring(h.length)
    }

    function o(e, t) {
      for (var i in t) {
        Object.defineProperty(e, i, {
          value: t[i],
          configurable: !0,
          writable: !0
        })
      }
    }

    function a(e) {
      if ("string" != typeof e) {
        throw new TypeError("key must be a string.")
      }
    }
    var s = Object.prototype.hasOwnProperty,
      h = "~";
    t.exports = function(e) {
      var t = Object.create(null),
        i = 0,
        h = {};
      return o(h, {
        get: function(e, i) {
          a(e);
          var r = n(e);
          return r in t ? t[r] : i
        },
        set: function(e, r) {
          a(e);
          var o = n(e);
          return o in t || ++i, t[o] = r
        },
        has: function(e) {
          return a(e), n(e) in t
        },
        "delete": function(e) {
          a(e);
          var r = n(e);
          return r in t ? (--i, delete t[r], !0) : !1
        },
        clear: function() {
          t = Object.create(null), i = 0
        },
        forEach: function(e, i) {
          if ("function" != typeof e) {
            throw new TypeError("`callback` must be a function")
          };
          for (var n in t) {
            if (s.call(t, n)) {
              var o = r(n),
                a = t[n];
              e.call(i, a, o, h)
            }
          }
        }
      }), Object.defineProperty(h, "size", {
        get: function() {
          return i
        },
        configurable: !0
      }), "object" == typeof e && null !== e && Object.keys(e).forEach(function(t) {
        h["set"](t, e[t])
      }), h
    }
  }

  function _$af271232(e, t, i) {
    t.exports = e("./lib/heap")
  }

  function _$af271233(e, t, i) {
    (function() {
      var e, n, r, o, a, s, h, l, c, u, d, p, f, m, g;
      r = Math.floor, u = Math.min, n = function(e, t) {
          return t > e ? -1 : e > t ? 1 : 0
        }, c = function(e, t, i, o, a) {
          var s;
          if (null == i && (i = 0), null == a && (a = n), 0 > i) {
            throw new Error("lo must be non-negative")
          };
          for (null == o && (o = e.length); o > i;) {
            s = r((i + o) / 2), a(t, e[s]) < 0 ? o = s : i = s + 1
          };
          return [].splice.apply(e, [i, i - i].concat(t)), t
        }, s = function(e, t, i) {
          return null == i && (i = n), e.push(t), m(e, 0, e.length - 1, i)
        }, a = function(e, t) {
          var i, r;
          return null == t && (t = n), i = e.pop(), e.length ? (r = e[0], e[0] = i, g(e, 0, t)) : r = i, r
        }, l = function(e, t, i) {
          var r;
          return null == i && (i = n), r = e[0], e[0] = t, g(e, 0, i), r
        }, h = function(e, t, i) {
          var r;
          return null == i && (i = n), e.length && i(e[0], t) < 0 && (r = [e[0], t], t = r[0], e[0] = r[1], g(e, 0, i)), t
        }, o = function(e, t) {
          var i, o, a, s, h, l;
          for (null == t && (t = n), s = function() {
              l = [];
              for (var t = 0, i = r(e.length / 2); i >= 0 ? i > t : t > i; i >= 0 ? t++ : t--) {
                l.push(t)
              };
              return l
            }.apply(this).reverse(), h = [], o = 0, a = s.length; a > o; o++) {
            i = s[o], h.push(g(e, i, t))
          };
          return h
        }, f = function(e, t, i) {
          var r;
          return null == i && (i = n), r = e.indexOf(t), -1 !== r ? (m(e, 0, r, i), g(e, r, i)) : void(0)
        }, d = function(e, t, i) {
          var r, a, s, l, c;
          if (null == i && (i = n), a = e.slice(0, t), !a.length) {
            return a
          };
          for (o(a, i), c = e.slice(t), s = 0, l = c.length; l > s; s++) {
            r = c[s], h(a, r, i)
          };
          return a.sort(i).reverse()
        }, p = function(e, t, i) {
          var r, s, h, l, d, p, f, m, g, v;
          if (null == i && (i = n), 10 * t <= e.length) {
            if (l = e.slice(0, t).sort(i), !l.length) {
              return l
            };
            for (h = l[l.length - 1], m = e.slice(t), d = 0, f = m.length; f > d; d++) {
              r = m[d], i(r, h) < 0 && (c(l, r, 0, null, i), l.pop(), h = l[l.length - 1])
            };
            return l
          };
          for (o(e, i), v = [], s = p = 0, g = u(t, e.length); g >= 0 ? g > p : p > g; s = g >= 0 ? ++p : --p) {
            v.push(a(e, i))
          };
          return v
        }, m = function(e, t, i, r) {
          var o, a, s;
          for (null == r && (r = n), o = e[i]; i > t && (s = i - 1 >> 1, a = e[s], r(o, a) < 0);) {
            e[i] = a, i = s
          };
          return e[i] = o
        }, g = function(e, t, i) {
          var r, o, a, s, h;
          for (null == i && (i = n), o = e.length, h = t, a = e[t], r = 2 * t + 1; o > r;) {
            s = r + 1, o > s && !(i(e[r], e[s]) < 0) && (r = s), e[t] = e[r], t = r, r = 2 * t + 1
          };
          return e[t] = a, m(e, h, t, i)
        }, e = function() {
          function e(e) {
            this.cmp = null != e ? e : n, this.nodes = []
          }
          return e.push = s, e.pop = a, e.replace = l, e.pushpop = h, e.heapify = o, e.updateItem = f, e.nlargest = d, e.nsmallest = p, e.prototype.push = function(e) {
            return s(this.nodes, e, this.cmp)
          }, e.prototype.pop = function() {
            return a(this.nodes, this.cmp)
          }, e.prototype.peek = function() {
            return this.nodes[0]
          }, e.prototype.contains = function(e) {
            return -1 !== this.nodes.indexOf(e)
          }, e.prototype.replace = function(e) {
            return l(this.nodes, e, this.cmp)
          }, e.prototype.pushpop = function(e) {
            return h(this.nodes, e, this.cmp)
          }, e.prototype.heapify = function() {
            return o(this.nodes, this.cmp)
          }, e.prototype.updateItem = function(e) {
            return f(this.nodes, e, this.cmp)
          }, e.prototype.clear = function() {
            return this.nodes = []
          }, e.prototype.empty = function() {
            return 0 === this.nodes.length
          }, e.prototype.size = function() {
            return this.nodes.length
          }, e.prototype.clone = function() {
            var t;
            return t = new e, t.nodes = this.nodes.slice(0), t
          }, e.prototype.toArray = function() {
            return this.nodes.slice(0)
          }, e.prototype.insert = e.prototype.push, e.prototype.top = e.prototype.peek, e.prototype.front = e.prototype.peek, e.prototype.has = e.prototype.contains, e.prototype.copy = e.prototype.clone, e
        }(),
        function(e, n) {
          return "function" == typeof define && define.amd ? define([], n) : "object" == typeof i ? t.exports = n() : e.Heap = n()
        }(this, function() {
          return e
        })
    }).call(this)
  }

  function _$af271265(e, t, i) {
    (function(i) {
      ! function(i, n) {
        "function" == typeof define && define.amd ? define(["bytebuffer"], n) : "function" == typeof e && "object" == typeof t && t && t.exports ? t.exports = n(e("bytebuffer"), !0) : (i.dcodeIO = i.dcodeIO || {}).ProtoBuf = n(i.dcodeIO.ByteBuffer)
      }(this, function(t, n) {
        "use strict";
        var r = {};
        return r.ByteBuffer = t, r.Long = t.Long || null, r.VERSION = "5.0.1", r.WIRE_TYPES = {}, r.WIRE_TYPES.VARINT = 0, r.WIRE_TYPES.BITS64 = 1, r.WIRE_TYPES.LDELIM = 2, r.WIRE_TYPES.STARTGROUP = 3, r.WIRE_TYPES.ENDGROUP = 4, r.WIRE_TYPES.BITS32 = 5, r.PACKABLE_WIRE_TYPES = [r.WIRE_TYPES.VARINT, r.WIRE_TYPES.BITS64, r.WIRE_TYPES.BITS32], r.TYPES = {
          int32: {
            name: "int32",
            wireType: r.WIRE_TYPES.VARINT,
            defaultValue: 0
          },
          uint32: {
            name: "uint32",
            wireType: r.WIRE_TYPES.VARINT,
            defaultValue: 0
          },
          sint32: {
            name: "sint32",
            wireType: r.WIRE_TYPES.VARINT,
            defaultValue: 0
          },
          int64: {
            name: "int64",
            wireType: r.WIRE_TYPES.VARINT,
            defaultValue: r.Long ? r.Long.ZERO : void(0)
          },
          uint64: {
            name: "uint64",
            wireType: r.WIRE_TYPES.VARINT,
            defaultValue: r.Long ? r.Long.UZERO : void(0)
          },
          sint64: {
            name: "sint64",
            wireType: r.WIRE_TYPES.VARINT,
            defaultValue: r.Long ? r.Long.ZERO : void(0)
          },
          bool: {
            name: "bool",
            wireType: r.WIRE_TYPES.VARINT,
            defaultValue: !1
          },
          "double": {
            name: "double",
            wireType: r.WIRE_TYPES.BITS64,
            defaultValue: 0
          },
          string: {
            name: "string",
            wireType: r.WIRE_TYPES.LDELIM,
            defaultValue: ""
          },
          bytes: {
            name: "bytes",
            wireType: r.WIRE_TYPES.LDELIM,
            defaultValue: null
          },
          fixed32: {
            name: "fixed32",
            wireType: r.WIRE_TYPES.BITS32,
            defaultValue: 0
          },
          sfixed32: {
            name: "sfixed32",
            wireType: r.WIRE_TYPES.BITS32,
            defaultValue: 0
          },
          fixed64: {
            name: "fixed64",
            wireType: r.WIRE_TYPES.BITS64,
            defaultValue: r.Long ? r.Long.UZERO : void(0)
          },
          sfixed64: {
            name: "sfixed64",
            wireType: r.WIRE_TYPES.BITS64,
            defaultValue: r.Long ? r.Long.ZERO : void(0)
          },
          "float": {
            name: "float",
            wireType: r.WIRE_TYPES.BITS32,
            defaultValue: 0
          },
          "enum": {
            name: "enum",
            wireType: r.WIRE_TYPES.VARINT,
            defaultValue: 0
          },
          message: {
            name: "message",
            wireType: r.WIRE_TYPES.LDELIM,
            defaultValue: null
          },
          group: {
            name: "group",
            wireType: r.WIRE_TYPES.STARTGROUP,
            defaultValue: null
          }
        }, r.MAP_KEY_TYPES = [r.TYPES.int32, r.TYPES.sint32, r.TYPES.sfixed32, r.TYPES.uint32, r.TYPES.fixed32, r.TYPES.int64, r.TYPES.sint64, r.TYPES.sfixed64, r.TYPES.uint64, r.TYPES.fixed64, r.TYPES.bool, r.TYPES.string, r.TYPES.bytes], r.ID_MIN = 1, r.ID_MAX = 536870911, r.convertFieldsToCamelCase = !1, r.populateAccessors = !0, r.populateDefaults = !0, r.Util = function() {
          var t = {};
          return t.IS_NODE = !("object" != typeof i || i + "" != "[object process]" || i.browser), t.XHR = function() {
            for (var e = [function() {
                return new XMLHttpRequest
              }, function() {
                return new ActiveXObject("Msxml2.XMLHTTP")
              }, function() {
                return new ActiveXObject("Msxml3.XMLHTTP")
              }, function() {
                return new ActiveXObject("Microsoft.XMLHTTP")
              }], t = null, i = 0; i < e.length; i++) {
              try {
                t = e[i]()
              } catch (n) {
                continue
              };
              break
            };
            if (!t) {
              throw Error("XMLHttpRequest is not supported")
            };
            return t
          }, t.fetch = function(i, n) {
            if (n && "function" != typeof n && (n = null), t.IS_NODE) {
              var r = e("fs");
              if (n) {
                r.readFile(i, function(e, t) {
                  n(e ? null : "" + t)
                })
              } else {
                try {
                  return r.readFileSync(i)
                } catch (o) {
                  return null
                }
              }
            } else {
              var a = t.XHR();
              if (a.open("GET", i, n ? !0 : !1), a.setRequestHeader("Accept", "text/plain"), "function" == typeof a.overrideMimeType && a.overrideMimeType("text/plain"), !n) {
                return a.send(null), 200 == a.status || 0 == a.status && "string" == typeof a.responseText ? a.responseText : null
              };
              if (a.onreadystatechange = function() {
                  4 == a.readyState && n(200 == a.status || 0 == a.status && "string" == typeof a.responseText ? a.responseText : null)
                }, 4 == a.readyState) {
                return
              };
              a.send(null)
            }
          }, t.toCamelCase = function(e) {
            return e.replace(/_([a-zA-Z])/g, function(e, t) {
              return t.toUpperCase()
            })
          }, t
        }(), r.Lang = {
          DELIM: /[\s\{\}=;:\[\],'"\(\)<>]/g,
          RULE: /^(?:required|optional|repeated|map)$/,
          TYPE: /^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,
          NAME: /^[a-zA-Z_][a-zA-Z_0-9]*$/,
          TYPEDEF: /^[a-zA-Z][a-zA-Z_0-9]*$/,
          TYPEREF: /^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,
          FQTYPEREF: /^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,
          NUMBER: /^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,
          NUMBER_DEC: /^(?:[1-9][0-9]*|0)$/,
          NUMBER_HEX: /^0[xX][0-9a-fA-F]+$/,
          NUMBER_OCT: /^0[0-7]+$/,
          NUMBER_FLT: /^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,
          BOOL: /^(?:true|false)$/i,
          ID: /^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,
          NEGID: /^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,
          WHITESPACE: /\s/,
          STRING: /(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,
          STRING_DQ: /(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,
          STRING_SQ: /(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g
        }, r.DotProto = function(e, t) {
          function i(e, i) {
            var n = -1,
              r = 1;
            if ("-" == e.charAt(0) && (r = -1, e = e.substring(1)), t.NUMBER_DEC.test(e)) {
              n = parseInt(e)
            } else {
              if (t.NUMBER_HEX.test(e)) {
                n = parseInt(e.substring(2), 16)
              } else {
                if (!t.NUMBER_OCT.test(e)) {
                  throw Error("illegal id value: " + (0 > r ? "-" : "") + e)
                };
                n = parseInt(e.substring(1), 8)
              }
            };
            if (n = r * n | 0, !i && 0 > n) {
              throw Error("illegal id value: " + (0 > r ? "-" : "") + e)
            };
            return n
          }

          function n(e) {
            var i = 1;
            if ("-" == e.charAt(0) && (i = -1, e = e.substring(1)), t.NUMBER_DEC.test(e)) {
              return i * parseInt(e, 10)
            };
            if (t.NUMBER_HEX.test(e)) {
              return i * parseInt(e.substring(2), 16)
            };
            if (t.NUMBER_OCT.test(e)) {
              return i * parseInt(e.substring(1), 8)
            };
            if ("inf" === e) {
              return i * (1 / 0)
            };
            if ("nan" === e) {
              return 0 / 0
            };
            if (t.NUMBER_FLT.test(e)) {
              return i * parseFloat(e)
            };
            throw Error("illegal number value: " + (0 > i ? "-" : "") + e)
          }

          function r(e, t, i) {
            "undefined" == typeof e[t] ? e[t] = i : (Array.isArray(e[t]) || (e[t] = [e[t]]), e[t].push(i))
          }
          var o = {},
            a = function(e) {
              this.source = e + "", this.index = 0, this.line = 1, this.stack = [], this._stringOpen = null
            },
            s = a.prototype;
          s._readString = function() {
            var e = "\"" === this._stringOpen ? t.STRING_DQ : t.STRING_SQ;
            e.lastIndex = this.index - 1;
            var i = e.exec(this.source);
            if (!i) {
              throw Error("unterminated string")
            };
            return this.index = e.lastIndex, this.stack.push(this._stringOpen), this._stringOpen = null, i[1]
          }, s.next = function() {
            if (this.stack.length > 0) {
              return this.stack.shift()
            };
            if (this.index >= this.source.length) {
              return null
            };
            if (null !== this._stringOpen) {
              return this._readString()
            };
            var e, i, n;
            do {
              for (e = !1; t.WHITESPACE.test(n = this.source.charAt(this.index));) {
                if ("\x0A" === n && ++this.line, ++this.index === this.source.length) {
                  return null
                }
              };
              if ("/" === this.source.charAt(this.index)) {
                if (++this.index, "/" === this.source.charAt(this.index)) {
                  for (;
                    "\x0A" !== this.source.charAt(++this.index);) {
                    if (this.index == this.source.length) {
                      return null
                    }
                  };
                  ++this.index, ++this.line, e = !0
                } else {
                  if ("*" !== (n = this.source.charAt(this.index))) {
                    return "/"
                  };
                  do {
                    if ("\x0A" === n && ++this.line, ++this.index === this.source.length) {
                      return null
                    };
                    i = n, n = this.source.charAt(this.index)
                  } while ("*" !== i || "/" !== n);;
                  ++this.index, e = !0
                }
              }
            } while (e);;
            if (this.index === this.source.length) {
              return null
            };
            var r = this.index;
            t.DELIM.lastIndex = 0;
            var o = t.DELIM.test(this.source.charAt(r++));
            if (!o) {
              for (; r < this.source.length && !t.DELIM.test(this.source.charAt(r));) {
                ++r
              }
            };
            var a = this.source.substring(this.index, this.index = r);
            return ("\"" === a || "'" === a) && (this._stringOpen = a), a
          }, s.peek = function() {
            if (0 === this.stack.length) {
              var e = this.next();
              if (null === e) {
                return null
              };
              this.stack.push(e)
            };
            return this.stack[0]
          }, s.skip = function(e) {
            var t = this.next();
            if (t !== e) {
              throw Error("illegal '" + t + "', '" + e + "' expected")
            }
          }, s.omit = function(e) {
            return this.peek() === e ? (this.next(), !0) : !1
          }, s.toString = function() {
            return "Tokenizer (" + this.index + "/" + this.source.length + " at line " + this.line + ")"
          }, o.Tokenizer = a;
          var h = function(e) {
              this.tn = new a(e), this.proto3 = !1
            },
            l = h.prototype;
          return l.parse = function() {
            var e, i, n = {
                name: "[ROOT]",
                "package": null,
                messages: [],
                enums: [],
                imports: [],
                options: {},
                services: []
              },
              r = !0;
            try {
              for (; e = this.tn.next();) {
                switch (e) {
                  case "package":
                    if (!r || null !== n["package"]) {
                      throw Error("unexpected 'package'")
                    };
                    if (e = this.tn.next(), !t.TYPEREF.test(e)) {
                      throw Error("illegal package name: " + e)
                    };
                    this.tn.skip(";"), n["package"] = e;
                    break;
                  case "import":
                    if (!r) {
                      throw Error("unexpected 'import'")
                    };
                    e = this.tn.peek(), ("public" === e || (i = "weak" === e)) && this.tn.next(), e = this._readString(), this.tn.skip(";"), i || n.imports.push(e);
                    break;
                  case "syntax":
                    if (!r) {
                      throw Error("unexpected 'syntax'")
                    };
                    this.tn.skip("="), "proto3" === (n.syntax = this._readString()) && (this.proto3 = !0), this.tn.skip(";");
                    break;
                  case "message":
                    this._parseMessage(n, null), r = !1;
                    break;
                  case "enum":
                    this._parseEnum(n), r = !1;
                    break;
                  case "option":
                    this._parseOption(n);
                    break;
                  case "service":
                    this._parseService(n);
                    break;
                  case "extend":
                    this._parseExtend(n);
                    break;
                  default:
                    throw Error("unexpected '" + e + "'")
                }
              }
            } catch (o) {
              throw o.message = "Parse error at line " + this.tn.line + ": " + o.message, o
            };
            return delete n.name, n
          }, h.parse = function(e) {
            return new h(e).parse()
          }, l._readString = function() {
            var e, t, i = "";
            do {
              if (t = this.tn.next(), "'" !== t && "\"" !== t) {
                throw Error("illegal string delimiter: " + t)
              };
              i += this.tn.next(), this.tn.skip(t), e = this.tn.peek()
            } while ("\"" === e || "\"" === e);;
            return i
          }, l._readValue = function(e) {
            var i = this.tn.peek();
            if ("\"" === i || "'" === i) {
              return this._readString()
            };
            if (this.tn.next(), t.NUMBER.test(i)) {
              return n(i)
            };
            if (t.BOOL.test(i)) {
              return "true" === i.toLowerCase()
            };
            if (e && t.TYPEREF.test(i)) {
              return i
            };
            throw Error("illegal value: " + i)
          }, l._parseOption = function(e, i) {
            var n = this.tn.next(),
              r = !1;
            if ("(" === n && (r = !0, n = this.tn.next()), !t.TYPEREF.test(n)) {
              throw Error("illegal option name: " + n)
            };
            var o = n;
            r && (this.tn.skip(")"), o = "(" + o + ")", n = this.tn.peek(), t.FQTYPEREF.test(n) && (o += n, this.tn.next())), this.tn.skip("="), this._parseOptionValue(e, o), i || this.tn.skip(";")
          }, l._parseOptionValue = function(e, i) {
            var n = this.tn.peek();
            if ("{" !== n) {
              r(e.options, i, this._readValue(!0))
            } else {
              for (this.tn.skip("{");
                "}" !== (n = this.tn.next());) {
                if (!t.NAME.test(n)) {
                  throw Error("illegal option name: " + i + "." + n)
                };
                this.tn.omit(":") ? r(e.options, i + "." + n, this._readValue(!0)) : this._parseOptionValue(e, i + "." + n)
              }
            }
          }, l._parseService = function(e) {
            var i = this.tn.next();
            if (!t.NAME.test(i)) {
              throw Error("illegal service name at line " + this.tn.line + ": " + i)
            };
            var n = i,
              r = {
                name: n,
                rpc: {},
                options: {}
              };
            for (this.tn.skip("{");
              "}" !== (i = this.tn.next());) {
              if ("option" === i) {
                this._parseOption(r)
              } else {
                if ("rpc" !== i) {
                  throw Error("illegal service token: " + i)
                };
                this._parseServiceRPC(r)
              }
            };
            this.tn.omit(";"), e.services.push(r)
          }, l._parseServiceRPC = function(e) {
            var i = "rpc",
              n = this.tn.next();
            if (!t.NAME.test(n)) {
              throw Error("illegal rpc service method name: " + n)
            };
            var r = n,
              o = {
                request: null,
                response: null,
                request_stream: !1,
                response_stream: !1,
                options: {}
              };
            if (this.tn.skip("("), n = this.tn.next(), "stream" === n.toLowerCase() && (o.request_stream = !0, n = this.tn.next()), !t.TYPEREF.test(n)) {
              throw Error("illegal rpc service request type: " + n)
            };
            if (o.request = n, this.tn.skip(")"), n = this.tn.next(), "returns" !== n.toLowerCase()) {
              throw Error("illegal rpc service request type delimiter: " + n)
            };
            if (this.tn.skip("("), n = this.tn.next(), "stream" === n.toLowerCase() && (o.response_stream = !0, n = this.tn.next()), o.response = n, this.tn.skip(")"), n = this.tn.peek(), "{" === n) {
              for (this.tn.next();
                "}" !== (n = this.tn.next());) {
                if ("option" !== n) {
                  throw Error("illegal rpc service token: " + n)
                };
                this._parseOption(o)
              };
              this.tn.omit(";")
            } else {
              this.tn.skip(";")
            };
            "undefined" == typeof e[i] && (e[i] = {}), e[i][r] = o
          }, l._parseMessage = function(e, n) {
            var r = !!n,
              o = this.tn.next(),
              a = {
                name: "",
                fields: [],
                enums: [],
                messages: [],
                options: {},
                services: [],
                oneofs: {}
              };
            if (!t.NAME.test(o)) {
              throw Error("illegal " + (r ? "group" : "message") + " name: " + o)
            };
            for (a.name = o, r && (this.tn.skip("="), n.id = i(this.tn.next()), a.isGroup = !0), o = this.tn.peek(), "[" === o && n && this._parseFieldOptions(n), this.tn.skip("{");
              "}" !== (o = this.tn.next());) {
              if (t.RULE.test(o)) {
                this._parseMessageField(a, o)
              } else {
                if ("oneof" === o) {
                  this._parseMessageOneOf(a)
                } else {
                  if ("enum" === o) {
                    this._parseEnum(a)
                  } else {
                    if ("message" === o) {
                      this._parseMessage(a)
                    } else {
                      if ("option" === o) {
                        this._parseOption(a)
                      } else {
                        if ("service" === o) {
                          this._parseService(a)
                        } else {
                          if ("extensions" === o) {
                            a.extensions = this._parseExtensionRanges()
                          } else {
                            if ("reserved" === o) {
                              this._parseIgnored()
                            } else {
                              if ("extend" === o) {
                                this._parseExtend(a)
                              } else {
                                if (!t.TYPEREF.test(o)) {
                                  throw Error("illegal message token: " + o)
                                };
                                if (!this.proto3) {
                                  throw Error("illegal field rule: " + o)
                                };
                                this._parseMessageField(a, "optional", o)
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            };
            return this.tn.omit(";"), e.messages.push(a), a
          }, l._parseIgnored = function() {
            for (;
              ";" !== this.tn.peek();) {
              this.tn.next()
            };
            this.tn.skip(";")
          }, l._parseMessageField = function(e, n, r) {
            if (!t.RULE.test(n)) {
              throw Error("illegal message field rule: " + n)
            };
            var o, a = {
              rule: n,
              type: "",
              name: "",
              options: {},
              id: 0
            };
            if ("map" === n) {
              if (r) {
                throw Error("illegal type: " + r)
              };
              if (this.tn.skip("<"), o = this.tn.next(), !t.TYPE.test(o) && !t.TYPEREF.test(o)) {
                throw Error("illegal message field type: " + o)
              };
              if (a.keytype = o, this.tn.skip(","), o = this.tn.next(), !t.TYPE.test(o) && !t.TYPEREF.test(o)) {
                throw Error("illegal message field: " + o)
              };
              if (a.type = o, this.tn.skip(">"), o = this.tn.next(), !t.NAME.test(o)) {
                throw Error("illegal message field name: " + o)
              };
              a.name = o, this.tn.skip("="), a.id = i(this.tn.next()), o = this.tn.peek(), "[" === o && this._parseFieldOptions(a), this.tn.skip(";")
            } else {
              if (r = "undefined" != typeof r ? r : this.tn.next(), "group" === r) {
                var s = this._parseMessage(e, a);
                if (!/^[A-Z]/.test(s.name)) {
                  throw Error("illegal group name: " + s.name)
                };
                a.type = s.name, a.name = s.name.toLowerCase(), this.tn.omit(";")
              } else {
                if (!t.TYPE.test(r) && !t.TYPEREF.test(r)) {
                  throw Error("illegal message field type: " + r)
                };
                if (a.type = r, o = this.tn.next(), !t.NAME.test(o)) {
                  throw Error("illegal message field name: " + o)
                };
                a.name = o, this.tn.skip("="), a.id = i(this.tn.next()), o = this.tn.peek(), "[" === o && this._parseFieldOptions(a), this.tn.skip(";")
              }
            };
            return e.fields.push(a), a
          }, l._parseMessageOneOf = function(e) {
            var i = this.tn.next();
            if (!t.NAME.test(i)) {
              throw Error("illegal oneof name: " + i)
            };
            var n, r = i,
              o = [];
            for (this.tn.skip("{");
              "}" !== (i = this.tn.next());) {
              n = this._parseMessageField(e, "optional", i), n.oneof = r, o.push(n.id)
            };
            this.tn.omit(";"), e.oneofs[r] = o
          }, l._parseFieldOptions = function(e) {
            this.tn.skip("[");
            for (var t, i = !0;
              "]" !== (t = this.tn.peek());) {
              i || this.tn.skip(","), this._parseOption(e, !0), i = !1
            };
            this.tn.next()
          }, l._parseEnum = function(e) {
            var n = {
                name: "",
                values: [],
                options: {}
              },
              r = this.tn.next();
            if (!t.NAME.test(r)) {
              throw Error("illegal name: " + r)
            };
            for (n.name = r, this.tn.skip("{");
              "}" !== (r = this.tn.next());) {
              if ("option" === r) {
                this._parseOption(n)
              } else {
                if (!t.NAME.test(r)) {
                  throw Error("illegal name: " + r)
                };
                this.tn.skip("=");
                var o = {
                  name: r,
                  id: i(this.tn.next(), !0)
                };
                r = this.tn.peek(), "[" === r && this._parseFieldOptions({
                  options: {}
                }), this.tn.skip(";"), n.values.push(o)
              }
            };
            this.tn.omit(";"), e.enums.push(n)
          }, l._parseExtensionRanges = function() {
            var t, i, r, o = [];
            do {
              for (i = [];;) {
                switch (t = this.tn.next()) {
                  case "min":
                    r = e.ID_MIN;
                    break;
                  case "max":
                    r = e.ID_MAX;
                    break;
                  default:
                    r = n(t)
                };
                if (i.push(r), 2 === i.length) {
                  break
                };
                if ("to" !== this.tn.peek()) {
                  i.push(r);
                  break
                };
                this.tn.next()
              };
              o.push(i)
            } while (this.tn.omit(","));;
            return this.tn.skip(";"), o
          }, l._parseExtend = function(e) {
            var i = this.tn.next();
            if (!t.TYPEREF.test(i)) {
              throw Error("illegal extend reference: " + i)
            };
            var n = {
              ref: i,
              fields: []
            };
            for (this.tn.skip("{");
              "}" !== (i = this.tn.next());) {
              if (t.RULE.test(i)) {
                this._parseMessageField(n, i)
              } else {
                if (!t.TYPEREF.test(i)) {
                  throw Error("illegal extend token: " + i)
                };
                if (!this.proto3) {
                  throw Error("illegal field rule: " + i)
                };
                this._parseMessageField(n, "optional", i)
              }
            };
            return this.tn.omit(";"), e.messages.push(n), n
          }, l.toString = function() {
            return "Parser at line " + this.tn.line
          }, o.Parser = h, o
        }(r, r.Lang), r.Reflect = function(e) {
          function i(i) {
            if ("string" == typeof i && (i = e.TYPES[i]), "undefined" == typeof i.defaultValue) {
              throw Error("default value for type " + i.name + " is not supported")
            };
            return i == e.TYPES.bytes ? new t(0) : i.defaultValue
          }

          function n(t, i) {
            if (t && "number" == typeof t.low && "number" == typeof t.high && "boolean" == typeof t.unsigned && t.low === t.low && t.high === t.high) {
              return new e.Long(t.low, t.high, "undefined" == typeof i ? t.unsigned : i)
            };
            if ("string" == typeof t) {
              return e.Long.fromString(t, i || !1, 10)
            };
            if ("number" == typeof t) {
              return e.Long.fromNumber(t, i || !1)
            };
            throw Error("not convertible to Long")
          }

          function r(t, i) {
            var n = i.readVarint32(),
              o = 7 & n,
              a = n >>> 3;
            switch (o) {
              case e.WIRE_TYPES.VARINT:
                do {
                  n = i.readUint8()
                } while (128 === (128 & n));;
                break;
              case e.WIRE_TYPES.BITS64:
                i.offset += 8;
                break;
              case e.WIRE_TYPES.LDELIM:
                n = i.readVarint32(), i.offset += n;
                break;
              case e.WIRE_TYPES.STARTGROUP:
                r(a, i);
                break;
              case e.WIRE_TYPES.ENDGROUP:
                if (a === t) {
                  return !1
                };
                throw Error("Illegal GROUPEND after unknown group: " + a + " (" + t + " expected)");
              case e.WIRE_TYPES.BITS32:
                i.offset += 4;
                break;
              default:
                throw Error("Illegal wire type in unknown group " + t + ": " + o)
            };
            return !0
          }
          var o = {},
            a = function(e, t, i) {
              this.builder = e, this.parent = t, this.name = i, this.className
            },
            s = a.prototype;
          s.fqn = function() {
            for (var e = this.name, t = this;;) {
              if (t = t.parent, null == t) {
                break
              };
              e = t.name + "." + e
            };
            return e
          }, s.toString = function(e) {
            return (e ? this.className + " " : "") + this.fqn()
          }, s.build = function() {
            throw Error(this.toString(!0) + " cannot be built directly")
          }, o.T = a;
          var h = function(e, t, i, n, r) {
              a.call(this, e, t, i), this.className = "Namespace", this.children = [], this.options = n || {}, this.syntax = r || "proto2"
            },
            l = h.prototype = Object.create(a.prototype);
          l.getChildren = function(e) {
            if (e = e || null, null == e) {
              return this.children.slice()
            };
            for (var t = [], i = 0, n = this.children.length; n > i; ++i) {
              this.children[i] instanceof e && t.push(this.children[i])
            };
            return t
          }, l.addChild = function(e) {
            var t;
            if (t = this.getChild(e.name)) {
              if (t instanceof d.Field && t.name !== t.originalName && null === this.getChild(t.originalName)) {
                t.name = t.originalName
              } else {
                if (!(e instanceof d.Field && e.name !== e.originalName && null === this.getChild(e.originalName))) {
                  throw Error("Duplicate name in namespace " + this.toString(!0) + ": " + e.name)
                };
                e.name = e.originalName
              }
            };
            this.children.push(e)
          }, l.getChild = function(e) {
            for (var t = "number" == typeof e ? "id" : "name", i = 0, n = this.children.length; n > i; ++i) {
              if (this.children[i][t] === e) {
                return this.children[i]
              }
            };
            return null
          }, l.resolve = function(e, t) {
            var i = "string" == typeof e ? e.split(".") : e,
              n = this,
              r = 0;
            if ("" === i[r]) {
              for (; null !== n.parent;) {
                n = n.parent
              };
              r++
            };
            var a;
            do {
              do {
                if (!(n instanceof o.Namespace)) {
                  n = null;
                  break
                };
                if (a = n.getChild(i[r]), !(a && a instanceof o.T && (!t || a instanceof o.Namespace))) {
                  n = null;
                  break
                };
                n = a, r++
              } while (r < i.length);;
              if (null != n) {
                break
              };
              if (null !== this.parent) {
                return this.parent.resolve(e, t)
              }
            } while (null != n);;
            return n
          }, l.qn = function(e) {
            var t = [],
              i = e;
            do {
              t.unshift(i.name), i = i.parent
            } while (null !== i);;
            for (var n = 1; n <= t.length; n++) {
              var r = t.slice(t.length - n);
              if (e === this.resolve(r, e instanceof o.Namespace)) {
                return r.join(".")
              }
            };
            return e.fqn()
          }, l.build = function() {
            for (var e, t = {}, i = this.children, n = 0, r = i.length; r > n; ++n) {
              e = i[n], e instanceof h && (t[e.name] = e.build())
            };
            return Object.defineProperty && Object.defineProperty(t, "$options", {
              value: this.buildOpt()
            }), t
          }, l.buildOpt = function() {
            for (var e = {}, t = Object.keys(this.options), i = 0, n = t.length; n > i; ++i) {
              var r = t[i],
                o = this.options[t[i]];
              e[r] = o
            };
            return e
          }, l.getOption = function(e) {
            return "undefined" == typeof e ? this.options : "undefined" != typeof this.options[e] ? this.options[e] : null
          }, o.Namespace = h;
          var c = function(t, i, n, r) {
              if (this.type = t, this.resolvedType = i, this.isMapKey = n, this.syntax = r, n && e.MAP_KEY_TYPES.indexOf(t) < 0) {
                throw Error("Invalid map key type: " + t.name)
              }
            },
            u = c.prototype;
          c.defaultFieldValue = i, u.verifyValue = function(i) {
            function r(e, t) {
              throw Error("Illegal value for " + o.toString(!0) + " of type " + o.type.name + ": " + e + " (" + t + ")")
            }
            var o = this;
            switch (this.type) {
              case e.TYPES.int32:
                ;
              case e.TYPES.sint32:
                ;
              case e.TYPES.sfixed32:
                return ("number" != typeof i || i === i && i % 1 !== 0) && r(typeof i, "not an integer"), i > 4294967295 ? 0 | i : i;
              case e.TYPES.uint32:
                ;
              case e.TYPES.fixed32:
                return ("number" != typeof i || i === i && i % 1 !== 0) && r(typeof i, "not an integer"), 0 > i ? i >>> 0 : i;
              case e.TYPES.int64:
                ;
              case e.TYPES.sint64:
                ;
              case e.TYPES.sfixed64:
                if (e.Long) {
                  try {
                    return n(i, !1)
                  } catch (a) {
                    r(typeof i, a.message)
                  }
                } else {
                  r(typeof i, "requires Long.js")
                };
              case e.TYPES.uint64:
                ;
              case e.TYPES.fixed64:
                if (e.Long) {
                  try {
                    return n(i, !0)
                  } catch (a) {
                    r(typeof i, a.message)
                  }
                } else {
                  r(typeof i, "requires Long.js")
                };
              case e.TYPES.bool:
                return "boolean" != typeof i && r(typeof i, "not a boolean"), i;
              case e.TYPES["float"]:
                ;
              case e.TYPES["double"]:
                return "number" != typeof i && r(typeof i, "not a number"), i;
              case e.TYPES.string:
                return "string" == typeof i || i && i instanceof String || r(typeof i, "not a string"), "" + i;
              case e.TYPES.bytes:
                return t.isByteBuffer(i) ? i : t.wrap(i, "base64");
              case e.TYPES["enum"]:
                var s = this.resolvedType.getChildren(e.Reflect.Enum.Value);
                for (l = 0; l < s.length; l++) {
                  if (s[l].name == i) {
                    return s[l].id
                  };
                  if (s[l].id == i) {
                    return s[l].id
                  }
                };
                if ("proto3" === this.syntax) {
                  return ("number" != typeof i || i === i && i % 1 !== 0) && r(typeof i, "not an integer"), (i > 4294967295 || 0 > i) && r(typeof i, "not in range for uint32"), i
                };
                r(i, "not a valid enum value");
              case e.TYPES.group:
                ;
              case e.TYPES.message:
                if (i && "object" == typeof i || r(typeof i, "object expected"), i instanceof this.resolvedType.clazz) {
                  return i
                };
                if (i instanceof e.Builder.Message) {
                  var h = {};
                  for (var l in i) {
                    i.hasOwnProperty(l) && (h[l] = i[l])
                  };
                  i = h
                };
                return new this.resolvedType.clazz(i)
            };
            throw Error("[INTERNAL] Illegal value for " + this.toString(!0) + ": " + i + " (undefined type " + this.type + ")")
          }, u.calculateLength = function(i, n) {
            if (null === n) {
              return 0
            };
            var r;
            switch (this.type) {
              case e.TYPES.int32:
                return 0 > n ? t.calculateVarint64(n) : t.calculateVarint32(n);
              case e.TYPES.uint32:
                return t.calculateVarint32(n);
              case e.TYPES.sint32:
                return t.calculateVarint32(t.zigZagEncode32(n));
              case e.TYPES.fixed32:
                ;
              case e.TYPES.sfixed32:
                ;
              case e.TYPES["float"]:
                return 4;
              case e.TYPES.int64:
                ;
              case e.TYPES.uint64:
                return t.calculateVarint64(n);
              case e.TYPES.sint64:
                return t.calculateVarint64(t.zigZagEncode64(n));
              case e.TYPES.fixed64:
                ;
              case e.TYPES.sfixed64:
                return 8;
              case e.TYPES.bool:
                return 1;
              case e.TYPES["enum"]:
                return t.calculateVarint32(n);
              case e.TYPES["double"]:
                return 8;
              case e.TYPES.string:
                return r = t.calculateUTF8Bytes(n), t.calculateVarint32(r) + r;
              case e.TYPES.bytes:
                if (n.remaining() < 0) {
                  throw Error("Illegal value for " + this.toString(!0) + ": " + n.remaining() + " bytes remaining")
                };
                return t.calculateVarint32(n.remaining()) + n.remaining();
              case e.TYPES.message:
                return r = this.resolvedType.calculate(n), t.calculateVarint32(r) + r;
              case e.TYPES.group:
                return r = this.resolvedType.calculate(n), r + t.calculateVarint32(i << 3 | e.WIRE_TYPES.ENDGROUP)
            };
            throw Error("[INTERNAL] Illegal value to encode in " + this.toString(!0) + ": " + n + " (unknown type)")
          }, u.encodeValue = function(i, n, r) {
            if (null === n) {
              return r
            };
            switch (this.type) {
              case e.TYPES.int32:
                0 > n ? r.writeVarint64(n) : r.writeVarint32(n);
                break;
              case e.TYPES.uint32:
                r.writeVarint32(n);
                break;
              case e.TYPES.sint32:
                r.writeVarint32ZigZag(n);
                break;
              case e.TYPES.fixed32:
                r.writeUint32(n);
                break;
              case e.TYPES.sfixed32:
                r.writeInt32(n);
                break;
              case e.TYPES.int64:
                ;
              case e.TYPES.uint64:
                r.writeVarint64(n);
                break;
              case e.TYPES.sint64:
                r.writeVarint64ZigZag(n);
                break;
              case e.TYPES.fixed64:
                r.writeUint64(n);
                break;
              case e.TYPES.sfixed64:
                r.writeInt64(n);
                break;
              case e.TYPES.bool:
                r.writeVarint32("string" == typeof n ? "false" === n.toLowerCase() ? 0 : !!n : n ? 1 : 0);
                break;
              case e.TYPES["enum"]:
                r.writeVarint32(n);
                break;
              case e.TYPES["float"]:
                r.writeFloat32(n);
                break;
              case e.TYPES["double"]:
                r.writeFloat64(n);
                break;
              case e.TYPES.string:
                r.writeVString(n);
                break;
              case e.TYPES.bytes:
                if (n.remaining() < 0) {
                  throw Error("Illegal value for " + this.toString(!0) + ": " + n.remaining() + " bytes remaining")
                };
                var o = n.offset;
                r.writeVarint32(n.remaining()), r.append(n), n.offset = o;
                break;
              case e.TYPES.message:
                var a = (new t).LE();
                this.resolvedType.encode(n, a), r.writeVarint32(a.offset), r.append(a.flip());
                break;
              case e.TYPES.group:
                this.resolvedType.encode(n, r), r.writeVarint32(i << 3 | e.WIRE_TYPES.ENDGROUP);
                break;
              default:
                throw Error("[INTERNAL] Illegal value to encode in " + this.toString(!0) + ": " + n + " (unknown type)")
            };
            return r
          }, u.decode = function(t, i, n) {
            if (i != this.type.wireType) {
              throw Error("Unexpected wire type for element")
            };
            var r, o;
            switch (this.type) {
              case e.TYPES.int32:
                return 0 | t.readVarint32();
              case e.TYPES.uint32:
                return t.readVarint32() >>> 0;
              case e.TYPES.sint32:
                return 0 | t.readVarint32ZigZag();
              case e.TYPES.fixed32:
                return t.readUint32() >>> 0;
              case e.TYPES.sfixed32:
                return 0 | t.readInt32();
              case e.TYPES.int64:
                return t.readVarint64();
              case e.TYPES.uint64:
                return t.readVarint64().toUnsigned();
              case e.TYPES.sint64:
                return t.readVarint64ZigZag();
              case e.TYPES.fixed64:
                return t.readUint64();
              case e.TYPES.sfixed64:
                return t.readInt64();
              case e.TYPES.bool:
                return !!t.readVarint32();
              case e.TYPES["enum"]:
                return t.readVarint32();
              case e.TYPES["float"]:
                return t.readFloat();
              case e.TYPES["double"]:
                return t.readDouble();
              case e.TYPES.string:
                return t.readVString();
              case e.TYPES.bytes:
                if (o = t.readVarint32(), t.remaining() < o) {
                  throw Error("Illegal number of bytes for " + this.toString(!0) + ": " + o + " required but got only " + t.remaining())
                };
                return r = t.clone(), r.limit = r.offset + o, t.offset += o, r;
              case e.TYPES.message:
                return o = t.readVarint32(), this.resolvedType.decode(t, o);
              case e.TYPES.group:
                return this.resolvedType.decode(t, -1, n)
            };
            throw Error("[INTERNAL] Illegal decode type")
          }, u.valueFromString = function(i) {
            if (!this.isMapKey) {
              throw Error("valueFromString() called on non-map-key element")
            };
            switch (this.type) {
              case e.TYPES.int32:
                ;
              case e.TYPES.sint32:
                ;
              case e.TYPES.sfixed32:
                ;
              case e.TYPES.uint32:
                ;
              case e.TYPES.fixed32:
                return this.verifyValue(parseInt(i));
              case e.TYPES.int64:
                ;
              case e.TYPES.sint64:
                ;
              case e.TYPES.sfixed64:
                ;
              case e.TYPES.uint64:
                ;
              case e.TYPES.fixed64:
                return this.verifyValue(i);
              case e.TYPES.bool:
                return "true" === i;
              case e.TYPES.string:
                return this.verifyValue(i);
              case e.TYPES.bytes:
                return t.fromBinary(i)
            }
          }, u.valueToString = function(t) {
            if (!this.isMapKey) {
              throw Error("valueToString() called on non-map-key element")
            };
            return this.type === e.TYPES.bytes ? t.toString("binary") : t.toString()
          }, o.Element = c;
          var d = function(e, t, i, n, r, o) {
              h.call(this, e, t, i, n, o), this.className = "Message", this.extensions = void(0), this.clazz = null, this.isGroup = !!r, this._fields = null, this._fieldsById = null, this._fieldsByName = null
            },
            p = d.prototype = Object.create(h.prototype);
          p.build = function(i) {
            if (this.clazz && !i) {
              return this.clazz
            };
            var n = function(e, i) {
              function n(i, r, o, a) {
                if (null === i || "object" != typeof i) {
                  if (a && a instanceof e.Reflect.Enum) {
                    var s = e.Reflect.Enum.getName(a.object, i);
                    if (null !== s) {
                      return s
                    }
                  };
                  return i
                };
                if (t.isByteBuffer(i)) {
                  return r ? i.toBase64() : i.toBuffer()
                };
                if (e.Long.isLong(i)) {
                  return o ? i.toString() : e.Long.fromValue(i)
                };
                var h;
                if (Array.isArray(i)) {
                  return h = [], i.forEach(function(e, t) {
                    h[t] = n(e, r, o, a)
                  }), h
                };
                if (h = {}, i instanceof e.Map) {
                  for (var l = i.entries(), c = l.next(); !c.done; c = l.next()) {
                    h[i.keyElem.valueToString(c.value[0])] = n(c.value[1], r, o, i.valueElem.resolvedType)
                  };
                  return h
                };
                var u = i.$type,
                  d = void(0);
                for (var p in i) {
                  i.hasOwnProperty(p) && (h[p] = u && (d = u.getChild(p)) ? n(i[p], r, o, d.resolvedType) : n(i[p], r, o))
                };
                return h
              }
              var r = i.getChildren(e.Reflect.Message.Field),
                o = i.getChildren(e.Reflect.Message.OneOf),
                a = function(n, s) {
                  e.Builder.Message.call(this);
                  for (var h = 0, l = o.length; l > h; ++h) {
                    this[o[h].name] = null
                  };
                  for (h = 0, l = r.length; l > h; ++h) {
                    var c = r[h];
                    this[c.name] = c.repeated ? [] : c.map ? new e.Map(c) : null, !c.required && "proto3" !== i.syntax || null === c.defaultValue || (this[c.name] = c.defaultValue)
                  };
                  if (arguments.length > 0) {
                    var u;
                    if (1 !== arguments.length || null === n || "object" != typeof n || !("function" != typeof n.encode || n instanceof a) || Array.isArray(n) || n instanceof e.Map || t.isByteBuffer(n) || n instanceof ArrayBuffer || e.Long && n instanceof e.Long) {
                      for (h = 0, l = arguments.length; l > h; ++h) {
                        "undefined" != typeof(u = arguments[h]) && this.$set(r[h].name, u)
                      }
                    } else {
                      this.$set(n)
                    }
                  }
                },
                s = a.prototype = Object.create(e.Builder.Message.prototype);
              s.add = function(t, n, r) {
                var o = i._fieldsByName[t];
                if (!r) {
                  if (!o) {
                    throw Error(this + "#" + t + " is undefined")
                  };
                  if (!(o instanceof e.Reflect.Message.Field)) {
                    throw Error(this + "#" + t + " is not a field: " + o.toString(!0))
                  };
                  if (!o.repeated) {
                    throw Error(this + "#" + t + " is not a repeated field")
                  };
                  n = o.verifyValue(n, !0)
                };
                return null === this[t] && (this[t] = []), this[t].push(n), this
              }, s.$add = s.add, s["set"] = function(t, n, r) {
                if (t && "object" == typeof t) {
                  r = n;
                  for (var o in t) {
                    t.hasOwnProperty(o) && "undefined" != typeof(n = t[o]) && this.$set(o, n, r)
                  };
                  return this
                };
                var a = i._fieldsByName[t];
                if (r) {
                  this[t] = n
                } else {
                  if (!a) {
                    throw Error(this + "#" + t + " is not a field: undefined")
                  };
                  if (!(a instanceof e.Reflect.Message.Field)) {
                    throw Error(this + "#" + t + " is not a field: " + a.toString(!0))
                  };
                  this[a.name] = n = a.verifyValue(n)
                };
                if (a && a.oneof) {
                  var s = this[a.oneof.name];
                  null !== n ? (null !== s && s !== a.name && (this[s] = null), this[a.oneof.name] = a.name) : s === t && (this[a.oneof.name] = null)
                };
                return this
              }, s.$set = s["set"], s["get"] = function(t, n) {
                if (n) {
                  return this[t]
                };
                var r = i._fieldsByName[t];
                if (!(r && r instanceof e.Reflect.Message.Field)) {
                  throw Error(this + "#" + t + " is not a field: undefined")
                };
                if (!(r instanceof e.Reflect.Message.Field)) {
                  throw Error(this + "#" + t + " is not a field: " + r.toString(!0))
                };
                return this[r.name]
              }, s.$get = s["get"];
              for (var h = 0; h < r.length; h++) {
                var l = r[h];
                l instanceof e.Reflect.Message.ExtensionField || i.builder.options.populateAccessors && function(e) {
                  var t = e.originalName.replace(/(_[a-zA-Z])/g, function(e) {
                    return e.toUpperCase().replace("_", "")
                  });
                  t = t.substring(0, 1).toUpperCase() + t.substring(1);
                  var n = e.originalName.replace(/([A-Z])/g, function(e) {
                      return "_" + e
                    }),
                    r = function(t, i) {
                      return this[e.name] = i ? t : e.verifyValue(t), this
                    },
                    o = function() {
                      return this[e.name]
                    };
                  null === i.getChild("set" + t) && (s["set" + t] = r), null === i.getChild("set_" + n) && (s["set_" + n] = r), null === i.getChild("get" + t) && (s["get" + t] = o), null === i.getChild("get_" + n) && (s["get_" + n] = o)
                }(l)
              };
              s.encode = function(e, n) {
                "boolean" == typeof e && (n = e, e = void(0));
                var r = !1;
                e || (e = new t, r = !0);
                var o = e.littleEndian;
                try {
                  return i.encode(this, e.LE(), n), (r ? e.flip() : e).LE(o)
                } catch (a) {
                  throw e.LE(o), a
                }
              }, a.encode = function(e, t, i) {
                return new a(e).encode(t, i)
              }, s.calculate = function() {
                return i.calculate(this)
              }, s.encodeDelimited = function(e, n) {
                var r = !1;
                e || (e = new t, r = !0);
                var o = (new t).LE();
                return i.encode(this, o, n).flip(), e.writeVarint32(o.remaining()), e.append(o), r ? e.flip() : e
              }, s.encodeAB = function() {
                try {
                  return this.encode().toArrayBuffer()
                } catch (e) {
                  throw e.encoded && (e.encoded = e.encoded.toArrayBuffer()), e
                }
              }, s.toArrayBuffer = s.encodeAB, s.encodeNB = function() {
                try {
                  return this.encode().toBuffer()
                } catch (e) {
                  throw e.encoded && (e.encoded = e.encoded.toBuffer()), e
                }
              }, s.toBuffer = s.encodeNB, s.encode64 = function() {
                try {
                  return this.encode().toBase64()
                } catch (e) {
                  throw e.encoded && (e.encoded = e.encoded.toBase64()), e
                }
              }, s.toBase64 = s.encode64, s.encodeHex = function() {
                try {
                  return this.encode().toHex()
                } catch (e) {
                  throw e.encoded && (e.encoded = e.encoded.toHex()), e
                }
              }, s.toHex = s.encodeHex, s.toRaw = function(e, t) {
                return n(this, !!e, !!t, this.$type)
              }, s.encodeJSON = function() {
                return JSON.stringify(n(this, !0, !0, this.$type))
              }, a.decode = function(e, n, r) {
                "string" == typeof n && (r = n, n = -1), "string" == typeof e && (e = t.wrap(e, r ? r : "base64")), e = t.isByteBuffer(e) ? e : t.wrap(e);
                var o = e.littleEndian;
                try {
                  var a = i.decode(e.LE());
                  return e.LE(o), a
                } catch (s) {
                  throw e.LE(o), s
                }
              }, a.decodeDelimited = function(e, n) {
                if ("string" == typeof e && (e = t.wrap(e, n ? n : "base64")), e = t.isByteBuffer(e) ? e : t.wrap(e), e.remaining() < 1) {
                  return null
                };
                var r = e.offset,
                  o = e.readVarint32();
                if (e.remaining() < o) {
                  return e.offset = r, null
                };
                try {
                  var a = i.decode(e.slice(e.offset, e.offset + o).LE());
                  return e.offset += o, a
                } catch (s) {
                  throw e.offset += o, s
                }
              }, a.decode64 = function(e) {
                return a.decode(e, "base64")
              }, a.decodeHex = function(e) {
                return a.decode(e, "hex")
              }, a.decodeJSON = function(e) {
                return new a(JSON.parse(e))
              }, s.toString = function() {
                return i.toString()
              };
              return Object.defineProperty && (Object.defineProperty(a, "$options", {
                value: i.buildOpt()
              }), Object.defineProperty(s, "$options", {
                value: a.$options
              }), Object.defineProperty(a, "$type", {
                value: i
              }), Object.defineProperty(s, "$type", {
                value: i
              })), a
            }(e, this);
            this._fields = [], this._fieldsById = {}, this._fieldsByName = {};
            for (var r, o = 0, a = this.children.length; a > o; o++) {
              if (r = this.children[o], r instanceof y || r instanceof d || r instanceof x) {
                if (n.hasOwnProperty(r.name)) {
                  throw Error("Illegal reflect child of " + this.toString(!0) + ": " + r.toString(!0) + " cannot override static property '" + r.name + "'")
                };
                n[r.name] = r.build()
              } else {
                if (r instanceof d.Field) {
                  r.build(), this._fields.push(r), this._fieldsById[r.id] = r, this._fieldsByName[r.name] = r
                } else {
                  if (!(r instanceof d.OneOf || r instanceof _)) {
                    throw Error("Illegal reflect child of " + this.toString(!0) + ": " + this.children[o].toString(!0))
                  }
                }
              }
            };
            return this.clazz = n
          }, p.encode = function(e, t, i) {
            for (var n, r, o = null, a = 0, s = this._fields.length; s > a; ++a) {
              n = this._fields[a], r = e[n.name], n.required && null === r ? null === o && (o = n) : n.encode(i ? r : n.verifyValue(r), t, e)
            };
            if (null !== o) {
              var h = Error("Missing at least one required field for " + this.toString(!0) + ": " + o);
              throw h.encoded = t, h
            };
            return t
          }, p.calculate = function(e) {
            for (var t, i, n = 0, r = 0, o = this._fields.length; o > r; ++r) {
              if (t = this._fields[r], i = e[t.name], t.required && null === i) {
                throw Error("Missing at least one required field for " + this.toString(!0) + ": " + t)
              };
              n += t.calculate(i, e)
            };
            return n
          }, p.decode = function(t, i, n) {
            i = "number" == typeof i ? i : -1;
            for (var o, a, s, h, l = t.offset, c = new this.clazz; t.offset < l + i || -1 === i && t.remaining() > 0;) {
              if (o = t.readVarint32(), a = 7 & o, s = o >>> 3, a === e.WIRE_TYPES.ENDGROUP) {
                if (s !== n) {
                  throw Error("Illegal group end indicator for " + this.toString(!0) + ": " + s + " (" + (n ? n + " expected" : "not a group") + ")")
                };
                break
              };
              if (h = this._fieldsById[s]) {
                if (h.repeated && !h.options.packed) {
                  c[h.name].push(h.decode(a, t))
                } else {
                  if (h.map) {
                    var u = h.decode(a, t);
                    c[h.name]["set"](u[0], u[1])
                  } else {
                    if (c[h.name] = h.decode(a, t), h.oneof) {
                      var d = c[h.oneof.name];
                      null !== d && d !== h.name && (c[d] = null), c[h.oneof.name] = h.name
                    }
                  }
                }
              } else {
                switch (a) {
                  case e.WIRE_TYPES.VARINT:
                    t.readVarint32();
                    break;
                  case e.WIRE_TYPES.BITS32:
                    t.offset += 4;
                    break;
                  case e.WIRE_TYPES.BITS64:
                    t.offset += 8;
                    break;
                  case e.WIRE_TYPES.LDELIM:
                    var p = t.readVarint32();
                    t.offset += p;
                    break;
                  case e.WIRE_TYPES.STARTGROUP:
                    for (; r(s, t);) {;
                    };
                    break;
                  default:
                    throw Error("Illegal wire type for unknown field " + s + " in " + this.toString(!0) + "#decode: " + a)
                }
              }
            };
            for (var f = 0, m = this._fields.length; m > f; ++f) {
              if (h = this._fields[f], null === c[h.name]) {
                if ("proto3" === this.syntax) {
                  c[h.name] = h.defaultValue
                } else {
                  if (h.required) {
                    var g = Error("Missing at least one required field for " + this.toString(!0) + ": " + h.name);
                    throw g.decoded = c, g
                  };
                  e.populateDefaults && null !== h.defaultValue && (c[h.name] = h.defaultValue)
                }
              }
            };
            return c
          }, o.Message = d;
          var f = function(t, i, n, r, o, s, h, l, c, u) {
              a.call(this, t, i, s), this.className = "Message.Field", this.required = "required" === n, this.repeated = "repeated" === n, this.map = "map" === n, this.keyType = r || null, this.type = o, this.resolvedType = null, this.id = h, this.options = l || {}, this.defaultValue = null, this.oneof = c || null, this.syntax = u || "proto2", this.originalName = this.name, this.element = null, this.keyElement = null, !this.builder.options.convertFieldsToCamelCase || this instanceof d.ExtensionField || (this.name = e.Util.toCamelCase(this.name))
            },
            m = f.prototype = Object.create(a.prototype);
          m.build = function() {
            this.element = new c(this.type, this.resolvedType, !1, this.syntax), this.map && (this.keyElement = new c(this.keyType, void(0), !0, this.syntax)), "proto3" !== this.syntax || this.repeated || this.map ? "undefined" != typeof this.options["default"] && (this.defaultValue = this.verifyValue(this.options["default"])) : this.defaultValue = c.defaultFieldValue(this.type)
          }, m.verifyValue = function(t, i) {
            function n(e, t) {
              throw Error("Illegal value for " + r.toString(!0) + " of type " + r.type.name + ": " + e + " (" + t + ")")
            }
            i = i || !1;
            var r = this;
            if (null === t) {
              return this.required && n(typeof t, "required"), "proto3" === this.syntax && this.type !== e.TYPES.message && n(typeof t, "proto3 field without field presence cannot be null"), null
            };
            var o;
            if (this.repeated && !i) {
              Array.isArray(t) || (t = [t]);
              var a = [];
              for (o = 0; o < t.length; o++) {
                a.push(this.element.verifyValue(t[o]))
              };
              return a
            };
            return this.map && !i ? t instanceof e.Map ? t : (t instanceof Object || n(typeof t, "expected ProtoBuf.Map or raw object for map field"), new e.Map(this, t)) : (!this.repeated && Array.isArray(t) && n(typeof t, "no array expected"), this.element.verifyValue(t))
          }, m.hasWirePresence = function(t, i) {
            if ("proto3" !== this.syntax) {
              return null !== t
            };
            if (this.oneof && i[this.oneof.name] === this.name) {
              return !0
            };
            switch (this.type) {
              case e.TYPES.int32:
                ;
              case e.TYPES.sint32:
                ;
              case e.TYPES.sfixed32:
                ;
              case e.TYPES.uint32:
                ;
              case e.TYPES.fixed32:
                return 0 !== t;
              case e.TYPES.int64:
                ;
              case e.TYPES.sint64:
                ;
              case e.TYPES.sfixed64:
                ;
              case e.TYPES.uint64:
                ;
              case e.TYPES.fixed64:
                return 0 !== t.low || 0 !== t.high;
              case e.TYPES.bool:
                return t;
              case e.TYPES["float"]:
                ;
              case e.TYPES["double"]:
                return 0 !== t;
              case e.TYPES.string:
                return t.length > 0;
              case e.TYPES.bytes:
                return t.remaining() > 0;
              case e.TYPES["enum"]:
                return 0 !== t;
              case e.TYPES.message:
                return null !== t;
              default:
                return !0
            }
          }, m.encode = function(i, n, r) {
            if (null === this.type || "object" != typeof this.type) {
              throw Error("[INTERNAL] Unresolved type in " + this.toString(!0) + ": " + this.type)
            };
            if (null === i || this.repeated && 0 == i.length) {
              return n
            };
            try {
              if (this.repeated) {
                var o;
                if (this.options.packed && e.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType) >= 0) {
                  n.writeVarint32(this.id << 3 | e.WIRE_TYPES.LDELIM), n.ensureCapacity(n.offset += 1);
                  var a = n.offset;
                  for (o = 0; o < i.length; o++) {
                    this.element.encodeValue(this.id, i[o], n)
                  };
                  var s = n.offset - a,
                    h = t.calculateVarint32(s);
                  if (h > 1) {
                    var l = n.slice(a, n.offset);
                    a += h - 1, n.offset = a, n.append(l)
                  };
                  n.writeVarint32(s, a - h)
                } else {
                  for (o = 0; o < i.length; o++) {
                    n.writeVarint32(this.id << 3 | this.type.wireType), this.element.encodeValue(this.id, i[o], n)
                  }
                }
              } else {
                this.map ? i.forEach(function(i, r, o) {
                  var a = t.calculateVarint32(8 | this.keyType.wireType) + this.keyElement.calculateLength(1, r) + t.calculateVarint32(16 | this.type.wireType) + this.element.calculateLength(2, i);
                  n.writeVarint32(this.id << 3 | e.WIRE_TYPES.LDELIM), n.writeVarint32(a), n.writeVarint32(8 | this.keyType.wireType), this.keyElement.encodeValue(1, r, n), n.writeVarint32(16 | this.type.wireType), this.element.encodeValue(2, i, n)
                }, this) : this.hasWirePresence(i, r) && (n.writeVarint32(this.id << 3 | this.type.wireType), this.element.encodeValue(this.id, i, n))
              }
            } catch (c) {
              throw Error("Illegal value for " + this.toString(!0) + ": " + i + " (" + c + ")")
            };
            return n
          }, m.calculate = function(i, n) {
            if (i = this.verifyValue(i), null === this.type || "object" != typeof this.type) {
              throw Error("[INTERNAL] Unresolved type in " + this.toString(!0) + ": " + this.type)
            };
            if (null === i || this.repeated && 0 == i.length) {
              return 0
            };
            var r = 0;
            try {
              if (this.repeated) {
                var o, a;
                if (this.options.packed && e.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType) >= 0) {
                  for (r += t.calculateVarint32(this.id << 3 | e.WIRE_TYPES.LDELIM), a = 0, o = 0; o < i.length; o++) {
                    a += this.element.calculateLength(this.id, i[o])
                  };
                  r += t.calculateVarint32(a), r += a
                } else {
                  for (o = 0; o < i.length; o++) {
                    r += t.calculateVarint32(this.id << 3 | this.type.wireType), r += this.element.calculateLength(this.id, i[o])
                  }
                }
              } else {
                this.map ? i.forEach(function(i, n, o) {
                  var a = t.calculateVarint32(8 | this.keyType.wireType) + this.keyElement.calculateLength(1, n) + t.calculateVarint32(16 | this.type.wireType) + this.element.calculateLength(2, i);
                  r += t.calculateVarint32(this.id << 3 | e.WIRE_TYPES.LDELIM), r += t.calculateVarint32(a), r += a
                }, this) : this.hasWirePresence(i, n) && (r += t.calculateVarint32(this.id << 3 | this.type.wireType), r += this.element.calculateLength(this.id, i))
              }
            } catch (s) {
              throw Error("Illegal value for " + this.toString(!0) + ": " + i + " (" + s + ")")
            };
            return r
          }, m.decode = function(t, i, n) {
            var r, o, a = !this.map && t == this.type.wireType || !n && this.repeated && this.options.packed && t == e.WIRE_TYPES.LDELIM || this.map && t == e.WIRE_TYPES.LDELIM;
            if (!a) {
              throw Error("Illegal wire type for field " + this.toString(!0) + ": " + t + " (" + this.type.wireType + " expected)")
            };
            if (t == e.WIRE_TYPES.LDELIM && this.repeated && this.options.packed && e.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType) >= 0 && !n) {
              o = i.readVarint32(), o = i.offset + o;
              for (var s = []; i.offset < o;) {
                s.push(this.decode(this.type.wireType, i, !0))
              };
              return s
            };
            if (this.map) {
              var h = c.defaultFieldValue(this.keyType);
              if (r = c.defaultFieldValue(this.type), o = i.readVarint32(), i.remaining() < o) {
                throw Error("Illegal number of bytes for " + this.toString(!0) + ": " + o + " required but got only " + i.remaining())
              };
              var l = i.clone();
              for (l.limit = l.offset + o, i.offset += o; l.remaining() > 0;) {
                var u = l.readVarint32();
                t = 7 & u;
                var d = u >>> 3;
                if (1 === d) {
                  h = this.keyElement.decode(l, t, d)
                } else {
                  if (2 !== d) {
                    throw Error("Unexpected tag in map field key/value submessage")
                  };
                  r = this.element.decode(l, t, d)
                }
              };
              return [h, r]
            };
            return this.element.decode(i, t, this.id)
          }, o.Message.Field = f;
          var g = function(e, t, i, n, r, o, a) {
            f.call(this, e, t, i, null, n, r, o, a), this.extension
          };
          g.prototype = Object.create(f.prototype), o.Message.ExtensionField = g;
          var v = function(e, t, i) {
            a.call(this, e, t, i), this.fields = []
          };
          o.Message.OneOf = v;
          var y = function(e, t, i, n, r) {
            h.call(this, e, t, i, n, r), this.className = "Enum", this.object = null
          };
          y.getName = function(e, t) {
            for (var i, n = Object.keys(e), r = 0; r < n.length; ++r) {
              if (e[i = n[r]] === t) {
                return i
              }
            };
            return null
          };
          var b = y.prototype = Object.create(h.prototype);
          b.build = function(t) {
            if (this.object && !t) {
              return this.object
            };
            for (var i = new e.Builder.Enum, n = this.getChildren(y.Value), r = 0, o = n.length; o > r; ++r) {
              i[n[r].name] = n[r].id
            };
            return Object.defineProperty && Object.defineProperty(i, "$options", {
              value: this.buildOpt(),
              enumerable: !1
            }), this.object = i
          }, o.Enum = y;
          var w = function(e, t, i, n) {
            a.call(this, e, t, i), this.className = "Enum.Value", this.id = n
          };
          w.prototype = Object.create(a.prototype), o.Enum.Value = w;
          var _ = function(e, t, i, n) {
            a.call(this, e, t, i), this.field = n
          };
          _.prototype = Object.create(a.prototype), o.Extension = _;
          var x = function(e, t, i, n) {
              h.call(this, e, t, i, n), this.className = "Service", this.clazz = null
            },
            M = x.prototype = Object.create(h.prototype);
          M.build = function(i) {
            return this.clazz && !i ? this.clazz : this.clazz = function(e, i) {
              for (var n = function(t) {
                  e.Builder.Service.call(this), this.rpcImpl = t || function(e, t, i) {
                    setTimeout(i.bind(this, Error("Not implemented")), 0)
                  }
                }, r = n.prototype = Object.create(e.Builder.Service.prototype), o = i.getChildren(e.Reflect.Service.RPCMethod), a = 0; a < o.length; a++) {
                ! function(e) {
                  r[e.name] = function(n, r) {
                    try {
                      try {
                        n = e.resolvedRequestType.clazz.decode(t.wrap(n))
                      } catch (o) {
                        if (!(o instanceof TypeError)) {
                          throw o
                        }
                      };
                      if (null === n || "object" != typeof n) {
                        throw Error("Illegal arguments")
                      };
                      n instanceof e.resolvedRequestType.clazz || (n = new e.resolvedRequestType.clazz(n)), this.rpcImpl(e.fqn(), n, function(t, n) {
                        if (t) {
                          return void(r(t))
                        };
                        null === n && (n = "");
                        try {
                          n = e.resolvedResponseType.clazz.decode(n)
                        } catch (o) {};
                        return n && n instanceof e.resolvedResponseType.clazz ? void(r(null, n)) : void(r(Error("Illegal response type received in service method " + i.name + "#" + e.name)))
                      })
                    } catch (o) {
                      setTimeout(r.bind(this, o), 0)
                    }
                  }, n[e.name] = function(t, i, r) {
                    new n(t)[e.name](i, r)
                  }, Object.defineProperty && (Object.defineProperty(n[e.name], "$options", {
                    value: e.buildOpt()
                  }), Object.defineProperty(r[e.name], "$options", {
                    value: n[e.name].$options
                  }))
                }(o[a])
              };
              return Object.defineProperty && (Object.defineProperty(n, "$options", {
                value: i.buildOpt()
              }), Object.defineProperty(r, "$options", {
                value: n.$options
              }), Object.defineProperty(n, "$type", {
                value: i
              }), Object.defineProperty(r, "$type", {
                value: i
              })), n
            }(e, this)
          }, o.Service = x;
          var E = function(e, t, i, n) {
              a.call(this, e, t, i), this.className = "Service.Method", this.options = n || {}
            },
            S = E.prototype = Object.create(a.prototype);
          S.buildOpt = l.buildOpt, o.Service.Method = E;
          var T = function(e, t, i, n, r, o, a, s) {
            E.call(this, e, t, i, s), this.className = "Service.RPCMethod", this.requestName = n, this.responseName = r, this.requestStream = o, this.responseStream = a, this.resolvedRequestType = null, this.resolvedResponseType = null
          };
          return T.prototype = Object.create(E.prototype), o.Service.RPCMethod = T, o
        }(r), r.Builder = function(t, i, n) {
          function r(e) {
            e.messages && e.messages.forEach(function(t) {
              t.syntax = e.syntax, r(t)
            }), e.enums && e.enums.forEach(function(t) {
              t.syntax = e.syntax
            })
          }
          var o = function(e) {
              this.ns = new n.Namespace(this, null, ""), this.ptr = this.ns, this.resolved = !1, this.result = null, this.files = {}, this.importRoot = null, this.options = e || {}
            },
            a = o.prototype;
          return o.isMessage = function(e) {
            return "string" != typeof e.name ? !1 : "undefined" != typeof e.values || "undefined" != typeof e.rpc ? !1 : !0
          }, o.isMessageField = function(e) {
            return "string" != typeof e.rule || "string" != typeof e.name || "string" != typeof e.type || "undefined" == typeof e.id ? !1 : !0
          }, o.isEnum = function(e) {
            return "string" != typeof e.name ? !1 : "undefined" != typeof e.values && Array.isArray(e.values) && 0 !== e.values.length ? !0 : !1
          }, o.isService = function(e) {
            return "string" == typeof e.name && "object" == typeof e.rpc && e.rpc ? !0 : !1
          }, o.isExtend = function(e) {
            return "string" != typeof e.ref ? !1 : !0
          }, a.reset = function() {
            return this.ptr = this.ns, this
          }, a.define = function(e) {
            if ("string" != typeof e || !i.TYPEREF.test(e)) {
              throw Error("illegal namespace: " + e)
            };
            return e.split(".").forEach(function(e) {
              var t = this.ptr.getChild(e);
              null === t && this.ptr.addChild(t = new n.Namespace(this, this.ptr, e)), this.ptr = t
            }, this), this
          }, a.create = function(e) {
            if (!e) {
              return this
            };
            if (Array.isArray(e)) {
              if (0 === e.length) {
                return this
              };
              e = e.slice()
            } else {
              e = [e]
            };
            for (var i = [e]; i.length > 0;) {
              if (e = i.pop(), !Array.isArray(e)) {
                throw Error("not a valid namespace: " + JSON.stringify(e))
              };
              for (; e.length > 0;) {
                var r = e.shift();
                if (o.isMessage(r)) {
                  var a = new n.Message(this, this.ptr, r.name, r.options, r.isGroup, r.syntax),
                    s = {};
                  r.oneofs && Object.keys(r.oneofs).forEach(function(e) {
                    a.addChild(s[e] = new n.Message.OneOf(this, a, e))
                  }, this), r.fields && r.fields.forEach(function(e) {
                    if (null !== a.getChild(0 | e.id)) {
                      throw Error("duplicate or invalid field id in " + a.name + ": " + e.id)
                    };
                    if (e.options && "object" != typeof e.options) {
                      throw Error("illegal field options in " + a.name + "#" + e.name)
                    };
                    var t = null;
                    if ("string" == typeof e.oneof && !(t = s[e.oneof])) {
                      throw Error("illegal oneof in " + a.name + "#" + e.name + ": " + e.oneof)
                    };
                    e = new n.Message.Field(this, a, e.rule, e.keytype, e.type, e.name, e.id, e.options, t, r.syntax), t && t.fields.push(e), a.addChild(e)
                  }, this);
                  var h = [];
                  if (r.enums && r.enums.forEach(function(e) {
                      h.push(e)
                    }), r.messages && r.messages.forEach(function(e) {
                      h.push(e)
                    }), r.services && r.services.forEach(function(e) {
                      h.push(e)
                    }), r.extensions && (a.extensions = "number" == typeof r.extensions[0] ? [r.extensions] : r.extensions), this.ptr.addChild(a), h.length > 0) {
                    i.push(e), e = h, h = null, this.ptr = a, a = null;
                    continue
                  };
                  h = null
                } else {
                  if (o.isEnum(r)) {
                    a = new n.Enum(this, this.ptr, r.name, r.options, r.syntax), r.values.forEach(function(e) {
                      a.addChild(new n.Enum.Value(this, a, e.name, e.id))
                    }, this), this.ptr.addChild(a)
                  } else {
                    if (o.isService(r)) {
                      a = new n.Service(this, this.ptr, r.name, r.options), Object.keys(r.rpc).forEach(function(e) {
                        var t = r.rpc[e];
                        a.addChild(new n.Service.RPCMethod(this, a, e, t.request, t.response, !!t.request_stream, !!t.response_stream, t.options))
                      }, this), this.ptr.addChild(a)
                    } else {
                      if (!o.isExtend(r)) {
                        throw Error("not a valid definition: " + JSON.stringify(r))
                      };
                      if (a = this.ptr.resolve(r.ref, !0)) {
                        r.fields.forEach(function(e) {
                          if (null !== a.getChild(0 | e.id)) {
                            throw Error("duplicate extended field id in " + a.name + ": " + e.id)
                          };
                          if (a.extensions) {
                            var i = !1;
                            if (a.extensions.forEach(function(t) {
                                e.id >= t[0] && e.id <= t[1] && (i = !0)
                              }), !i) {
                              throw Error("illegal extended field id in " + a.name + ": " + e.id + " (not within valid ranges)")
                            }
                          };
                          var r = e.name;
                          this.options.convertFieldsToCamelCase && (r = t.Util.toCamelCase(r));
                          var o = new n.Message.ExtensionField(this, a, e.rule, e.type, this.ptr.fqn() + "." + r, e.id, e.options),
                            s = new n.Extension(this, this.ptr, e.name, o);
                          o.extension = s, this.ptr.addChild(s), a.addChild(o)
                        }, this)
                      } else {
                        if (!/\.?google\.protobuf\./.test(r.ref)) {
                          throw Error("extended message " + r.ref + " is not defined")
                        }
                      }
                    }
                  }
                };
                r = null, a = null
              };
              e = null, this.ptr = this.ptr.parent
            };
            return this.resolved = !1, this.result = null, this
          }, a["import"] = function(i, n) {
            var o = "/";
            if ("string" == typeof n) {
              if (t.Util.IS_NODE && (n = e("path").resolve(n)), this.files[n] === !0) {
                return this.reset()
              };
              this.files[n] = !0
            } else {
              if ("object" == typeof n) {
                var a = n.root;
                t.Util.IS_NODE && (a = e("path").resolve(a)), (a.indexOf("\\") >= 0 || n.file.indexOf("\\") >= 0) && (o = "\\");
                var s = a + o + n.file;
                if (this.files[s] === !0) {
                  return this.reset()
                };
                this.files[s] = !0
              }
            };
            if (i.imports && i.imports.length > 0) {
              var h, l = !1;
              "object" == typeof n ? (this.importRoot = n.root, l = !0, h = this.importRoot, n = n.file, (h.indexOf("\\") >= 0 || n.indexOf("\\") >= 0) && (o = "\\")) : "string" == typeof n ? this.importRoot ? h = this.importRoot : n.indexOf("/") >= 0 ? (h = n.replace(/\/[^\/]*$/, ""), "" === h && (h = "/")) : n.indexOf("\\") >= 0 ? (h = n.replace(/\\[^\\]*$/, ""), o = "\\") : h = "." : h = null;
              for (var c = 0; c < i.imports.length; c++) {
                if ("string" == typeof i.imports[c]) {
                  if (!h) {
                    throw Error("cannot determine import root")
                  };
                  var u = i.imports[c];
                  if ("google/protobuf/descriptor.proto" === u) {
                    continue
                  };
                  if (u = h + o + u, this.files[u] === !0) {
                    continue
                  };
                  /\.proto$/i.test(u) && !t.DotProto && (u = u.replace(/\.proto$/, ".json"));
                  var d = t.Util.fetch(u);
                  if (null === d) {
                    throw Error("failed to import '" + u + "' in '" + n + "': file not found")
                  };
                  /\.json$/i.test(u) ? this["import"](JSON.parse(d + ""), u) : this["import"](t.DotProto.Parser.parse(d), u)
                } else {
                  n ? /\.(\w+)$/.test(n) ? this["import"](i.imports[c], n.replace(/^(.+)\.(\w+)$/, function(e, t, i) {
                    return t + "_import" + c + "." + i
                  })) : this["import"](i.imports[c], n + "_import" + c) : this["import"](i.imports[c])
                }
              };
              l && (this.importRoot = null)
            };
            i["package"] && this.define(i["package"]), i.syntax && r(i);
            var p = this.ptr;
            return i.options && Object.keys(i.options).forEach(function(e) {
              p.options[e] = i.options[e]
            }), i.messages && (this.create(i.messages), this.ptr = p), i.enums && (this.create(i.enums), this.ptr = p), i.services && (this.create(i.services), this.ptr = p), i["extends"] && this.create(i["extends"]), this.reset()
          }, a.resolveAll = function() {
            var e;
            if (null == this.ptr || "object" == typeof this.ptr.type) {
              return this
            };
            if (this.ptr instanceof n.Namespace) {
              this.ptr.children.forEach(function(e) {
                this.ptr = e, this.resolveAll()
              }, this)
            } else {
              if (this.ptr instanceof n.Message.Field) {
                if (i.TYPE.test(this.ptr.type)) {
                  this.ptr.type = t.TYPES[this.ptr.type]
                } else {
                  if (!i.TYPEREF.test(this.ptr.type)) {
                    throw Error("illegal type reference in " + this.ptr.toString(!0) + ": " + this.ptr.type)
                  };
                  if (e = (this.ptr instanceof n.Message.ExtensionField ? this.ptr.extension.parent : this.ptr.parent).resolve(this.ptr.type, !0), !e) {
                    throw Error("unresolvable type reference in " + this.ptr.toString(!0) + ": " + this.ptr.type)
                  };
                  if (this.ptr.resolvedType = e, e instanceof n.Enum) {
                    if (this.ptr.type = t.TYPES["enum"], "proto3" === this.ptr.syntax && "proto3" !== e.syntax) {
                      throw Error("proto3 message cannot reference proto2 enum")
                    }
                  } else {
                    if (!(e instanceof n.Message)) {
                      throw Error("illegal type reference in " + this.ptr.toString(!0) + ": " + this.ptr.type)
                    };
                    this.ptr.type = e.isGroup ? t.TYPES.group : t.TYPES.message
                  }
                };
                if (this.ptr.map) {
                  if (!i.TYPE.test(this.ptr.keyType)) {
                    throw Error("illegal key type for map field in " + this.ptr.toString(!0) + ": " + this.ptr.keyType)
                  };
                  this.ptr.keyType = t.TYPES[this.ptr.keyType]
                }
              } else {
                if (this.ptr instanceof t.Reflect.Service.Method) {
                  if (!(this.ptr instanceof t.Reflect.Service.RPCMethod)) {
                    throw Error("illegal service type in " + this.ptr.toString(!0))
                  };
                  if (e = this.ptr.parent.resolve(this.ptr.requestName, !0), !(e && e instanceof t.Reflect.Message)) {
                    throw Error("Illegal type reference in " + this.ptr.toString(!0) + ": " + this.ptr.requestName)
                  };
                  if (this.ptr.resolvedRequestType = e, e = this.ptr.parent.resolve(this.ptr.responseName, !0), !(e && e instanceof t.Reflect.Message)) {
                    throw Error("Illegal type reference in " + this.ptr.toString(!0) + ": " + this.ptr.responseName)
                  };
                  this.ptr.resolvedResponseType = e
                } else {
                  if (!(this.ptr instanceof t.Reflect.Message.OneOf || this.ptr instanceof t.Reflect.Extension || this.ptr instanceof t.Reflect.Enum.Value)) {
                    throw Error("illegal object in namespace: " + typeof this.ptr + ": " + this.ptr)
                  }
                }
              }
            };
            return this.reset()
          }, a.build = function(e) {
            if (this.reset(), this.resolved || (this.resolveAll(), this.resolved = !0, this.result = null), null === this.result && (this.result = this.ns.build()), !e) {
              return this.result
            };
            for (var t = "string" == typeof e ? e.split(".") : e, i = this.result, n = 0; n < t.length; n++) {
              if (!i[t[n]]) {
                i = null;
                break
              };
              i = i[t[n]]
            };
            return i
          }, a.lookup = function(e, t) {
            return e ? this.ns.resolve(e, t) : this.ns
          }, a.toString = function() {
            return "Builder"
          }, o.Message = function() {}, o.Enum = function() {}, o.Service = function() {}, o
        }(r, r.Lang, r.Reflect), r.Map = function(e, t) {
          function i(e) {
            var t = 0;
            return {
              next: function() {
                return t < e.length ? {
                  done: !1,
                  value: e[t++]
                } : {
                  done: !0
                }
              }
            }
          }
          var n = function(e, i) {
              if (!e.map) {
                throw Error("field is not a map")
              };
              if (this.field = e, this.keyElem = new t.Element(e.keyType, null, !0, e.syntax), this.valueElem = new t.Element(e.type, e.resolvedType, !1, e.syntax), this.map = {}, Object.defineProperty(this, "size", {
                  get: function() {
                    return Object.keys(this.map).length
                  }
                }), i) {
                for (var n = Object.keys(i), r = 0; r < n.length; r++) {
                  var o = this.keyElem.valueFromString(n[r]),
                    a = this.valueElem.verifyValue(i[n[r]]);
                  this.map[this.keyElem.valueToString(o)] = {
                    key: o,
                    value: a
                  }
                }
              }
            },
            r = n.prototype;
          return r.clear = function() {
            this.map = {}
          }, r["delete"] = function(e) {
            var t = this.keyElem.valueToString(this.keyElem.verifyValue(e)),
              i = t in this.map;
            return delete this.map[t], i
          }, r.entries = function() {
            for (var e, t = [], n = Object.keys(this.map), r = 0; r < n.length; r++) {
              t.push([(e = this.map[n[r]]).key, e.value])
            };
            return i(t)
          }, r.keys = function() {
            for (var e = [], t = Object.keys(this.map), n = 0; n < t.length; n++) {
              e.push(this.map[t[n]].key)
            };
            return i(e)
          }, r.values = function() {
            for (var e = [], t = Object.keys(this.map), n = 0; n < t.length; n++) {
              e.push(this.map[t[n]].value)
            };
            return i(e)
          }, r.forEach = function(e, t) {
            for (var i, n = Object.keys(this.map), r = 0; r < n.length; r++) {
              e.call(t, (i = this.map[n[r]]).value, i.key, this)
            }
          }, r["set"] = function(e, t) {
            var i = this.keyElem.verifyValue(e),
              n = this.valueElem.verifyValue(t);
            return this.map[this.keyElem.valueToString(i)] = {
              key: i,
              value: n
            }, this
          }, r["get"] = function(e) {
            var t = this.keyElem.valueToString(this.keyElem.verifyValue(e));
            return t in this.map ? this.map[t].value : void(0)
          }, r.has = function(e) {
            var t = this.keyElem.valueToString(this.keyElem.verifyValue(e));
            return t in this.map
          }, n
        }(r, r.Reflect), r.loadProto = function(e, t, i) {
          return ("string" == typeof t || t && "string" == typeof t.file && "string" == typeof t.root) && (i = t, t = void(0)), r.loadJson(r.DotProto.Parser.parse(e), t, i)
        }, r.protoFromString = r.loadProto, r.loadProtoFile = function(e, t, i) {
          if (t && "object" == typeof t ? (i = t, t = null) : t && "function" == typeof t || (t = null), t) {
            return r.Util.fetch("string" == typeof e ? e : e.root + "/" + e.file, function(n) {
              if (null === n) {
                return void(t(Error("Failed to fetch file")))
              };
              try {
                t(null, r.loadProto(n, i, e))
              } catch (o) {
                t(o)
              }
            })
          };
          var n = r.Util.fetch("object" == typeof e ? e.root + "/" + e.file : e);
          return null === n ? null : r.loadProto(n, i, e)
        }, r.protoFromFile = r.loadProtoFile, r.newBuilder = function(e) {
          return e = e || {}, "undefined" == typeof e.convertFieldsToCamelCase && (e.convertFieldsToCamelCase = r.convertFieldsToCamelCase), "undefined" == typeof e.populateAccessors && (e.populateAccessors = r.populateAccessors), new r.Builder(e)
        }, r.loadJson = function(e, t, i) {
          return ("string" == typeof t || t && "string" == typeof t.file && "string" == typeof t.root) && (i = t, t = null), t && "object" == typeof t || (t = r.newBuilder()), "string" == typeof e && (e = JSON.parse(e)), t["import"](e, i), t.resolveAll(), t
        }, r.loadJsonFile = function(e, t, i) {
          if (t && "object" == typeof t ? (i = t, t = null) : t && "function" == typeof t || (t = null), t) {
            return r.Util.fetch("string" == typeof e ? e : e.root + "/" + e.file, function(n) {
              if (null === n) {
                return void(t(Error("Failed to fetch file")))
              };
              try {
                t(null, r.loadJson(JSON.parse(n), i, e))
              } catch (o) {
                t(o)
              }
            })
          };
          var n = r.Util.fetch("object" == typeof e ? e.root + "/" + e.file : e);
          return null === n ? null : r.loadJson(JSON.parse(n), i, e)
        }, r
      })
    }).call(this, e("_process"))
  }

  function _$af271450(e, t, i) {
    ! function(i, n) {
      "function" == typeof define && define.amd ? define(["long"], n) : "function" == typeof e && "object" == typeof t && t && t.exports ? t.exports = function() {
        var t;
        try {
          t = e("long")
        } catch (i) {};
        return n(t)
      }() : (i.dcodeIO = i.dcodeIO || {}).ByteBuffer = n(i.dcodeIO.Long)
    }(this, function(e) {
      "use strict";

      function t(e) {
        var t = 0;
        return function() {
          return t < e.length ? e.charCodeAt(t++) : null
        }
      }

      function i() {
        var e = [],
          t = [];
        return function() {
          return 0 === arguments.length ? t.join("") + h.apply(String, e) : (e.length + arguments.length > 1024 && (t.push(h.apply(String, e)), e.length = 0), void(Array.prototype.push.apply(e, arguments)))
        }
      }

      function n(e, t, i, n, r) {
        var o, a, s = 8 * r - n - 1,
          h = (1 << s) - 1,
          l = h >> 1,
          c = -7,
          u = i ? r - 1 : 0,
          d = i ? -1 : 1,
          p = e[t + u];
        for (u += d, o = p & (1 << -c) - 1, p >>= -c, c += s; c > 0; o = 256 * o + e[t + u], u += d, c -= 8) {;
        };
        for (a = o & (1 << -c) - 1, o >>= -c, c += n; c > 0; a = 256 * a + e[t + u], u += d, c -= 8) {;
        };
        if (0 === o) {
          o = 1 - l
        } else {
          if (o === h) {
            return a ? 0 / 0 : (p ? -1 : 1) * (1 / 0)
          };
          a += Math.pow(2, n), o -= l
        };
        return (p ? -1 : 1) * a * Math.pow(2, o - n)
      }

      function r(e, t, i, n, r, o) {
        var a, s, h, l = 8 * o - r - 1,
          c = (1 << l) - 1,
          u = c >> 1,
          d = 23 === r ? Math.pow(2, -24) - Math.pow(2, -77) : 0,
          p = n ? 0 : o - 1,
          f = n ? 1 : -1,
          m = 0 > t || 0 === t && 0 > 1 / t ? 1 : 0;
        for (t = Math.abs(t), isNaN(t) || t === 1 / 0 ? (s = isNaN(t) ? 1 : 0, a = c) : (a = Math.floor(Math.log(t) / Math.LN2), t * (h = Math.pow(2, -a)) < 1 && (a--, h *= 2), t += a + u >= 1 ? d / h : d * Math.pow(2, 1 - u), t * h >= 2 && (a++, h /= 2), a + u >= c ? (s = 0, a = c) : a + u >= 1 ? (s = (t * h - 1) * Math.pow(2, r), a += u) : (s = t * Math.pow(2, u - 1) * Math.pow(2, r), a = 0)); r >= 8; e[i + p] = 255 & s, p += f, s /= 256, r -= 8) {;
        };
        for (a = a << r | s, l += r; l > 0; e[i + p] = 255 & a, p += f, a /= 256, l -= 8) {;
        };
        e[i + p - f] |= 128 * m
      }
      var o = function(e, t, i) {
        if ("undefined" == typeof e && (e = o.DEFAULT_CAPACITY), "undefined" == typeof t && (t = o.DEFAULT_ENDIAN), "undefined" == typeof i && (i = o.DEFAULT_NOASSERT), !i) {
          if (e = 0 | e, 0 > e) {
            throw RangeError("Illegal capacity")
          };
          t = !!t, i = !!i
        };
        this.buffer = 0 === e ? s : new ArrayBuffer(e), this.view = 0 === e ? null : new Uint8Array(this.buffer), this.offset = 0, this.markedOffset = -1, this.limit = e, this.littleEndian = "undefined" != typeof t ? !!t : !1, this.noAssert = !!i
      };
      o.VERSION = "5.0.0", o.LITTLE_ENDIAN = !0, o.BIG_ENDIAN = !1, o.DEFAULT_CAPACITY = 16, o.DEFAULT_ENDIAN = o.BIG_ENDIAN, o.DEFAULT_NOASSERT = !1, o.Long = e || null;
      var a = o.prototype;
      a.__isByteBuffer__, Object.defineProperty(a, "__isByteBuffer__", {
        value: !0,
        enumerable: !1,
        configurable: !1
      });
      var s = new ArrayBuffer(0),
        h = String.fromCharCode;
      o.accessor = function() {
        return Uint8Array
      }, o.allocate = function(e, t, i) {
        return new o(e, t, i)
      }, o.concat = function(e, t, i, n) {
        ("boolean" == typeof t || "string" != typeof t) && (n = i, i = t, t = void(0));
        for (var r, a = 0, s = 0, h = e.length; h > s; ++s) {
          o.isByteBuffer(e[s]) || (e[s] = o.wrap(e[s], t)), r = e[s].limit - e[s].offset, r > 0 && (a += r)
        };
        if (0 === a) {
          return new o(0, i, n)
        };
        var l, c = new o(a, i, n);
        for (s = 0; h > s;) {
          l = e[s++], r = l.limit - l.offset, 0 >= r || (c.view["set"](l.view.subarray(l.offset, l.limit), c.offset), c.offset += r)
        };
        return c.limit = c.offset, c.offset = 0, c
      }, o.isByteBuffer = function(e) {
        return (e && e.__isByteBuffer__) === !0
      }, o.type = function() {
        return ArrayBuffer
      }, o.wrap = function(e, t, i, n) {
        if ("string" != typeof t && (n = i, i = t, t = void(0)), "string" == typeof e) {
          switch ("undefined" == typeof t && (t = "utf8"), t) {
            case "base64":
              return o.fromBase64(e, i);
            case "hex":
              return o.fromHex(e, i);
            case "binary":
              return o.fromBinary(e, i);
            case "utf8":
              return o.fromUTF8(e, i);
            case "debug":
              return o.fromDebug(e, i);
            default:
              throw Error("Unsupported encoding: " + t)
          }
        };
        if (null === e || "object" != typeof e) {
          throw TypeError("Illegal buffer")
        };
        var r;
        if (o.isByteBuffer(e)) {
          return r = a.clone.call(e), r.markedOffset = -1, r
        };
        if (e instanceof Uint8Array) {
          r = new o(0, i, n), e.length > 0 && (r.buffer = e.buffer, r.offset = e.byteOffset, r.limit = e.byteOffset + e.byteLength, r.view = new Uint8Array(e.buffer))
        } else {
          if (e instanceof ArrayBuffer) {
            r = new o(0, i, n), e.byteLength > 0 && (r.buffer = e, r.offset = 0, r.limit = e.byteLength, r.view = e.byteLength > 0 ? new Uint8Array(e) : null)
          } else {
            if ("[object Array]" !== Object.prototype.toString.call(e)) {
              throw TypeError("Illegal buffer")
            };
            r = new o(e.length, i, n), r.limit = e.length;
            for (var s = 0; s < e.length; ++s) {
              r.view[s] = e[s]
            }
          }
        };
        return r
      }, a.readBytes = function(e, t) {
        var i = "undefined" == typeof t;
        if (i && (t = this.offset), !this.noAssert) {
          if ("number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal offset: " + t + " (not an integer)")
          };
          if (t >>>= 0, 0 > t || t + e > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + t + " (+" + e + ") <= " + this.buffer.byteLength)
          }
        };
        var n = this.slice(t, t + e);
        return i && (this.offset += e), n
      }, a.writeBytes = a.append, a.writeInt8 = function(e, t) {
        var i = "undefined" == typeof t;
        if (i && (t = this.offset), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal value: " + e + " (not an integer)")
          };
          if (e |= 0, "number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal offset: " + t + " (not an integer)")
          };
          if (t >>>= 0, 0 > t || t + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + t + " (+0) <= " + this.buffer.byteLength)
          }
        };
        t += 1;
        var n = this.buffer.byteLength;
        return t > n && this.resize((n *= 2) > t ? n : t), t -= 1, this.view[t] = e, i && (this.offset += 1), this
      }, a.writeByte = a.writeInt8, a.readInt8 = function(e) {
        var t = "undefined" == typeof e;
        if (t && (e = this.offset), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal offset: " + e + " (not an integer)")
          };
          if (e >>>= 0, 0 > e || e + 1 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + e + " (+1) <= " + this.buffer.byteLength)
          }
        };
        var i = this.view[e];
        return 128 === (128 & i) && (i = -(255 - i + 1)), t && (this.offset += 1), i
      }, a.readByte = a.readInt8, a.writeUint8 = function(e, t) {
        var i = "undefined" == typeof t;
        if (i && (t = this.offset), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal value: " + e + " (not an integer)")
          };
          if (e >>>= 0, "number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal offset: " + t + " (not an integer)")
          };
          if (t >>>= 0, 0 > t || t + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + t + " (+0) <= " + this.buffer.byteLength)
          }
        };
        t += 1;
        var n = this.buffer.byteLength;
        return t > n && this.resize((n *= 2) > t ? n : t), t -= 1, this.view[t] = e, i && (this.offset += 1), this
      }, a.writeUInt8 = a.writeUint8, a.readUint8 = function(e) {
        var t = "undefined" == typeof e;
        if (t && (e = this.offset), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal offset: " + e + " (not an integer)")
          };
          if (e >>>= 0, 0 > e || e + 1 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + e + " (+1) <= " + this.buffer.byteLength)
          }
        };
        var i = this.view[e];
        return t && (this.offset += 1), i
      }, a.readUInt8 = a.readUint8, a.writeInt16 = function(e, t) {
        var i = "undefined" == typeof t;
        if (i && (t = this.offset), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal value: " + e + " (not an integer)")
          };
          if (e |= 0, "number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal offset: " + t + " (not an integer)")
          };
          if (t >>>= 0, 0 > t || t + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + t + " (+0) <= " + this.buffer.byteLength)
          }
        };
        t += 2;
        var n = this.buffer.byteLength;
        return t > n && this.resize((n *= 2) > t ? n : t), t -= 2, this.littleEndian ? (this.view[t + 1] = (65280 & e) >>> 8, this.view[t] = 255 & e) : (this.view[t] = (65280 & e) >>> 8, this.view[t + 1] = 255 & e), i && (this.offset += 2), this
      }, a.writeShort = a.writeInt16, a.readInt16 = function(e) {
        var t = "undefined" == typeof e;
        if (t && (e = this.offset), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal offset: " + e + " (not an integer)")
          };
          if (e >>>= 0, 0 > e || e + 2 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + e + " (+2) <= " + this.buffer.byteLength)
          }
        };
        var i = 0;
        return this.littleEndian ? (i = this.view[e], i |= this.view[e + 1] << 8) : (i = this.view[e] << 8, i |= this.view[e + 1]), 32768 === (32768 & i) && (i = -(65535 - i + 1)), t && (this.offset += 2), i
      }, a.readShort = a.readInt16, a.writeUint16 = function(e, t) {
        var i = "undefined" == typeof t;
        if (i && (t = this.offset), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal value: " + e + " (not an integer)")
          };
          if (e >>>= 0, "number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal offset: " + t + " (not an integer)")
          };
          if (t >>>= 0, 0 > t || t + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + t + " (+0) <= " + this.buffer.byteLength)
          }
        };
        t += 2;
        var n = this.buffer.byteLength;
        return t > n && this.resize((n *= 2) > t ? n : t), t -= 2, this.littleEndian ? (this.view[t + 1] = (65280 & e) >>> 8, this.view[t] = 255 & e) : (this.view[t] = (65280 & e) >>> 8, this.view[t + 1] = 255 & e), i && (this.offset += 2), this
      }, a.writeUInt16 = a.writeUint16, a.readUint16 = function(e) {
        var t = "undefined" == typeof e;
        if (t && (e = this.offset), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal offset: " + e + " (not an integer)")
          };
          if (e >>>= 0, 0 > e || e + 2 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + e + " (+2) <= " + this.buffer.byteLength)
          }
        };
        var i = 0;
        return this.littleEndian ? (i = this.view[e], i |= this.view[e + 1] << 8) : (i = this.view[e] << 8, i |= this.view[e + 1]), t && (this.offset += 2), i
      }, a.readUInt16 = a.readUint16, a.writeInt32 = function(e, t) {
        var i = "undefined" == typeof t;
        if (i && (t = this.offset), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal value: " + e + " (not an integer)")
          };
          if (e |= 0, "number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal offset: " + t + " (not an integer)")
          };
          if (t >>>= 0, 0 > t || t + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + t + " (+0) <= " + this.buffer.byteLength)
          }
        };
        t += 4;
        var n = this.buffer.byteLength;
        return t > n && this.resize((n *= 2) > t ? n : t), t -= 4, this.littleEndian ? (this.view[t + 3] = e >>> 24 & 255, this.view[t + 2] = e >>> 16 & 255, this.view[t + 1] = e >>> 8 & 255, this.view[t] = 255 & e) : (this.view[t] = e >>> 24 & 255, this.view[t + 1] = e >>> 16 & 255, this.view[t + 2] = e >>> 8 & 255, this.view[t + 3] = 255 & e), i && (this.offset += 4), this
      }, a.writeInt = a.writeInt32, a.readInt32 = function(e) {
        var t = "undefined" == typeof e;
        if (t && (e = this.offset), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal offset: " + e + " (not an integer)")
          };
          if (e >>>= 0, 0 > e || e + 4 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + e + " (+4) <= " + this.buffer.byteLength)
          }
        };
        var i = 0;
        return this.littleEndian ? (i = this.view[e + 2] << 16, i |= this.view[e + 1] << 8, i |= this.view[e], i += this.view[e + 3] << 24 >>> 0) : (i = this.view[e + 1] << 16, i |= this.view[e + 2] << 8, i |= this.view[e + 3], i += this.view[e] << 24 >>> 0), i |= 0, t && (this.offset += 4), i
      }, a.readInt = a.readInt32, a.writeUint32 = function(e, t) {
        var i = "undefined" == typeof t;
        if (i && (t = this.offset), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal value: " + e + " (not an integer)")
          };
          if (e >>>= 0, "number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal offset: " + t + " (not an integer)")
          };
          if (t >>>= 0, 0 > t || t + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + t + " (+0) <= " + this.buffer.byteLength)
          }
        };
        t += 4;
        var n = this.buffer.byteLength;
        return t > n && this.resize((n *= 2) > t ? n : t), t -= 4, this.littleEndian ? (this.view[t + 3] = e >>> 24 & 255, this.view[t + 2] = e >>> 16 & 255, this.view[t + 1] = e >>> 8 & 255, this.view[t] = 255 & e) : (this.view[t] = e >>> 24 & 255, this.view[t + 1] = e >>> 16 & 255, this.view[t + 2] = e >>> 8 & 255, this.view[t + 3] = 255 & e), i && (this.offset += 4), this
      }, a.writeUInt32 = a.writeUint32, a.readUint32 = function(e) {
        var t = "undefined" == typeof e;
        if (t && (e = this.offset), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal offset: " + e + " (not an integer)")
          };
          if (e >>>= 0, 0 > e || e + 4 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + e + " (+4) <= " + this.buffer.byteLength)
          }
        };
        var i = 0;
        return this.littleEndian ? (i = this.view[e + 2] << 16, i |= this.view[e + 1] << 8, i |= this.view[e], i += this.view[e + 3] << 24 >>> 0) : (i = this.view[e + 1] << 16, i |= this.view[e + 2] << 8, i |= this.view[e + 3], i += this.view[e] << 24 >>> 0), t && (this.offset += 4), i
      }, a.readUInt32 = a.readUint32, e && (a.writeInt64 = function(t, i) {
        var n = "undefined" == typeof i;
        if (n && (i = this.offset), !this.noAssert) {
          if ("number" == typeof t) {
            t = e.fromNumber(t)
          } else {
            if ("string" == typeof t) {
              t = e.fromString(t)
            } else {
              if (!(t && t instanceof e)) {
                throw TypeError("Illegal value: " + t + " (not an integer or Long)")
              }
            }
          };
          if ("number" != typeof i || i % 1 !== 0) {
            throw TypeError("Illegal offset: " + i + " (not an integer)")
          };
          if (i >>>= 0, 0 > i || i + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + i + " (+0) <= " + this.buffer.byteLength)
          }
        };
        "number" == typeof t ? t = e.fromNumber(t) : "string" == typeof t && (t = e.fromString(t)), i += 8;
        var r = this.buffer.byteLength;
        i > r && this.resize((r *= 2) > i ? r : i), i -= 8;
        var o = t.low,
          a = t.high;
        return this.littleEndian ? (this.view[i + 3] = o >>> 24 & 255, this.view[i + 2] = o >>> 16 & 255, this.view[i + 1] = o >>> 8 & 255, this.view[i] = 255 & o, i += 4, this.view[i + 3] = a >>> 24 & 255, this.view[i + 2] = a >>> 16 & 255, this.view[i + 1] = a >>> 8 & 255, this.view[i] = 255 & a) : (this.view[i] = a >>> 24 & 255, this.view[i + 1] = a >>> 16 & 255, this.view[i + 2] = a >>> 8 & 255, this.view[i + 3] = 255 & a, i += 4, this.view[i] = o >>> 24 & 255, this.view[i + 1] = o >>> 16 & 255, this.view[i + 2] = o >>> 8 & 255, this.view[i + 3] = 255 & o), n && (this.offset += 8), this
      }, a.writeLong = a.writeInt64, a.readInt64 = function(t) {
        var i = "undefined" == typeof t;
        if (i && (t = this.offset), !this.noAssert) {
          if ("number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal offset: " + t + " (not an integer)")
          };
          if (t >>>= 0, 0 > t || t + 8 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + t + " (+8) <= " + this.buffer.byteLength)
          }
        };
        var n = 0,
          r = 0;
        this.littleEndian ? (n = this.view[t + 2] << 16, n |= this.view[t + 1] << 8, n |= this.view[t], n += this.view[t + 3] << 24 >>> 0, t += 4, r = this.view[t + 2] << 16, r |= this.view[t + 1] << 8, r |= this.view[t], r += this.view[t + 3] << 24 >>> 0) : (r = this.view[t + 1] << 16, r |= this.view[t + 2] << 8, r |= this.view[t + 3], r += this.view[t] << 24 >>> 0, t += 4, n = this.view[t + 1] << 16, n |= this.view[t + 2] << 8, n |= this.view[t + 3], n += this.view[t] << 24 >>> 0);
        var o = new e(n, r, !1);
        return i && (this.offset += 8), o
      }, a.readLong = a.readInt64, a.writeUint64 = function(t, i) {
        var n = "undefined" == typeof i;
        if (n && (i = this.offset), !this.noAssert) {
          if ("number" == typeof t) {
            t = e.fromNumber(t)
          } else {
            if ("string" == typeof t) {
              t = e.fromString(t)
            } else {
              if (!(t && t instanceof e)) {
                throw TypeError("Illegal value: " + t + " (not an integer or Long)")
              }
            }
          };
          if ("number" != typeof i || i % 1 !== 0) {
            throw TypeError("Illegal offset: " + i + " (not an integer)")
          };
          if (i >>>= 0, 0 > i || i + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + i + " (+0) <= " + this.buffer.byteLength)
          }
        };
        "number" == typeof t ? t = e.fromNumber(t) : "string" == typeof t && (t = e.fromString(t)), i += 8;
        var r = this.buffer.byteLength;
        i > r && this.resize((r *= 2) > i ? r : i), i -= 8;
        var o = t.low,
          a = t.high;
        return this.littleEndian ? (this.view[i + 3] = o >>> 24 & 255, this.view[i + 2] = o >>> 16 & 255, this.view[i + 1] = o >>> 8 & 255, this.view[i] = 255 & o, i += 4, this.view[i + 3] = a >>> 24 & 255, this.view[i + 2] = a >>> 16 & 255, this.view[i + 1] = a >>> 8 & 255, this.view[i] = 255 & a) : (this.view[i] = a >>> 24 & 255, this.view[i + 1] = a >>> 16 & 255, this.view[i + 2] = a >>> 8 & 255, this.view[i + 3] = 255 & a, i += 4, this.view[i] = o >>> 24 & 255, this.view[i + 1] = o >>> 16 & 255, this.view[i + 2] = o >>> 8 & 255, this.view[i + 3] = 255 & o), n && (this.offset += 8), this
      }, a.writeUInt64 = a.writeUint64, a.readUint64 = function(t) {
        var i = "undefined" == typeof t;
        if (i && (t = this.offset), !this.noAssert) {
          if ("number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal offset: " + t + " (not an integer)")
          };
          if (t >>>= 0, 0 > t || t + 8 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + t + " (+8) <= " + this.buffer.byteLength)
          }
        };
        var n = 0,
          r = 0;
        this.littleEndian ? (n = this.view[t + 2] << 16, n |= this.view[t + 1] << 8, n |= this.view[t], n += this.view[t + 3] << 24 >>> 0, t += 4, r = this.view[t + 2] << 16, r |= this.view[t + 1] << 8, r |= this.view[t], r += this.view[t + 3] << 24 >>> 0) : (r = this.view[t + 1] << 16, r |= this.view[t + 2] << 8, r |= this.view[t + 3], r += this.view[t] << 24 >>> 0, t += 4, n = this.view[t + 1] << 16, n |= this.view[t + 2] << 8, n |= this.view[t + 3], n += this.view[t] << 24 >>> 0);
        var o = new e(n, r, !0);
        return i && (this.offset += 8), o
      }, a.readUInt64 = a.readUint64), a.writeFloat32 = function(e, t) {
        var i = "undefined" == typeof t;
        if (i && (t = this.offset), !this.noAssert) {
          if ("number" != typeof e) {
            throw TypeError("Illegal value: " + e + " (not a number)")
          };
          if ("number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal offset: " + t + " (not an integer)")
          };
          if (t >>>= 0, 0 > t || t + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + t + " (+0) <= " + this.buffer.byteLength)
          }
        };
        t += 4;
        var n = this.buffer.byteLength;
        return t > n && this.resize((n *= 2) > t ? n : t), t -= 4, r(this.view, e, t, this.littleEndian, 23, 4), i && (this.offset += 4), this
      }, a.writeFloat = a.writeFloat32, a.readFloat32 = function(e) {
        var t = "undefined" == typeof e;
        if (t && (e = this.offset), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal offset: " + e + " (not an integer)")
          };
          if (e >>>= 0, 0 > e || e + 4 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + e + " (+4) <= " + this.buffer.byteLength)
          }
        };
        var i = n(this.view, e, this.littleEndian, 23, 4);
        return t && (this.offset += 4), i
      }, a.readFloat = a.readFloat32, a.writeFloat64 = function(e, t) {
        var i = "undefined" == typeof t;
        if (i && (t = this.offset), !this.noAssert) {
          if ("number" != typeof e) {
            throw TypeError("Illegal value: " + e + " (not a number)")
          };
          if ("number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal offset: " + t + " (not an integer)")
          };
          if (t >>>= 0, 0 > t || t + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + t + " (+0) <= " + this.buffer.byteLength)
          }
        };
        t += 8;
        var n = this.buffer.byteLength;
        return t > n && this.resize((n *= 2) > t ? n : t), t -= 8, r(this.view, e, t, this.littleEndian, 52, 8), i && (this.offset += 8), this
      }, a.writeDouble = a.writeFloat64, a.readFloat64 = function(e) {
        var t = "undefined" == typeof e;
        if (t && (e = this.offset), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal offset: " + e + " (not an integer)")
          };
          if (e >>>= 0, 0 > e || e + 8 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + e + " (+8) <= " + this.buffer.byteLength)
          }
        };
        var i = n(this.view, e, this.littleEndian, 52, 8);
        return t && (this.offset += 8), i
      }, a.readDouble = a.readFloat64, o.MAX_VARINT32_BYTES = 5, o.calculateVarint32 = function(e) {
        return e >>>= 0, 128 > e ? 1 : 16384 > e ? 2 : 1 << 21 > e ? 3 : 1 << 28 > e ? 4 : 5
      }, o.zigZagEncode32 = function(e) {
        return ((e |= 0) << 1 ^ e >> 31) >>> 0
      }, o.zigZagDecode32 = function(e) {
        return e >>> 1 ^ -(1 & e) | 0
      }, a.writeVarint32 = function(e, t) {
        var i = "undefined" == typeof t;
        if (i && (t = this.offset), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal value: " + e + " (not an integer)")
          };
          if (e |= 0, "number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal offset: " + t + " (not an integer)")
          };
          if (t >>>= 0, 0 > t || t + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + t + " (+0) <= " + this.buffer.byteLength)
          }
        };
        var n, r = o.calculateVarint32(e);
        t += r;
        var a = this.buffer.byteLength;
        for (t > a && this.resize((a *= 2) > t ? a : t), t -= r, e >>>= 0; e >= 128;) {
          n = 127 & e | 128, this.view[t++] = n, e >>>= 7
        };
        return this.view[t++] = e, i ? (this.offset = t, this) : r
      }, a.writeVarint32ZigZag = function(e, t) {
        return this.writeVarint32(o.zigZagEncode32(e), t)
      }, a.readVarint32 = function(e) {
        var t = "undefined" == typeof e;
        if (t && (e = this.offset), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal offset: " + e + " (not an integer)")
          };
          if (e >>>= 0, 0 > e || e + 1 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + e + " (+1) <= " + this.buffer.byteLength)
          }
        };
        var i, n = 0,
          r = 0;
        do {
          if (!this.noAssert && e > this.limit) {
            var o = Error("Truncated");
            throw o.truncated = !0, o
          };
          i = this.view[e++], 5 > n && (r |= (127 & i) << 7 * n), ++n
        } while (0 !== (128 & i));;
        return r |= 0, t ? (this.offset = e, r) : {
          value: r,
          length: n
        }
      }, a.readVarint32ZigZag = function(e) {
        var t = this.readVarint32(e);
        return "object" == typeof t ? t.value = o.zigZagDecode32(t.value) : t = o.zigZagDecode32(t), t
      }, e && (o.MAX_VARINT64_BYTES = 10, o.calculateVarint64 = function(t) {
        "number" == typeof t ? t = e.fromNumber(t) : "string" == typeof t && (t = e.fromString(t));
        var i = t.toInt() >>> 0,
          n = t.shiftRightUnsigned(28).toInt() >>> 0,
          r = t.shiftRightUnsigned(56).toInt() >>> 0;
        return 0 == r ? 0 == n ? 16384 > i ? 128 > i ? 1 : 2 : 1 << 21 > i ? 3 : 4 : 16384 > n ? 128 > n ? 5 : 6 : 1 << 21 > n ? 7 : 8 : 128 > r ? 9 : 10
      }, o.zigZagEncode64 = function(t) {
        return "number" == typeof t ? t = e.fromNumber(t, !1) : "string" == typeof t ? t = e.fromString(t, !1) : t.unsigned !== !1 && (t = t.toSigned()), t.shiftLeft(1).xor(t.shiftRight(63)).toUnsigned()
      }, o.zigZagDecode64 = function(t) {
        return "number" == typeof t ? t = e.fromNumber(t, !1) : "string" == typeof t ? t = e.fromString(t, !1) : t.unsigned !== !1 && (t = t.toSigned()), t.shiftRightUnsigned(1).xor(t.and(e.ONE).toSigned().negate()).toSigned()
      }, a.writeVarint64 = function(t, i) {
        var n = "undefined" == typeof i;
        if (n && (i = this.offset), !this.noAssert) {
          if ("number" == typeof t) {
            t = e.fromNumber(t)
          } else {
            if ("string" == typeof t) {
              t = e.fromString(t)
            } else {
              if (!(t && t instanceof e)) {
                throw TypeError("Illegal value: " + t + " (not an integer or Long)")
              }
            }
          };
          if ("number" != typeof i || i % 1 !== 0) {
            throw TypeError("Illegal offset: " + i + " (not an integer)")
          };
          if (i >>>= 0, 0 > i || i + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + i + " (+0) <= " + this.buffer.byteLength)
          }
        };
        "number" == typeof t ? t = e.fromNumber(t, !1) : "string" == typeof t ? t = e.fromString(t, !1) : t.unsigned !== !1 && (t = t.toSigned());
        var r = o.calculateVarint64(t),
          a = t.toInt() >>> 0,
          s = t.shiftRightUnsigned(28).toInt() >>> 0,
          h = t.shiftRightUnsigned(56).toInt() >>> 0;
        i += r;
        var l = this.buffer.byteLength;
        switch (i > l && this.resize((l *= 2) > i ? l : i), i -= r, r) {
          case 10:
            this.view[i + 9] = h >>> 7 & 1;
          case 9:
            this.view[i + 8] = 9 !== r ? 128 | h : 127 & h;
          case 8:
            this.view[i + 7] = 8 !== r ? s >>> 21 | 128 : s >>> 21 & 127;
          case 7:
            this.view[i + 6] = 7 !== r ? s >>> 14 | 128 : s >>> 14 & 127;
          case 6:
            this.view[i + 5] = 6 !== r ? s >>> 7 | 128 : s >>> 7 & 127;
          case 5:
            this.view[i + 4] = 5 !== r ? 128 | s : 127 & s;
          case 4:
            this.view[i + 3] = 4 !== r ? a >>> 21 | 128 : a >>> 21 & 127;
          case 3:
            this.view[i + 2] = 3 !== r ? a >>> 14 | 128 : a >>> 14 & 127;
          case 2:
            this.view[i + 1] = 2 !== r ? a >>> 7 | 128 : a >>> 7 & 127;
          case 1:
            this.view[i] = 1 !== r ? 128 | a : 127 & a
        };
        return n ? (this.offset += r, this) : r
      }, a.writeVarint64ZigZag = function(e, t) {
        return this.writeVarint64(o.zigZagEncode64(e), t)
      }, a.readVarint64 = function(t) {
        var i = "undefined" == typeof t;
        if (i && (t = this.offset), !this.noAssert) {
          if ("number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal offset: " + t + " (not an integer)")
          };
          if (t >>>= 0, 0 > t || t + 1 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + t + " (+1) <= " + this.buffer.byteLength)
          }
        };
        var n = t,
          r = 0,
          o = 0,
          a = 0,
          s = 0;
        if (s = this.view[t++], r = 127 & s, 128 & s && (s = this.view[t++], r |= (127 & s) << 7, (128 & s || this.noAssert && "undefined" == typeof s) && (s = this.view[t++], r |= (127 & s) << 14, (128 & s || this.noAssert && "undefined" == typeof s) && (s = this.view[t++], r |= (127 & s) << 21, (128 & s || this.noAssert && "undefined" == typeof s) && (s = this.view[t++], o = 127 & s, (128 & s || this.noAssert && "undefined" == typeof s) && (s = this.view[t++], o |= (127 & s) << 7, (128 & s || this.noAssert && "undefined" == typeof s) && (s = this.view[t++], o |= (127 & s) << 14, (128 & s || this.noAssert && "undefined" == typeof s) && (s = this.view[t++], o |= (127 & s) << 21, (128 & s || this.noAssert && "undefined" == typeof s) && (s = this.view[t++], a = 127 & s, (128 & s || this.noAssert && "undefined" == typeof s) && (s = this.view[t++], a |= (127 & s) << 7, 128 & s || this.noAssert && "undefined" == typeof s)))))))))) {
          throw Error("Buffer overrun")
        };
        var h = e.fromBits(r | o << 28, o >>> 4 | a << 24, !1);
        return i ? (this.offset = t, h) : {
          value: h,
          length: t - n
        }
      }, a.readVarint64ZigZag = function(t) {
        var i = this.readVarint64(t);
        return i && i.value instanceof e ? i.value = o.zigZagDecode64(i.value) : i = o.zigZagDecode64(i), i
      }), a.writeCString = function(e, i) {
        var n = "undefined" == typeof i;
        n && (i = this.offset);
        var r, o = e.length;
        if (!this.noAssert) {
          if ("string" != typeof e) {
            throw TypeError("Illegal str: Not a string")
          };
          for (r = 0; o > r; ++r) {
            if (0 === e.charCodeAt(r)) {
              throw RangeError("Illegal str: Contains NULL-characters")
            }
          };
          if ("number" != typeof i || i % 1 !== 0) {
            throw TypeError("Illegal offset: " + i + " (not an integer)")
          };
          if (i >>>= 0, 0 > i || i + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + i + " (+0) <= " + this.buffer.byteLength)
          }
        };
        o = c.calculateUTF16asUTF8(t(e))[1], i += o + 1;
        var a = this.buffer.byteLength;
        return i > a && this.resize((a *= 2) > i ? a : i), i -= o + 1, c.encodeUTF16toUTF8(t(e), function(e) {
          this.view[i++] = e
        }.bind(this)), this.view[i++] = 0, n ? (this.offset = i, this) : o
      }, a.readCString = function(e) {
        var t = "undefined" == typeof e;
        if (t && (e = this.offset), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal offset: " + e + " (not an integer)")
          };
          if (e >>>= 0, 0 > e || e + 1 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + e + " (+1) <= " + this.buffer.byteLength)
          }
        };
        var n, r = e,
          o = -1;
        return c.decodeUTF8toUTF16(function() {
          if (0 === o) {
            return null
          };
          if (e >= this.limit) {
            throw RangeError("Illegal range: Truncated data, " + e + " < " + this.limit)
          };
          return o = this.view[e++], 0 === o ? null : o
        }.bind(this), n = i(), !0), t ? (this.offset = e, n()) : {
          string: n(),
          length: e - r
        }
      }, a.writeIString = function(e, i) {
        var n = "undefined" == typeof i;
        if (n && (i = this.offset), !this.noAssert) {
          if ("string" != typeof e) {
            throw TypeError("Illegal str: Not a string")
          };
          if ("number" != typeof i || i % 1 !== 0) {
            throw TypeError("Illegal offset: " + i + " (not an integer)")
          };
          if (i >>>= 0, 0 > i || i + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + i + " (+0) <= " + this.buffer.byteLength)
          }
        };
        var r, o = i;
        r = c.calculateUTF16asUTF8(t(e), this.noAssert)[1], i += 4 + r;
        var a = this.buffer.byteLength;
        if (i > a && this.resize((a *= 2) > i ? a : i), i -= 4 + r, this.littleEndian ? (this.view[i + 3] = r >>> 24 & 255, this.view[i + 2] = r >>> 16 & 255, this.view[i + 1] = r >>> 8 & 255, this.view[i] = 255 & r) : (this.view[i] = r >>> 24 & 255, this.view[i + 1] = r >>> 16 & 255, this.view[i + 2] = r >>> 8 & 255, this.view[i + 3] = 255 & r), i += 4, c.encodeUTF16toUTF8(t(e), function(e) {
            this.view[i++] = e
          }.bind(this)), i !== o + 4 + r) {
          throw RangeError("Illegal range: Truncated data, " + i + " == " + (i + 4 + r))
        };
        return n ? (this.offset = i, this) : i - o
      }, a.readIString = function(e) {
        var t = "undefined" == typeof e;
        if (t && (e = this.offset), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal offset: " + e + " (not an integer)")
          };
          if (e >>>= 0, 0 > e || e + 4 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + e + " (+4) <= " + this.buffer.byteLength)
          }
        };
        var i = e,
          n = this.readUint32(e),
          r = this.readUTF8String(n, o.METRICS_BYTES, e += 4);
        return e += r.length, t ? (this.offset = e, r.string) : {
          string: r.string,
          length: e - i
        }
      }, o.METRICS_CHARS = "c", o.METRICS_BYTES = "b", a.writeUTF8String = function(e, i) {
        var n = "undefined" == typeof i;
        if (n && (i = this.offset), !this.noAssert) {
          if ("number" != typeof i || i % 1 !== 0) {
            throw TypeError("Illegal offset: " + i + " (not an integer)")
          };
          if (i >>>= 0, 0 > i || i + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + i + " (+0) <= " + this.buffer.byteLength)
          }
        };
        var r, o = i;
        r = c.calculateUTF16asUTF8(t(e))[1], i += r;
        var a = this.buffer.byteLength;
        return i > a && this.resize((a *= 2) > i ? a : i), i -= r, c.encodeUTF16toUTF8(t(e), function(e) {
          this.view[i++] = e
        }.bind(this)), n ? (this.offset = i, this) : i - o
      }, a.writeString = a.writeUTF8String, o.calculateUTF8Chars = function(e) {
        return c.calculateUTF16asUTF8(t(e))[0]
      }, o.calculateUTF8Bytes = function(e) {
        return c.calculateUTF16asUTF8(t(e))[1]
      }, o.calculateString = o.calculateUTF8Bytes, a.readUTF8String = function(e, t, n) {
        "number" == typeof t && (n = t, t = void(0));
        var r = "undefined" == typeof n;
        if (r && (n = this.offset), "undefined" == typeof t && (t = o.METRICS_CHARS), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal length: " + e + " (not an integer)")
          };
          if (e |= 0, "number" != typeof n || n % 1 !== 0) {
            throw TypeError("Illegal offset: " + n + " (not an integer)")
          };
          if (n >>>= 0, 0 > n || n + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + n + " (+0) <= " + this.buffer.byteLength)
          }
        };
        var a, s = 0,
          h = n;
        if (t === o.METRICS_CHARS) {
          if (a = i(), c.decodeUTF8(function() {
              return e > s && n < this.limit ? this.view[n++] : null
            }.bind(this), function(e) {
              ++s, c.UTF8toUTF16(e, a)
            }), s !== e) {
            throw RangeError("Illegal range: Truncated data, " + s + " == " + e)
          };
          return r ? (this.offset = n, a()) : {
            string: a(),
            length: n - h
          }
        };
        if (t === o.METRICS_BYTES) {
          if (!this.noAssert) {
            if ("number" != typeof n || n % 1 !== 0) {
              throw TypeError("Illegal offset: " + n + " (not an integer)")
            };
            if (n >>>= 0, 0 > n || n + e > this.buffer.byteLength) {
              throw RangeError("Illegal offset: 0 <= " + n + " (+" + e + ") <= " + this.buffer.byteLength)
            }
          };
          var l = n + e;
          if (c.decodeUTF8toUTF16(function() {
              return l > n ? this.view[n++] : null
            }.bind(this), a = i(), this.noAssert), n !== l) {
            throw RangeError("Illegal range: Truncated data, " + n + " == " + l)
          };
          return r ? (this.offset = n, a()) : {
            string: a(),
            length: n - h
          }
        };
        throw TypeError("Unsupported metrics: " + t)
      }, a.readString = a.readUTF8String, a.writeVString = function(e, i) {
        var n = "undefined" == typeof i;
        if (n && (i = this.offset), !this.noAssert) {
          if ("string" != typeof e) {
            throw TypeError("Illegal str: Not a string")
          };
          if ("number" != typeof i || i % 1 !== 0) {
            throw TypeError("Illegal offset: " + i + " (not an integer)")
          };
          if (i >>>= 0, 0 > i || i + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + i + " (+0) <= " + this.buffer.byteLength)
          }
        };
        var r, a, s = i;
        r = c.calculateUTF16asUTF8(t(e), this.noAssert)[1], a = o.calculateVarint32(r), i += a + r;
        var h = this.buffer.byteLength;
        if (i > h && this.resize((h *= 2) > i ? h : i), i -= a + r, i += this.writeVarint32(r, i), c.encodeUTF16toUTF8(t(e), function(e) {
            this.view[i++] = e
          }.bind(this)), i !== s + r + a) {
          throw RangeError("Illegal range: Truncated data, " + i + " == " + (i + r + a))
        };
        return n ? (this.offset = i, this) : i - s
      }, a.readVString = function(e) {
        var t = "undefined" == typeof e;
        if (t && (e = this.offset), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal offset: " + e + " (not an integer)")
          };
          if (e >>>= 0, 0 > e || e + 1 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + e + " (+1) <= " + this.buffer.byteLength)
          }
        };
        var i = e,
          n = this.readVarint32(e),
          r = this.readUTF8String(n.value, o.METRICS_BYTES, e += n.length);
        return e += r.length, t ? (this.offset = e, r.string) : {
          string: r.string,
          length: e - i
        }
      }, a.append = function(e, t, i) {
        ("number" == typeof t || "string" != typeof t) && (i = t, t = void(0));
        var n = "undefined" == typeof i;
        if (n && (i = this.offset), !this.noAssert) {
          if ("number" != typeof i || i % 1 !== 0) {
            throw TypeError("Illegal offset: " + i + " (not an integer)")
          };
          if (i >>>= 0, 0 > i || i + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + i + " (+0) <= " + this.buffer.byteLength)
          }
        };
        e instanceof o || (e = o.wrap(e, t));
        var r = e.limit - e.offset;
        if (0 >= r) {
          return this
        };
        i += r;
        var a = this.buffer.byteLength;
        return i > a && this.resize((a *= 2) > i ? a : i), i -= r, this.view["set"](e.view.subarray(e.offset, e.limit), i), e.offset += r, n && (this.offset += r), this
      }, a.appendTo = function(e, t) {
        return e.append(this, t), this
      }, a.assert = function(e) {
        return this.noAssert = !e, this
      }, a.capacity = function() {
        return this.buffer.byteLength
      }, a.clear = function() {
        return this.offset = 0, this.limit = this.buffer.byteLength, this.markedOffset = -1, this
      }, a.clone = function(e) {
        var t = new o(0, this.littleEndian, this.noAssert);
        return e ? (t.buffer = new ArrayBuffer(this.buffer.byteLength), t.view = new Uint8Array(t.buffer)) : (t.buffer = this.buffer, t.view = this.view), t.offset = this.offset, t.markedOffset = this.markedOffset, t.limit = this.limit, t
      }, a.compact = function(e, t) {
        if ("undefined" == typeof e && (e = this.offset), "undefined" == typeof t && (t = this.limit), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal begin: Not an integer")
          };
          if (e >>>= 0, "number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal end: Not an integer")
          };
          if (t >>>= 0, 0 > e || e > t || t > this.buffer.byteLength) {
            throw RangeError("Illegal range: 0 <= " + e + " <= " + t + " <= " + this.buffer.byteLength)
          }
        };
        if (0 === e && t === this.buffer.byteLength) {
          return this
        };
        var i = t - e;
        if (0 === i) {
          return this.buffer = s, this.view = null, this.markedOffset >= 0 && (this.markedOffset -= e), this.offset = 0, this.limit = 0, this
        };
        var n = new ArrayBuffer(i),
          r = new Uint8Array(n);
        return r["set"](this.view.subarray(e, t)), this.buffer = n, this.view = r, this.markedOffset >= 0 && (this.markedOffset -= e), this.offset = 0, this.limit = i, this
      }, a.copy = function(e, t) {
        if ("undefined" == typeof e && (e = this.offset), "undefined" == typeof t && (t = this.limit), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal begin: Not an integer")
          };
          if (e >>>= 0, "number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal end: Not an integer")
          };
          if (t >>>= 0, 0 > e || e > t || t > this.buffer.byteLength) {
            throw RangeError("Illegal range: 0 <= " + e + " <= " + t + " <= " + this.buffer.byteLength)
          }
        };
        if (e === t) {
          return new o(0, this.littleEndian, this.noAssert)
        };
        var i = t - e,
          n = new o(i, this.littleEndian, this.noAssert);
        return n.offset = 0, n.limit = i, n.markedOffset >= 0 && (n.markedOffset -= e), this.copyTo(n, 0, e, t), n
      }, a.copyTo = function(e, t, i, n) {
        var r, a;
        if (!this.noAssert && !o.isByteBuffer(e)) {
          throw TypeError("Illegal target: Not a ByteBuffer")
        };
        if (t = (a = "undefined" == typeof t) ? e.offset : 0 | t, i = (r = "undefined" == typeof i) ? this.offset : 0 | i, n = "undefined" == typeof n ? this.limit : 0 | n, 0 > t || t > e.buffer.byteLength) {
          throw RangeError("Illegal target range: 0 <= " + t + " <= " + e.buffer.byteLength)
        };
        if (0 > i || n > this.buffer.byteLength) {
          throw RangeError("Illegal source range: 0 <= " + i + " <= " + this.buffer.byteLength)
        };
        var s = n - i;
        return 0 === s ? e : (e.ensureCapacity(t + s), e.view["set"](this.view.subarray(i, n), t), r && (this.offset += s), a && (e.offset += s), this)
      }, a.ensureCapacity = function(e) {
        var t = this.buffer.byteLength;
        return e > t ? this.resize((t *= 2) > e ? t : e) : this
      }, a.fill = function(e, t, i) {
        var n = "undefined" == typeof t;
        if (n && (t = this.offset), "string" == typeof e && e.length > 0 && (e = e.charCodeAt(0)), "undefined" == typeof t && (t = this.offset), "undefined" == typeof i && (i = this.limit), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal value: " + e + " (not an integer)")
          };
          if (e |= 0, "number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal begin: Not an integer")
          };
          if (t >>>= 0, "number" != typeof i || i % 1 !== 0) {
            throw TypeError("Illegal end: Not an integer")
          };
          if (i >>>= 0, 0 > t || t > i || i > this.buffer.byteLength) {
            throw RangeError("Illegal range: 0 <= " + t + " <= " + i + " <= " + this.buffer.byteLength)
          }
        };
        if (t >= i) {
          return this
        };
        for (; i > t;) {
          this.view[t++] = e
        };
        return n && (this.offset = t), this
      }, a.flip = function() {
        return this.limit = this.offset, this.offset = 0, this
      }, a.mark = function(e) {
        if (e = "undefined" == typeof e ? this.offset : e, !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal offset: " + e + " (not an integer)")
          };
          if (e >>>= 0, 0 > e || e + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + e + " (+0) <= " + this.buffer.byteLength)
          }
        };
        return this.markedOffset = e, this
      }, a.order = function(e) {
        if (!this.noAssert && "boolean" != typeof e) {
          throw TypeError("Illegal littleEndian: Not a boolean")
        };
        return this.littleEndian = !!e, this
      }, a.LE = function(e) {
        return this.littleEndian = "undefined" != typeof e ? !!e : !0, this
      }, a.BE = function(e) {
        return this.littleEndian = "undefined" != typeof e ? !e : !1, this
      }, a.prepend = function(e, t, i) {
        ("number" == typeof t || "string" != typeof t) && (i = t, t = void(0));
        var n = "undefined" == typeof i;
        if (n && (i = this.offset), !this.noAssert) {
          if ("number" != typeof i || i % 1 !== 0) {
            throw TypeError("Illegal offset: " + i + " (not an integer)")
          };
          if (i >>>= 0, 0 > i || i + 0 > this.buffer.byteLength) {
            throw RangeError("Illegal offset: 0 <= " + i + " (+0) <= " + this.buffer.byteLength)
          }
        };
        e instanceof o || (e = o.wrap(e, t));
        var r = e.limit - e.offset;
        if (0 >= r) {
          return this
        };
        var a = r - i;
        if (a > 0) {
          var s = new ArrayBuffer(this.buffer.byteLength + a),
            h = new Uint8Array(s);
          h["set"](this.view.subarray(i, this.buffer.byteLength), r), this.buffer = s, this.view = h, this.offset += a, this.markedOffset >= 0 && (this.markedOffset += a), this.limit += a, i += a
        } else {
          new Uint8Array(this.buffer)
        };
        return this.view["set"](e.view.subarray(e.offset, e.limit), i - r), e.offset = e.limit, n && (this.offset -= r), this
      }, a.prependTo = function(e, t) {
        return e.prepend(this, t), this
      }, a.printDebug = function(e) {
        "function" != typeof e && (e = console.log.bind(console)), e(this.toString() + "\x0A-------------------------------------------------------------------\x0A" + this.toDebug(!0))
      }, a.remaining = function() {
        return this.limit - this.offset
      }, a.reset = function() {
        return this.markedOffset >= 0 ? (this.offset = this.markedOffset, this.markedOffset = -1) : this.offset = 0, this
      }, a.resize = function(e) {
        if (!this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal capacity: " + e + " (not an integer)")
          };
          if (e |= 0, 0 > e) {
            throw RangeError("Illegal capacity: 0 <= " + e)
          }
        };
        if (this.buffer.byteLength < e) {
          var t = new ArrayBuffer(e),
            i = new Uint8Array(t);
          i["set"](this.view), this.buffer = t, this.view = i
        };
        return this
      }, a.reverse = function(e, t) {
        if ("undefined" == typeof e && (e = this.offset), "undefined" == typeof t && (t = this.limit), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal begin: Not an integer")
          };
          if (e >>>= 0, "number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal end: Not an integer")
          };
          if (t >>>= 0, 0 > e || e > t || t > this.buffer.byteLength) {
            throw RangeError("Illegal range: 0 <= " + e + " <= " + t + " <= " + this.buffer.byteLength)
          }
        };
        return e === t ? this : (Array.prototype.reverse.call(this.view.subarray(e, t)), this)
      }, a.skip = function(e) {
        if (!this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal length: " + e + " (not an integer)")
          };
          e |= 0
        };
        var t = this.offset + e;
        if (!this.noAssert && (0 > t || t > this.buffer.byteLength)) {
          throw RangeError("Illegal length: 0 <= " + this.offset + " + " + e + " <= " + this.buffer.byteLength)
        };
        return this.offset = t, this
      }, a.slice = function(e, t) {
        if ("undefined" == typeof e && (e = this.offset), "undefined" == typeof t && (t = this.limit), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal begin: Not an integer")
          };
          if (e >>>= 0, "number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal end: Not an integer")
          };
          if (t >>>= 0, 0 > e || e > t || t > this.buffer.byteLength) {
            throw RangeError("Illegal range: 0 <= " + e + " <= " + t + " <= " + this.buffer.byteLength)
          }
        };
        var i = this.clone();
        return i.offset = e, i.limit = t, i
      }, a.toBuffer = function(e) {
        var t = this.offset,
          i = this.limit;
        if (!this.noAssert) {
          if ("number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal offset: Not an integer")
          };
          if (t >>>= 0, "number" != typeof i || i % 1 !== 0) {
            throw TypeError("Illegal limit: Not an integer")
          };
          if (i >>>= 0, 0 > t || t > i || i > this.buffer.byteLength) {
            throw RangeError("Illegal range: 0 <= " + t + " <= " + i + " <= " + this.buffer.byteLength)
          }
        };
        if (!e && 0 === t && i === this.buffer.byteLength) {
          return this.buffer
        };
        if (t === i) {
          return s
        };
        var n = new ArrayBuffer(i - t);
        return new Uint8Array(n)["set"](new Uint8Array(this.buffer).subarray(t, i), 0), n
      }, a.toArrayBuffer = a.toBuffer, a.toString = function(e, t, i) {
        if ("undefined" == typeof e) {
          return "ByteBufferAB(offset=" + this.offset + ",markedOffset=" + this.markedOffset + ",limit=" + this.limit + ",capacity=" + this.capacity() + ")"
        };
        switch ("number" == typeof e && (e = "utf8", t = e, i = t), e) {
          case "utf8":
            return this.toUTF8(t, i);
          case "base64":
            return this.toBase64(t, i);
          case "hex":
            return this.toHex(t, i);
          case "binary":
            return this.toBinary(t, i);
          case "debug":
            return this.toDebug();
          case "columns":
            return this.toColumns();
          default:
            throw Error("Unsupported encoding: " + e)
        }
      };
      var l = function() {
        for (var e = {}, t = [65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 43, 47], i = [], n = 0, r = t.length; r > n; ++n) {
          i[t[n]] = n
        };
        return e.encode = function(e, i) {
          for (var n, r; null !== (n = e());) {
            i(t[n >> 2 & 63]), r = (3 & n) << 4, null !== (n = e()) ? (r |= n >> 4 & 15, i(t[63 & (r | n >> 4 & 15)]), r = (15 & n) << 2, null !== (n = e()) ? (i(t[63 & (r | n >> 6 & 3)]), i(t[63 & n])) : (i(t[63 & r]), i(61))) : (i(t[63 & r]), i(61), i(61))
          }
        }, e.decode = function(e, t) {
          function n(e) {
            throw Error("Illegal character code: " + e)
          }
          for (var r, o, a; null !== (r = e());) {
            if (o = i[r], "undefined" == typeof o && n(r), null !== (r = e()) && (a = i[r], "undefined" == typeof a && n(r), t(o << 2 >>> 0 | (48 & a) >> 4), null !== (r = e()))) {
              if (o = i[r], "undefined" == typeof o) {
                if (61 === r) {
                  break
                };
                n(r)
              };
              if (t((15 & a) << 4 >>> 0 | (60 & o) >> 2), null !== (r = e())) {
                if (a = i[r], "undefined" == typeof a) {
                  if (61 === r) {
                    break
                  };
                  n(r)
                };
                t((3 & o) << 6 >>> 0 | a)
              }
            }
          }
        }, e.test = function(e) {
          return /^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)
        }, e
      }();
      a.toBase64 = function(e, t) {
        if ("undefined" == typeof e && (e = this.offset), "undefined" == typeof t && (t = this.limit), e = 0 | e, t = 0 | t, 0 > e || t > this.capacity || e > t) {
          throw RangeError("begin, end")
        };
        var n;
        return l.encode(function() {
          return t > e ? this.view[e++] : null
        }.bind(this), n = i()), n()
      }, o.fromBase64 = function(e, i) {
        if ("string" != typeof e) {
          throw TypeError("str")
        };
        var n = new o(e.length / 4 * 3, i),
          r = 0;
        return l.decode(t(e), function(e) {
          n.view[r++] = e
        }), n.limit = r, n
      }, o.btoa = function(e) {
        return o.fromBinary(e).toBase64()
      }, o.atob = function(e) {
        return o.fromBase64(e).toBinary()
      }, a.toBinary = function(e, t) {
        if ("undefined" == typeof e && (e = this.offset), "undefined" == typeof t && (t = this.limit), e |= 0, t |= 0, 0 > e || t > this.capacity() || e > t) {
          throw RangeError("begin, end")
        };
        if (e === t) {
          return ""
        };
        for (var i = [], n = []; t > e;) {
          i.push(this.view[e++]), i.length >= 1024 && (n.push(String.fromCharCode.apply(String, i)), i = [])
        };
        return n.join("") + String.fromCharCode.apply(String, i)
      }, o.fromBinary = function(e, t) {
        if ("string" != typeof e) {
          throw TypeError("str")
        };
        for (var i, n = 0, r = e.length, a = new o(r, t); r > n;) {
          if (i = e.charCodeAt(n), i > 255) {
            throw RangeError("illegal char code: " + i)
          };
          a.view[n++] = i
        };
        return a.limit = r, a
      }, a.toDebug = function(e) {
        for (var t, i = -1, n = this.buffer.byteLength, r = "", o = "", a = ""; n > i;) {
          if (-1 !== i && (t = this.view[i], r += 16 > t ? "0" + t.toString(16).toUpperCase() : t.toString(16).toUpperCase(), e && (o += t > 32 && 127 > t ? String.fromCharCode(t) : ".")), ++i, e && i > 0 && i % 16 === 0 && i !== n) {
            for (; r.length < 51;) {
              r += " "
            };
            a += r + o + "\x0A", r = o = ""
          };
          r += i === this.offset && i === this.limit ? i === this.markedOffset ? "!" : "|" : i === this.offset ? i === this.markedOffset ? "[" : "<" : i === this.limit ? i === this.markedOffset ? "]" : ">" : i === this.markedOffset ? "'" : e || 0 !== i && i !== n ? " " : ""
        };
        if (e && " " !== r) {
          for (; r.length < 51;) {
            r += " "
          };
          a += r + o + "\x0A"
        };
        return e ? a : r
      }, o.fromDebug = function(e, t, i) {
        for (var n, r, a = e.length, s = new o((a + 1) / 3 | 0, t, i), h = 0, l = 0, c = !1, u = !1, d = !1, p = !1, f = !1; a > h;) {
          switch (n = e.charAt(h++)) {
            case "!":
              if (!i) {
                if (u || d || p) {
                  f = !0;
                  break
                };
                u = d = p = !0
              };
              s.offset = s.markedOffset = s.limit = l, c = !1;
              break;
            case "|":
              if (!i) {
                if (u || p) {
                  f = !0;
                  break
                };
                u = p = !0
              };
              s.offset = s.limit = l, c = !1;
              break;
            case "[":
              if (!i) {
                if (u || d) {
                  f = !0;
                  break
                };
                u = d = !0
              };
              s.offset = s.markedOffset = l, c = !1;
              break;
            case "<":
              if (!i) {
                if (u) {
                  f = !0;
                  break
                };
                u = !0
              };
              s.offset = l, c = !1;
              break;
            case "]":
              if (!i) {
                if (p || d) {
                  f = !0;
                  break
                };
                p = d = !0
              };
              s.limit = s.markedOffset = l, c = !1;
              break;
            case ">":
              if (!i) {
                if (p) {
                  f = !0;
                  break
                };
                p = !0
              };
              s.limit = l, c = !1;
              break;
            case "'":
              if (!i) {
                if (d) {
                  f = !0;
                  break
                };
                d = !0
              };
              s.markedOffset = l, c = !1;
              break;
            case " ":
              c = !1;
              break;
            default:
              if (!i && c) {
                f = !0;
                break
              };
              if (r = parseInt(n + e.charAt(h++), 16), !i && (isNaN(r) || 0 > r || r > 255)) {
                throw TypeError("Illegal str: Not a debug encoded string")
              };
              s.view[l++] = r, c = !0
          };
          if (f) {
            throw TypeError("Illegal str: Invalid symbol at " + h)
          }
        };
        if (!i) {
          if (!u || !p) {
            throw TypeError("Illegal str: Missing offset or limit")
          };
          if (l < s.buffer.byteLength) {
            throw TypeError("Illegal str: Not a debug encoded string (is it hex?) " + l + " < " + a)
          }
        };
        return s
      }, a.toHex = function(e, t) {
        if (e = "undefined" == typeof e ? this.offset : e, t = "undefined" == typeof t ? this.limit : t, !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal begin: Not an integer")
          };
          if (e >>>= 0, "number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal end: Not an integer")
          };
          if (t >>>= 0, 0 > e || e > t || t > this.buffer.byteLength) {
            throw RangeError("Illegal range: 0 <= " + e + " <= " + t + " <= " + this.buffer.byteLength)
          }
        };
        for (var i, n = new Array(t - e); t > e;) {
          i = this.view[e++], 16 > i ? n.push("0", i.toString(16)) : n.push(i.toString(16))
        };
        return n.join("")
      }, o.fromHex = function(e, t, i) {
        if (!i) {
          if ("string" != typeof e) {
            throw TypeError("Illegal str: Not a string")
          };
          if (e.length % 2 !== 0) {
            throw TypeError("Illegal str: Length not a multiple of 2")
          }
        };
        for (var n, r = e.length, a = new o(r / 2 | 0, t), s = 0, h = 0; r > s; s += 2) {
          if (n = parseInt(e.substring(s, s + 2), 16), !i && (!isFinite(n) || 0 > n || n > 255)) {
            throw TypeError("Illegal str: Contains non-hex characters")
          };
          a.view[h++] = n
        };
        return a.limit = h, a
      };
      var c = function() {
        var e = {};
        return e.MAX_CODEPOINT = 1114111, e.encodeUTF8 = function(e, t) {
          var i = null;
          for ("number" == typeof e && (i = e, e = function() {
              return null
            }); null !== i || null !== (i = e());) {
            128 > i ? t(127 & i) : 2048 > i ? (t(i >> 6 & 31 | 192), t(63 & i | 128)) : 65536 > i ? (t(i >> 12 & 15 | 224), t(i >> 6 & 63 | 128), t(63 & i | 128)) : (t(i >> 18 & 7 | 240), t(i >> 12 & 63 | 128), t(i >> 6 & 63 | 128), t(63 & i | 128)), i = null
          }
        }, e.decodeUTF8 = function(e, t) {
          for (var i, n, r, o, a = function(e) {
              e = e.slice(0, e.indexOf(null));
              var t = Error(e.toString());
              throw t.name = "TruncatedError", t.bytes = e, t
            }; null !== (i = e());) {
            if (0 === (128 & i)) {
              t(i)
            } else {
              if (192 === (224 & i)) {
                null === (n = e()) && a([i, n]), t((31 & i) << 6 | 63 & n)
              } else {
                if (224 === (240 & i)) {
                  (null === (n = e()) || null === (r = e())) && a([i, n, r]), t((15 & i) << 12 | (63 & n) << 6 | 63 & r)
                } else {
                  if (240 !== (248 & i)) {
                    throw RangeError("Illegal starting byte: " + i)
                  };
                  (null === (n = e()) || null === (r = e()) || null === (o = e())) && a([i, n, r, o]), t((7 & i) << 18 | (63 & n) << 12 | (63 & r) << 6 | 63 & o)
                }
              }
            }
          }
        }, e.UTF16toUTF8 = function(e, t) {
          for (var i, n = null;;) {
            if (null === (i = null !== n ? n : e())) {
              break
            };
            i >= 55296 && 57343 >= i && null !== (n = e()) && n >= 56320 && 57343 >= n ? (t(1024 * (i - 55296) + n - 56320 + 65536), n = null) : t(i)
          };
          null !== n && t(n)
        }, e.UTF8toUTF16 = function(e, t) {
          var i = null;
          for ("number" == typeof e && (i = e, e = function() {
              return null
            }); null !== i || null !== (i = e());) {
            65535 >= i ? t(i) : (i -= 65536, t((i >> 10) + 55296), t(i % 1024 + 56320)), i = null
          }
        }, e.encodeUTF16toUTF8 = function(t, i) {
          e.UTF16toUTF8(t, function(t) {
            e.encodeUTF8(t, i)
          })
        }, e.decodeUTF8toUTF16 = function(t, i) {
          e.decodeUTF8(t, function(t) {
            e.UTF8toUTF16(t, i)
          })
        }, e.calculateCodePoint = function(e) {
          return 128 > e ? 1 : 2048 > e ? 2 : 65536 > e ? 3 : 4
        }, e.calculateUTF8 = function(e) {
          for (var t, i = 0; null !== (t = e());) {
            i += 128 > t ? 1 : 2048 > t ? 2 : 65536 > t ? 3 : 4
          };
          return i
        }, e.calculateUTF16asUTF8 = function(t) {
          var i = 0,
            n = 0;
          return e.UTF16toUTF8(t, function(e) {
            ++i, n += 128 > e ? 1 : 2048 > e ? 2 : 65536 > e ? 3 : 4
          }), [i, n]
        }, e
      }();
      return a.toUTF8 = function(e, t) {
        if ("undefined" == typeof e && (e = this.offset), "undefined" == typeof t && (t = this.limit), !this.noAssert) {
          if ("number" != typeof e || e % 1 !== 0) {
            throw TypeError("Illegal begin: Not an integer")
          };
          if (e >>>= 0, "number" != typeof t || t % 1 !== 0) {
            throw TypeError("Illegal end: Not an integer")
          };
          if (t >>>= 0, 0 > e || e > t || t > this.buffer.byteLength) {
            throw RangeError("Illegal range: 0 <= " + e + " <= " + t + " <= " + this.buffer.byteLength)
          }
        };
        var n;
        try {
          c.decodeUTF8toUTF16(function() {
            return t > e ? this.view[e++] : null
          }.bind(this), n = i())
        } catch (r) {
          if (e !== t) {
            throw RangeError("Illegal range: Truncated data, " + e + " != " + t)
          }
        };
        return n()
      }, o.fromUTF8 = function(e, i, n) {
        if (!n && "string" != typeof e) {
          throw TypeError("Illegal str: Not a string")
        };
        var r = new o(c.calculateUTF16asUTF8(t(e), !0)[1], i, n),
          a = 0;
        return c.encodeUTF16toUTF8(t(e), function(e) {
          r.view[a++] = e
        }), r.limit = a, r
      }, o
    })
  }

  function _$af271584(e, t, i) {
    ! function(i, n) {
      "function" == typeof define && define.amd ? define([], n) : "function" == typeof e && "object" == typeof t && t && t.exports ? t.exports = n() : (i.dcodeIO = i.dcodeIO || {}).Long = n()
    }(this, function() {
      "use strict";

      function e(e, t, i) {
        this.low = 0 | e, this.high = 0 | t, this.unsigned = !!i
      }

      function t(e) {
        return (e && e.__isLong__) === !0
      }

      function i(e, t) {
        var i, n, o;
        return t ? (e >>>= 0, (o = e >= 0 && 256 > e) && (n = h[e]) ? n : (i = r(e, 0 > (0 | e) ? -1 : 0, !0), o && (h[e] = i), i)) : (e |= 0, (o = e >= -128 && 128 > e) && (n = s[e]) ? n : (i = r(e, 0 > e ? -1 : 0, !1), o && (s[e] = i), i))
      }

      function n(e, t) {
        if (isNaN(e) || !isFinite(e)) {
          return t ? v : g
        };
        if (t) {
          if (0 > e) {
            return v
          };
          if (e >= p) {
            return x
          }
        } else {
          if (-f >= e) {
            return M
          };
          if (e + 1 >= f) {
            return _
          }
        };
        return 0 > e ? n(-e, t).neg() : r(e % d | 0, e / d | 0, t)
      }

      function r(t, i, n) {
        return new e(t, i, n)
      }

      function o(e, t, i) {
        if (0 === e.length) {
          throw Error("empty string")
        };
        if ("NaN" === e || "Infinity" === e || "+Infinity" === e || "-Infinity" === e) {
          return g
        };
        if ("number" == typeof t && (i = t, t = !1), i = i || 10, 2 > i || i > 36) {
          throw RangeError("radix")
        };
        var r;
        if ((r = e.indexOf("-")) > 0) {
          throw Error("interior hyphen")
        };
        if (0 === r) {
          return o(e.substring(1), t, i).neg()
        };
        for (var a = n(l(i, 8)), s = g, h = 0; h < e.length; h += 8) {
          var c = Math.min(8, e.length - h),
            u = parseInt(e.substring(h, h + c), i);
          if (8 > c) {
            var d = n(l(i, c));
            s = s.mul(d).add(n(u))
          } else {
            s = s.mul(a), s = s.add(n(u))
          }
        };
        return s.unsigned = t, s
      }

      function a(t) {
        return t instanceof e ? t : "number" == typeof t ? n(t) : "string" == typeof t ? o(t) : r(t.low, t.high, t.unsigned)
      }
      e.__isLong__, Object.defineProperty(e.prototype, "__isLong__", {
        value: !0,
        enumerable: !1,
        configurable: !1
      }), e.isLong = t;
      var s = {},
        h = {};
      e.fromInt = i, e.fromNumber = n, e.fromBits = r;
      var l = Math.pow;
      e.fromString = o, e.fromValue = a;
      var c = 65536,
        u = 1 << 24,
        d = c * c,
        p = d * d,
        f = p / 2,
        m = i(u),
        g = i(0);
      e.ZERO = g;
      var v = i(0, !0);
      e.UZERO = v;
      var y = i(1);
      e.ONE = y;
      var b = i(1, !0);
      e.UONE = b;
      var w = i(-1);
      e.NEG_ONE = w;
      var _ = r(-1, 2147483647, !1);
      e.MAX_VALUE = _;
      var x = r(-1, -1, !0);
      e.MAX_UNSIGNED_VALUE = x;
      var M = r(0, -2147483648, !1);
      e.MIN_VALUE = M;
      var E = e.prototype;
      return E.toInt = function() {
        return this.unsigned ? this.low >>> 0 : this.low
      }, E.toNumber = function() {
        return this.unsigned ? (this.high >>> 0) * d + (this.low >>> 0) : this.high * d + (this.low >>> 0)
      }, E.toString = function(e) {
        if (e = e || 10, 2 > e || e > 36) {
          throw RangeError("radix")
        };
        if (this.isZero()) {
          return "0"
        };
        if (this.isNegative()) {
          if (this.eq(M)) {
            var t = n(e),
              i = this.div(t),
              r = i.mul(t).sub(this);
            return i.toString(e) + r.toInt().toString(e)
          };
          return "-" + this.neg().toString(e)
        };
        for (var o = n(l(e, 6), this.unsigned), a = this, s = "";;) {
          var h = a.div(o),
            c = a.sub(h.mul(o)).toInt() >>> 0,
            u = c.toString(e);
          if (a = h, a.isZero()) {
            return u + s
          };
          for (; u.length < 6;) {
            u = "0" + u
          };
          s = "" + u + s
        }
      }, E.getHighBits = function() {
        return this.high
      }, E.getHighBitsUnsigned = function() {
        return this.high >>> 0
      }, E.getLowBits = function() {
        return this.low
      }, E.getLowBitsUnsigned = function() {
        return this.low >>> 0
      }, E.getNumBitsAbs = function() {
        if (this.isNegative()) {
          return this.eq(M) ? 64 : this.neg().getNumBitsAbs()
        };
        for (var e = 0 != this.high ? this.high : this.low, t = 31; t > 0 && 0 == (e & 1 << t); t--) {;
        };
        return 0 != this.high ? t + 33 : t + 1
      }, E.isZero = function() {
        return 0 === this.high && 0 === this.low
      }, E.isNegative = function() {
        return !this.unsigned && this.high < 0
      }, E.isPositive = function() {
        return this.unsigned || this.high >= 0
      }, E.isOdd = function() {
        return 1 === (1 & this.low)
      }, E.isEven = function() {
        return 0 === (1 & this.low)
      }, E.equals = function(e) {
        return t(e) || (e = a(e)), this.unsigned !== e.unsigned && this.high >>> 31 === 1 && e.high >>> 31 === 1 ? !1 : this.high === e.high && this.low === e.low
      }, E.eq = E.equals, E.notEquals = function(e) {
        return !this.eq(e)
      }, E.neq = E.notEquals, E.lessThan = function(e) {
        return this.comp(e) < 0
      }, E.lt = E.lessThan, E.lessThanOrEqual = function(e) {
        return this.comp(e) <= 0
      }, E.lte = E.lessThanOrEqual, E.greaterThan = function(e) {
        return this.comp(e) > 0
      }, E.gt = E.greaterThan, E.greaterThanOrEqual = function(e) {
        return this.comp(e) >= 0
      }, E.gte = E.greaterThanOrEqual, E.compare = function(e) {
        if (t(e) || (e = a(e)), this.eq(e)) {
          return 0
        };
        var i = this.isNegative(),
          n = e.isNegative();
        return i && !n ? -1 : !i && n ? 1 : this.unsigned ? e.high >>> 0 > this.high >>> 0 || e.high === this.high && e.low >>> 0 > this.low >>> 0 ? -1 : 1 : this.sub(e).isNegative() ? -1 : 1
      }, E.comp = E.compare, E.negate = function() {
        return !this.unsigned && this.eq(M) ? M : this.not().add(y)
      }, E.neg = E.negate, E.add = function(e) {
        t(e) || (e = a(e));
        var i = this.high >>> 16,
          n = 65535 & this.high,
          o = this.low >>> 16,
          s = 65535 & this.low,
          h = e.high >>> 16,
          l = 65535 & e.high,
          c = e.low >>> 16,
          u = 65535 & e.low,
          d = 0,
          p = 0,
          f = 0,
          m = 0;
        return m += s + u, f += m >>> 16, m &= 65535, f += o + c, p += f >>> 16, f &= 65535, p += n + l, d += p >>> 16, p &= 65535, d += i + h, d &= 65535, r(f << 16 | m, d << 16 | p, this.unsigned)
      }, E.subtract = function(e) {
        return t(e) || (e = a(e)), this.add(e.neg())
      }, E.sub = E.subtract, E.multiply = function(e) {
        if (this.isZero()) {
          return g
        };
        if (t(e) || (e = a(e)), e.isZero()) {
          return g
        };
        if (this.eq(M)) {
          return e.isOdd() ? M : g
        };
        if (e.eq(M)) {
          return this.isOdd() ? M : g
        };
        if (this.isNegative()) {
          return e.isNegative() ? this.neg().mul(e.neg()) : this.neg().mul(e).neg()
        };
        if (e.isNegative()) {
          return this.mul(e.neg()).neg()
        };
        if (this.lt(m) && e.lt(m)) {
          return n(this.toNumber() * e.toNumber(), this.unsigned)
        };
        var i = this.high >>> 16,
          o = 65535 & this.high,
          s = this.low >>> 16,
          h = 65535 & this.low,
          l = e.high >>> 16,
          c = 65535 & e.high,
          u = e.low >>> 16,
          d = 65535 & e.low,
          p = 0,
          f = 0,
          v = 0,
          y = 0;
        return y += h * d, v += y >>> 16, y &= 65535, v += s * d, f += v >>> 16, v &= 65535, v += h * u, f += v >>> 16, v &= 65535, f += o * d, p += f >>> 16, f &= 65535, f += s * u, p += f >>> 16, f &= 65535, f += h * c, p += f >>> 16, f &= 65535, p += i * d + o * u + s * c + h * l, p &= 65535, r(v << 16 | y, p << 16 | f, this.unsigned)
      }, E.mul = E.multiply, E.divide = function(e) {
        if (t(e) || (e = a(e)), e.isZero()) {
          throw Error("division by zero")
        };
        if (this.isZero()) {
          return this.unsigned ? v : g
        };
        var i, r, o;
        if (this.eq(M)) {
          if (e.eq(y) || e.eq(w)) {
            return M
          };
          if (e.eq(M)) {
            return y
          };
          var s = this.shr(1);
          return i = s.div(e).shl(1), i.eq(g) ? e.isNegative() ? y : w : (r = this.sub(e.mul(i)), o = i.add(r.div(e)))
        };
        if (e.eq(M)) {
          return this.unsigned ? v : g
        };
        if (this.isNegative()) {
          return e.isNegative() ? this.neg().div(e.neg()) : this.neg().div(e).neg()
        };
        if (e.isNegative()) {
          return this.div(e.neg()).neg()
        };
        for (o = g, r = this; r.gte(e);) {
          i = Math.max(1, Math.floor(r.toNumber() / e.toNumber()));
          for (var h = Math.ceil(Math.log(i) / Math.LN2), c = 48 >= h ? 1 : l(2, h - 48), u = n(i), d = u.mul(e); d.isNegative() || d.gt(r);) {
            i -= c, u = n(i, this.unsigned), d = u.mul(e)
          };
          u.isZero() && (u = y), o = o.add(u), r = r.sub(d)
        };
        return o
      }, E.div = E.divide, E.modulo = function(e) {
        return t(e) || (e = a(e)), this.sub(this.div(e).mul(e))
      }, E.mod = E.modulo, E.not = function() {
        return r(~this.low, ~this.high, this.unsigned)
      }, E.and = function(e) {
        return t(e) || (e = a(e)), r(this.low & e.low, this.high & e.high, this.unsigned)
      }, E.or = function(e) {
        return t(e) || (e = a(e)), r(this.low | e.low, this.high | e.high, this.unsigned)
      }, E.xor = function(e) {
        return t(e) || (e = a(e)), r(this.low ^ e.low, this.high ^ e.high, this.unsigned)
      }, E.shiftLeft = function(e) {
        return t(e) && (e = e.toInt()), 0 === (e &= 63) ? this : 32 > e ? r(this.low << e, this.high << e | this.low >>> 32 - e, this.unsigned) : r(0, this.low << e - 32, this.unsigned)
      }, E.shl = E.shiftLeft, E.shiftRight = function(e) {
        return t(e) && (e = e.toInt()), 0 === (e &= 63) ? this : 32 > e ? r(this.low >>> e | this.high << 32 - e, this.high >> e, this.unsigned) : r(this.high >> e - 32, this.high >= 0 ? 0 : -1, this.unsigned)
      }, E.shr = E.shiftRight, E.shiftRightUnsigned = function(e) {
        if (t(e) && (e = e.toInt()), e &= 63, 0 === e) {
          return this
        };
        var i = this.high;
        if (32 > e) {
          var n = this.low;
          return r(n >>> e | i << 32 - e, i >>> e, this.unsigned)
        };
        return 32 === e ? r(i, 0, this.unsigned) : r(i >>> e - 32, 0, this.unsigned)
      }, E.shru = E.shiftRightUnsigned, E.toSigned = function() {
        return this.unsigned ? r(this.low, this.high, !1) : this
      }, E.toUnsigned = function() {
        return this.unsigned ? this : r(this.low, this.high, !0)
      }, e
    })
  }

  function _$af271629(e, t, i) {
    var n = {
      REVISION: "75"
    };
    "function" == typeof define && define.amd ? define("three", n) : "undefined" != typeof i && "undefined" != typeof t && (t.exports = n), void(0) === Number.EPSILON && (Number.EPSILON = Math.pow(2, -52)), void(0) === Math.sign && (Math.sign = function(e) {
        return 0 > e ? -1 : e > 0 ? 1 : +e
      }), void(0) === Function.prototype.name && void(0) !== Object.defineProperty && Object.defineProperty(Function.prototype, "name", {
        get: function() {
          return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]
        }
      }), void(0) === Object.assign && Object.defineProperty(Object, "assign", {
        writable: !0,
        configurable: !0,
        value: function(e) {
          "use strict";
          if (void(0) === e || null === e) {
            throw new TypeError("Cannot convert first argument to object")
          };
          for (var t = Object(e), i = 1, n = arguments.length; i !== n; ++i) {
            var r = arguments[i];
            if (void(0) !== r && null !== r) {
              r = Object(r);
              for (var o = Object.keys(r), a = 0, s = o.length; a !== s; ++a) {
                var h = o[a],
                  l = Object.getOwnPropertyDescriptor(r, h);
                void(0) !== l && l.enumerable && (t[h] = r[h])
              }
            }
          };
          return t
        }
      }), n.MOUSE = {
        LEFT: 0,
        MIDDLE: 1,
        RIGHT: 2
      }, n.CullFaceNone = 0, n.CullFaceBack = 1, n.CullFaceFront = 2, n.CullFaceFrontBack = 3, n.FrontFaceDirectionCW = 0, n.FrontFaceDirectionCCW = 1, n.BasicShadowMap = 0, n.PCFShadowMap = 1, n.PCFSoftShadowMap = 2, n.FrontSide = 0, n.BackSide = 1, n.DoubleSide = 2, n.FlatShading = 1, n.SmoothShading = 2, n.NoColors = 0, n.FaceColors = 1, n.VertexColors = 2, n.NoBlending = 0, n.NormalBlending = 1, n.AdditiveBlending = 2, n.SubtractiveBlending = 3, n.MultiplyBlending = 4, n.CustomBlending = 5, n.AddEquation = 100, n.SubtractEquation = 101, n.ReverseSubtractEquation = 102, n.MinEquation = 103, n.MaxEquation = 104, n.ZeroFactor = 200, n.OneFactor = 201, n.SrcColorFactor = 202, n.OneMinusSrcColorFactor = 203, n.SrcAlphaFactor = 204, n.OneMinusSrcAlphaFactor = 205, n.DstAlphaFactor = 206, n.OneMinusDstAlphaFactor = 207, n.DstColorFactor = 208, n.OneMinusDstColorFactor = 209, n.SrcAlphaSaturateFactor = 210, n.NeverDepth = 0, n.AlwaysDepth = 1, n.LessDepth = 2, n.LessEqualDepth = 3, n.EqualDepth = 4, n.GreaterEqualDepth = 5, n.GreaterDepth = 6, n.NotEqualDepth = 7, n.MultiplyOperation = 0, n.MixOperation = 1, n.AddOperation = 2, n.NoToneMapping = 0, n.LinearToneMapping = 1, n.ReinhardToneMapping = 2, n.Uncharted2ToneMapping = 3, n.CineonToneMapping = 4, n.UVMapping = 300, n.CubeReflectionMapping = 301, n.CubeRefractionMapping = 302, n.EquirectangularReflectionMapping = 303, n.EquirectangularRefractionMapping = 304, n.SphericalReflectionMapping = 305, n.CubeUVReflectionMapping = 306, n.CubeUVRefractionMapping = 307, n.RepeatWrapping = 1e3, n.ClampToEdgeWrapping = 1001, n.MirroredRepeatWrapping = 1002, n.NearestFilter = 1003, n.NearestMipMapNearestFilter = 1004, n.NearestMipMapLinearFilter = 1005, n.LinearFilter = 1006, n.LinearMipMapNearestFilter = 1007, n.LinearMipMapLinearFilter = 1008, n.UnsignedByteType = 1009, n.ByteType = 1010, n.ShortType = 1011, n.UnsignedShortType = 1012, n.IntType = 1013, n.UnsignedIntType = 1014, n.FloatType = 1015, n.HalfFloatType = 1025, n.UnsignedShort4444Type = 1016, n.UnsignedShort5551Type = 1017, n.UnsignedShort565Type = 1018, n.AlphaFormat = 1019, n.RGBFormat = 1020, n.RGBAFormat = 1021, n.LuminanceFormat = 1022, n.LuminanceAlphaFormat = 1023, n.RGBEFormat = n.RGBAFormat, n.RGB_S3TC_DXT1_Format = 2001, n.RGBA_S3TC_DXT1_Format = 2002, n.RGBA_S3TC_DXT3_Format = 2003, n.RGBA_S3TC_DXT5_Format = 2004, n.RGB_PVRTC_4BPPV1_Format = 2100, n.RGB_PVRTC_2BPPV1_Format = 2101, n.RGBA_PVRTC_4BPPV1_Format = 2102, n.RGBA_PVRTC_2BPPV1_Format = 2103, n.RGB_ETC1_Format = 2151, n.LoopOnce = 2200, n.LoopRepeat = 2201, n.LoopPingPong = 2202, n.InterpolateDiscrete = 2300, n.InterpolateLinear = 2301, n.InterpolateSmooth = 2302, n.ZeroCurvatureEnding = 2400, n.ZeroSlopeEnding = 2401, n.WrapAroundEnding = 2402, n.TrianglesDrawMode = 0, n.TriangleStripDrawMode = 1, n.TriangleFanDrawMode = 2, n.LinearEncoding = 3e3, n.sRGBEncoding = 3001, n.GammaEncoding = 3007, n.RGBEEncoding = 3002, n.LogLuvEncoding = 3003, n.RGBM7Encoding = 3004, n.RGBM16Encoding = 3005, n.RGBDEncoding = 3006, n.Color = function(e) {
        return 3 === arguments.length ? this.fromArray(arguments) : this["set"](e)
      }, n.Color.prototype = {
        constructor: n.Color,
        r: 1,
        g: 1,
        b: 1,
        set: function(e) {
          return e instanceof n.Color ? this.copy(e) : "number" == typeof e ? this.setHex(e) : "string" == typeof e && this.setStyle(e), this
        },
        setScalar: function(e) {
          this.r = e, this.g = e, this.b = e
        },
        setHex: function(e) {
          return e = Math.floor(e), this.r = (e >> 16 & 255) / 255, this.g = (e >> 8 & 255) / 255, this.b = (255 & e) / 255, this
        },
        setRGB: function(e, t, i) {
          return this.r = e, this.g = t, this.b = i, this
        },
        setHSL: function() {
          function e(e, t, i) {
            return 0 > i && (i += 1), i > 1 && (i -= 1), 1 / 6 > i ? e + 6 * (t - e) * i : 0.5 > i ? t : 2 / 3 > i ? e + 6 * (t - e) * (2 / 3 - i) : e
          }
          return function(t, i, r) {
            if (t = n.Math.euclideanModulo(t, 1), i = n.Math.clamp(i, 0, 1), r = n.Math.clamp(r, 0, 1), 0 === i) {
              this.r = this.g = this.b = r
            } else {
              var o = 0.5 >= r ? r * (1 + i) : r + i - r * i,
                a = 2 * r - o;
              this.r = e(a, o, t + 1 / 3), this.g = e(a, o, t), this.b = e(a, o, t - 1 / 3)
            };
            return this
          }
        }(),
        setStyle: function(e) {
          function t(t) {
            void(0) !== t && parseFloat(t) < 1 && console.warn("THREE.Color: Alpha component of " + e + " will be ignored.")
          }
          var i;
          if (i = /^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)) {
            var r, o = i[1],
              a = i[2];
            switch (o) {
              case "rgb":
                ;
              case "rgba":
                if (r = /^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)) {
                  return this.r = Math.min(255, parseInt(r[1], 10)) / 255, this.g = Math.min(255, parseInt(r[2], 10)) / 255, this.b = Math.min(255, parseInt(r[3], 10)) / 255, t(r[5]), this
                };
                if (r = /^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)) {
                  return this.r = Math.min(100, parseInt(r[1], 10)) / 100, this.g = Math.min(100, parseInt(r[2], 10)) / 100, this.b = Math.min(100, parseInt(r[3], 10)) / 100, t(r[5]), this
                };
                break;
              case "hsl":
                ;
              case "hsla":
                if (r = /^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)) {
                  var s = parseFloat(r[1]) / 360,
                    h = parseInt(r[2], 10) / 100,
                    l = parseInt(r[3], 10) / 100;
                  return t(r[5]), this.setHSL(s, h, l)
                }
            }
          } else {
            if (i = /^\#([A-Fa-f0-9]+)$/.exec(e)) {
              var c = i[1],
                u = c.length;
              if (3 === u) {
                return this.r = parseInt(c.charAt(0) + c.charAt(0), 16) / 255, this.g = parseInt(c.charAt(1) + c.charAt(1), 16) / 255, this.b = parseInt(c.charAt(2) + c.charAt(2), 16) / 255, this
              };
              if (6 === u) {
                return this.r = parseInt(c.charAt(0) + c.charAt(1), 16) / 255, this.g = parseInt(c.charAt(2) + c.charAt(3), 16) / 255, this.b = parseInt(c.charAt(4) + c.charAt(5), 16) / 255, this
              }
            }
          };
          if (e && e.length > 0) {
            var c = n.ColorKeywords[e];
            void(0) !== c ? this.setHex(c) : console.warn("THREE.Color: Unknown color " + e)
          };
          return this
        },
        clone: function() {
          return new this.constructor(this.r, this.g, this.b)
        },
        copy: function(e) {
          return this.r = e.r, this.g = e.g, this.b = e.b, this
        },
        copyGammaToLinear: function(e, t) {
          return void(0) === t && (t = 2), this.r = Math.pow(e.r, t), this.g = Math.pow(e.g, t), this.b = Math.pow(e.b, t), this
        },
        copyLinearToGamma: function(e, t) {
          void(0) === t && (t = 2);
          var i = t > 0 ? 1 / t : 1;
          return this.r = Math.pow(e.r, i), this.g = Math.pow(e.g, i), this.b = Math.pow(e.b, i), this
        },
        convertGammaToLinear: function() {
          var e = this.r,
            t = this.g,
            i = this.b;
          return this.r = e * e, this.g = t * t, this.b = i * i, this
        },
        convertLinearToGamma: function() {
          return this.r = Math.sqrt(this.r), this.g = Math.sqrt(this.g), this.b = Math.sqrt(this.b), this
        },
        getHex: function() {
          return 255 * this.r << 16 ^ 255 * this.g << 8 ^ 255 * this.b << 0
        },
        getHexString: function() {
          return ("000000" + this.getHex().toString(16)).slice(-6)
        },
        getHSL: function(e) {
          var t, i, n = e || {
              h: 0,
              s: 0,
              l: 0
            },
            r = this.r,
            o = this.g,
            a = this.b,
            s = Math.max(r, o, a),
            h = Math.min(r, o, a),
            l = (h + s) / 2;
          if (h === s) {
            t = 0, i = 0
          } else {
            var c = s - h;
            switch (i = 0.5 >= l ? c / (s + h) : c / (2 - s - h), s) {
              case r:
                t = (o - a) / c + (a > o ? 6 : 0);
                break;
              case o:
                t = (a - r) / c + 2;
                break;
              case a:
                t = (r - o) / c + 4
            };
            t /= 6
          };
          return n.h = t, n.s = i, n.l = l, n
        },
        getStyle: function() {
          return "rgb(" + (255 * this.r | 0) + "," + (255 * this.g | 0) + "," + (255 * this.b | 0) + ")"
        },
        offsetHSL: function(e, t, i) {
          var n = this.getHSL();
          return n.h += e, n.s += t, n.l += i, this.setHSL(n.h, n.s, n.l), this
        },
        add: function(e) {
          return this.r += e.r, this.g += e.g, this.b += e.b, this
        },
        addColors: function(e, t) {
          return this.r = e.r + t.r, this.g = e.g + t.g, this.b = e.b + t.b, this
        },
        addScalar: function(e) {
          return this.r += e, this.g += e, this.b += e, this
        },
        multiply: function(e) {
          return this.r *= e.r, this.g *= e.g, this.b *= e.b, this
        },
        multiplyScalar: function(e) {
          return this.r *= e, this.g *= e, this.b *= e, this
        },
        lerp: function(e, t) {
          return this.r += (e.r - this.r) * t, this.g += (e.g - this.g) * t, this.b += (e.b - this.b) * t, this
        },
        equals: function(e) {
          return e.r === this.r && e.g === this.g && e.b === this.b
        },
        fromArray: function(e, t) {
          return void(0) === t && (t = 0), this.r = e[t], this.g = e[t + 1], this.b = e[t + 2], this
        },
        toArray: function(e, t) {
          return void(0) === e && (e = []), void(0) === t && (t = 0), e[t] = this.r, e[t + 1] = this.g, e[t + 2] = this.b, e
        }
      }, n.ColorKeywords = {
        aliceblue: 15792383,
        antiquewhite: 16444375,
        aqua: 65535,
        aquamarine: 8388564,
        azure: 15794175,
        beige: 16119260,
        bisque: 16770244,
        black: 0,
        blanchedalmond: 16772045,
        blue: 255,
        blueviolet: 9055202,
        brown: 10824234,
        burlywood: 14596231,
        cadetblue: 6266528,
        chartreuse: 8388352,
        chocolate: 13789470,
        coral: 16744272,
        cornflowerblue: 6591981,
        cornsilk: 16775388,
        crimson: 14423100,
        cyan: 65535,
        darkblue: 139,
        darkcyan: 35723,
        darkgoldenrod: 12092939,
        darkgray: 11119017,
        darkgreen: 25600,
        darkgrey: 11119017,
        darkkhaki: 12433259,
        darkmagenta: 9109643,
        darkolivegreen: 5597999,
        darkorange: 16747520,
        darkorchid: 10040012,
        darkred: 9109504,
        darksalmon: 15308410,
        darkseagreen: 9419919,
        darkslateblue: 4734347,
        darkslategray: 3100495,
        darkslategrey: 3100495,
        darkturquoise: 52945,
        darkviolet: 9699539,
        deeppink: 16716947,
        deepskyblue: 49151,
        dimgray: 6908265,
        dimgrey: 6908265,
        dodgerblue: 2003199,
        firebrick: 11674146,
        floralwhite: 16775920,
        forestgreen: 2263842,
        fuchsia: 16711935,
        gainsboro: 14474460,
        ghostwhite: 16316671,
        gold: 16766720,
        goldenrod: 14329120,
        gray: 8421504,
        green: 32768,
        greenyellow: 11403055,
        grey: 8421504,
        honeydew: 15794160,
        hotpink: 16738740,
        indianred: 13458524,
        indigo: 4915330,
        ivory: 16777200,
        khaki: 15787660,
        lavender: 15132410,
        lavenderblush: 16773365,
        lawngreen: 8190976,
        lemonchiffon: 16775885,
        lightblue: 11393254,
        lightcoral: 15761536,
        lightcyan: 14745599,
        lightgoldenrodyellow: 16448210,
        lightgray: 13882323,
        lightgreen: 9498256,
        lightgrey: 13882323,
        lightpink: 16758465,
        lightsalmon: 16752762,
        lightseagreen: 2142890,
        lightskyblue: 8900346,
        lightslategray: 7833753,
        lightslategrey: 7833753,
        lightsteelblue: 11584734,
        lightyellow: 16777184,
        lime: 65280,
        limegreen: 3329330,
        linen: 16445670,
        magenta: 16711935,
        maroon: 8388608,
        mediumaquamarine: 6737322,
        mediumblue: 205,
        mediumorchid: 12211667,
        mediumpurple: 9662683,
        mediumseagreen: 3978097,
        mediumslateblue: 8087790,
        mediumspringgreen: 64154,
        mediumturquoise: 4772300,
        mediumvioletred: 13047173,
        midnightblue: 1644912,
        mintcream: 16121850,
        mistyrose: 16770273,
        moccasin: 16770229,
        navajowhite: 16768685,
        navy: 128,
        oldlace: 16643558,
        olive: 8421376,
        olivedrab: 7048739,
        orange: 16753920,
        orangered: 16729344,
        orchid: 14315734,
        palegoldenrod: 15657130,
        palegreen: 10025880,
        paleturquoise: 11529966,
        palevioletred: 14381203,
        papayawhip: 16773077,
        peachpuff: 16767673,
        peru: 13468991,
        pink: 16761035,
        plum: 14524637,
        powderblue: 11591910,
        purple: 8388736,
        red: 16711680,
        rosybrown: 12357519,
        royalblue: 4286945,
        saddlebrown: 9127187,
        salmon: 16416882,
        sandybrown: 16032864,
        seagreen: 3050327,
        seashell: 16774638,
        sienna: 10506797,
        silver: 12632256,
        skyblue: 8900331,
        slateblue: 6970061,
        slategray: 7372944,
        slategrey: 7372944,
        snow: 16775930,
        springgreen: 65407,
        steelblue: 4620980,
        tan: 13808780,
        teal: 32896,
        thistle: 14204888,
        tomato: 16737095,
        turquoise: 4251856,
        violet: 15631086,
        wheat: 16113331,
        white: 16777215,
        whitesmoke: 16119285,
        yellow: 16776960,
        yellowgreen: 10145074
      }, n.Quaternion = function(e, t, i, n) {
        this._x = e || 0, this._y = t || 0, this._z = i || 0, this._w = void(0) !== n ? n : 1
      }, n.Quaternion.prototype = {
        constructor: n.Quaternion,
        get x() {
          return this._x
        },
        set x(e) {
          this._x = e, this.onChangeCallback()
        },
        get y() {
          return this._y
        },
        set y(e) {
          this._y = e, this.onChangeCallback()
        },
        get z() {
          return this._z
        },
        set z(e) {
          this._z = e, this.onChangeCallback()
        },
        get w() {
          return this._w
        },
        set w(e) {
          this._w = e, this.onChangeCallback()
        },
        set: function(e, t, i, n) {
          return this._x = e, this._y = t, this._z = i, this._w = n, this.onChangeCallback(), this
        },
        clone: function() {
          return new this.constructor(this._x, this._y, this._z, this._w)
        },
        copy: function(e) {
          return this._x = e.x, this._y = e.y, this._z = e.z, this._w = e.w, this.onChangeCallback(), this
        },
        setFromEuler: function(e, t) {
          if (e instanceof n.Euler == !1) {
            throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.")
          };
          var i = Math.cos(e._x / 2),
            r = Math.cos(e._y / 2),
            o = Math.cos(e._z / 2),
            a = Math.sin(e._x / 2),
            s = Math.sin(e._y / 2),
            h = Math.sin(e._z / 2),
            l = e.order;
          return "XYZ" === l ? (this._x = a * r * o + i * s * h, this._y = i * s * o - a * r * h, this._z = i * r * h + a * s * o, this._w = i * r * o - a * s * h) : "YXZ" === l ? (this._x = a * r * o + i * s * h, this._y = i * s * o - a * r * h, this._z = i * r * h - a * s * o, this._w = i * r * o + a * s * h) : "ZXY" === l ? (this._x = a * r * o - i * s * h, this._y = i * s * o + a * r * h, this._z = i * r * h + a * s * o, this._w = i * r * o - a * s * h) : "ZYX" === l ? (this._x = a * r * o - i * s * h, this._y = i * s * o + a * r * h, this._z = i * r * h - a * s * o, this._w = i * r * o + a * s * h) : "YZX" === l ? (this._x = a * r * o + i * s * h, this._y = i * s * o + a * r * h, this._z = i * r * h - a * s * o, this._w = i * r * o - a * s * h) : "XZY" === l && (this._x = a * r * o - i * s * h, this._y = i * s * o - a * r * h, this._z = i * r * h + a * s * o, this._w = i * r * o + a * s * h), t !== !1 && this.onChangeCallback(), this
        },
        setFromAxisAngle: function(e, t) {
          var i = t / 2,
            n = Math.sin(i);
          return this._x = e.x * n, this._y = e.y * n, this._z = e.z * n, this._w = Math.cos(i), this.onChangeCallback(), this
        },
        setFromRotationMatrix: function(e) {
          var t, i = e.elements,
            n = i[0],
            r = i[4],
            o = i[8],
            a = i[1],
            s = i[5],
            h = i[9],
            l = i[2],
            c = i[6],
            u = i[10],
            d = n + s + u;
          return d > 0 ? (t = 0.5 / Math.sqrt(d + 1), this._w = 0.25 / t, this._x = (c - h) * t, this._y = (o - l) * t, this._z = (a - r) * t) : n > s && n > u ? (t = 2 * Math.sqrt(1 + n - s - u), this._w = (c - h) / t, this._x = 0.25 * t, this._y = (r + a) / t, this._z = (o + l) / t) : s > u ? (t = 2 * Math.sqrt(1 + s - n - u), this._w = (o - l) / t, this._x = (r + a) / t, this._y = 0.25 * t, this._z = (h + c) / t) : (t = 2 * Math.sqrt(1 + u - n - s), this._w = (a - r) / t, this._x = (o + l) / t, this._y = (h + c) / t, this._z = 0.25 * t), this.onChangeCallback(), this
        },
        setFromUnitVectors: function() {
          var e, t, i = 1e-6;
          return function(r, o) {
            return void(0) === e && (e = new n.Vector3), t = r.dot(o) + 1, i > t ? (t = 0, Math.abs(r.x) > Math.abs(r.z) ? e["set"](-r.y, r.x, 0) : e["set"](0, -r.z, r.y)) : e.crossVectors(r, o), this._x = e.x, this._y = e.y, this._z = e.z, this._w = t, this.normalize(), this
          }
        }(),
        inverse: function() {
          return this.conjugate().normalize(), this
        },
        conjugate: function() {
          return this._x *= -1, this._y *= -1, this._z *= -1, this.onChangeCallback(), this
        },
        dot: function(e) {
          return this._x * e._x + this._y * e._y + this._z * e._z + this._w * e._w
        },
        lengthSq: function() {
          return this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w
        },
        length: function() {
          return Math.sqrt(this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w)
        },
        normalize: function() {
          var e = this.length();
          return 0 === e ? (this._x = 0, this._y = 0, this._z = 0, this._w = 1) : (e = 1 / e, this._x = this._x * e, this._y = this._y * e, this._z = this._z * e, this._w = this._w * e), this.onChangeCallback(), this
        },
        multiply: function(e, t) {
          return void(0) !== t ? (console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."), this.multiplyQuaternions(e, t)) : this.multiplyQuaternions(this, e)
        },
        multiplyQuaternions: function(e, t) {
          var i = e._x,
            n = e._y,
            r = e._z,
            o = e._w,
            a = t._x,
            s = t._y,
            h = t._z,
            l = t._w;
          return this._x = i * l + o * a + n * h - r * s, this._y = n * l + o * s + r * a - i * h, this._z = r * l + o * h + i * s - n * a, this._w = o * l - i * a - n * s - r * h, this.onChangeCallback(), this
        },
        slerp: function(e, t) {
          if (0 === t) {
            return this
          };
          if (1 === t) {
            return this.copy(e)
          };
          var i = this._x,
            n = this._y,
            r = this._z,
            o = this._w,
            a = o * e._w + i * e._x + n * e._y + r * e._z;
          if (0 > a ? (this._w = -e._w, this._x = -e._x, this._y = -e._y, this._z = -e._z, a = -a) : this.copy(e), a >= 1) {
            return this._w = o, this._x = i, this._y = n, this._z = r, this
          };
          var s = Math.sqrt(1 - a * a);
          if (Math.abs(s) < 0.001) {
            return this._w = 0.5 * (o + this._w), this._x = 0.5 * (i + this._x), this._y = 0.5 * (n + this._y), this._z = 0.5 * (r + this._z), this
          };
          var h = Math.atan2(s, a),
            l = Math.sin((1 - t) * h) / s,
            c = Math.sin(t * h) / s;
          return this._w = o * l + this._w * c, this._x = i * l + this._x * c, this._y = n * l + this._y * c, this._z = r * l + this._z * c, this.onChangeCallback(), this
        },
        equals: function(e) {
          return e._x === this._x && e._y === this._y && e._z === this._z && e._w === this._w
        },
        fromArray: function(e, t) {
          return void(0) === t && (t = 0), this._x = e[t], this._y = e[t + 1], this._z = e[t + 2], this._w = e[t + 3], this.onChangeCallback(), this
        },
        toArray: function(e, t) {
          return void(0) === e && (e = []), void(0) === t && (t = 0), e[t] = this._x, e[t + 1] = this._y, e[t + 2] = this._z, e[t + 3] = this._w, e
        },
        onChange: function(e) {
          return this.onChangeCallback = e, this
        },
        onChangeCallback: function() {}
      }, Object.assign(n.Quaternion, {
        slerp: function(e, t, i, n) {
          return i.copy(e).slerp(t, n)
        },
        slerpFlat: function(e, t, i, n, r, o, a) {
          var s = i[n + 0],
            h = i[n + 1],
            l = i[n + 2],
            c = i[n + 3],
            u = r[o + 0],
            d = r[o + 1],
            p = r[o + 2],
            f = r[o + 3];
          if (c !== f || s !== u || h !== d || l !== p) {
            var m = 1 - a,
              g = s * u + h * d + l * p + c * f,
              v = g >= 0 ? 1 : -1,
              y = 1 - g * g;
            if (y > Number.EPSILON) {
              var b = Math.sqrt(y),
                w = Math.atan2(b, g * v);
              m = Math.sin(m * w) / b, a = Math.sin(a * w) / b
            };
            var _ = a * v;
            if (s = s * m + u * _, h = h * m + d * _, l = l * m + p * _, c = c * m + f * _, m === 1 - a) {
              var x = 1 / Math.sqrt(s * s + h * h + l * l + c * c);
              s *= x, h *= x, l *= x, c *= x
            }
          };
          e[t] = s, e[t + 1] = h, e[t + 2] = l, e[t + 3] = c
        }
      }), n.Vector2 = function(e, t) {
        this.x = e || 0, this.y = t || 0
      }, n.Vector2.prototype = {
        constructor: n.Vector2,
        get width() {
          return this.x
        },
        set width(e) {
          this.x = e
        },
        get height() {
          return this.y
        },
        set height(e) {
          this.y = e
        },
        set: function(e, t) {
          return this.x = e, this.y = t, this
        },
        setScalar: function(e) {
          return this.x = e, this.y = e, this
        },
        setX: function(e) {
          return this.x = e, this
        },
        setY: function(e) {
          return this.y = e, this
        },
        setComponent: function(e, t) {
          switch (e) {
            case 0:
              this.x = t;
              break;
            case 1:
              this.y = t;
              break;
            default:
              throw new Error("index is out of range: " + e)
          }
        },
        getComponent: function(e) {
          switch (e) {
            case 0:
              return this.x;
            case 1:
              return this.y;
            default:
              throw new Error("index is out of range: " + e)
          }
        },
        clone: function() {
          return new this.constructor(this.x, this.y)
        },
        copy: function(e) {
          return this.x = e.x, this.y = e.y, this
        },
        add: function(e, t) {
          return void(0) !== t ? (console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."), this.addVectors(e, t)) : (this.x += e.x, this.y += e.y, this)
        },
        addScalar: function(e) {
          return this.x += e, this.y += e, this
        },
        addVectors: function(e, t) {
          return this.x = e.x + t.x, this.y = e.y + t.y, this
        },
        addScaledVector: function(e, t) {
          return this.x += e.x * t, this.y += e.y * t, this
        },
        sub: function(e, t) {
          return void(0) !== t ? (console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."), this.subVectors(e, t)) : (this.x -= e.x, this.y -= e.y, this)
        },
        subScalar: function(e) {
          return this.x -= e, this.y -= e, this
        },
        subVectors: function(e, t) {
          return this.x = e.x - t.x, this.y = e.y - t.y, this
        },
        multiply: function(e) {
          return this.x *= e.x, this.y *= e.y, this
        },
        multiplyScalar: function(e) {
          return isFinite(e) ? (this.x *= e, this.y *= e) : (this.x = 0, this.y = 0), this
        },
        divide: function(e) {
          return this.x /= e.x, this.y /= e.y, this
        },
        divideScalar: function(e) {
          return this.multiplyScalar(1 / e)
        },
        min: function(e) {
          return this.x = Math.min(this.x, e.x), this.y = Math.min(this.y, e.y), this
        },
        max: function(e) {
          return this.x = Math.max(this.x, e.x), this.y = Math.max(this.y, e.y), this
        },
        clamp: function(e, t) {
          return this.x = Math.max(e.x, Math.min(t.x, this.x)), this.y = Math.max(e.y, Math.min(t.y, this.y)), this
        },
        clampScalar: function() {
          var e, t;
          return function(i, r) {
            return void(0) === e && (e = new n.Vector2, t = new n.Vector2), e["set"](i, i), t["set"](r, r), this.clamp(e, t)
          }
        }(),
        clampLength: function(e, t) {
          var i = this.length();
          return this.multiplyScalar(Math.max(e, Math.min(t, i)) / i), this
        },
        floor: function() {
          return this.x = Math.floor(this.x), this.y = Math.floor(this.y), this
        },
        ceil: function() {
          return this.x = Math.ceil(this.x), this.y = Math.ceil(this.y), this
        },
        round: function() {
          return this.x = Math.round(this.x), this.y = Math.round(this.y), this
        },
        roundToZero: function() {
          return this.x = this.x < 0 ? Math.ceil(this.x) : Math.floor(this.x), this.y = this.y < 0 ? Math.ceil(this.y) : Math.floor(this.y), this
        },
        negate: function() {
          return this.x = -this.x, this.y = -this.y, this
        },
        dot: function(e) {
          return this.x * e.x + this.y * e.y
        },
        lengthSq: function() {
          return this.x * this.x + this.y * this.y
        },
        length: function() {
          return Math.sqrt(this.x * this.x + this.y * this.y)
        },
        lengthManhattan: function() {
          return Math.abs(this.x) + Math.abs(this.y)
        },
        normalize: function() {
          return this.divideScalar(this.length())
        },
        angle: function() {
          var e = Math.atan2(this.y, this.x);
          return 0 > e && (e += 2 * Math.PI), e
        },
        distanceTo: function(e) {
          return Math.sqrt(this.distanceToSquared(e))
        },
        distanceToSquared: function(e) {
          var t = this.x - e.x,
            i = this.y - e.y;
          return t * t + i * i
        },
        setLength: function(e) {
          return this.multiplyScalar(e / this.length())
        },
        lerp: function(e, t) {
          return this.x += (e.x - this.x) * t, this.y += (e.y - this.y) * t, this
        },
        lerpVectors: function(e, t, i) {
          return this.subVectors(t, e).multiplyScalar(i).add(e), this
        },
        equals: function(e) {
          return e.x === this.x && e.y === this.y
        },
        fromArray: function(e, t) {
          return void(0) === t && (t = 0), this.x = e[t], this.y = e[t + 1], this
        },
        toArray: function(e, t) {
          return void(0) === e && (e = []), void(0) === t && (t = 0), e[t] = this.x, e[t + 1] = this.y, e
        },
        fromAttribute: function(e, t, i) {
          return void(0) === i && (i = 0), t = t * e.itemSize + i, this.x = e.array[t], this.y = e.array[t + 1], this
        },
        rotateAround: function(e, t) {
          var i = Math.cos(t),
            n = Math.sin(t),
            r = this.x - e.x,
            o = this.y - e.y;
          return this.x = r * i - o * n + e.x, this.y = r * n + o * i + e.y, this
        }
      }, n.Vector3 = function(e, t, i) {
        this.x = e || 0, this.y = t || 0, this.z = i || 0
      }, n.Vector3.prototype = {
        constructor: n.Vector3,
        set: function(e, t, i) {
          return this.x = e, this.y = t, this.z = i, this
        },
        setScalar: function(e) {
          return this.x = e, this.y = e, this.z = e, this
        },
        setX: function(e) {
          return this.x = e, this
        },
        setY: function(e) {
          return this.y = e, this
        },
        setZ: function(e) {
          return this.z = e, this
        },
        setComponent: function(e, t) {
          switch (e) {
            case 0:
              this.x = t;
              break;
            case 1:
              this.y = t;
              break;
            case 2:
              this.z = t;
              break;
            default:
              throw new Error("index is out of range: " + e)
          }
        },
        getComponent: function(e) {
          switch (e) {
            case 0:
              return this.x;
            case 1:
              return this.y;
            case 2:
              return this.z;
            default:
              throw new Error("index is out of range: " + e)
          }
        },
        clone: function() {
          return new this.constructor(this.x, this.y, this.z)
        },
        copy: function(e) {
          return this.x = e.x, this.y = e.y, this.z = e.z, this
        },
        add: function(e, t) {
          return void(0) !== t ? (console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."), this.addVectors(e, t)) : (this.x += e.x, this.y += e.y, this.z += e.z, this)
        },
        addScalar: function(e) {
          return this.x += e, this.y += e, this.z += e, this
        },
        addVectors: function(e, t) {
          return this.x = e.x + t.x, this.y = e.y + t.y, this.z = e.z + t.z, this
        },
        addScaledVector: function(e, t) {
          return this.x += e.x * t, this.y += e.y * t, this.z += e.z * t, this
        },
        sub: function(e, t) {
          return void(0) !== t ? (console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."), this.subVectors(e, t)) : (this.x -= e.x, this.y -= e.y, this.z -= e.z, this)
        },
        subScalar: function(e) {
          return this.x -= e, this.y -= e, this.z -= e, this
        },
        subVectors: function(e, t) {
          return this.x = e.x - t.x, this.y = e.y - t.y, this.z = e.z - t.z, this
        },
        multiply: function(e, t) {
          return void(0) !== t ? (console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."), this.multiplyVectors(e, t)) : (this.x *= e.x, this.y *= e.y, this.z *= e.z, this)
        },
        multiplyScalar: function(e) {
          return isFinite(e) ? (this.x *= e, this.y *= e, this.z *= e) : (this.x = 0, this.y = 0, this.z = 0), this
        },
        multiplyVectors: function(e, t) {
          return this.x = e.x * t.x, this.y = e.y * t.y, this.z = e.z * t.z, this
        },
        applyEuler: function() {
          var e;
          return function(t) {
            return t instanceof n.Euler == !1 && console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."), void(0) === e && (e = new n.Quaternion), this.applyQuaternion(e.setFromEuler(t)), this
          }
        }(),
        applyAxisAngle: function() {
          var e;
          return function(t, i) {
            return void(0) === e && (e = new n.Quaternion), this.applyQuaternion(e.setFromAxisAngle(t, i)), this
          }
        }(),
        applyMatrix3: function(e) {
          var t = this.x,
            i = this.y,
            n = this.z,
            r = e.elements;
          return this.x = r[0] * t + r[3] * i + r[6] * n, this.y = r[1] * t + r[4] * i + r[7] * n, this.z = r[2] * t + r[5] * i + r[8] * n, this
        },
        applyMatrix4: function(e) {
          var t = this.x,
            i = this.y,
            n = this.z,
            r = e.elements;
          return this.x = r[0] * t + r[4] * i + r[8] * n + r[12], this.y = r[1] * t + r[5] * i + r[9] * n + r[13], this.z = r[2] * t + r[6] * i + r[10] * n + r[14], this
        },
        applyProjection: function(e) {
          var t = this.x,
            i = this.y,
            n = this.z,
            r = e.elements,
            o = 1 / (r[3] * t + r[7] * i + r[11] * n + r[15]);
          return this.x = (r[0] * t + r[4] * i + r[8] * n + r[12]) * o, this.y = (r[1] * t + r[5] * i + r[9] * n + r[13]) * o, this.z = (r[2] * t + r[6] * i + r[10] * n + r[14]) * o, this
        },
        applyQuaternion: function(e) {
          var t = this.x,
            i = this.y,
            n = this.z,
            r = e.x,
            o = e.y,
            a = e.z,
            s = e.w,
            h = s * t + o * n - a * i,
            l = s * i + a * t - r * n,
            c = s * n + r * i - o * t,
            u = -r * t - o * i - a * n;
          return this.x = h * s + u * -r + l * -a - c * -o, this.y = l * s + u * -o + c * -r - h * -a, this.z = c * s + u * -a + h * -o - l * -r, this
        },
        project: function() {
          var e;
          return function(t) {
            return void(0) === e && (e = new n.Matrix4), e.multiplyMatrices(t.projectionMatrix, e.getInverse(t.matrixWorld)), this.applyProjection(e)
          }
        }(),
        unproject: function() {
          var e;
          return function(t) {
            return void(0) === e && (e = new n.Matrix4), e.multiplyMatrices(t.matrixWorld, e.getInverse(t.projectionMatrix)), this.applyProjection(e)
          }
        }(),
        transformDirection: function(e) {
          var t = this.x,
            i = this.y,
            n = this.z,
            r = e.elements;
          return this.x = r[0] * t + r[4] * i + r[8] * n, this.y = r[1] * t + r[5] * i + r[9] * n, this.z = r[2] * t + r[6] * i + r[10] * n, this.normalize(), this
        },
        divide: function(e) {
          return this.x /= e.x, this.y /= e.y, this.z /= e.z, this
        },
        divideScalar: function(e) {
          return this.multiplyScalar(1 / e)
        },
        min: function(e) {
          return this.x = Math.min(this.x, e.x), this.y = Math.min(this.y, e.y), this.z = Math.min(this.z, e.z), this
        },
        max: function(e) {
          return this.x = Math.max(this.x, e.x), this.y = Math.max(this.y, e.y), this.z = Math.max(this.z, e.z), this
        },
        clamp: function(e, t) {
          return this.x = Math.max(e.x, Math.min(t.x, this.x)), this.y = Math.max(e.y, Math.min(t.y, this.y)), this.z = Math.max(e.z, Math.min(t.z, this.z)), this
        },
        clampScalar: function() {
          var e, t;
          return function(i, r) {
            return void(0) === e && (e = new n.Vector3, t = new n.Vector3), e["set"](i, i, i), t["set"](r, r, r), this.clamp(e, t)
          }
        }(),
        clampLength: function(e, t) {
          var i = this.length();
          return this.multiplyScalar(Math.max(e, Math.min(t, i)) / i), this
        },
        floor: function() {
          return this.x = Math.floor(this.x), this.y = Math.floor(this.y), this.z = Math.floor(this.z), this
        },
        ceil: function() {
          return this.x = Math.ceil(this.x), this.y = Math.ceil(this.y), this.z = Math.ceil(this.z), this
        },
        round: function() {
          return this.x = Math.round(this.x), this.y = Math.round(this.y), this.z = Math.round(this.z), this
        },
        roundToZero: function() {
          return this.x = this.x < 0 ? Math.ceil(this.x) : Math.floor(this.x), this.y = this.y < 0 ? Math.ceil(this.y) : Math.floor(this.y), this.z = this.z < 0 ? Math.ceil(this.z) : Math.floor(this.z), this
        },
        negate: function() {
          return this.x = -this.x, this.y = -this.y, this.z = -this.z, this
        },
        dot: function(e) {
          return this.x * e.x + this.y * e.y + this.z * e.z
        },
        lengthSq: function() {
          return this.x * this.x + this.y * this.y + this.z * this.z
        },
        length: function() {
          return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z)
        },
        lengthManhattan: function() {
          return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z)
        },
        normalize: function() {
          return this.divideScalar(this.length())
        },
        setLength: function(e) {
          return this.multiplyScalar(e / this.length())
        },
        lerp: function(e, t) {
          return this.x += (e.x - this.x) * t, this.y += (e.y - this.y) * t, this.z += (e.z - this.z) * t, this
        },
        lerpVectors: function(e, t, i) {
          return this.subVectors(t, e).multiplyScalar(i).add(e), this
        },
        cross: function(e, t) {
          if (void(0) !== t) {
            return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."), this.crossVectors(e, t)
          };
          var i = this.x,
            n = this.y,
            r = this.z;
          return this.x = n * e.z - r * e.y, this.y = r * e.x - i * e.z, this.z = i * e.y - n * e.x, this
        },
        crossVectors: function(e, t) {
          var i = e.x,
            n = e.y,
            r = e.z,
            o = t.x,
            a = t.y,
            s = t.z;
          return this.x = n * s - r * a, this.y = r * o - i * s, this.z = i * a - n * o, this
        },
        projectOnVector: function() {
          var e, t;
          return function(i) {
            return void(0) === e && (e = new n.Vector3), e.copy(i).normalize(), t = this.dot(e), this.copy(e).multiplyScalar(t)
          }
        }(),
        projectOnPlane: function() {
          var e;
          return function(t) {
            return void(0) === e && (e = new n.Vector3), e.copy(this).projectOnVector(t), this.sub(e)
          }
        }(),
        reflect: function() {
          var e;
          return function(t) {
            return void(0) === e && (e = new n.Vector3), this.sub(e.copy(t).multiplyScalar(2 * this.dot(t)))
          }
        }(),
        angleTo: function(e) {
          var t = this.dot(e) / Math.sqrt(this.lengthSq() * e.lengthSq());
          return Math.acos(n.Math.clamp(t, -1, 1))
        },
        distanceTo: function(e) {
          return Math.sqrt(this.distanceToSquared(e))
        },
        distanceToSquared: function(e) {
          var t = this.x - e.x,
            i = this.y - e.y,
            n = this.z - e.z;
          return t * t + i * i + n * n
        },
        setFromSpherical: function(e) {
          var t = Math.sin(e.phi) * e.radius;
          return this.x = t * Math.sin(e.theta), this.y = Math.cos(e.phi) * e.radius, this.z = t * Math.cos(e.theta), this
        },
        setFromMatrixPosition: function(e) {
          return this.setFromMatrixColumn(e, 3)
        },
        setFromMatrixScale: function(e) {
          var t = this.setFromMatrixColumn(e, 0).length(),
            i = this.setFromMatrixColumn(e, 1).length(),
            n = this.setFromMatrixColumn(e, 2).length();
          return this.x = t, this.y = i, this.z = n, this
        },
        setFromMatrixColumn: function(e, t) {
          return "number" == typeof e && (console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index )."), e = arguments[1], t = arguments[0]), this.fromArray(e.elements, 4 * t)
        },
        equals: function(e) {
          return e.x === this.x && e.y === this.y && e.z === this.z
        },
        fromArray: function(e, t) {
          return void(0) === t && (t = 0), this.x = e[t], this.y = e[t + 1], this.z = e[t + 2], this
        },
        toArray: function(e, t) {
          return void(0) === e && (e = []), void(0) === t && (t = 0), e[t] = this.x, e[t + 1] = this.y, e[t + 2] = this.z, e
        },
        fromAttribute: function(e, t, i) {
          return void(0) === i && (i = 0), t = t * e.itemSize + i, this.x = e.array[t], this.y = e.array[t + 1], this.z = e.array[t + 2], this
        }
      }, n.Vector4 = function(e, t, i, n) {
        this.x = e || 0, this.y = t || 0, this.z = i || 0, this.w = void(0) !== n ? n : 1
      }, n.Vector4.prototype = {
        constructor: n.Vector4,
        set: function(e, t, i, n) {
          return this.x = e, this.y = t, this.z = i, this.w = n, this
        },
        setScalar: function(e) {
          return this.x = e, this.y = e, this.z = e, this.w = e, this
        },
        setX: function(e) {
          return this.x = e, this
        },
        setY: function(e) {
          return this.y = e, this
        },
        setZ: function(e) {
          return this.z = e, this
        },
        setW: function(e) {
          return this.w = e, this
        },
        setComponent: function(e, t) {
          switch (e) {
            case 0:
              this.x = t;
              break;
            case 1:
              this.y = t;
              break;
            case 2:
              this.z = t;
              break;
            case 3:
              this.w = t;
              break;
            default:
              throw new Error("index is out of range: " + e)
          }
        },
        getComponent: function(e) {
          switch (e) {
            case 0:
              return this.x;
            case 1:
              return this.y;
            case 2:
              return this.z;
            case 3:
              return this.w;
            default:
              throw new Error("index is out of range: " + e)
          }
        },
        clone: function() {
          return new this.constructor(this.x, this.y, this.z, this.w)
        },
        copy: function(e) {
          return this.x = e.x, this.y = e.y, this.z = e.z, this.w = void(0) !== e.w ? e.w : 1, this
        },
        add: function(e, t) {
          return void(0) !== t ? (console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."), this.addVectors(e, t)) : (this.x += e.x, this.y += e.y, this.z += e.z, this.w += e.w, this)
        },
        addScalar: function(e) {
          return this.x += e, this.y += e, this.z += e, this.w += e, this
        },
        addVectors: function(e, t) {
          return this.x = e.x + t.x, this.y = e.y + t.y, this.z = e.z + t.z, this.w = e.w + t.w, this
        },
        addScaledVector: function(e, t) {
          return this.x += e.x * t, this.y += e.y * t, this.z += e.z * t, this.w += e.w * t, this
        },
        sub: function(e, t) {
          return void(0) !== t ? (console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."), this.subVectors(e, t)) : (this.x -= e.x, this.y -= e.y, this.z -= e.z, this.w -= e.w, this)
        },
        subScalar: function(e) {
          return this.x -= e, this.y -= e, this.z -= e, this.w -= e, this
        },
        subVectors: function(e, t) {
          return this.x = e.x - t.x, this.y = e.y - t.y, this.z = e.z - t.z, this.w = e.w - t.w, this
        },
        multiplyScalar: function(e) {
          return isFinite(e) ? (this.x *= e, this.y *= e, this.z *= e, this.w *= e) : (this.x = 0, this.y = 0, this.z = 0, this.w = 0), this
        },
        applyMatrix4: function(e) {
          var t = this.x,
            i = this.y,
            n = this.z,
            r = this.w,
            o = e.elements;
          return this.x = o[0] * t + o[4] * i + o[8] * n + o[12] * r, this.y = o[1] * t + o[5] * i + o[9] * n + o[13] * r, this.z = o[2] * t + o[6] * i + o[10] * n + o[14] * r, this.w = o[3] * t + o[7] * i + o[11] * n + o[15] * r, this
        },
        divideScalar: function(e) {
          return this.multiplyScalar(1 / e)
        },
        setAxisAngleFromQuaternion: function(e) {
          this.w = 2 * Math.acos(e.w);
          var t = Math.sqrt(1 - e.w * e.w);
          return 1e-4 > t ? (this.x = 1, this.y = 0, this.z = 0) : (this.x = e.x / t, this.y = e.y / t, this.z = e.z / t), this
        },
        setAxisAngleFromRotationMatrix: function(e) {
          var t, i, n, r, o = 0.01,
            a = 0.1,
            s = e.elements,
            h = s[0],
            l = s[4],
            c = s[8],
            u = s[1],
            d = s[5],
            p = s[9],
            f = s[2],
            m = s[6],
            g = s[10];
          if (Math.abs(l - u) < o && Math.abs(c - f) < o && Math.abs(p - m) < o) {
            if (Math.abs(l + u) < a && Math.abs(c + f) < a && Math.abs(p + m) < a && Math.abs(h + d + g - 3) < a) {
              return this["set"](1, 0, 0, 0), this
            };
            t = Math.PI;
            var v = (h + 1) / 2,
              y = (d + 1) / 2,
              b = (g + 1) / 2,
              w = (l + u) / 4,
              _ = (c + f) / 4,
              x = (p + m) / 4;
            return v > y && v > b ? o > v ? (i = 0, n = 0.707106781, r = 0.707106781) : (i = Math.sqrt(v), n = w / i, r = _ / i) : y > b ? o > y ? (i = 0.707106781, n = 0, r = 0.707106781) : (n = Math.sqrt(y), i = w / n, r = x / n) : o > b ? (i = 0.707106781, n = 0.707106781, r = 0) : (r = Math.sqrt(b), i = _ / r, n = x / r), this["set"](i, n, r, t), this
          };
          var M = Math.sqrt((m - p) * (m - p) + (c - f) * (c - f) + (u - l) * (u - l));
          return Math.abs(M) < 0.001 && (M = 1), this.x = (m - p) / M, this.y = (c - f) / M, this.z = (u - l) / M, this.w = Math.acos((h + d + g - 1) / 2), this
        },
        min: function(e) {
          return this.x = Math.min(this.x, e.x), this.y = Math.min(this.y, e.y), this.z = Math.min(this.z, e.z), this.w = Math.min(this.w, e.w), this
        },
        max: function(e) {
          return this.x = Math.max(this.x, e.x), this.y = Math.max(this.y, e.y), this.z = Math.max(this.z, e.z), this.w = Math.max(this.w, e.w), this
        },
        clamp: function(e, t) {
          return this.x = Math.max(e.x, Math.min(t.x, this.x)), this.y = Math.max(e.y, Math.min(t.y, this.y)), this.z = Math.max(e.z, Math.min(t.z, this.z)), this.w = Math.max(e.w, Math.min(t.w, this.w)), this
        },
        clampScalar: function() {
          var e, t;
          return function(i, r) {
            return void(0) === e && (e = new n.Vector4, t = new n.Vector4), e["set"](i, i, i, i), t["set"](r, r, r, r), this.clamp(e, t)
          }
        }(),
        floor: function() {
          return this.x = Math.floor(this.x), this.y = Math.floor(this.y), this.z = Math.floor(this.z), this.w = Math.floor(this.w), this
        },
        ceil: function() {
          return this.x = Math.ceil(this.x), this.y = Math.ceil(this.y), this.z = Math.ceil(this.z), this.w = Math.ceil(this.w), this
        },
        round: function() {
          return this.x = Math.round(this.x), this.y = Math.round(this.y), this.z = Math.round(this.z), this.w = Math.round(this.w), this
        },
        roundToZero: function() {
          return this.x = this.x < 0 ? Math.ceil(this.x) : Math.floor(this.x), this.y = this.y < 0 ? Math.ceil(this.y) : Math.floor(this.y), this.z = this.z < 0 ? Math.ceil(this.z) : Math.floor(this.z), this.w = this.w < 0 ? Math.ceil(this.w) : Math.floor(this.w), this
        },
        negate: function() {
          return this.x = -this.x, this.y = -this.y, this.z = -this.z, this.w = -this.w, this
        },
        dot: function(e) {
          return this.x * e.x + this.y * e.y + this.z * e.z + this.w * e.w
        },
        lengthSq: function() {
          return this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w
        },
        length: function() {
          return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w)
        },
        lengthManhattan: function() {
          return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z) + Math.abs(this.w)
        },
        normalize: function() {
          return this.divideScalar(this.length())
        },
        setLength: function(e) {
          return this.multiplyScalar(e / this.length())
        },
        lerp: function(e, t) {
          return this.x += (e.x - this.x) * t, this.y += (e.y - this.y) * t, this.z += (e.z - this.z) * t, this.w += (e.w - this.w) * t, this
        },
        lerpVectors: function(e, t, i) {
          return this.subVectors(t, e).multiplyScalar(i).add(e), this
        },
        equals: function(e) {
          return e.x === this.x && e.y === this.y && e.z === this.z && e.w === this.w
        },
        fromArray: function(e, t) {
          return void(0) === t && (t = 0), this.x = e[t], this.y = e[t + 1], this.z = e[t + 2], this.w = e[t + 3], this
        },
        toArray: function(e, t) {
          return void(0) === e && (e = []), void(0) === t && (t = 0), e[t] = this.x, e[t + 1] = this.y, e[t + 2] = this.z, e[t + 3] = this.w, e
        },
        fromAttribute: function(e, t, i) {
          return void(0) === i && (i = 0), t = t * e.itemSize + i, this.x = e.array[t], this.y = e.array[t + 1], this.z = e.array[t + 2], this.w = e.array[t + 3], this
        }
      }, n.Euler = function(e, t, i, r) {
        this._x = e || 0, this._y = t || 0, this._z = i || 0, this._order = r || n.Euler.DefaultOrder
      }, n.Euler.RotationOrders = ["XYZ", "YZX", "ZXY", "XZY", "YXZ", "ZYX"], n.Euler.DefaultOrder = "XYZ", n.Euler.prototype = {
        constructor: n.Euler,
        get x() {
          return this._x
        },
        set x(e) {
          this._x = e, this.onChangeCallback()
        },
        get y() {
          return this._y
        },
        set y(e) {
          this._y = e, this.onChangeCallback()
        },
        get z() {
          return this._z
        },
        set z(e) {
          this._z = e, this.onChangeCallback()
        },
        get order() {
          return this._order
        },
        set order(e) {
          this._order = e, this.onChangeCallback()
        },
        set: function(e, t, i, n) {
          return this._x = e, this._y = t, this._z = i, this._order = n || this._order, this.onChangeCallback(), this
        },
        clone: function() {
          return new this.constructor(this._x, this._y, this._z, this._order)
        },
        copy: function(e) {
          return this._x = e._x, this._y = e._y, this._z = e._z, this._order = e._order, this.onChangeCallback(), this
        },
        setFromRotationMatrix: function(e, t, i) {
          var r = n.Math.clamp,
            o = e.elements,
            a = o[0],
            s = o[4],
            h = o[8],
            l = o[1],
            c = o[5],
            u = o[9],
            d = o[2],
            p = o[6],
            f = o[10];
          return t = t || this._order, "XYZ" === t ? (this._y = Math.asin(r(h, -1, 1)), Math.abs(h) < 0.99999 ? (this._x = Math.atan2(-u, f), this._z = Math.atan2(-s, a)) : (this._x = Math.atan2(p, c), this._z = 0)) : "YXZ" === t ? (this._x = Math.asin(-r(u, -1, 1)), Math.abs(u) < 0.99999 ? (this._y = Math.atan2(h, f), this._z = Math.atan2(l, c)) : (this._y = Math.atan2(-d, a), this._z = 0)) : "ZXY" === t ? (this._x = Math.asin(r(p, -1, 1)), Math.abs(p) < 0.99999 ? (this._y = Math.atan2(-d, f), this._z = Math.atan2(-s, c)) : (this._y = 0, this._z = Math.atan2(l, a))) : "ZYX" === t ? (this._y = Math.asin(-r(d, -1, 1)), Math.abs(d) < 0.99999 ? (this._x = Math.atan2(p, f), this._z = Math.atan2(l, a)) : (this._x = 0, this._z = Math.atan2(-s, c))) : "YZX" === t ? (this._z = Math.asin(r(l, -1, 1)), Math.abs(l) < 0.99999 ? (this._x = Math.atan2(-u, c), this._y = Math.atan2(-d, a)) : (this._x = 0, this._y = Math.atan2(h, f))) : "XZY" === t ? (this._z = Math.asin(-r(s, -1, 1)), Math.abs(s) < 0.99999 ? (this._x = Math.atan2(p, c), this._y = Math.atan2(h, a)) : (this._x = Math.atan2(-u, f), this._y = 0)) : console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: " + t), this._order = t, i !== !1 && this.onChangeCallback(), this
        },
        setFromQuaternion: function() {
          var e;
          return function(t, i, r) {
            return void(0) === e && (e = new n.Matrix4), e.makeRotationFromQuaternion(t), this.setFromRotationMatrix(e, i, r), this
          }
        }(),
        setFromVector3: function(e, t) {
          return this["set"](e.x, e.y, e.z, t || this._order)
        },
        reorder: function() {
          var e = new n.Quaternion;
          return function(t) {
            e.setFromEuler(this), this.setFromQuaternion(e, t)
          }
        }(),
        equals: function(e) {
          return e._x === this._x && e._y === this._y && e._z === this._z && e._order === this._order
        },
        fromArray: function(e) {
          return this._x = e[0], this._y = e[1], this._z = e[2], void(0) !== e[3] && (this._order = e[3]), this.onChangeCallback(), this
        },
        toArray: function(e, t) {
          return void(0) === e && (e = []), void(0) === t && (t = 0), e[t] = this._x, e[t + 1] = this._y, e[t + 2] = this._z, e[t + 3] = this._order, e
        },
        toVector3: function(e) {
          return e ? e["set"](this._x, this._y, this._z) : new n.Vector3(this._x, this._y, this._z)
        },
        onChange: function(e) {
          return this.onChangeCallback = e, this
        },
        onChangeCallback: function() {}
      }, n.Line3 = function(e, t) {
        this.start = void(0) !== e ? e : new n.Vector3, this.end = void(0) !== t ? t : new n.Vector3
      }, n.Line3.prototype = {
        constructor: n.Line3,
        set: function(e, t) {
          return this.start.copy(e), this.end.copy(t), this
        },
        clone: function() {
          return (new this.constructor).copy(this)
        },
        copy: function(e) {
          return this.start.copy(e.start), this.end.copy(e.end), this
        },
        center: function(e) {
          var t = e || new n.Vector3;
          return t.addVectors(this.start, this.end).multiplyScalar(0.5)
        },
        delta: function(e) {
          var t = e || new n.Vector3;
          return t.subVectors(this.end, this.start)
        },
        distanceSq: function() {
          return this.start.distanceToSquared(this.end)
        },
        distance: function() {
          return this.start.distanceTo(this.end)
        },
        at: function(e, t) {
          var i = t || new n.Vector3;
          return this.delta(i).multiplyScalar(e).add(this.start)
        },
        closestPointToPointParameter: function() {
          var e = new n.Vector3,
            t = new n.Vector3;
          return function(i, r) {
            e.subVectors(i, this.start), t.subVectors(this.end, this.start);
            var o = t.dot(t),
              a = t.dot(e),
              s = a / o;
            return r && (s = n.Math.clamp(s, 0, 1)), s
          }
        }(),
        closestPointToPoint: function(e, t, i) {
          var r = this.closestPointToPointParameter(e, t),
            o = i || new n.Vector3;
          return this.delta(o).multiplyScalar(r).add(this.start)
        },
        applyMatrix4: function(e) {
          return this.start.applyMatrix4(e), this.end.applyMatrix4(e), this
        },
        equals: function(e) {
          return e.start.equals(this.start) && e.end.equals(this.end)
        }
      }, n.Box2 = function(e, t) {
        this.min = void(0) !== e ? e : new n.Vector2(+(1 / 0), +(1 / 0)), this.max = void(0) !== t ? t : new n.Vector2(-(1 / 0), -(1 / 0))
      }, n.Box2.prototype = {
        constructor: n.Box2,
        set: function(e, t) {
          return this.min.copy(e), this.max.copy(t), this
        },
        setFromPoints: function(e) {
          this.makeEmpty();
          for (var t = 0, i = e.length; i > t; t++) {
            this.expandByPoint(e[t])
          };
          return this
        },
        setFromCenterAndSize: function() {
          var e = new n.Vector2;
          return function(t, i) {
            var n = e.copy(i).multiplyScalar(0.5);
            return this.min.copy(t).sub(n), this.max.copy(t).add(n), this
          }
        }(),
        clone: function() {
          return (new this.constructor).copy(this)
        },
        copy: function(e) {
          return this.min.copy(e.min), this.max.copy(e.max), this
        },
        makeEmpty: function() {
          return this.min.x = this.min.y = +(1 / 0), this.max.x = this.max.y = -(1 / 0), this
        },
        isEmpty: function() {
          return this.max.x < this.min.x || this.max.y < this.min.y
        },
        center: function(e) {
          var t = e || new n.Vector2;
          return t.addVectors(this.min, this.max).multiplyScalar(0.5)
        },
        size: function(e) {
          var t = e || new n.Vector2;
          return t.subVectors(this.max, this.min)
        },
        expandByPoint: function(e) {
          return this.min.min(e), this.max.max(e), this
        },
        expandByVector: function(e) {
          return this.min.sub(e), this.max.add(e), this
        },
        expandByScalar: function(e) {
          return this.min.addScalar(-e), this.max.addScalar(e), this
        },
        containsPoint: function(e) {
          return e.x < this.min.x || e.x > this.max.x || e.y < this.min.y || e.y > this.max.y ? !1 : !0
        },
        containsBox: function(e) {
          return this.min.x <= e.min.x && e.max.x <= this.max.x && this.min.y <= e.min.y && e.max.y <= this.max.y ? !0 : !1
        },
        getParameter: function(e, t) {
          var i = t || new n.Vector2;
          return i["set"]((e.x - this.min.x) / (this.max.x - this.min.x), (e.y - this.min.y) / (this.max.y - this.min.y))
        },
        intersectsBox: function(e) {
          return e.max.x < this.min.x || e.min.x > this.max.x || e.max.y < this.min.y || e.min.y > this.max.y ? !1 : !0
        },
        clampPoint: function(e, t) {
          var i = t || new n.Vector2;
          return i.copy(e).clamp(this.min, this.max)
        },
        distanceToPoint: function() {
          var e = new n.Vector2;
          return function(t) {
            var i = e.copy(t).clamp(this.min, this.max);
            return i.sub(t).length()
          }
        }(),
        intersect: function(e) {
          return this.min.max(e.min), this.max.min(e.max), this
        },
        union: function(e) {
          return this.min.min(e.min), this.max.max(e.max), this
        },
        translate: function(e) {
          return this.min.add(e), this.max.add(e), this
        },
        equals: function(e) {
          return e.min.equals(this.min) && e.max.equals(this.max)
        }
      }, n.Box3 = function(e, t) {
        this.min = void(0) !== e ? e : new n.Vector3(+(1 / 0), +(1 / 0), +(1 / 0)), this.max = void(0) !== t ? t : new n.Vector3(-(1 / 0), -(1 / 0), -(1 / 0))
      }, n.Box3.prototype = {
        constructor: n.Box3,
        set: function(e, t) {
          return this.min.copy(e), this.max.copy(t), this
        },
        setFromArray: function(e) {
          this.makeEmpty();
          for (var t = +(1 / 0), i = +(1 / 0), n = +(1 / 0), r = -(1 / 0), o = -(1 / 0), a = -(1 / 0), s = 0, h = e.length; h > s; s += 3) {
            var l = e[s],
              c = e[s + 1],
              u = e[s + 2];
            t > l && (t = l), i > c && (i = c), n > u && (n = u), l > r && (r = l), c > o && (o = c), u > a && (a = u)
          };
          this.min["set"](t, i, n), this.max["set"](r, o, a)
        },
        setFromPoints: function(e) {
          this.makeEmpty();
          for (var t = 0, i = e.length; i > t; t++) {
            this.expandByPoint(e[t])
          };
          return this
        },
        setFromCenterAndSize: function() {
          var e = new n.Vector3;
          return function(t, i) {
            var n = e.copy(i).multiplyScalar(0.5);
            return this.min.copy(t).sub(n), this.max.copy(t).add(n), this
          }
        }(),
        setFromObject: function() {
          var e;
          return function(t) {
            void(0) === e && (e = new n.Box3);
            var i = this;
            return this.makeEmpty(), t.updateMatrixWorld(!0), t.traverse(function(t) {
              var n = t.geometry;
              void(0) !== n && (null === n.boundingBox && n.computeBoundingBox(), n.boundingBox.isEmpty() === !1 && (e.copy(n.boundingBox), e.applyMatrix4(t.matrixWorld), i.union(e)))
            }), this
          }
        }(),
        clone: function() {
          return (new this.constructor).copy(this)
        },
        copy: function(e) {
          return this.min.copy(e.min), this.max.copy(e.max), this
        },
        makeEmpty: function() {
          return this.min.x = this.min.y = this.min.z = +(1 / 0), this.max.x = this.max.y = this.max.z = -(1 / 0), this
        },
        isEmpty: function() {
          return this.max.x < this.min.x || this.max.y < this.min.y || this.max.z < this.min.z
        },
        center: function(e) {
          var t = e || new n.Vector3;
          return t.addVectors(this.min, this.max).multiplyScalar(0.5)
        },
        size: function(e) {
          var t = e || new n.Vector3;
          return t.subVectors(this.max, this.min)
        },
        expandByPoint: function(e) {
          return this.min.min(e), this.max.max(e), this
        },
        expandByVector: function(e) {
          return this.min.sub(e), this.max.add(e), this
        },
        expandByScalar: function(e) {
          return this.min.addScalar(-e), this.max.addScalar(e), this
        },
        containsPoint: function(e) {
          return e.x < this.min.x || e.x > this.max.x || e.y < this.min.y || e.y > this.max.y || e.z < this.min.z || e.z > this.max.z ? !1 : !0
        },
        containsBox: function(e) {
          return this.min.x <= e.min.x && e.max.x <= this.max.x && this.min.y <= e.min.y && e.max.y <= this.max.y && this.min.z <= e.min.z && e.max.z <= this.max.z ? !0 : !1
        },
        getParameter: function(e, t) {
          var i = t || new n.Vector3;
          return i["set"]((e.x - this.min.x) / (this.max.x - this.min.x), (e.y - this.min.y) / (this.max.y - this.min.y), (e.z - this.min.z) / (this.max.z - this.min.z))
        },
        intersectsBox: function(e) {
          return e.max.x < this.min.x || e.min.x > this.max.x || e.max.y < this.min.y || e.min.y > this.max.y || e.max.z < this.min.z || e.min.z > this.max.z ? !1 : !0
        },
        intersectsSphere: function() {
          var e;
          return function(t) {
            return void(0) === e && (e = new n.Vector3), this.clampPoint(t.center, e), e.distanceToSquared(t.center) <= t.radius * t.radius
          }
        }(),
        intersectsPlane: function(e) {
          var t, i;
          return e.normal.x > 0 ? (t = e.normal.x * this.min.x, i = e.normal.x * this.max.x) : (t = e.normal.x * this.max.x, i = e.normal.x * this.min.x), e.normal.y > 0 ? (t += e.normal.y * this.min.y, i += e.normal.y * this.max.y) : (t += e.normal.y * this.max.y, i += e.normal.y * this.min.y), e.normal.z > 0 ? (t += e.normal.z * this.min.z, i += e.normal.z * this.max.z) : (t += e.normal.z * this.max.z, i += e.normal.z * this.min.z), t <= e.constant && i >= e.constant
        },
        clampPoint: function(e, t) {
          var i = t || new n.Vector3;
          return i.copy(e).clamp(this.min, this.max)
        },
        distanceToPoint: function() {
          var e = new n.Vector3;
          return function(t) {
            var i = e.copy(t).clamp(this.min, this.max);
            return i.sub(t).length()
          }
        }(),
        getBoundingSphere: function() {
          var e = new n.Vector3;
          return function(t) {
            var i = t || new n.Sphere;
            return i.center = this.center(), i.radius = 0.5 * this.size(e).length(), i
          }
        }(),
        intersect: function(e) {
          return this.min.max(e.min), this.max.min(e.max), this
        },
        union: function(e) {
          return this.min.min(e.min), this.max.max(e.max), this
        },
        applyMatrix4: function() {
          var e = [new n.Vector3, new n.Vector3, new n.Vector3, new n.Vector3, new n.Vector3, new n.Vector3, new n.Vector3, new n.Vector3];
          return function(t) {
            return e[0]["set"](this.min.x, this.min.y, this.min.z).applyMatrix4(t), e[1]["set"](this.min.x, this.min.y, this.max.z).applyMatrix4(t), e[2]["set"](this.min.x, this.max.y, this.min.z).applyMatrix4(t), e[3]["set"](this.min.x, this.max.y, this.max.z).applyMatrix4(t), e[4]["set"](this.max.x, this.min.y, this.min.z).applyMatrix4(t), e[5]["set"](this.max.x, this.min.y, this.max.z).applyMatrix4(t), e[6]["set"](this.max.x, this.max.y, this.min.z).applyMatrix4(t), e[7]["set"](this.max.x, this.max.y, this.max.z).applyMatrix4(t), this.makeEmpty(), this.setFromPoints(e), this
          }
        }(),
        translate: function(e) {
          return this.min.add(e), this.max.add(e), this
        },
        equals: function(e) {
          return e.min.equals(this.min) && e.max.equals(this.max)
        }
      }, n.Matrix3 = function() {
        this.elements = new Float32Array([1, 0, 0, 0, 1, 0, 0, 0, 1]), arguments.length > 0 && console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")
      }, n.Matrix3.prototype = {
        constructor: n.Matrix3,
        set: function(e, t, i, n, r, o, a, s, h) {
          var l = this.elements;
          return l[0] = e, l[1] = n, l[2] = a, l[3] = t, l[4] = r, l[5] = s, l[6] = i, l[7] = o, l[8] = h, this
        },
        identity: function() {
          return this["set"](1, 0, 0, 0, 1, 0, 0, 0, 1), this
        },
        clone: function() {
          return (new this.constructor).fromArray(this.elements)
        },
        copy: function(e) {
          var t = e.elements;
          return this["set"](t[0], t[3], t[6], t[1], t[4], t[7], t[2], t[5], t[8]), this
        },
        setFromMatrix4: function(e) {
          var t = e.elements;
          return this["set"](t[0], t[4], t[8], t[1], t[5], t[9], t[2], t[6], t[10]), this
        },
        applyToVector3Array: function() {
          var e;
          return function(t, i, r) {
            void(0) === e && (e = new n.Vector3), void(0) === i && (i = 0), void(0) === r && (r = t.length);
            for (var o = 0, a = i; r > o; o += 3, a += 3) {
              e.fromArray(t, a), e.applyMatrix3(this), e.toArray(t, a)
            };
            return t
          }
        }(),
        applyToBuffer: function() {
          var e;
          return function(t, i, r) {
            void(0) === e && (e = new n.Vector3), void(0) === i && (i = 0), void(0) === r && (r = t.length / t.itemSize);
            for (var o = 0, a = i; r > o; o++, a++) {
              e.x = t.getX(a), e.y = t.getY(a), e.z = t.getZ(a), e.applyMatrix3(this), t.setXYZ(e.x, e.y, e.z)
            };
            return t
          }
        }(),
        multiplyScalar: function(e) {
          var t = this.elements;
          return t[0] *= e, t[3] *= e, t[6] *= e, t[1] *= e, t[4] *= e, t[7] *= e, t[2] *= e, t[5] *= e, t[8] *= e, this
        },
        determinant: function() {
          var e = this.elements,
            t = e[0],
            i = e[1],
            n = e[2],
            r = e[3],
            o = e[4],
            a = e[5],
            s = e[6],
            h = e[7],
            l = e[8];
          return t * o * l - t * a * h - i * r * l + i * a * s + n * r * h - n * o * s
        },
        getInverse: function(e, t) {
          e instanceof n.Matrix4 && console.warn("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");
          var i = e.elements,
            r = this.elements,
            o = i[0],
            a = i[1],
            s = i[2],
            h = i[3],
            l = i[4],
            c = i[5],
            u = i[6],
            d = i[7],
            p = i[8],
            f = p * l - c * d,
            m = c * u - p * h,
            g = d * h - l * u,
            v = o * f + a * m + s * g;
          if (0 === v) {
            var y = "THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0";
            if (t) {
              throw new Error(y)
            };
            return console.warn(y), this.identity()
          };
          return r[0] = f, r[1] = s * d - p * a, r[2] = c * a - s * l, r[3] = m, r[4] = p * o - s * u, r[5] = s * h - c * o, r[6] = g, r[7] = a * u - d * o, r[8] = l * o - a * h, this.multiplyScalar(1 / v)
        },
        transpose: function() {
          var e, t = this.elements;
          return e = t[1], t[1] = t[3], t[3] = e, e = t[2], t[2] = t[6], t[6] = e, e = t[5], t[5] = t[7], t[7] = e, this
        },
        flattenToArrayOffset: function(e, t) {
          var i = this.elements;
          return e[t] = i[0], e[t + 1] = i[1], e[t + 2] = i[2], e[t + 3] = i[3], e[t + 4] = i[4], e[t + 5] = i[5], e[t + 6] = i[6], e[t + 7] = i[7], e[t + 8] = i[8], e
        },
        getNormalMatrix: function(e) {
          return this.setFromMatrix4(e).getInverse(this).transpose()
        },
        transposeIntoArray: function(e) {
          var t = this.elements;
          return e[0] = t[0], e[1] = t[3], e[2] = t[6], e[3] = t[1], e[4] = t[4], e[5] = t[7], e[6] = t[2], e[7] = t[5], e[8] = t[8], this
        },
        fromArray: function(e) {
          return this.elements["set"](e), this
        },
        toArray: function() {
          var e = this.elements;
          return [e[0], e[1], e[2], e[3], e[4], e[5], e[6], e[7], e[8]]
        }
      }, n.Matrix4 = function() {
        this.elements = new Float32Array([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]), arguments.length > 0 && console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")
      }, n.Matrix4.prototype = {
        constructor: n.Matrix4,
        set: function(e, t, i, n, r, o, a, s, h, l, c, u, d, p, f, m) {
          var g = this.elements;
          return g[0] = e, g[4] = t, g[8] = i, g[12] = n, g[1] = r, g[5] = o, g[9] = a, g[13] = s, g[2] = h, g[6] = l, g[10] = c, g[14] = u, g[3] = d, g[7] = p, g[11] = f, g[15] = m, this
        },
        identity: function() {
          return this["set"](1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1), this
        },
        clone: function() {
          return (new n.Matrix4).fromArray(this.elements)
        },
        copy: function(e) {
          return this.elements["set"](e.elements), this
        },
        copyPosition: function(e) {
          var t = this.elements,
            i = e.elements;
          return t[12] = i[12], t[13] = i[13], t[14] = i[14], this
        },
        extractBasis: function(e, t, i) {
          return e.setFromMatrixColumn(this, 0), t.setFromMatrixColumn(this, 1), i.setFromMatrixColumn(this, 2), this
        },
        makeBasis: function(e, t, i) {
          return this["set"](e.x, t.x, i.x, 0, e.y, t.y, i.y, 0, e.z, t.z, i.z, 0, 0, 0, 0, 1), this
        },
        extractRotation: function() {
          var e;
          return function(t) {
            void(0) === e && (e = new n.Vector3);
            var i = this.elements,
              r = t.elements,
              o = 1 / e.setFromMatrixColumn(t, 0).length(),
              a = 1 / e.setFromMatrixColumn(t, 1).length(),
              s = 1 / e.setFromMatrixColumn(t, 2).length();
            return i[0] = r[0] * o, i[1] = r[1] * o, i[2] = r[2] * o, i[4] = r[4] * a, i[5] = r[5] * a, i[6] = r[6] * a, i[8] = r[8] * s, i[9] = r[9] * s, i[10] = r[10] * s, this
          }
        }(),
        makeRotationFromEuler: function(e) {
          e instanceof n.Euler == !1 && console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");
          var t = this.elements,
            i = e.x,
            r = e.y,
            o = e.z,
            a = Math.cos(i),
            s = Math.sin(i),
            h = Math.cos(r),
            l = Math.sin(r),
            c = Math.cos(o),
            u = Math.sin(o);
          if ("XYZ" === e.order) {
            var d = a * c,
              p = a * u,
              f = s * c,
              m = s * u;
            t[0] = h * c, t[4] = -h * u, t[8] = l, t[1] = p + f * l, t[5] = d - m * l, t[9] = -s * h, t[2] = m - d * l, t[6] = f + p * l, t[10] = a * h
          } else {
            if ("YXZ" === e.order) {
              var g = h * c,
                v = h * u,
                y = l * c,
                b = l * u;
              t[0] = g + b * s, t[4] = y * s - v, t[8] = a * l, t[1] = a * u, t[5] = a * c, t[9] = -s, t[2] = v * s - y, t[6] = b + g * s, t[10] = a * h
            } else {
              if ("ZXY" === e.order) {
                var g = h * c,
                  v = h * u,
                  y = l * c,
                  b = l * u;
                t[0] = g - b * s, t[4] = -a * u, t[8] = y + v * s, t[1] = v + y * s, t[5] = a * c, t[9] = b - g * s, t[2] = -a * l, t[6] = s, t[10] = a * h
              } else {
                if ("ZYX" === e.order) {
                  var d = a * c,
                    p = a * u,
                    f = s * c,
                    m = s * u;
                  t[0] = h * c, t[4] = f * l - p, t[8] = d * l + m, t[1] = h * u, t[5] = m * l + d, t[9] = p * l - f, t[2] = -l, t[6] = s * h, t[10] = a * h
                } else {
                  if ("YZX" === e.order) {
                    var w = a * h,
                      _ = a * l,
                      x = s * h,
                      M = s * l;
                    t[0] = h * c, t[4] = M - w * u, t[8] = x * u + _, t[1] = u, t[5] = a * c, t[9] = -s * c, t[2] = -l * c, t[6] = _ * u + x, t[10] = w - M * u
                  } else {
                    if ("XZY" === e.order) {
                      var w = a * h,
                        _ = a * l,
                        x = s * h,
                        M = s * l;
                      t[0] = h * c, t[4] = -u, t[8] = l * c, t[1] = w * u + M, t[5] = a * c, t[9] = _ * u - x, t[2] = x * u - _, t[6] = s * c, t[10] = M * u + w
                    }
                  }
                }
              }
            }
          };
          return t[3] = 0, t[7] = 0, t[11] = 0, t[12] = 0, t[13] = 0, t[14] = 0, t[15] = 1, this
        },
        makeRotationFromQuaternion: function(e) {
          var t = this.elements,
            i = e.x,
            n = e.y,
            r = e.z,
            o = e.w,
            a = i + i,
            s = n + n,
            h = r + r,
            l = i * a,
            c = i * s,
            u = i * h,
            d = n * s,
            p = n * h,
            f = r * h,
            m = o * a,
            g = o * s,
            v = o * h;
          return t[0] = 1 - (d + f), t[4] = c - v, t[8] = u + g, t[1] = c + v, t[5] = 1 - (l + f), t[9] = p - m, t[2] = u - g, t[6] = p + m, t[10] = 1 - (l + d), t[3] = 0, t[7] = 0, t[11] = 0, t[12] = 0, t[13] = 0, t[14] = 0, t[15] = 1, this
        },
        lookAt: function() {
          var e, t, i;
          return function(r, o, a) {
            void(0) === e && (e = new n.Vector3), void(0) === t && (t = new n.Vector3), void(0) === i && (i = new n.Vector3);
            var s = this.elements;
            return i.subVectors(r, o).normalize(), 0 === i.lengthSq() && (i.z = 1), e.crossVectors(a, i).normalize(), 0 === e.lengthSq() && (i.x += 1e-4, e.crossVectors(a, i).normalize()), t.crossVectors(i, e), s[0] = e.x, s[4] = t.x, s[8] = i.x, s[1] = e.y, s[5] = t.y, s[9] = i.y, s[2] = e.z, s[6] = t.z, s[10] = i.z, this
          }
        }(),
        multiply: function(e, t) {
          return void(0) !== t ? (console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."), this.multiplyMatrices(e, t)) : this.multiplyMatrices(this, e)
        },
        multiplyMatrices: function(e, t) {
          var i = e.elements,
            n = t.elements,
            r = this.elements,
            o = i[0],
            a = i[4],
            s = i[8],
            h = i[12],
            l = i[1],
            c = i[5],
            u = i[9],
            d = i[13],
            p = i[2],
            f = i[6],
            m = i[10],
            g = i[14],
            v = i[3],
            y = i[7],
            b = i[11],
            w = i[15],
            _ = n[0],
            x = n[4],
            M = n[8],
            E = n[12],
            S = n[1],
            T = n[5],
            P = n[9],
            A = n[13],
            L = n[2],
            C = n[6],
            R = n[10],
            I = n[14],
            D = n[3],
            O = n[7],
            k = n[11],
            B = n[15];
          return r[0] = o * _ + a * S + s * L + h * D, r[4] = o * x + a * T + s * C + h * O, r[8] = o * M + a * P + s * R + h * k, r[12] = o * E + a * A + s * I + h * B, r[1] = l * _ + c * S + u * L + d * D, r[5] = l * x + c * T + u * C + d * O, r[9] = l * M + c * P + u * R + d * k, r[13] = l * E + c * A + u * I + d * B, r[2] = p * _ + f * S + m * L + g * D, r[6] = p * x + f * T + m * C + g * O, r[10] = p * M + f * P + m * R + g * k, r[14] = p * E + f * A + m * I + g * B, r[3] = v * _ + y * S + b * L + w * D, r[7] = v * x + y * T + b * C + w * O, r[11] = v * M + y * P + b * R + w * k, r[15] = v * E + y * A + b * I + w * B, this
        },
        multiplyToArray: function(e, t, i) {
          var n = this.elements;
          return this.multiplyMatrices(e, t), i[0] = n[0], i[1] = n[1], i[2] = n[2], i[3] = n[3], i[4] = n[4], i[5] = n[5], i[6] = n[6], i[7] = n[7], i[8] = n[8], i[9] = n[9], i[10] = n[10], i[11] = n[11], i[12] = n[12], i[13] = n[13], i[14] = n[14], i[15] = n[15], this
        },
        multiplyScalar: function(e) {
          var t = this.elements;
          return t[0] *= e, t[4] *= e, t[8] *= e, t[12] *= e, t[1] *= e, t[5] *= e, t[9] *= e, t[13] *= e, t[2] *= e, t[6] *= e, t[10] *= e, t[14] *= e, t[3] *= e, t[7] *= e, t[11] *= e, t[15] *= e, this
        },
        applyToVector3Array: function() {
          var e;
          return function(t, i, r) {
            void(0) === e && (e = new n.Vector3), void(0) === i && (i = 0), void(0) === r && (r = t.length);
            for (var o = 0, a = i; r > o; o += 3, a += 3) {
              e.fromArray(t, a), e.applyMatrix4(this), e.toArray(t, a)
            };
            return t
          }
        }(),
        applyToBuffer: function() {
          var e;
          return function(t, i, r) {
            void(0) === e && (e = new n.Vector3), void(0) === i && (i = 0), void(0) === r && (r = t.length / t.itemSize);
            for (var o = 0, a = i; r > o; o++, a++) {
              e.x = t.getX(a), e.y = t.getY(a), e.z = t.getZ(a), e.applyMatrix4(this), t.setXYZ(e.x, e.y, e.z)
            };
            return t
          }
        }(),
        determinant: function() {
          var e = this.elements,
            t = e[0],
            i = e[4],
            n = e[8],
            r = e[12],
            o = e[1],
            a = e[5],
            s = e[9],
            h = e[13],
            l = e[2],
            c = e[6],
            u = e[10],
            d = e[14],
            p = e[3],
            f = e[7],
            m = e[11],
            g = e[15];
          return p * (+r * s * c - n * h * c - r * a * u + i * h * u + n * a * d - i * s * d) + f * (+t * s * d - t * h * u + r * o * u - n * o * d + n * h * l - r * s * l) + m * (+t * h * c - t * a * d - r * o * c + i * o * d + r * a * l - i * h * l) + g * (-n * a * l - t * s * c + t * a * u + n * o * c - i * o * u + i * s * l)
        },
        transpose: function() {
          var e, t = this.elements;
          return e = t[1], t[1] = t[4], t[4] = e, e = t[2], t[2] = t[8], t[8] = e, e = t[6], t[6] = t[9], t[9] = e, e = t[3], t[3] = t[12], t[12] = e, e = t[7], t[7] = t[13], t[13] = e, e = t[11], t[11] = t[14], t[14] = e, this
        },
        flattenToArrayOffset: function(e, t) {
          var i = this.elements;
          return e[t] = i[0], e[t + 1] = i[1], e[t + 2] = i[2], e[t + 3] = i[3], e[t + 4] = i[4], e[t + 5] = i[5], e[t + 6] = i[6], e[t + 7] = i[7], e[t + 8] = i[8], e[t + 9] = i[9], e[t + 10] = i[10], e[t + 11] = i[11], e[t + 12] = i[12], e[t + 13] = i[13], e[t + 14] = i[14], e[t + 15] = i[15], e
        },
        getPosition: function() {
          var e;
          return function() {
            return void(0) === e && (e = new n.Vector3), console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."), e.setFromMatrixColumn(this, 3)
          }
        }(),
        setPosition: function(e) {
          var t = this.elements;
          return t[12] = e.x, t[13] = e.y, t[14] = e.z, this
        },
        getInverse: function(e, t) {
          var i = this.elements,
            n = e.elements,
            r = n[0],
            o = n[1],
            a = n[2],
            s = n[3],
            h = n[4],
            l = n[5],
            c = n[6],
            u = n[7],
            d = n[8],
            p = n[9],
            f = n[10],
            m = n[11],
            g = n[12],
            v = n[13],
            y = n[14],
            b = n[15],
            w = p * y * u - v * f * u + v * c * m - l * y * m - p * c * b + l * f * b,
            _ = g * f * u - d * y * u - g * c * m + h * y * m + d * c * b - h * f * b,
            x = d * v * u - g * p * u + g * l * m - h * v * m - d * l * b + h * p * b,
            M = g * p * c - d * v * c - g * l * f + h * v * f + d * l * y - h * p * y,
            E = r * w + o * _ + a * x + s * M;
          if (0 === E) {
            var S = "THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";
            if (t) {
              throw new Error(S)
            };
            return console.warn(S), this.identity()
          };
          return i[0] = w, i[1] = v * f * s - p * y * s - v * a * m + o * y * m + p * a * b - o * f * b, i[2] = l * y * s - v * c * s + v * a * u - o * y * u - l * a * b + o * c * b, i[3] = p * c * s - l * f * s - p * a * u + o * f * u + l * a * m - o * c * m, i[4] = _, i[5] = d * y * s - g * f * s + g * a * m - r * y * m - d * a * b + r * f * b, i[6] = g * c * s - h * y * s - g * a * u + r * y * u + h * a * b - r * c * b, i[7] = h * f * s - d * c * s + d * a * u - r * f * u - h * a * m + r * c * m, i[8] = x, i[9] = g * p * s - d * v * s - g * o * m + r * v * m + d * o * b - r * p * b, i[10] = h * v * s - g * l * s + g * o * u - r * v * u - h * o * b + r * l * b, i[11] = d * l * s - h * p * s - d * o * u + r * p * u + h * o * m - r * l * m, i[12] = M, i[13] = d * v * a - g * p * a + g * o * f - r * v * f - d * o * y + r * p * y, i[14] = g * l * a - h * v * a - g * o * c + r * v * c + h * o * y - r * l * y, i[15] = h * p * a - d * l * a + d * o * c - r * p * c - h * o * f + r * l * f, this.multiplyScalar(1 / E)
        },
        scale: function(e) {
          var t = this.elements,
            i = e.x,
            n = e.y,
            r = e.z;
          return t[0] *= i, t[4] *= n, t[8] *= r, t[1] *= i, t[5] *= n, t[9] *= r, t[2] *= i, t[6] *= n, t[10] *= r, t[3] *= i, t[7] *= n, t[11] *= r, this
        },
        getMaxScaleOnAxis: function() {
          var e = this.elements,
            t = e[0] * e[0] + e[1] * e[1] + e[2] * e[2],
            i = e[4] * e[4] + e[5] * e[5] + e[6] * e[6],
            n = e[8] * e[8] + e[9] * e[9] + e[10] * e[10];
          return Math.sqrt(Math.max(t, i, n))
        },
        makeTranslation: function(e, t, i) {
          return this["set"](1, 0, 0, e, 0, 1, 0, t, 0, 0, 1, i, 0, 0, 0, 1), this
        },
        makeRotationX: function(e) {
          var t = Math.cos(e),
            i = Math.sin(e);
          return this["set"](1, 0, 0, 0, 0, t, -i, 0, 0, i, t, 0, 0, 0, 0, 1), this
        },
        makeRotationY: function(e) {
          var t = Math.cos(e),
            i = Math.sin(e);
          return this["set"](t, 0, i, 0, 0, 1, 0, 0, -i, 0, t, 0, 0, 0, 0, 1), this
        },
        makeRotationZ: function(e) {
          var t = Math.cos(e),
            i = Math.sin(e);
          return this["set"](t, -i, 0, 0, i, t, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1), this
        },
        makeRotationAxis: function(e, t) {
          var i = Math.cos(t),
            n = Math.sin(t),
            r = 1 - i,
            o = e.x,
            a = e.y,
            s = e.z,
            h = r * o,
            l = r * a;
          return this["set"](h * o + i, h * a - n * s, h * s + n * a, 0, h * a + n * s, l * a + i, l * s - n * o, 0, h * s - n * a, l * s + n * o, r * s * s + i, 0, 0, 0, 0, 1), this
        },
        makeScale: function(e, t, i) {
          return this["set"](e, 0, 0, 0, 0, t, 0, 0, 0, 0, i, 0, 0, 0, 0, 1), this
        },
        compose: function(e, t, i) {
          return this.makeRotationFromQuaternion(t), this.scale(i), this.setPosition(e), this
        },
        decompose: function() {
          var e, t;
          return function(i, r, o) {
            void(0) === e && (e = new n.Vector3), void(0) === t && (t = new n.Matrix4);
            var a = this.elements,
              s = e["set"](a[0], a[1], a[2]).length(),
              h = e["set"](a[4], a[5], a[6]).length(),
              l = e["set"](a[8], a[9], a[10]).length(),
              c = this.determinant();
            0 > c && (s = -s), i.x = a[12], i.y = a[13], i.z = a[14], t.elements["set"](this.elements);
            var u = 1 / s,
              d = 1 / h,
              p = 1 / l;
            return t.elements[0] *= u, t.elements[1] *= u, t.elements[2] *= u, t.elements[4] *= d, t.elements[5] *= d, t.elements[6] *= d, t.elements[8] *= p, t.elements[9] *= p, t.elements[10] *= p, r.setFromRotationMatrix(t), o.x = s, o.y = h, o.z = l, this
          }
        }(),
        makeFrustum: function(e, t, i, n, r, o) {
          var a = this.elements,
            s = 2 * r / (t - e),
            h = 2 * r / (n - i),
            l = (t + e) / (t - e),
            c = (n + i) / (n - i),
            u = -(o + r) / (o - r),
            d = -2 * o * r / (o - r);
          return a[0] = s, a[4] = 0, a[8] = l, a[12] = 0, a[1] = 0, a[5] = h, a[9] = c, a[13] = 0, a[2] = 0, a[6] = 0, a[10] = u, a[14] = d, a[3] = 0, a[7] = 0, a[11] = -1, a[15] = 0, this
        },
        makePerspective: function(e, t, i, r) {
          var o = i * Math.tan(n.Math.degToRad(0.5 * e)),
            a = -o,
            s = a * t,
            h = o * t;
          return this.makeFrustum(s, h, a, o, i, r)
        },
        makeOrthographic: function(e, t, i, n, r, o) {
          var a = this.elements,
            s = 1 / (t - e),
            h = 1 / (i - n),
            l = 1 / (o - r),
            c = (t + e) * s,
            u = (i + n) * h,
            d = (o + r) * l;
          return a[0] = 2 * s, a[4] = 0, a[8] = 0, a[12] = -c, a[1] = 0, a[5] = 2 * h, a[9] = 0, a[13] = -u, a[2] = 0, a[6] = 0, a[10] = -2 * l, a[14] = -d, a[3] = 0, a[7] = 0, a[11] = 0, a[15] = 1, this
        },
        equals: function(e) {
          for (var t = this.elements, i = e.elements, n = 0; 16 > n; n++) {
            if (t[n] !== i[n]) {
              return !1
            }
          };
          return !0
        },
        fromArray: function(e) {
          return this.elements["set"](e), this
        },
        toArray: function() {
          var e = this.elements;
          return [e[0], e[1], e[2], e[3], e[4], e[5], e[6], e[7], e[8], e[9], e[10], e[11], e[12], e[13], e[14], e[15]]
        }
      }, n.Ray = function(e, t) {
        this.origin = void(0) !== e ? e : new n.Vector3, this.direction = void(0) !== t ? t : new n.Vector3
      }, n.Ray.prototype = {
        constructor: n.Ray,
        set: function(e, t) {
          return this.origin.copy(e), this.direction.copy(t), this
        },
        clone: function() {
          return (new this.constructor).copy(this)
        },
        copy: function(e) {
          return this.origin.copy(e.origin), this.direction.copy(e.direction), this
        },
        at: function(e, t) {
          var i = t || new n.Vector3;
          return i.copy(this.direction).multiplyScalar(e).add(this.origin)
        },
        lookAt: function(e) {
          this.direction.copy(e).sub(this.origin).normalize()
        },
        recast: function() {
          var e = new n.Vector3;
          return function(t) {
            return this.origin.copy(this.at(t, e)), this
          }
        }(),
        closestPointToPoint: function(e, t) {
          var i = t || new n.Vector3;
          i.subVectors(e, this.origin);
          var r = i.dot(this.direction);
          return 0 > r ? i.copy(this.origin) : i.copy(this.direction).multiplyScalar(r).add(this.origin)
        },
        distanceToPoint: function(e) {
          return Math.sqrt(this.distanceSqToPoint(e))
        },
        distanceSqToPoint: function() {
          var e = new n.Vector3;
          return function(t) {
            var i = e.subVectors(t, this.origin).dot(this.direction);
            return 0 > i ? this.origin.distanceToSquared(t) : (e.copy(this.direction).multiplyScalar(i).add(this.origin), e.distanceToSquared(t))
          }
        }(),
        distanceSqToSegment: function() {
          var e = new n.Vector3,
            t = new n.Vector3,
            i = new n.Vector3;
          return function(n, r, o, a) {
            e.copy(n).add(r).multiplyScalar(0.5), t.copy(r).sub(n).normalize(), i.copy(this.origin).sub(e);
            var s, h, l, c, u = 0.5 * n.distanceTo(r),
              d = -this.direction.dot(t),
              p = i.dot(this.direction),
              f = -i.dot(t),
              m = i.lengthSq(),
              g = Math.abs(1 - d * d);
            if (g > 0) {
              if (s = d * f - p, h = d * p - f, c = u * g, s >= 0) {
                if (h >= -c) {
                  if (c >= h) {
                    var v = 1 / g;
                    s *= v, h *= v, l = s * (s + d * h + 2 * p) + h * (d * s + h + 2 * f) + m
                  } else {
                    h = u, s = Math.max(0, -(d * h + p)), l = -s * s + h * (h + 2 * f) + m
                  }
                } else {
                  h = -u, s = Math.max(0, -(d * h + p)), l = -s * s + h * (h + 2 * f) + m
                }
              } else {
                -c >= h ? (s = Math.max(0, -(-d * u + p)), h = s > 0 ? -u : Math.min(Math.max(-u, -f), u), l = -s * s + h * (h + 2 * f) + m) : c >= h ? (s = 0, h = Math.min(Math.max(-u, -f), u), l = h * (h + 2 * f) + m) : (s = Math.max(0, -(d * u + p)), h = s > 0 ? u : Math.min(Math.max(-u, -f), u), l = -s * s + h * (h + 2 * f) + m)
              }
            } else {
              h = d > 0 ? -u : u, s = Math.max(0, -(d * h + p)), l = -s * s + h * (h + 2 * f) + m
            };
            return o && o.copy(this.direction).multiplyScalar(s).add(this.origin), a && a.copy(t).multiplyScalar(h).add(e), l
          }
        }(),
        intersectSphere: function() {
          var e = new n.Vector3;
          return function(t, i) {
            e.subVectors(t.center, this.origin);
            var n = e.dot(this.direction),
              r = e.dot(e) - n * n,
              o = t.radius * t.radius;
            if (r > o) {
              return null
            };
            var a = Math.sqrt(o - r),
              s = n - a,
              h = n + a;
            return 0 > s && 0 > h ? null : 0 > s ? this.at(h, i) : this.at(s, i)
          }
        }(),
        intersectsSphere: function(e) {
          return this.distanceToPoint(e.center) <= e.radius
        },
        distanceToPlane: function(e) {
          var t = e.normal.dot(this.direction);
          if (0 === t) {
            return 0 === e.distanceToPoint(this.origin) ? 0 : null
          };
          var i = -(this.origin.dot(e.normal) + e.constant) / t;
          return i >= 0 ? i : null
        },
        intersectPlane: function(e, t) {
          var i = this.distanceToPlane(e);
          return null === i ? null : this.at(i, t)
        },
        intersectsPlane: function(e) {
          var t = e.distanceToPoint(this.origin);
          if (0 === t) {
            return !0
          };
          var i = e.normal.dot(this.direction);
          return 0 > i * t ? !0 : !1
        },
        intersectBox: function(e, t) {
          var i, n, r, o, a, s, h = 1 / this.direction.x,
            l = 1 / this.direction.y,
            c = 1 / this.direction.z,
            u = this.origin;
          return h >= 0 ? (i = (e.min.x - u.x) * h, n = (e.max.x - u.x) * h) : (i = (e.max.x - u.x) * h, n = (e.min.x - u.x) * h), l >= 0 ? (r = (e.min.y - u.y) * l, o = (e.max.y - u.y) * l) : (r = (e.max.y - u.y) * l, o = (e.min.y - u.y) * l), i > o || r > n ? null : ((r > i || i !== i) && (i = r), (n > o || n !== n) && (n = o), c >= 0 ? (a = (e.min.z - u.z) * c, s = (e.max.z - u.z) * c) : (a = (e.max.z - u.z) * c, s = (e.min.z - u.z) * c), i > s || a > n ? null : ((a > i || i !== i) && (i = a), (n > s || n !== n) && (n = s), 0 > n ? null : this.at(i >= 0 ? i : n, t)))
        },
        intersectsBox: function() {
          var e = new n.Vector3;
          return function(t) {
            return null !== this.intersectBox(t, e)
          }
        }(),
        intersectTriangle: function() {
          var e = new n.Vector3,
            t = new n.Vector3,
            i = new n.Vector3,
            r = new n.Vector3;
          return function(n, o, a, s, h) {
            t.subVectors(o, n), i.subVectors(a, n), r.crossVectors(t, i);
            var l, c = this.direction.dot(r);
            if (c > 0) {
              if (s) {
                return null
              };
              l = 1
            } else {
              if (!(0 > c)) {
                return null
              };
              l = -1, c = -c
            };
            e.subVectors(this.origin, n);
            var u = l * this.direction.dot(i.crossVectors(e, i));
            if (0 > u) {
              return null
            };
            var d = l * this.direction.dot(t.cross(e));
            if (0 > d) {
              return null
            };
            if (u + d > c) {
              return null
            };
            var p = -l * e.dot(r);
            return 0 > p ? null : this.at(p / c, h)
          }
        }(),
        applyMatrix4: function(e) {
          return this.direction.add(this.origin).applyMatrix4(e), this.origin.applyMatrix4(e), this.direction.sub(this.origin), this.direction.normalize(), this
        },
        equals: function(e) {
          return e.origin.equals(this.origin) && e.direction.equals(this.direction)
        }
      }, n.Sphere = function(e, t) {
        this.center = void(0) !== e ? e : new n.Vector3, this.radius = void(0) !== t ? t : 0
      }, n.Sphere.prototype = {
        constructor: n.Sphere,
        set: function(e, t) {
          return this.center.copy(e), this.radius = t, this
        },
        setFromPoints: function() {
          var e = new n.Box3;
          return function(t, i) {
            var n = this.center;
            void(0) !== i ? n.copy(i) : e.setFromPoints(t).center(n);
            for (var r = 0, o = 0, a = t.length; a > o; o++) {
              r = Math.max(r, n.distanceToSquared(t[o]))
            };
            return this.radius = Math.sqrt(r), this
          }
        }(),
        clone: function() {
          return (new this.constructor).copy(this)
        },
        copy: function(e) {
          return this.center.copy(e.center), this.radius = e.radius, this
        },
        empty: function() {
          return this.radius <= 0
        },
        containsPoint: function(e) {
          return e.distanceToSquared(this.center) <= this.radius * this.radius
        },
        distanceToPoint: function(e) {
          return e.distanceTo(this.center) - this.radius
        },
        intersectsSphere: function(e) {
          var t = this.radius + e.radius;
          return e.center.distanceToSquared(this.center) <= t * t
        },
        intersectsBox: function(e) {
          return e.intersectsSphere(this)
        },
        intersectsPlane: function(e) {
          return Math.abs(this.center.dot(e.normal) - e.constant) <= this.radius
        },
        clampPoint: function(e, t) {
          var i = this.center.distanceToSquared(e),
            r = t || new n.Vector3;
          return r.copy(e), i > this.radius * this.radius && (r.sub(this.center).normalize(), r.multiplyScalar(this.radius).add(this.center)), r
        },
        getBoundingBox: function(e) {
          var t = e || new n.Box3;
          return t["set"](this.center, this.center), t.expandByScalar(this.radius), t
        },
        applyMatrix4: function(e) {
          return this.center.applyMatrix4(e), this.radius = this.radius * e.getMaxScaleOnAxis(), this
        },
        translate: function(e) {
          return this.center.add(e), this
        },
        equals: function(e) {
          return e.center.equals(this.center) && e.radius === this.radius
        }
      }, n.Frustum = function(e, t, i, r, o, a) {
        this.planes = [void(0) !== e ? e : new n.Plane, void(0) !== t ? t : new n.Plane, void(0) !== i ? i : new n.Plane, void(0) !== r ? r : new n.Plane, void(0) !== o ? o : new n.Plane, void(0) !== a ? a : new n.Plane]
      }, n.Frustum.prototype = {
        constructor: n.Frustum,
        set: function(e, t, i, n, r, o) {
          var a = this.planes;
          return a[0].copy(e), a[1].copy(t), a[2].copy(i), a[3].copy(n), a[4].copy(r), a[5].copy(o), this
        },
        clone: function() {
          return (new this.constructor).copy(this)
        },
        copy: function(e) {
          for (var t = this.planes, i = 0; 6 > i; i++) {
            t[i].copy(e.planes[i])
          };
          return this
        },
        setFromMatrix: function(e) {
          var t = this.planes,
            i = e.elements,
            n = i[0],
            r = i[1],
            o = i[2],
            a = i[3],
            s = i[4],
            h = i[5],
            l = i[6],
            c = i[7],
            u = i[8],
            d = i[9],
            p = i[10],
            f = i[11],
            m = i[12],
            g = i[13],
            v = i[14],
            y = i[15];
          return t[0].setComponents(a - n, c - s, f - u, y - m).normalize(), t[1].setComponents(a + n, c + s, f + u, y + m).normalize(), t[2].setComponents(a + r, c + h, f + d, y + g).normalize(), t[3].setComponents(a - r, c - h, f - d, y - g).normalize(), t[4].setComponents(a - o, c - l, f - p, y - v).normalize(), t[5].setComponents(a + o, c + l, f + p, y + v).normalize(), this
        },
        intersectsObject: function() {
          var e = new n.Sphere;
          return function(t) {
            var i = t.geometry;
            return null === i.boundingSphere && i.computeBoundingSphere(), e.copy(i.boundingSphere), e.applyMatrix4(t.matrixWorld), this.intersectsSphere(e)
          }
        }(),
        intersectsSphere: function(e) {
          for (var t = this.planes, i = e.center, n = -e.radius, r = 0; 6 > r; r++) {
            var o = t[r].distanceToPoint(i);
            if (n > o) {
              return !1
            }
          };
          return !0
        },
        intersectsBox: function() {
          var e = new n.Vector3,
            t = new n.Vector3;
          return function(i) {
            for (var n = this.planes, r = 0; 6 > r; r++) {
              var o = n[r];
              e.x = o.normal.x > 0 ? i.min.x : i.max.x, t.x = o.normal.x > 0 ? i.max.x : i.min.x, e.y = o.normal.y > 0 ? i.min.y : i.max.y, t.y = o.normal.y > 0 ? i.max.y : i.min.y, e.z = o.normal.z > 0 ? i.min.z : i.max.z, t.z = o.normal.z > 0 ? i.max.z : i.min.z;
              var a = o.distanceToPoint(e),
                s = o.distanceToPoint(t);
              if (0 > a && 0 > s) {
                return !1
              }
            };
            return !0
          }
        }(),
        containsPoint: function(e) {
          for (var t = this.planes, i = 0; 6 > i; i++) {
            if (t[i].distanceToPoint(e) < 0) {
              return !1
            }
          };
          return !0
        }
      }, n.Plane = function(e, t) {
        this.normal = void(0) !== e ? e : new n.Vector3(1, 0, 0), this.constant = void(0) !== t ? t : 0
      }, n.Plane.prototype = {
        constructor: n.Plane,
        set: function(e, t) {
          return this.normal.copy(e), this.constant = t, this
        },
        setComponents: function(e, t, i, n) {
          return this.normal["set"](e, t, i), this.constant = n, this
        },
        setFromNormalAndCoplanarPoint: function(e, t) {
          return this.normal.copy(e), this.constant = -t.dot(this.normal), this
        },
        setFromCoplanarPoints: function() {
          var e = new n.Vector3,
            t = new n.Vector3;
          return function(i, n, r) {
            var o = e.subVectors(r, n).cross(t.subVectors(i, n)).normalize();
            return this.setFromNormalAndCoplanarPoint(o, i), this
          }
        }(),
        clone: function() {
          return (new this.constructor).copy(this)
        },
        copy: function(e) {
          return this.normal.copy(e.normal), this.constant = e.constant, this
        },
        normalize: function() {
          var e = 1 / this.normal.length();
          return this.normal.multiplyScalar(e), this.constant *= e, this
        },
        negate: function() {
          return this.constant *= -1, this.normal.negate(), this
        },
        distanceToPoint: function(e) {
          return this.normal.dot(e) + this.constant
        },
        distanceToSphere: function(e) {
          return this.distanceToPoint(e.center) - e.radius
        },
        projectPoint: function(e, t) {
          return this.orthoPoint(e, t).sub(e).negate()
        },
        orthoPoint: function(e, t) {
          var i = this.distanceToPoint(e),
            r = t || new n.Vector3;
          return r.copy(this.normal).multiplyScalar(i)
        },
        intersectLine: function() {
          var e = new n.Vector3;
          return function(t, i) {
            var r = i || new n.Vector3,
              o = t.delta(e),
              a = this.normal.dot(o);
            if (0 === a) {
              return 0 === this.distanceToPoint(t.start) ? r.copy(t.start) : void(0)
            };
            var s = -(t.start.dot(this.normal) + this.constant) / a;
            return 0 > s || s > 1 ? void(0) : r.copy(o).multiplyScalar(s).add(t.start)
          }
        }(),
        intersectsLine: function(e) {
          var t = this.distanceToPoint(e.start),
            i = this.distanceToPoint(e.end);
          return 0 > t && i > 0 || 0 > i && t > 0
        },
        intersectsBox: function(e) {
          return e.intersectsPlane(this)
        },
        intersectsSphere: function(e) {
          return e.intersectsPlane(this)
        },
        coplanarPoint: function(e) {
          var t = e || new n.Vector3;
          return t.copy(this.normal).multiplyScalar(-this.constant)
        },
        applyMatrix4: function() {
          var e = new n.Vector3,
            t = new n.Vector3,
            i = new n.Matrix3;
          return function(n, r) {
            var o = r || i.getNormalMatrix(n),
              a = e.copy(this.normal).applyMatrix3(o),
              s = this.coplanarPoint(t);
            return s.applyMatrix4(n), this.setFromNormalAndCoplanarPoint(a, s), this
          }
        }(),
        translate: function(e) {
          return this.constant = this.constant - e.dot(this.normal), this
        },
        equals: function(e) {
          return e.normal.equals(this.normal) && e.constant === this.constant
        }
      }, n.Spherical = function(e, t, i) {
        return this.radius = void(0) !== e ? e : 1, this.phi = void(0) !== t ? t : 0, this.theta = void(0) !== i ? i : 0, this
      }, n.Spherical.prototype = {
        constructor: n.Spherical,
        set: function(e, t, i) {
          this.radius = e, this.phi = t, this.theta = i
        },
        clone: function() {
          return (new this.constructor).copy(this)
        },
        copy: function(e) {
          return this.radius.copy(e.radius), this.phi.copy(e.phi), this.theta.copy(e.theta), this
        },
        makeSafe: function() {
          var e = 1e-6;
          this.phi = Math.max(e, Math.min(Math.PI - e, this.phi))
        },
        setFromVector3: function(e) {
          return this.radius = e.length(), 0 === this.radius ? (this.theta = 0, this.phi = 0) : (this.theta = Math.atan2(e.x, e.z), this.phi = Math.acos(n.Math.clamp(e.y / this.radius, -1, 1))), this
        }
      }, n.Math = {
        generateUUID: function() {
          var e, t = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),
            i = new Array(36),
            n = 0;
          return function() {
            for (var r = 0; 36 > r; r++) {
              8 === r || 13 === r || 18 === r || 23 === r ? i[r] = "-" : 14 === r ? i[r] = "4" : (2 >= n && (n = 33554432 + 16777216 * Math.random() | 0), e = 15 & n, n >>= 4, i[r] = t[19 === r ? 3 & e | 8 : e])
            };
            return i.join("")
          }
        }(),
        clamp: function(e, t, i) {
          return Math.max(t, Math.min(i, e))
        },
        euclideanModulo: function(e, t) {
          return (e % t + t) % t
        },
        mapLinear: function(e, t, i, n, r) {
          return n + (e - t) * (r - n) / (i - t)
        },
        smoothstep: function(e, t, i) {
          return t >= e ? 0 : e >= i ? 1 : (e = (e - t) / (i - t), e * e * (3 - 2 * e))
        },
        smootherstep: function(e, t, i) {
          return t >= e ? 0 : e >= i ? 1 : (e = (e - t) / (i - t), e * e * e * (e * (6 * e - 15) + 10))
        },
        random16: function() {
          return console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead."), Math.random()
        },
        randInt: function(e, t) {
          return e + Math.floor(Math.random() * (t - e + 1))
        },
        randFloat: function(e, t) {
          return e + Math.random() * (t - e)
        },
        randFloatSpread: function(e) {
          return e * (0.5 - Math.random())
        },
        degToRad: function() {
          var e = Math.PI / 180;
          return function(t) {
            return t * e
          }
        }(),
        radToDeg: function() {
          var e = 180 / Math.PI;
          return function(t) {
            return t * e
          }
        }(),
        isPowerOfTwo: function(e) {
          return 0 === (e & e - 1) && 0 !== e
        },
        nearestPowerOfTwo: function(e) {
          return Math.pow(2, Math.round(Math.log(e) / Math.LN2))
        },
        nextPowerOfTwo: function(e) {
          return e--, e |= e >> 1, e |= e >> 2, e |= e >> 4, e |= e >> 8, e |= e >> 16, e++, e
        }
      }, n.Spline = function(e) {
        function t(e, t, i, n, r, o, a) {
          var s = 0.5 * (i - e),
            h = 0.5 * (n - t);
          return (2 * (t - i) + s + h) * a + (-3 * (t - i) - 2 * s - h) * o + s * r + t
        }
        this.points = e;
        var i, r, o, a, s, h, l, c, u, d = [],
          p = {
            x: 0,
            y: 0,
            z: 0
          };
        this.initFromArray = function(e) {
          this.points = [];
          for (var t = 0; t < e.length; t++) {
            this.points[t] = {
              x: e[t][0],
              y: e[t][1],
              z: e[t][2]
            }
          }
        }, this.getPoint = function(e) {
          return i = (this.points.length - 1) * e, r = Math.floor(i), o = i - r, d[0] = 0 === r ? r : r - 1, d[1] = r, d[2] = r > this.points.length - 2 ? this.points.length - 1 : r + 1, d[3] = r > this.points.length - 3 ? this.points.length - 1 : r + 2, h = this.points[d[0]], l = this.points[d[1]], c = this.points[d[2]], u = this.points[d[3]], a = o * o, s = o * a, p.x = t(h.x, l.x, c.x, u.x, o, a, s), p.y = t(h.y, l.y, c.y, u.y, o, a, s), p.z = t(h.z, l.z, c.z, u.z, o, a, s), p
        }, this.getControlPointsArray = function() {
          var e, t, i = this.points.length,
            n = [];
          for (e = 0; i > e; e++) {
            t = this.points[e], n[e] = [t.x, t.y, t.z]
          };
          return n
        }, this.getLength = function(e) {
          var t, i, r, o, a = 0,
            s = 0,
            h = 0,
            l = new n.Vector3,
            c = new n.Vector3,
            u = [],
            d = 0;
          for (u[0] = 0, e || (e = 100), r = this.points.length * e, l.copy(this.points[0]), t = 1; r > t; t++) {
            i = t / r, o = this.getPoint(i), c.copy(o), d += c.distanceTo(l), l.copy(o), a = (this.points.length - 1) * i, s = Math.floor(a), s !== h && (u[s] = d, h = s)
          };
          return u[u.length] = d, {
            chunks: u,
            total: d
          }
        }, this.reparametrizeByArcLength = function(e) {
          var t, i, r, o, a, s, h, l, c = [],
            u = new n.Vector3,
            d = this.getLength();
          for (c.push(u.copy(this.points[0]).clone()), t = 1; t < this.points.length; t++) {
            for (s = d.chunks[t] - d.chunks[t - 1], h = Math.ceil(e * s / d.total), o = (t - 1) / (this.points.length - 1), a = t / (this.points.length - 1), i = 1; h - 1 > i; i++) {
              r = o + i * (1 / h) * (a - o), l = this.getPoint(r), c.push(u.copy(l).clone())
            };
            c.push(u.copy(this.points[t]).clone())
          };
          this.points = c
        }
      }, n.Triangle = function(e, t, i) {
        this.a = void(0) !== e ? e : new n.Vector3, this.b = void(0) !== t ? t : new n.Vector3, this.c = void(0) !== i ? i : new n.Vector3
      }, n.Triangle.normal = function() {
        var e = new n.Vector3;
        return function(t, i, r, o) {
          var a = o || new n.Vector3;
          a.subVectors(r, i), e.subVectors(t, i), a.cross(e);
          var s = a.lengthSq();
          return s > 0 ? a.multiplyScalar(1 / Math.sqrt(s)) : a["set"](0, 0, 0)
        }
      }(), n.Triangle.barycoordFromPoint = function() {
        var e = new n.Vector3,
          t = new n.Vector3,
          i = new n.Vector3;
        return function(r, o, a, s, h) {
          e.subVectors(s, o), t.subVectors(a, o), i.subVectors(r, o);
          var l = e.dot(e),
            c = e.dot(t),
            u = e.dot(i),
            d = t.dot(t),
            p = t.dot(i),
            f = l * d - c * c,
            m = h || new n.Vector3;
          if (0 === f) {
            return m["set"](-2, -1, -1)
          };
          var g = 1 / f,
            v = (d * u - c * p) * g,
            y = (l * p - c * u) * g;
          return m["set"](1 - v - y, y, v)
        }
      }(), n.Triangle.containsPoint = function() {
        var e = new n.Vector3;
        return function(t, i, r, o) {
          var a = n.Triangle.barycoordFromPoint(t, i, r, o, e);
          return a.x >= 0 && a.y >= 0 && a.x + a.y <= 1
        }
      }(), n.Triangle.prototype = {
        constructor: n.Triangle,
        set: function(e, t, i) {
          return this.a.copy(e), this.b.copy(t), this.c.copy(i), this
        },
        setFromPointsAndIndices: function(e, t, i, n) {
          return this.a.copy(e[t]), this.b.copy(e[i]), this.c.copy(e[n]), this
        },
        clone: function() {
          return (new this.constructor).copy(this)
        },
        copy: function(e) {
          return this.a.copy(e.a), this.b.copy(e.b), this.c.copy(e.c), this
        },
        area: function() {
          var e = new n.Vector3,
            t = new n.Vector3;
          return function() {
            return e.subVectors(this.c, this.b), t.subVectors(this.a, this.b), 0.5 * e.cross(t).length()
          }
        }(),
        midpoint: function(e) {
          var t = e || new n.Vector3;
          return t.addVectors(this.a, this.b).add(this.c).multiplyScalar(1 / 3)
        },
        normal: function(e) {
          return n.Triangle.normal(this.a, this.b, this.c, e)
        },
        plane: function(e) {
          var t = e || new n.Plane;
          return t.setFromCoplanarPoints(this.a, this.b, this.c)
        },
        barycoordFromPoint: function(e, t) {
          return n.Triangle.barycoordFromPoint(e, this.a, this.b, this.c, t)
        },
        containsPoint: function(e) {
          return n.Triangle.containsPoint(e, this.a, this.b, this.c)
        },
        equals: function(e) {
          return e.a.equals(this.a) && e.b.equals(this.b) && e.c.equals(this.c)
        }
      }, n.Interpolant = function(e, t, i, n) {
        this.parameterPositions = e, this._cachedIndex = 0, this.resultBuffer = void(0) !== n ? n : new t.constructor(i), this.sampleValues = t, this.valueSize = i
      }, n.Interpolant.prototype = {
        constructor: n.Interpolant,
        evaluate: function(e) {
          var t = this.parameterPositions,
            i = this._cachedIndex,
            n = t[i],
            r = t[i - 1];
          e: {
            t: {
              var o;i: {
                n: if (!(n > e)) {
                  for (var a = i + 2;;) {
                    if (void(0) === n) {
                      if (r > e) {
                        break n
                      };
                      return i = t.length, this._cachedIndex = i, this.afterEnd_(i - 1, e, r)
                    };
                    if (i === a) {
                      break
                    };
                    if (r = n, n = t[++i], n > e) {
                      break t
                    }
                  };
                  o = t.length;
                  break i
                }; {
                  if (e >= r) {
                    break e
                  };
                  var s = t[1];
                  s > e && (i = 2, r = s);
                  for (var a = i - 2;;) {
                    if (void(0) === r) {
                      return this._cachedIndex = 0, this.beforeStart_(0, e, n)
                    };
                    if (i === a) {
                      break
                    };
                    if (n = r, r = t[--i - 1], e >= r) {
                      break t
                    }
                  };
                  o = i, i = 0
                }
              }
              for (; o > i;) {
                var h = i + o >>> 1;
                e < t[h] ? o = h : i = h + 1
              };
              if (n = t[i], r = t[i - 1], void(0) === r) {
                return this._cachedIndex = 0, this.beforeStart_(0, e, n)
              };
              if (void(0) === n) {
                return i = t.length, this._cachedIndex = i, this.afterEnd_(i - 1, r, e)
              }
            }
            this._cachedIndex = i,
            this.intervalChanged_(i, r, n)
          }
          return this.interpolate_(i, r, e, n)
        },
        settings: null,
        DefaultSettings_: {},
        getSettings_: function() {
          return this.settings || this.DefaultSettings_
        },
        copySampleValue_: function(e) {
          for (var t = this.resultBuffer, i = this.sampleValues, n = this.valueSize, r = e * n, o = 0; o !== n; ++o) {
            t[o] = i[r + o]
          };
          return t
        },
        interpolate_: function(e, t, i, n) {
          throw new Error("call to abstract method")
        },
        intervalChanged_: function(e, t, i) {}
      }, Object.assign(n.Interpolant.prototype, {
        beforeStart_: n.Interpolant.prototype.copySampleValue_,
        afterEnd_: n.Interpolant.prototype.copySampleValue_
      }), n.CubicInterpolant = function(e, t, i, r) {
        n.Interpolant.call(this, e, t, i, r), this._weightPrev = -0, this._offsetPrev = -0, this._weightNext = -0, this._offsetNext = -0
      }, n.CubicInterpolant.prototype = Object.assign(Object.create(n.Interpolant.prototype), {
        constructor: n.CubicInterpolant,
        DefaultSettings_: {
          endingStart: n.ZeroCurvatureEnding,
          endingEnd: n.ZeroCurvatureEnding
        },
        intervalChanged_: function(e, t, i) {
          var r = this.parameterPositions,
            o = e - 2,
            a = e + 1,
            s = r[o],
            h = r[a];
          if (void(0) === s) {
            switch (this.getSettings_().endingStart) {
              case n.ZeroSlopeEnding:
                o = e, s = 2 * t - i;
                break;
              case n.WrapAroundEnding:
                o = r.length - 2, s = t + r[o] - r[o + 1];
                break;
              default:
                o = e, s = i
            }
          };
          if (void(0) === h) {
            switch (this.getSettings_().endingEnd) {
              case n.ZeroSlopeEnding:
                a = e, h = 2 * i - t;
                break;
              case n.WrapAroundEnding:
                a = 1, h = i + r[1] - r[0];
                break;
              default:
                a = e - 1, h = t
            }
          };
          var l = 0.5 * (i - t),
            c = this.valueSize;
          this._weightPrev = l / (t - s), this._weightNext = l / (h - i), this._offsetPrev = o * c, this._offsetNext = a * c
        },
        interpolate_: function(e, t, i, n) {
          for (var r = this.resultBuffer, o = this.sampleValues, a = this.valueSize, s = e * a, h = s - a, l = this._offsetPrev, c = this._offsetNext, u = this._weightPrev, d = this._weightNext, p = (i - t) / (n - t), f = p * p, m = f * p, g = -u * m + 2 * u * f - u * p, v = (1 + u) * m + (-1.5 - 2 * u) * f + (-0.5 + u) * p + 1, y = (-1 - d) * m + (1.5 + d) * f + 0.5 * p, b = d * m - d * f, w = 0; w !== a; ++w) {
            r[w] = g * o[l + w] + v * o[h + w] + y * o[s + w] + b * o[c + w]
          };
          return r
        }
      }), n.DiscreteInterpolant = function(e, t, i, r) {
        n.Interpolant.call(this, e, t, i, r)
      }, n.DiscreteInterpolant.prototype = Object.assign(Object.create(n.Interpolant.prototype), {
        constructor: n.DiscreteInterpolant,
        interpolate_: function(e, t, i, n) {
          return this.copySampleValue_(e - 1)
        }
      }), n.LinearInterpolant = function(e, t, i, r) {
        n.Interpolant.call(this, e, t, i, r)
      }, n.LinearInterpolant.prototype = Object.assign(Object.create(n.Interpolant.prototype), {
        constructor: n.LinearInterpolant,
        interpolate_: function(e, t, i, n) {
          for (var r = this.resultBuffer, o = this.sampleValues, a = this.valueSize, s = e * a, h = s - a, l = (i - t) / (n - t), c = 1 - l, u = 0; u !== a; ++u) {
            r[u] = o[h + u] * c + o[s + u] * l
          };
          return r
        }
      }), n.QuaternionLinearInterpolant = function(e, t, i, r) {
        n.Interpolant.call(this, e, t, i, r)
      }, n.QuaternionLinearInterpolant.prototype = Object.assign(Object.create(n.Interpolant.prototype), {
        constructor: n.QuaternionLinearInterpolant,
        interpolate_: function(e, t, i, r) {
          for (var o = this.resultBuffer, a = this.sampleValues, s = this.valueSize, h = e * s, l = (i - t) / (r - t), c = h + s; h !== c; h += 4) {
            n.Quaternion.slerpFlat(o, 0, a, h - s, a, h, l)
          };
          return o
        }
      }), n.Clock = function(e) {
        this.autoStart = void(0) !== e ? e : !0, this.startTime = 0, this.oldTime = 0, this.elapsedTime = 0, this.running = !1
      }, n.Clock.prototype = {
        constructor: n.Clock,
        start: function() {
          this.startTime = performance.now(), this.oldTime = this.startTime, this.running = !0
        },
        stop: function() {
          this.getElapsedTime(), this.running = !1
        },
        getElapsedTime: function() {
          return this.getDelta(), this.elapsedTime
        },
        getDelta: function() {
          var e = 0;
          if (this.autoStart && !this.running && this.start(), this.running) {
            var t = performance.now();
            e = 0.001 * (t - this.oldTime), this.oldTime = t, this.elapsedTime += e
          };
          return e
        }
      }, n.EventDispatcher = function() {}, n.EventDispatcher.prototype = {
        constructor: n.EventDispatcher,
        apply: function(e) {
          e.addEventListener = n.EventDispatcher.prototype.addEventListener, e.hasEventListener = n.EventDispatcher.prototype.hasEventListener, e.removeEventListener = n.EventDispatcher.prototype.removeEventListener, e.dispatchEvent = n.EventDispatcher.prototype.dispatchEvent
        },
        addEventListener: function(e, t) {
          void(0) === this._listeners && (this._listeners = {});
          var i = this._listeners;
          void(0) === i[e] && (i[e] = []), -1 === i[e].indexOf(t) && i[e].push(t)
        },
        hasEventListener: function(e, t) {
          if (void(0) === this._listeners) {
            return !1
          };
          var i = this._listeners;
          return void(0) !== i[e] && -1 !== i[e].indexOf(t) ? !0 : !1
        },
        removeEventListener: function(e, t) {
          if (void(0) !== this._listeners) {
            var i = this._listeners,
              n = i[e];
            if (void(0) !== n) {
              var r = n.indexOf(t); - 1 !== r && n.splice(r, 1)
            }
          }
        },
        dispatchEvent: function(e) {
          if (void(0) !== this._listeners) {
            var t = this._listeners,
              i = t[e.type];
            if (void(0) !== i) {
              e.target = this;
              for (var n = [], r = i.length, o = 0; r > o; o++) {
                n[o] = i[o]
              };
              for (var o = 0; r > o; o++) {
                n[o].call(this, e)
              }
            }
          }
        }
      }, n.Layers = function() {
        this.mask = 1
      }, n.Layers.prototype = {
        constructor: n.Layers,
        set: function(e) {
          this.mask = 1 << e
        },
        enable: function(e) {
          this.mask |= 1 << e
        },
        toggle: function(e) {
          this.mask ^= 1 << e
        },
        disable: function(e) {
          this.mask &= ~(1 << e)
        },
        test: function(e) {
          return 0 !== (this.mask & e.mask)
        }
      },
      function(e) {
        function t(e, t) {
          return e.distance - t.distance
        }

        function i(e, t, n, r) {
          if (e.visible !== !1 && (e.raycast(t, n), r === !0)) {
            for (var o = e.children, a = 0, s = o.length; s > a; a++) {
              i(o[a], t, n, !0)
            }
          }
        }
        e.Raycaster = function(t, i, n, r) {
          this.ray = new e.Ray(t, i), this.near = n || 0, this.far = r || 1 / 0, this.params = {
            Mesh: {},
            Line: {},
            LOD: {},
            Points: {
              threshold: 1
            },
            Sprite: {}
          }, Object.defineProperties(this.params, {
            PointCloud: {
              get: function() {
                return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."), this.Points
              }
            }
          })
        }, e.Raycaster.prototype = {
          constructor: e.Raycaster,
          linePrecision: 1,
          set: function(e, t) {
            this.ray["set"](e, t)
          },
          setFromCamera: function(t, i) {
            i instanceof e.PerspectiveCamera ? (this.ray.origin.setFromMatrixPosition(i.matrixWorld), this.ray.direction["set"](t.x, t.y, 0.5).unproject(i).sub(this.ray.origin).normalize()) : i instanceof e.OrthographicCamera ? (this.ray.origin["set"](t.x, t.y, -1).unproject(i), this.ray.direction["set"](0, 0, -1).transformDirection(i.matrixWorld)) : console.error("THREE.Raycaster: Unsupported camera type.")
          },
          intersectObject: function(e, n) {
            var r = [];
            return i(e, this, r, n), r.sort(t), r
          },
          intersectObjects: function(e, n) {
            var r = [];
            if (Array.isArray(e) === !1) {
              return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."), r
            };
            for (var o = 0, a = e.length; a > o; o++) {
              i(e[o], this, r, n)
            };
            return r.sort(t), r
          }
        }
      }(n), n.Object3D = function() {
        function e() {
          o.setFromEuler(r, !1)
        }

        function t() {
          r.setFromQuaternion(o, void(0), !1)
        }
        Object.defineProperty(this, "id", {
          value: n.Object3DIdCount++
        }), this.uuid = n.Math.generateUUID(), this.name = "", this.type = "Object3D", this.parent = null, this.children = [], this.up = n.Object3D.DefaultUp.clone();
        var i = new n.Vector3,
          r = new n.Euler,
          o = new n.Quaternion,
          a = new n.Vector3(1, 1, 1);
        r.onChange(e), o.onChange(t), Object.defineProperties(this, {
          position: {
            enumerable: !0,
            value: i
          },
          rotation: {
            enumerable: !0,
            value: r
          },
          quaternion: {
            enumerable: !0,
            value: o
          },
          scale: {
            enumerable: !0,
            value: a
          },
          modelViewMatrix: {
            value: new n.Matrix4
          },
          normalMatrix: {
            value: new n.Matrix3
          }
        }), this.rotationAutoUpdate = !0, this.matrix = new n.Matrix4, this.matrixWorld = new n.Matrix4, this.matrixAutoUpdate = n.Object3D.DefaultMatrixAutoUpdate, this.matrixWorldNeedsUpdate = !1, this.layers = new n.Layers, this.visible = !0, this.castShadow = !1, this.receiveShadow = !1, this.frustumCulled = !0, this.renderOrder = 0, this.userData = {}
      }, n.Object3D.DefaultUp = new n.Vector3(0, 1, 0), n.Object3D.DefaultMatrixAutoUpdate = !0, n.Object3D.prototype = {
        constructor: n.Object3D,
        applyMatrix: function(e) {
          this.matrix.multiplyMatrices(e, this.matrix), this.matrix.decompose(this.position, this.quaternion, this.scale)
        },
        setRotationFromAxisAngle: function(e, t) {
          this.quaternion.setFromAxisAngle(e, t)
        },
        setRotationFromEuler: function(e) {
          this.quaternion.setFromEuler(e, !0)
        },
        setRotationFromMatrix: function(e) {
          this.quaternion.setFromRotationMatrix(e)
        },
        setRotationFromQuaternion: function(e) {
          this.quaternion.copy(e)
        },
        rotateOnAxis: function() {
          var e = new n.Quaternion;
          return function(t, i) {
            return e.setFromAxisAngle(t, i), this.quaternion.multiply(e), this
          }
        }(),
        rotateX: function() {
          var e = new n.Vector3(1, 0, 0);
          return function(t) {
            return this.rotateOnAxis(e, t)
          }
        }(),
        rotateY: function() {
          var e = new n.Vector3(0, 1, 0);
          return function(t) {
            return this.rotateOnAxis(e, t)
          }
        }(),
        rotateZ: function() {
          var e = new n.Vector3(0, 0, 1);
          return function(t) {
            return this.rotateOnAxis(e, t)
          }
        }(),
        translateOnAxis: function() {
          var e = new n.Vector3;
          return function(t, i) {
            return e.copy(t).applyQuaternion(this.quaternion), this.position.add(e.multiplyScalar(i)), this
          }
        }(),
        translateX: function() {
          var e = new n.Vector3(1, 0, 0);
          return function(t) {
            return this.translateOnAxis(e, t)
          }
        }(),
        translateY: function() {
          var e = new n.Vector3(0, 1, 0);
          return function(t) {
            return this.translateOnAxis(e, t)
          }
        }(),
        translateZ: function() {
          var e = new n.Vector3(0, 0, 1);
          return function(t) {
            return this.translateOnAxis(e, t)
          }
        }(),
        localToWorld: function(e) {
          return e.applyMatrix4(this.matrixWorld)
        },
        worldToLocal: function() {
          var e = new n.Matrix4;
          return function(t) {
            return t.applyMatrix4(e.getInverse(this.matrixWorld))
          }
        }(),
        lookAt: function() {
          var e = new n.Matrix4;
          return function(t) {
            e.lookAt(t, this.position, this.up), this.quaternion.setFromRotationMatrix(e)
          }
        }(),
        add: function(e) {
          if (arguments.length > 1) {
            for (var t = 0; t < arguments.length; t++) {
              this.add(arguments[t])
            };
            return this
          };
          return e === this ? (console.error("THREE.Object3D.add: object can't be added as a child of itself.", e), this) : (e instanceof n.Object3D ? (null !== e.parent && e.parent.remove(e), e.parent = this, e.dispatchEvent({
            type: "added"
          }), this.children.push(e)) : console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.", e), this)
        },
        remove: function(e) {
          if (arguments.length > 1) {
            for (var t = 0; t < arguments.length; t++) {
              this.remove(arguments[t])
            }
          };
          var i = this.children.indexOf(e); - 1 !== i && (e.parent = null, e.dispatchEvent({
            type: "removed"
          }), this.children.splice(i, 1))
        },
        getObjectById: function(e) {
          return this.getObjectByProperty("id", e)
        },
        getObjectByName: function(e) {
          return this.getObjectByProperty("name", e)
        },
        getObjectByProperty: function(e, t) {
          if (this[e] === t) {
            return this
          };
          for (var i = 0, n = this.children.length; n > i; i++) {
            var r = this.children[i],
              o = r.getObjectByProperty(e, t);
            if (void(0) !== o) {
              return o
            }
          };
          return void(0)
        },
        getWorldPosition: function(e) {
          var t = e || new n.Vector3;
          return this.updateMatrixWorld(!0), t.setFromMatrixPosition(this.matrixWorld)
        },
        getWorldQuaternion: function() {
          var e = new n.Vector3,
            t = new n.Vector3;
          return function(i) {
            var r = i || new n.Quaternion;
            return this.updateMatrixWorld(!0), this.matrixWorld.decompose(e, r, t), r
          }
        }(),
        getWorldRotation: function() {
          var e = new n.Quaternion;
          return function(t) {
            var i = t || new n.Euler;
            return this.getWorldQuaternion(e), i.setFromQuaternion(e, this.rotation.order, !1)
          }
        }(),
        getWorldScale: function() {
          var e = new n.Vector3,
            t = new n.Quaternion;
          return function(i) {
            var r = i || new n.Vector3;
            return this.updateMatrixWorld(!0), this.matrixWorld.decompose(e, t, r), r
          }
        }(),
        getWorldDirection: function() {
          var e = new n.Quaternion;
          return function(t) {
            var i = t || new n.Vector3;
            return this.getWorldQuaternion(e), i["set"](0, 0, 1).applyQuaternion(e)
          }
        }(),
        raycast: function() {},
        traverse: function(e) {
          e(this);
          for (var t = this.children, i = 0, n = t.length; n > i; i++) {
            t[i].traverse(e)
          }
        },
        traverseVisible: function(e) {
          if (this.visible !== !1) {
            e(this);
            for (var t = this.children, i = 0, n = t.length; n > i; i++) {
              t[i].traverseVisible(e)
            }
          }
        },
        traverseAncestors: function(e) {
          var t = this.parent;
          null !== t && (e(t), t.traverseAncestors(e))
        },
        updateMatrix: function() {
          this.matrix.compose(this.position, this.quaternion, this.scale), this.matrixWorldNeedsUpdate = !0
        },
        updateMatrixWorld: function(e) {
          this.matrixAutoUpdate === !0 && this.updateMatrix(), (this.matrixWorldNeedsUpdate === !0 || e === !0) && (null === this.parent ? this.matrixWorld.copy(this.matrix) : this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.matrix), this.matrixWorldNeedsUpdate = !1, e = !0);
          for (var t = 0, i = this.children.length; i > t; t++) {
            this.children[t].updateMatrixWorld(e)
          }
        },
        toJSON: function(e) {
          function t(e) {
            var t = [];
            for (var i in e) {
              var n = e[i];
              delete n.metadata, t.push(n)
            };
            return t
          }
          var i = void(0) === e,
            n = {};
          i && (e = {
            geometries: {},
            materials: {},
            textures: {},
            images: {}
          }, n.metadata = {
            version: 4.4,
            type: "Object",
            generator: "Object3D.toJSON"
          });
          var r = {};
          if (r.uuid = this.uuid, r.type = this.type, "" !== this.name && (r.name = this.name), "{}" !== JSON.stringify(this.userData) && (r.userData = this.userData), this.castShadow === !0 && (r.castShadow = !0), this.receiveShadow === !0 && (r.receiveShadow = !0), this.visible === !1 && (r.visible = !1), r.matrix = this.matrix.toArray(), void(0) !== this.geometry && (void(0) === e.geometries[this.geometry.uuid] && (e.geometries[this.geometry.uuid] = this.geometry.toJSON(e)), r.geometry = this.geometry.uuid), void(0) !== this.material && (void(0) === e.materials[this.material.uuid] && (e.materials[this.material.uuid] = this.material.toJSON(e)), r.material = this.material.uuid), this.children.length > 0) {
            r.children = [];
            for (var o = 0; o < this.children.length; o++) {
              r.children.push(this.children[o].toJSON(e).object)
            }
          };
          if (i) {
            var a = t(e.geometries),
              s = t(e.materials),
              h = t(e.textures),
              l = t(e.images);
            a.length > 0 && (n.geometries = a), s.length > 0 && (n.materials = s), h.length > 0 && (n.textures = h), l.length > 0 && (n.images = l)
          };
          return n.object = r, n
        },
        clone: function(e) {
          return (new this.constructor).copy(this, e)
        },
        copy: function(e, t) {
          if (void(0) === t && (t = !0), this.name = e.name, this.up.copy(e.up), this.position.copy(e.position), this.quaternion.copy(e.quaternion), this.scale.copy(e.scale), this.rotationAutoUpdate = e.rotationAutoUpdate, this.matrix.copy(e.matrix), this.matrixWorld.copy(e.matrixWorld), this.matrixAutoUpdate = e.matrixAutoUpdate, this.matrixWorldNeedsUpdate = e.matrixWorldNeedsUpdate, this.visible = e.visible, this.castShadow = e.castShadow, this.receiveShadow = e.receiveShadow, this.frustumCulled = e.frustumCulled, this.renderOrder = e.renderOrder, this.userData = JSON.parse(JSON.stringify(e.userData)), t === !0) {
            for (var i = 0; i < e.children.length; i++) {
              var n = e.children[i];
              this.add(n.clone())
            }
          };
          return this
        }
      }, n.EventDispatcher.prototype.apply(n.Object3D.prototype), n.Object3DIdCount = 0, n.Face3 = function(e, t, i, r, o, a) {
        this.a = e, this.b = t, this.c = i, this.normal = r instanceof n.Vector3 ? r : new n.Vector3, this.vertexNormals = Array.isArray(r) ? r : [], this.color = o instanceof n.Color ? o : new n.Color, this.vertexColors = Array.isArray(o) ? o : [], this.materialIndex = void(0) !== a ? a : 0
      }, n.Face3.prototype = {
        constructor: n.Face3,
        clone: function() {
          return (new this.constructor).copy(this)
        },
        copy: function(e) {
          this.a = e.a, this.b = e.b, this.c = e.c, this.normal.copy(e.normal), this.color.copy(e.color), this.materialIndex = e.materialIndex;
          for (var t = 0, i = e.vertexNormals.length; i > t; t++) {
            this.vertexNormals[t] = e.vertexNormals[t].clone()
          };
          for (var t = 0, i = e.vertexColors.length; i > t; t++) {
            this.vertexColors[t] = e.vertexColors[t].clone()
          };
          return this
        }
      }, n.BufferAttribute = function(e, t) {
        this.uuid = n.Math.generateUUID(), this.array = e, this.itemSize = t, this.dynamic = !1, this.updateRange = {
          offset: 0,
          count: -1
        }, this.version = 0
      }, n.BufferAttribute.prototype = {
        constructor: n.BufferAttribute,
        get count() {
          return this.array.length / this.itemSize
        },
        set needsUpdate(e) {
          e === !0 && this.version++
        },
        setDynamic: function(e) {
          return this.dynamic = e, this
        },
        copy: function(e) {
          return this.array = new e.array.constructor(e.array), this.itemSize = e.itemSize, this.dynamic = e.dynamic, this
        },
        copyAt: function(e, t, i) {
          e *= this.itemSize, i *= t.itemSize;
          for (var n = 0, r = this.itemSize; r > n; n++) {
            this.array[e + n] = t.array[i + n]
          };
          return this
        },
        copyArray: function(e) {
          return this.array["set"](e), this
        },
        copyColorsArray: function(e) {
          for (var t = this.array, i = 0, r = 0, o = e.length; o > r; r++) {
            var a = e[r];
            void(0) === a && (console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined", r), a = new n.Color), t[i++] = a.r, t[i++] = a.g, t[i++] = a.b
          };
          return this
        },
        copyIndicesArray: function(e) {
          for (var t = this.array, i = 0, n = 0, r = e.length; r > n; n++) {
            var o = e[n];
            t[i++] = o.a, t[i++] = o.b, t[i++] = o.c
          };
          return this
        },
        copyVector2sArray: function(e) {
          for (var t = this.array, i = 0, r = 0, o = e.length; o > r; r++) {
            var a = e[r];
            void(0) === a && (console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined", r), a = new n.Vector2), t[i++] = a.x, t[i++] = a.y
          };
          return this
        },
        copyVector3sArray: function(e) {
          for (var t = this.array, i = 0, r = 0, o = e.length; o > r; r++) {
            var a = e[r];
            void(0) === a && (console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined", r), a = new n.Vector3), t[i++] = a.x, t[i++] = a.y, t[i++] = a.z
          };
          return this
        },
        copyVector4sArray: function(e) {
          for (var t = this.array, i = 0, r = 0, o = e.length; o > r; r++) {
            var a = e[r];
            void(0) === a && (console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined", r), a = new n.Vector4), t[i++] = a.x, t[i++] = a.y, t[i++] = a.z, t[i++] = a.w
          };
          return this
        },
        set: function(e, t) {
          return void(0) === t && (t = 0), this.array["set"](e, t), this
        },
        getX: function(e) {
          return this.array[e * this.itemSize]
        },
        setX: function(e, t) {
          return this.array[e * this.itemSize] = t, this
        },
        getY: function(e) {
          return this.array[e * this.itemSize + 1]
        },
        setY: function(e, t) {
          return this.array[e * this.itemSize + 1] = t, this
        },
        getZ: function(e) {
          return this.array[e * this.itemSize + 2]
        },
        setZ: function(e, t) {
          return this.array[e * this.itemSize + 2] = t, this
        },
        getW: function(e) {
          return this.array[e * this.itemSize + 3]
        },
        setW: function(e, t) {
          return this.array[e * this.itemSize + 3] = t, this
        },
        setXY: function(e, t, i) {
          return e *= this.itemSize, this.array[e + 0] = t, this.array[e + 1] = i, this
        },
        setXYZ: function(e, t, i, n) {
          return e *= this.itemSize, this.array[e + 0] = t, this.array[e + 1] = i, this.array[e + 2] = n, this
        },
        setXYZW: function(e, t, i, n, r) {
          return e *= this.itemSize, this.array[e + 0] = t, this.array[e + 1] = i, this.array[e + 2] = n, this.array[e + 3] = r, this
        },
        clone: function() {
          return (new this.constructor).copy(this)
        }
      }, n.Int8Attribute = function(e, t) {
        return new n.BufferAttribute(new Int8Array(e), t)
      }, n.Uint8Attribute = function(e, t) {
        return new n.BufferAttribute(new Uint8Array(e), t)
      }, n.Uint8ClampedAttribute = function(e, t) {
        return new n.BufferAttribute(new Uint8ClampedArray(e), t)
      }, n.Int16Attribute = function(e, t) {
        return new n.BufferAttribute(new Int16Array(e), t)
      }, n.Uint16Attribute = function(e, t) {
        return new n.BufferAttribute(new Uint16Array(e), t)
      }, n.Int32Attribute = function(e, t) {
        return new n.BufferAttribute(new Int32Array(e), t)
      }, n.Uint32Attribute = function(e, t) {
        return new n.BufferAttribute(new Uint32Array(e), t)
      }, n.Float32Attribute = function(e, t) {
        return new n.BufferAttribute(new Float32Array(e), t)
      }, n.Float64Attribute = function(e, t) {
        return new n.BufferAttribute(new Float64Array(e), t)
      }, n.DynamicBufferAttribute = function(e, t) {
        return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."), new n.BufferAttribute(e, t).setDynamic(!0)
      }, n.InstancedBufferAttribute = function(e, t, i) {
        n.BufferAttribute.call(this, e, t), this.meshPerAttribute = i || 1
      }, n.InstancedBufferAttribute.prototype = Object.create(n.BufferAttribute.prototype), n.InstancedBufferAttribute.prototype.constructor = n.InstancedBufferAttribute, n.InstancedBufferAttribute.prototype.copy = function(e) {
        return n.BufferAttribute.prototype.copy.call(this, e), this.meshPerAttribute = e.meshPerAttribute, this
      }, n.InterleavedBuffer = function(e, t) {
        this.uuid = n.Math.generateUUID(), this.array = e, this.stride = t, this.dynamic = !1, this.updateRange = {
          offset: 0,
          count: -1
        }, this.version = 0
      }, n.InterleavedBuffer.prototype = {
        constructor: n.InterleavedBuffer,
        get length() {
          return this.array.length
        },
        get count() {
          return this.array.length / this.stride
        },
        set needsUpdate(e) {
          e === !0 && this.version++
        },
        setDynamic: function(e) {
          return this.dynamic = e, this
        },
        copy: function(e) {
          return this.array = new e.array.constructor(e.array), this.stride = e.stride, this.dynamic = e.dynamic, this
        },
        copyAt: function(e, t, i) {
          e *= this.stride, i *= t.stride;
          for (var n = 0, r = this.stride; r > n; n++) {
            this.array[e + n] = t.array[i + n]
          };
          return this
        },
        set: function(e, t) {
          return void(0) === t && (t = 0), this.array["set"](e, t), this
        },
        clone: function() {
          return (new this.constructor).copy(this)
        }
      }, n.InstancedInterleavedBuffer = function(e, t, i) {
        n.InterleavedBuffer.call(this, e, t), this.meshPerAttribute = i || 1
      }, n.InstancedInterleavedBuffer.prototype = Object.create(n.InterleavedBuffer.prototype), n.InstancedInterleavedBuffer.prototype.constructor = n.InstancedInterleavedBuffer, n.InstancedInterleavedBuffer.prototype.copy = function(e) {
        return n.InterleavedBuffer.prototype.copy.call(this, e), this.meshPerAttribute = e.meshPerAttribute, this
      }, n.InterleavedBufferAttribute = function(e, t, i) {
        this.uuid = n.Math.generateUUID(), this.data = e, this.itemSize = t, this.offset = i
      }, n.InterleavedBufferAttribute.prototype = {
        constructor: n.InterleavedBufferAttribute,
        get length() {
          return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."), this.array.length
        },
        get count() {
          return this.data.count
        },
        setX: function(e, t) {
          return this.data.array[e * this.data.stride + this.offset] = t, this
        },
        setY: function(e, t) {
          return this.data.array[e * this.data.stride + this.offset + 1] = t, this
        },
        setZ: function(e, t) {
          return this.data.array[e * this.data.stride + this.offset + 2] = t, this
        },
        setW: function(e, t) {
          return this.data.array[e * this.data.stride + this.offset + 3] = t, this
        },
        getX: function(e) {
          return this.data.array[e * this.data.stride + this.offset]
        },
        getY: function(e) {
          return this.data.array[e * this.data.stride + this.offset + 1]
        },
        getZ: function(e) {
          return this.data.array[e * this.data.stride + this.offset + 2]
        },
        getW: function(e) {
          return this.data.array[e * this.data.stride + this.offset + 3]
        },
        setXY: function(e, t, i) {
          return e = e * this.data.stride + this.offset, this.data.array[e + 0] = t, this.data.array[e + 1] = i, this
        },
        setXYZ: function(e, t, i, n) {
          return e = e * this.data.stride + this.offset, this.data.array[e + 0] = t, this.data.array[e + 1] = i, this.data.array[e + 2] = n, this
        },
        setXYZW: function(e, t, i, n, r) {
          return e = e * this.data.stride + this.offset, this.data.array[e + 0] = t, this.data.array[e + 1] = i, this.data.array[e + 2] = n, this.data.array[e + 3] = r, this
        }
      }, n.Geometry = function() {
        Object.defineProperty(this, "id", {
          value: n.GeometryIdCount++
        }), this.uuid = n.Math.generateUUID(), this.name = "", this.type = "Geometry", this.vertices = [], this.colors = [], this.faces = [], this.faceVertexUvs = [
          []
        ], this.morphTargets = [], this.morphNormals = [], this.skinWeights = [], this.skinIndices = [], this.lineDistances = [], this.boundingBox = null, this.boundingSphere = null, this.verticesNeedUpdate = !1, this.elementsNeedUpdate = !1, this.uvsNeedUpdate = !1, this.normalsNeedUpdate = !1, this.colorsNeedUpdate = !1, this.lineDistancesNeedUpdate = !1, this.groupsNeedUpdate = !1
      }, n.Geometry.prototype = {
        constructor: n.Geometry,
        applyMatrix: function(e) {
          for (var t = (new n.Matrix3).getNormalMatrix(e), i = 0, r = this.vertices.length; r > i; i++) {
            var o = this.vertices[i];
            o.applyMatrix4(e)
          };
          for (var i = 0, r = this.faces.length; r > i; i++) {
            var a = this.faces[i];
            a.normal.applyMatrix3(t).normalize();
            for (var s = 0, h = a.vertexNormals.length; h > s; s++) {
              a.vertexNormals[s].applyMatrix3(t).normalize()
            }
          };
          return null !== this.boundingBox && this.computeBoundingBox(), null !== this.boundingSphere && this.computeBoundingSphere(), this.verticesNeedUpdate = !0, this.normalsNeedUpdate = !0, this
        },
        rotateX: function() {
          var e;
          return function(t) {
            return void(0) === e && (e = new n.Matrix4), e.makeRotationX(t), this.applyMatrix(e), this
          }
        }(),
        rotateY: function() {
          var e;
          return function(t) {
            return void(0) === e && (e = new n.Matrix4), e.makeRotationY(t), this.applyMatrix(e), this
          }
        }(),
        rotateZ: function() {
          var e;
          return function(t) {
            return void(0) === e && (e = new n.Matrix4), e.makeRotationZ(t), this.applyMatrix(e), this
          }
        }(),
        translate: function() {
          var e;
          return function(t, i, r) {
            return void(0) === e && (e = new n.Matrix4), e.makeTranslation(t, i, r), this.applyMatrix(e), this
          }
        }(),
        scale: function() {
          var e;
          return function(t, i, r) {
            return void(0) === e && (e = new n.Matrix4), e.makeScale(t, i, r), this.applyMatrix(e), this
          }
        }(),
        lookAt: function() {
          var e;
          return function(t) {
            void(0) === e && (e = new n.Object3D), e.lookAt(t), e.updateMatrix(), this.applyMatrix(e.matrix)
          }
        }(),
        fromBufferGeometry: function(e) {
          function t(e, t, r, o) {
            var a = void(0) !== s ? [u[e].clone(), u[t].clone(), u[r].clone()] : [],
              f = void(0) !== h ? [i.colors[e].clone(), i.colors[t].clone(), i.colors[r].clone()] : [],
              m = new n.Face3(e, t, r, a, f, o);
            i.faces.push(m), void(0) !== l && i.faceVertexUvs[0].push([d[e].clone(), d[t].clone(), d[r].clone()]), void(0) !== c && i.faceVertexUvs[1].push([p[e].clone(), p[t].clone(), p[r].clone()])
          }
          var i = this,
            r = null !== e.index ? e.index.array : void(0),
            o = e.attributes,
            a = o.position.array,
            s = void(0) !== o.normal ? o.normal.array : void(0),
            h = void(0) !== o.color ? o.color.array : void(0),
            l = void(0) !== o.uv ? o.uv.array : void(0),
            c = void(0) !== o.uv2 ? o.uv2.array : void(0);
          void(0) !== c && (this.faceVertexUvs[1] = []);
          for (var u = [], d = [], p = [], f = 0, m = 0; f < a.length; f += 3, m += 2) {
            i.vertices.push(new n.Vector3(a[f], a[f + 1], a[f + 2])), void(0) !== s && u.push(new n.Vector3(s[f], s[f + 1], s[f + 2])), void(0) !== h && i.colors.push(new n.Color(h[f], h[f + 1], h[f + 2])), void(0) !== l && d.push(new n.Vector2(l[m], l[m + 1])), void(0) !== c && p.push(new n.Vector2(c[m], c[m + 1]))
          };
          if (void(0) !== r) {
            var g = e.groups;
            if (g.length > 0) {
              for (var f = 0; f < g.length; f++) {
                for (var v = g[f], y = v.start, b = v.count, m = y, w = y + b; w > m; m += 3) {
                  t(r[m], r[m + 1], r[m + 2], v.materialIndex)
                }
              }
            } else {
              for (var f = 0; f < r.length; f += 3) {
                t(r[f], r[f + 1], r[f + 2])
              }
            }
          } else {
            for (var f = 0; f < a.length / 3; f += 3) {
              t(f, f + 1, f + 2)
            }
          };
          return this.computeFaceNormals(), null !== e.boundingBox && (this.boundingBox = e.boundingBox.clone()), null !== e.boundingSphere && (this.boundingSphere = e.boundingSphere.clone()), this
        },
        center: function() {
          this.computeBoundingBox();
          var e = this.boundingBox.center().negate();
          return this.translate(e.x, e.y, e.z), e
        },
        normalize: function() {
          this.computeBoundingSphere();
          var e = this.boundingSphere.center,
            t = this.boundingSphere.radius,
            i = 0 === t ? 1 : 1 / t,
            r = new n.Matrix4;
          return r["set"](i, 0, 0, -i * e.x, 0, i, 0, -i * e.y, 0, 0, i, -i * e.z, 0, 0, 0, 1), this.applyMatrix(r), this
        },
        computeFaceNormals: function() {
          for (var e = new n.Vector3, t = new n.Vector3, i = 0, r = this.faces.length; r > i; i++) {
            var o = this.faces[i],
              a = this.vertices[o.a],
              s = this.vertices[o.b],
              h = this.vertices[o.c];
            e.subVectors(h, s), t.subVectors(a, s), e.cross(t), e.normalize(), o.normal.copy(e)
          }
        },
        computeVertexNormals: function(e) {
          void(0) === e && (e = !0);
          var t, i, r, o, a, s;
          for (s = new Array(this.vertices.length), t = 0, i = this.vertices.length; i > t; t++) {
            s[t] = new n.Vector3
          };
          if (e) {
            var h, l, c, u = new n.Vector3,
              d = new n.Vector3;
            for (r = 0, o = this.faces.length; o > r; r++) {
              a = this.faces[r], h = this.vertices[a.a], l = this.vertices[a.b], c = this.vertices[a.c], u.subVectors(c, l), d.subVectors(h, l), u.cross(d), s[a.a].add(u), s[a.b].add(u), s[a.c].add(u)
            }
          } else {
            for (r = 0, o = this.faces.length; o > r; r++) {
              a = this.faces[r], s[a.a].add(a.normal), s[a.b].add(a.normal), s[a.c].add(a.normal)
            }
          };
          for (t = 0, i = this.vertices.length; i > t; t++) {
            s[t].normalize()
          };
          for (r = 0, o = this.faces.length; o > r; r++) {
            a = this.faces[r];
            var p = a.vertexNormals;
            3 === p.length ? (p[0].copy(s[a.a]), p[1].copy(s[a.b]), p[2].copy(s[a.c])) : (p[0] = s[a.a].clone(), p[1] = s[a.b].clone(), p[2] = s[a.c].clone())
          };
          this.faces.length > 0 && (this.normalsNeedUpdate = !0)
        },
        computeMorphNormals: function() {
          var e, t, i, r, o;
          for (i = 0, r = this.faces.length; r > i; i++) {
            for (o = this.faces[i], o.__originalFaceNormal ? o.__originalFaceNormal.copy(o.normal) : o.__originalFaceNormal = o.normal.clone(), o.__originalVertexNormals || (o.__originalVertexNormals = []), e = 0, t = o.vertexNormals.length; t > e; e++) {
              o.__originalVertexNormals[e] ? o.__originalVertexNormals[e].copy(o.vertexNormals[e]) : o.__originalVertexNormals[e] = o.vertexNormals[e].clone()
            }
          };
          var a = new n.Geometry;
          for (a.faces = this.faces, e = 0, t = this.morphTargets.length; t > e; e++) {
            if (!this.morphNormals[e]) {
              this.morphNormals[e] = {}, this.morphNormals[e].faceNormals = [], this.morphNormals[e].vertexNormals = [];
              var s, h, l = this.morphNormals[e].faceNormals,
                c = this.morphNormals[e].vertexNormals;
              for (i = 0, r = this.faces.length; r > i; i++) {
                s = new n.Vector3, h = {
                  a: new n.Vector3,
                  b: new n.Vector3,
                  c: new n.Vector3
                }, l.push(s), c.push(h)
              }
            };
            var u = this.morphNormals[e];
            a.vertices = this.morphTargets[e].vertices, a.computeFaceNormals(), a.computeVertexNormals();
            var s, h;
            for (i = 0, r = this.faces.length; r > i; i++) {
              o = this.faces[i], s = u.faceNormals[i], h = u.vertexNormals[i], s.copy(o.normal), h.a.copy(o.vertexNormals[0]), h.b.copy(o.vertexNormals[1]), h.c.copy(o.vertexNormals[2])
            }
          };
          for (i = 0, r = this.faces.length; r > i; i++) {
            o = this.faces[i], o.normal = o.__originalFaceNormal, o.vertexNormals = o.__originalVertexNormals
          }
        },
        computeTangents: function() {
          console.warn("THREE.Geometry: .computeTangents() has been removed.")
        },
        computeLineDistances: function() {
          for (var e = 0, t = this.vertices, i = 0, n = t.length; n > i; i++) {
            i > 0 && (e += t[i].distanceTo(t[i - 1])), this.lineDistances[i] = e
          }
        },
        computeBoundingBox: function() {
          null === this.boundingBox && (this.boundingBox = new n.Box3), this.boundingBox.setFromPoints(this.vertices)
        },
        computeBoundingSphere: function() {
          null === this.boundingSphere && (this.boundingSphere = new n.Sphere), this.boundingSphere.setFromPoints(this.vertices)
        },
        merge: function(e, t, i) {
          if (e instanceof n.Geometry == !1) {
            return void(console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.", e))
          };
          var r, o = this.vertices.length,
            a = this.vertices,
            s = e.vertices,
            h = this.faces,
            l = e.faces,
            c = this.faceVertexUvs[0],
            u = e.faceVertexUvs[0];
          void(0) === i && (i = 0), void(0) !== t && (r = (new n.Matrix3).getNormalMatrix(t));
          for (var d = 0, p = s.length; p > d; d++) {
            var f = s[d],
              m = f.clone();
            void(0) !== t && m.applyMatrix4(t), a.push(m)
          };
          for (d = 0, p = l.length; p > d; d++) {
            var g, v, y, b = l[d],
              w = b.vertexNormals,
              _ = b.vertexColors;
            g = new n.Face3(b.a + o, b.b + o, b.c + o), g.normal.copy(b.normal), void(0) !== r && g.normal.applyMatrix3(r).normalize();
            for (var x = 0, M = w.length; M > x; x++) {
              v = w[x].clone(), void(0) !== r && v.applyMatrix3(r).normalize(), g.vertexNormals.push(v)
            };
            g.color.copy(b.color);
            for (var x = 0, M = _.length; M > x; x++) {
              y = _[x], g.vertexColors.push(y.clone())
            };
            g.materialIndex = b.materialIndex + i, h.push(g)
          };
          for (d = 0, p = u.length; p > d; d++) {
            var E = u[d],
              S = [];
            if (void(0) !== E) {
              for (var x = 0, M = E.length; M > x; x++) {
                S.push(E[x].clone())
              };
              c.push(S)
            }
          }
        },
        mergeMesh: function(e) {
          return e instanceof n.Mesh == !1 ? void(console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.", e)) : (e.matrixAutoUpdate && e.updateMatrix(), void(this.merge(e.geometry, e.matrix)))
        },
        mergeVertices: function() {
          var e, t, i, n, r, o, a, s, h = {},
            l = [],
            c = [],
            u = 4,
            d = Math.pow(10, u);
          for (i = 0, n = this.vertices.length; n > i; i++) {
            e = this.vertices[i], t = Math.round(e.x * d) + "_" + Math.round(e.y * d) + "_" + Math.round(e.z * d), void(0) === h[t] ? (h[t] = i, l.push(this.vertices[i]), c[i] = l.length - 1) : c[i] = c[h[t]]
          };
          var p = [];
          for (i = 0, n = this.faces.length; n > i; i++) {
            r = this.faces[i], r.a = c[r.a], r.b = c[r.b], r.c = c[r.c], o = [r.a, r.b, r.c];
            for (var f = -1, m = 0; 3 > m; m++) {
              if (o[m] === o[(m + 1) % 3]) {
                f = m, p.push(i);
                break
              }
            }
          };
          for (i = p.length - 1; i >= 0; i--) {
            var g = p[i];
            for (this.faces.splice(g, 1), a = 0, s = this.faceVertexUvs.length; s > a; a++) {
              this.faceVertexUvs[a].splice(g, 1)
            }
          };
          var v = this.vertices.length - l.length;
          return this.vertices = l, v
        },
        sortFacesByMaterialIndex: function() {
          function e(e, t) {
            return e.materialIndex - t.materialIndex
          }
          for (var t = this.faces, i = t.length, n = 0; i > n; n++) {
            t[n]._id = n
          };
          t.sort(e);
          var r, o, a = this.faceVertexUvs[0],
            s = this.faceVertexUvs[1];
          a && a.length === i && (r = []), s && s.length === i && (o = []);
          for (var n = 0; i > n; n++) {
            var h = t[n]._id;
            r && r.push(a[h]), o && o.push(s[h])
          };
          r && (this.faceVertexUvs[0] = r), o && (this.faceVertexUvs[1] = o)
        },
        toJSON: function() {
          function e(e, t, i) {
            return i ? e | 1 << t : e & ~(1 << t)
          }

          function t(e) {
            var t = e.x.toString() + e.y.toString() + e.z.toString();
            return void(0) !== d[t] ? d[t] : (d[t] = u.length / 3, u.push(e.x, e.y, e.z), d[t])
          }

          function i(e) {
            var t = e.r.toString() + e.g.toString() + e.b.toString();
            return void(0) !== f[t] ? f[t] : (f[t] = p.length, p.push(e.getHex()), f[t])
          }

          function n(e) {
            var t = e.x.toString() + e.y.toString();
            return void(0) !== g[t] ? g[t] : (g[t] = m.length / 2, m.push(e.x, e.y), g[t])
          }
          var r = {
            metadata: {
              version: 4.4,
              type: "Geometry",
              generator: "Geometry.toJSON"
            }
          };
          if (r.uuid = this.uuid, r.type = this.type, "" !== this.name && (r.name = this.name), void(0) !== this.parameters) {
            var o = this.parameters;
            for (var a in o) {
              void(0) !== o[a] && (r[a] = o[a])
            };
            return r
          };
          for (var s = [], h = 0; h < this.vertices.length; h++) {
            var l = this.vertices[h];
            s.push(l.x, l.y, l.z)
          };
          for (var c = [], u = [], d = {}, p = [], f = {}, m = [], g = {}, h = 0; h < this.faces.length; h++) {
            var v = this.faces[h],
              y = !0,
              b = !1,
              w = void(0) !== this.faceVertexUvs[0][h],
              _ = v.normal.length() > 0,
              x = v.vertexNormals.length > 0,
              M = 1 !== v.color.r || 1 !== v.color.g || 1 !== v.color.b,
              E = v.vertexColors.length > 0,
              S = 0;
            if (S = e(S, 0, 0), S = e(S, 1, y), S = e(S, 2, b), S = e(S, 3, w), S = e(S, 4, _), S = e(S, 5, x), S = e(S, 6, M), S = e(S, 7, E), c.push(S), c.push(v.a, v.b, v.c), c.push(v.materialIndex), w) {
              var T = this.faceVertexUvs[0][h];
              c.push(n(T[0]), n(T[1]), n(T[2]))
            };
            if (_ && c.push(t(v.normal)), x) {
              var P = v.vertexNormals;
              c.push(t(P[0]), t(P[1]), t(P[2]))
            };
            if (M && c.push(i(v.color)), E) {
              var A = v.vertexColors;
              c.push(i(A[0]), i(A[1]), i(A[2]))
            }
          };
          return r.data = {}, r.data.vertices = s, r.data.normals = u, p.length > 0 && (r.data.colors = p), m.length > 0 && (r.data.uvs = [m]), r.data.faces = c, r
        },
        clone: function() {
          return (new n.Geometry).copy(this)
        },
        copy: function(e) {
          this.vertices = [], this.faces = [], this.faceVertexUvs = [
            []
          ];
          for (var t = e.vertices, i = 0, n = t.length; n > i; i++) {
            this.vertices.push(t[i].clone())
          };
          for (var r = e.faces, i = 0, n = r.length; n > i; i++) {
            this.faces.push(r[i].clone())
          };
          for (var i = 0, n = e.faceVertexUvs.length; n > i; i++) {
            var o = e.faceVertexUvs[i];
            void(0) === this.faceVertexUvs[i] && (this.faceVertexUvs[i] = []);
            for (var a = 0, s = o.length; s > a; a++) {
              for (var h = o[a], l = [], c = 0, u = h.length; u > c; c++) {
                var d = h[c];
                l.push(d.clone())
              };
              this.faceVertexUvs[i].push(l)
            }
          };
          return this
        },
        dispose: function() {
          this.dispatchEvent({
            type: "dispose"
          })
        }
      }, n.EventDispatcher.prototype.apply(n.Geometry.prototype), n.GeometryIdCount = 0, n.DirectGeometry = function() {
        Object.defineProperty(this, "id", {
          value: n.GeometryIdCount++
        }), this.uuid = n.Math.generateUUID(), this.name = "", this.type = "DirectGeometry", this.indices = [], this.vertices = [], this.normals = [], this.colors = [], this.uvs = [], this.uvs2 = [], this.groups = [], this.morphTargets = {}, this.skinWeights = [], this.skinIndices = [], this.boundingBox = null, this.boundingSphere = null, this.verticesNeedUpdate = !1, this.normalsNeedUpdate = !1, this.colorsNeedUpdate = !1, this.uvsNeedUpdate = !1, this.groupsNeedUpdate = !1
      }, n.DirectGeometry.prototype = {
        constructor: n.DirectGeometry,
        computeBoundingBox: n.Geometry.prototype.computeBoundingBox,
        computeBoundingSphere: n.Geometry.prototype.computeBoundingSphere,
        computeFaceNormals: function() {
          console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")
        },
        computeVertexNormals: function() {
          console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")
        },
        computeGroups: function(e) {
          for (var t, i, n = [], r = e.faces, o = 0; o < r.length; o++) {
            var a = r[o];
            a.materialIndex !== i && (i = a.materialIndex, void(0) !== t && (t.count = 3 * o - t.start, n.push(t)), t = {
              start: 3 * o,
              materialIndex: i
            })
          };
          void(0) !== t && (t.count = 3 * o - t.start, n.push(t)), this.groups = n
        },
        fromGeometry: function(e) {
          var t, i = e.faces,
            r = e.vertices,
            o = e.faceVertexUvs,
            a = o[0] && o[0].length > 0,
            s = o[1] && o[1].length > 0,
            h = e.morphTargets,
            l = h.length;
          if (l > 0) {
            t = [];
            for (var c = 0; l > c; c++) {
              t[c] = []
            };
            this.morphTargets.position = t
          };
          var u, d = e.morphNormals,
            p = d.length;
          if (p > 0) {
            u = [];
            for (var c = 0; p > c; c++) {
              u[c] = []
            };
            this.morphTargets.normal = u
          };
          for (var f = e.skinIndices, m = e.skinWeights, g = f.length === r.length, v = m.length === r.length, c = 0; c < i.length; c++) {
            var y = i[c];
            this.vertices.push(r[y.a], r[y.b], r[y.c]);
            var b = y.vertexNormals;
            if (3 === b.length) {
              this.normals.push(b[0], b[1], b[2])
            } else {
              var w = y.normal;
              this.normals.push(w, w, w)
            };
            var _ = y.vertexColors;
            if (3 === _.length) {
              this.colors.push(_[0], _[1], _[2])
            } else {
              var x = y.color;
              this.colors.push(x, x, x)
            };
            if (a === !0) {
              var M = o[0][c];
              void(0) !== M ? this.uvs.push(M[0], M[1], M[2]) : (console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ", c), this.uvs.push(new n.Vector2, new n.Vector2, new n.Vector2))
            };
            if (s === !0) {
              var M = o[1][c];
              void(0) !== M ? this.uvs2.push(M[0], M[1], M[2]) : (console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ", c), this.uvs2.push(new n.Vector2, new n.Vector2, new n.Vector2))
            };
            for (var E = 0; l > E; E++) {
              var S = h[E].vertices;
              t[E].push(S[y.a], S[y.b], S[y.c])
            };
            for (var E = 0; p > E; E++) {
              var T = d[E].vertexNormals[c];
              u[E].push(T.a, T.b, T.c)
            };
            g && this.skinIndices.push(f[y.a], f[y.b], f[y.c]), v && this.skinWeights.push(m[y.a], m[y.b], m[y.c])
          };
          return this.computeGroups(e), this.verticesNeedUpdate = e.verticesNeedUpdate, this.normalsNeedUpdate = e.normalsNeedUpdate, this.colorsNeedUpdate = e.colorsNeedUpdate, this.uvsNeedUpdate = e.uvsNeedUpdate, this.groupsNeedUpdate = e.groupsNeedUpdate, this
        },
        dispose: function() {
          this.dispatchEvent({
            type: "dispose"
          })
        }
      }, n.EventDispatcher.prototype.apply(n.DirectGeometry.prototype), n.BufferGeometry = function() {
        Object.defineProperty(this, "id", {
          value: n.GeometryIdCount++
        }), this.uuid = n.Math.generateUUID(), this.name = "", this.type = "BufferGeometry", this.index = null, this.attributes = {}, this.morphAttributes = {}, this.groups = [], this.boundingBox = null, this.boundingSphere = null, this.drawRange = {
          start: 0,
          count: 1 / 0
        }
      }, n.BufferGeometry.prototype = {
        constructor: n.BufferGeometry,
        getIndex: function() {
          return this.index
        },
        setIndex: function(e) {
          this.index = e
        },
        addAttribute: function(e, t) {
          return t instanceof n.BufferAttribute == !1 && t instanceof n.InterleavedBufferAttribute == !1 ? (console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."), void(this.addAttribute(e, new n.BufferAttribute(arguments[1], arguments[2])))) : "index" === e ? (console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."), void(this.setIndex(t))) : (this.attributes[e] = t, this)
        },
        getAttribute: function(e) {
          return this.attributes[e]
        },
        removeAttribute: function(e) {
          return delete this.attributes[e], this
        },
        addGroup: function(e, t, i) {
          this.groups.push({
            start: e,
            count: t,
            materialIndex: void(0) !== i ? i : 0
          })
        },
        clearGroups: function() {
          this.groups = []
        },
        setDrawRange: function(e, t) {
          this.drawRange.start = e, this.drawRange.count = t
        },
        applyMatrix: function(e) {
          var t = this.attributes.position;
          void(0) !== t && (e.applyToVector3Array(t.array), t.needsUpdate = !0);
          var i = this.attributes.normal;
          if (void(0) !== i) {
            var r = (new n.Matrix3).getNormalMatrix(e);
            r.applyToVector3Array(i.array), i.needsUpdate = !0
          };
          return null !== this.boundingBox && this.computeBoundingBox(), null !== this.boundingSphere && this.computeBoundingSphere(), this
        },
        rotateX: function() {
          var e;
          return function(t) {
            return void(0) === e && (e = new n.Matrix4), e.makeRotationX(t), this.applyMatrix(e), this
          }
        }(),
        rotateY: function() {
          var e;
          return function(t) {
            return void(0) === e && (e = new n.Matrix4), e.makeRotationY(t), this.applyMatrix(e), this
          }
        }(),
        rotateZ: function() {
          var e;
          return function(t) {
            return void(0) === e && (e = new n.Matrix4), e.makeRotationZ(t), this.applyMatrix(e), this
          }
        }(),
        translate: function() {
          var e;
          return function(t, i, r) {
            return void(0) === e && (e = new n.Matrix4), e.makeTranslation(t, i, r), this.applyMatrix(e), this
          }
        }(),
        scale: function() {
          var e;
          return function(t, i, r) {
            return void(0) === e && (e = new n.Matrix4), e.makeScale(t, i, r), this.applyMatrix(e), this
          }
        }(),
        lookAt: function() {
          var e;
          return function(t) {
            void(0) === e && (e = new n.Object3D), e.lookAt(t), e.updateMatrix(), this.applyMatrix(e.matrix)
          }
        }(),
        center: function() {
          this.computeBoundingBox();
          var e = this.boundingBox.center().negate();
          return this.translate(e.x, e.y, e.z), e
        },
        setFromObject: function(e) {
          var t = e.geometry;
          if (e instanceof n.Points || e instanceof n.Line) {
            var i = new n.Float32Attribute(3 * t.vertices.length, 3),
              r = new n.Float32Attribute(3 * t.colors.length, 3);
            if (this.addAttribute("position", i.copyVector3sArray(t.vertices)), this.addAttribute("color", r.copyColorsArray(t.colors)), t.lineDistances && t.lineDistances.length === t.vertices.length) {
              var o = new n.Float32Attribute(t.lineDistances.length, 1);
              this.addAttribute("lineDistance", o.copyArray(t.lineDistances))
            };
            null !== t.boundingSphere && (this.boundingSphere = t.boundingSphere.clone()), null !== t.boundingBox && (this.boundingBox = t.boundingBox.clone())
          } else {
            e instanceof n.Mesh && t instanceof n.Geometry && this.fromGeometry(t)
          };
          return this
        },
        updateFromObject: function(e) {
          var t = e.geometry;
          if (e instanceof n.Mesh) {
            var i = t.__directGeometry;
            if (void(0) === i) {
              return this.fromGeometry(t)
            };
            i.verticesNeedUpdate = t.verticesNeedUpdate, i.normalsNeedUpdate = t.normalsNeedUpdate, i.colorsNeedUpdate = t.colorsNeedUpdate, i.uvsNeedUpdate = t.uvsNeedUpdate, i.groupsNeedUpdate = t.groupsNeedUpdate, t.verticesNeedUpdate = !1, t.normalsNeedUpdate = !1, t.colorsNeedUpdate = !1, t.uvsNeedUpdate = !1, t.groupsNeedUpdate = !1, t = i
          };
          if (t.verticesNeedUpdate === !0) {
            var r = this.attributes.position;
            void(0) !== r && (r.copyVector3sArray(t.vertices), r.needsUpdate = !0), t.verticesNeedUpdate = !1
          };
          if (t.normalsNeedUpdate === !0) {
            var r = this.attributes.normal;
            void(0) !== r && (r.copyVector3sArray(t.normals), r.needsUpdate = !0), t.normalsNeedUpdate = !1
          };
          if (t.colorsNeedUpdate === !0) {
            var r = this.attributes.color;
            void(0) !== r && (r.copyColorsArray(t.colors), r.needsUpdate = !0), t.colorsNeedUpdate = !1
          };
          if (t.uvsNeedUpdate) {
            var r = this.attributes.uv;
            void(0) !== r && (r.copyVector2sArray(t.uvs), r.needsUpdate = !0), t.uvsNeedUpdate = !1
          };
          if (t.lineDistancesNeedUpdate) {
            var r = this.attributes.lineDistance;
            void(0) !== r && (r.copyArray(t.lineDistances), r.needsUpdate = !0), t.lineDistancesNeedUpdate = !1
          };
          return t.groupsNeedUpdate && (t.computeGroups(e.geometry), this.groups = t.groups, t.groupsNeedUpdate = !1), this
        },
        fromGeometry: function(e) {
          return e.__directGeometry = (new n.DirectGeometry).fromGeometry(e), this.fromDirectGeometry(e.__directGeometry)
        },
        fromDirectGeometry: function(e) {
          var t = new Float32Array(3 * e.vertices.length);
          if (this.addAttribute("position", new n.BufferAttribute(t, 3).copyVector3sArray(e.vertices)), e.normals.length > 0) {
            var i = new Float32Array(3 * e.normals.length);
            this.addAttribute("normal", new n.BufferAttribute(i, 3).copyVector3sArray(e.normals))
          };
          if (e.colors.length > 0) {
            var r = new Float32Array(3 * e.colors.length);
            this.addAttribute("color", new n.BufferAttribute(r, 3).copyColorsArray(e.colors))
          };
          if (e.uvs.length > 0) {
            var o = new Float32Array(2 * e.uvs.length);
            this.addAttribute("uv", new n.BufferAttribute(o, 2).copyVector2sArray(e.uvs))
          };
          if (e.uvs2.length > 0) {
            var a = new Float32Array(2 * e.uvs2.length);
            this.addAttribute("uv2", new n.BufferAttribute(a, 2).copyVector2sArray(e.uvs2))
          };
          if (e.indices.length > 0) {
            var s = e.vertices.length > 65535 ? Uint32Array : Uint16Array,
              h = new s(3 * e.indices.length);
            this.setIndex(new n.BufferAttribute(h, 1).copyIndicesArray(e.indices))
          };
          this.groups = e.groups;
          for (var l in e.morphTargets) {
            for (var c = [], u = e.morphTargets[l], d = 0, p = u.length; p > d; d++) {
              var f = u[d],
                m = new n.Float32Attribute(3 * f.length, 3);
              c.push(m.copyVector3sArray(f))
            };
            this.morphAttributes[l] = c
          };
          if (e.skinIndices.length > 0) {
            var g = new n.Float32Attribute(4 * e.skinIndices.length, 4);
            this.addAttribute("skinIndex", g.copyVector4sArray(e.skinIndices))
          };
          if (e.skinWeights.length > 0) {
            var v = new n.Float32Attribute(4 * e.skinWeights.length, 4);
            this.addAttribute("skinWeight", v.copyVector4sArray(e.skinWeights))
          };
          return null !== e.boundingSphere && (this.boundingSphere = e.boundingSphere.clone()), null !== e.boundingBox && (this.boundingBox = e.boundingBox.clone()), this
        },
        computeBoundingBox: function() {
          new n.Vector3;
          return function() {
            null === this.boundingBox && (this.boundingBox = new n.Box3);
            var e = this.attributes.position.array;
            e && this.boundingBox.setFromArray(e), (void(0) === e || 0 === e.length) && (this.boundingBox.min["set"](0, 0, 0), this.boundingBox.max["set"](0, 0, 0)), (isNaN(this.boundingBox.min.x) || isNaN(this.boundingBox.min.y) || isNaN(this.boundingBox.min.z)) && console.error("THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.", this)
          }
        }(),
        computeBoundingSphere: function() {
          var e = new n.Box3,
            t = new n.Vector3;
          return function() {
            null === this.boundingSphere && (this.boundingSphere = new n.Sphere);
            var i = this.attributes.position.array;
            if (i) {
              var r = this.boundingSphere.center;
              e.setFromArray(i), e.center(r);
              for (var o = 0, a = 0, s = i.length; s > a; a += 3) {
                t.fromArray(i, a), o = Math.max(o, r.distanceToSquared(t))
              };
              this.boundingSphere.radius = Math.sqrt(o), isNaN(this.boundingSphere.radius) && console.error("THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.", this)
            }
          }
        }(),
        computeFaceNormals: function() {},
        computeVertexNormals: function() {
          var e = this.index,
            t = this.attributes,
            i = this.groups;
          if (t.position) {
            var r = t.position.array;
            if (void(0) === t.normal) {
              this.addAttribute("normal", new n.BufferAttribute(new Float32Array(r.length), 3))
            } else {
              for (var o = t.normal.array, a = 0, s = o.length; s > a; a++) {
                o[a] = 0
              }
            };
            var h, l, c, u = t.normal.array,
              d = new n.Vector3,
              p = new n.Vector3,
              f = new n.Vector3,
              m = new n.Vector3,
              g = new n.Vector3;
            if (e) {
              var v = e.array;
              0 === i.length && this.addGroup(0, v.length);
              for (var y = 0, b = i.length; b > y; ++y) {
                for (var w = i[y], _ = w.start, x = w.count, a = _, s = _ + x; s > a; a += 3) {
                  h = 3 * v[a + 0], l = 3 * v[a + 1], c = 3 * v[a + 2], d.fromArray(r, h), p.fromArray(r, l), f.fromArray(r, c), m.subVectors(f, p), g.subVectors(d, p), m.cross(g), u[h] += m.x, u[h + 1] += m.y, u[h + 2] += m.z, u[l] += m.x, u[l + 1] += m.y, u[l + 2] += m.z, u[c] += m.x, u[c + 1] += m.y, u[c + 2] += m.z
                }
              }
            } else {
              for (var a = 0, s = r.length; s > a; a += 9) {
                d.fromArray(r, a), p.fromArray(r, a + 3), f.fromArray(r, a + 6), m.subVectors(f, p), g.subVectors(d, p), m.cross(g), u[a] = m.x, u[a + 1] = m.y, u[a + 2] = m.z, u[a + 3] = m.x, u[a + 4] = m.y, u[a + 5] = m.z, u[a + 6] = m.x, u[a + 7] = m.y, u[a + 8] = m.z
              }
            };
            this.normalizeNormals(), t.normal.needsUpdate = !0
          }
        },
        merge: function(e, t) {
          if (e instanceof n.BufferGeometry == !1) {
            return void(console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.", e))
          };
          void(0) === t && (t = 0);
          var i = this.attributes;
          for (var r in i) {
            if (void(0) !== e.attributes[r]) {
              for (var o = i[r], a = o.array, s = e.attributes[r], h = s.array, l = s.itemSize, c = 0, u = l * t; c < h.length; c++, u++) {
                a[u] = h[c]
              }
            }
          };
          return this
        },
        normalizeNormals: function() {
          for (var e, t, i, n, r = this.attributes.normal.array, o = 0, a = r.length; a > o; o += 3) {
            e = r[o], t = r[o + 1], i = r[o + 2], n = 1 / Math.sqrt(e * e + t * t + i * i), r[o] *= n, r[o + 1] *= n, r[o + 2] *= n
          }
        },
        toNonIndexed: function() {
          if (null === this.index) {
            return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."), this
          };
          var e = new n.BufferGeometry,
            t = this.index.array,
            i = this.attributes;
          for (var r in i) {
            for (var o = i[r], a = o.array, s = o.itemSize, h = new a.constructor(t.length * s), l = 0, c = 0, u = 0, d = t.length; d > u; u++) {
              l = t[u] * s;
              for (var p = 0; s > p; p++) {
                h[c++] = a[l++]
              }
            };
            e.addAttribute(r, new n.BufferAttribute(h, s))
          };
          return e
        },
        toJSON: function() {
          var e = {
            metadata: {
              version: 4.4,
              type: "BufferGeometry",
              generator: "BufferGeometry.toJSON"
            }
          };
          if (e.uuid = this.uuid, e.type = this.type, "" !== this.name && (e.name = this.name), void(0) !== this.parameters) {
            var t = this.parameters;
            for (var i in t) {
              void(0) !== t[i] && (e[i] = t[i])
            };
            return e
          };
          e.data = {
            attributes: {}
          };
          var n = this.index;
          if (null !== n) {
            var r = Array.prototype.slice.call(n.array);
            e.data.index = {
              type: n.array.constructor.name,
              array: r
            }
          };
          var o = this.attributes;
          for (var i in o) {
            var a = o[i],
              r = Array.prototype.slice.call(a.array);
            e.data.attributes[i] = {
              itemSize: a.itemSize,
              type: a.array.constructor.name,
              array: r
            }
          };
          var s = this.groups;
          s.length > 0 && (e.data.groups = JSON.parse(JSON.stringify(s)));
          var h = this.boundingSphere;
          return null !== h && (e.data.boundingSphere = {
            center: h.center.toArray(),
            radius: h.radius
          }), e
        },
        clone: function() {
          return (new n.BufferGeometry).copy(this)
        },
        copy: function(e) {
          var t = e.index;
          null !== t && this.setIndex(t.clone());
          var i = e.attributes;
          for (var n in i) {
            var r = i[n];
            this.addAttribute(n, r.clone())
          };
          for (var o = e.groups, a = 0, s = o.length; s > a; a++) {
            var h = o[a];
            this.addGroup(h.start, h.count)
          };
          return this
        },
        dispose: function() {
          this.dispatchEvent({
            type: "dispose"
          })
        }
      }, n.EventDispatcher.prototype.apply(n.BufferGeometry.prototype), n.BufferGeometry.MaxIndex = 65535, n.InstancedBufferGeometry = function() {
        n.BufferGeometry.call(this), this.type = "InstancedBufferGeometry", this.maxInstancedCount = void(0)
      }, n.InstancedBufferGeometry.prototype = Object.create(n.BufferGeometry.prototype), n.InstancedBufferGeometry.prototype.constructor = n.InstancedBufferGeometry, n.InstancedBufferGeometry.prototype.addGroup = function(e, t, i) {
        this.groups.push({
          start: e,
          count: t,
          instances: i
        })
      }, n.InstancedBufferGeometry.prototype.copy = function(e) {
        var t = e.index;
        null !== t && this.setIndex(t.clone());
        var i = e.attributes;
        for (var n in i) {
          var r = i[n];
          this.addAttribute(n, r.clone())
        };
        for (var o = e.groups, a = 0, s = o.length; s > a; a++) {
          var h = o[a];
          this.addGroup(h.start, h.count, h.instances)
        };
        return this
      }, n.EventDispatcher.prototype.apply(n.InstancedBufferGeometry.prototype), n.Uniform = function(e, t) {
        this.type = e, this.value = t, this.dynamic = !1
      }, n.Uniform.prototype = {
        constructor: n.Uniform,
        onUpdate: function(e) {
          return this.dynamic = !0, this.onUpdateCallback = e, this
        }
      }, n.AnimationClip = function(e, t, i) {
        this.name = e || n.Math.generateUUID(), this.tracks = i, this.duration = void(0) !== t ? t : -1, this.duration < 0 && this.resetDuration(), this.trim(), this.optimize()
      }, n.AnimationClip.prototype = {
        constructor: n.AnimationClip,
        resetDuration: function() {
          for (var e = this.tracks, t = 0, i = 0, n = e.length; i !== n; ++i) {
            var r = this.tracks[i];
            t = Math.max(t, r.times[r.times.length - 1])
          };
          this.duration = t
        },
        trim: function() {
          for (var e = 0; e < this.tracks.length; e++) {
            this.tracks[e].trim(0, this.duration)
          };
          return this
        },
        optimize: function() {
          for (var e = 0; e < this.tracks.length; e++) {
            this.tracks[e].optimize()
          };
          return this
        }
      }, Object.assign(n.AnimationClip, {
        parse: function(e) {
          for (var t = [], i = e.tracks, r = 1 / (e.fps || 1), o = 0, a = i.length; o !== a; ++o) {
            t.push(n.KeyframeTrack.parse(i[o]).scale(r))
          };
          return new n.AnimationClip(e.name, e.duration, t)
        },
        toJSON: function(e) {
          for (var t = [], i = e.tracks, r = {
              name: e.name,
              duration: e.duration,
              tracks: t
            }, o = 0, a = i.length; o !== a; ++o) {
            t.push(n.KeyframeTrack.toJSON(i[o]))
          };
          return r
        },
        CreateFromMorphTargetSequence: function(e, t, i) {
          for (var r = t.length, o = [], a = 0; r > a; a++) {
            var s = [],
              h = [];
            s.push((a + r - 1) % r, a, (a + 1) % r), h.push(0, 1, 0);
            var l = n.AnimationUtils.getKeyframeOrder(s);
            s = n.AnimationUtils.sortedArray(s, 1, l), h = n.AnimationUtils.sortedArray(h, 1, l), 0 === s[0] && (s.push(r), h.push(h[0])), o.push(new n.NumberKeyframeTrack(".morphTargetInfluences[" + t[a].name + "]", s, h).scale(1 / i))
          };
          return new n.AnimationClip(e, -1, o)
        },
        findByName: function(e, t) {
          for (var i = 0; i < e.length; i++) {
            if (e[i].name === t) {
              return e[i]
            }
          };
          return null
        },
        CreateClipsFromMorphTargetSequences: function(e, t) {
          for (var i = {}, r = /^([\w-]*?)([\d]+)$/, o = 0, a = e.length; a > o; o++) {
            var s = e[o],
              h = s.name.match(r);
            if (h && h.length > 1) {
              var l = h[1],
                c = i[l];
              c || (i[l] = c = []), c.push(s)
            }
          };
          var u = [];
          for (var l in i) {
            u.push(n.AnimationClip.CreateFromMorphTargetSequence(l, i[l], t))
          };
          return u
        },
        parseAnimation: function(e, t, i) {
          if (!e) {
            return console.error("  no animation in JSONLoader data"), null
          };
          for (var r = function(e, t, i, r, o) {
              if (0 !== i.length) {
                var a = [],
                  s = [];
                n.AnimationUtils.flattenJSON(i, a, s, r), 0 !== a.length && o.push(new e(t, a, s))
              }
            }, o = [], a = e.name || "default", s = e.length || -1, h = e.fps || 30, l = e.hierarchy || [], c = 0; c < l.length; c++) {
            var u = l[c].keys;
            if (u && 0 != u.length) {
              if (u[0].morphTargets) {
                for (var d = {}, p = 0; p < u.length; p++) {
                  if (u[p].morphTargets) {
                    for (var f = 0; f < u[p].morphTargets.length; f++) {
                      d[u[p].morphTargets[f]] = -1
                    }
                  }
                };
                for (var m in d) {
                  for (var g = [], v = [], f = 0; f !== u[p].morphTargets.length; ++f) {
                    var y = u[p];
                    g.push(y.time), v.push(y.morphTarget === m ? 1 : 0)
                  };
                  o.push(new n.NumberKeyframeTrack(".morphTargetInfluence[" + m + "]", g, v))
                };
                s = d.length * (h || 1)
              } else {
                var b = ".bones[" + t[c].name + "]";
                r(n.VectorKeyframeTrack, b + ".position", u, "pos", o), r(n.QuaternionKeyframeTrack, b + ".quaternion", u, "rot", o), r(n.VectorKeyframeTrack, b + ".scale", u, "scl", o)
              }
            }
          };
          if (0 === o.length) {
            return null
          };
          var w = new n.AnimationClip(a, s, o);
          return w
        }
      }), n.AnimationMixer = function(e) {
        this._root = e, this._initMemoryManager(), this._accuIndex = 0, this.time = 0, this.timeScale = 1
      }, n.AnimationMixer.prototype = {
        constructor: n.AnimationMixer,
        clipAction: function(e, t) {
          var i, r = t || this._root,
            o = r.uuid,
            a = "string" == typeof e ? e : e.name,
            s = e !== a ? e : null,
            h = this._actionsByClip[a];
          if (void(0) !== h) {
            var l = h.actionByRoot[o];
            if (void(0) !== l) {
              return l
            };
            if (i = h.knownActions[0], s = i._clip, e !== a && e !== s) {
              throw new Error("Different clips with the same name detected!")
            }
          };
          if (null === s) {
            return null
          };
          var c = new n.AnimationMixer._Action(this, s, t);
          return this._bindAction(c, i), this._addInactiveAction(c, a, o), c
        },
        existingAction: function(e, t) {
          var i = t || this._root,
            n = i.uuid,
            r = "string" == typeof e ? e : e.name,
            o = this._actionsByClip[r];
          return void(0) !== o ? o.actionByRoot[n] || null : null
        },
        stopAllAction: function() {
          var e = this._actions,
            t = this._nActiveActions,
            i = this._bindings,
            n = this._nActiveBindings;
          this._nActiveActions = 0, this._nActiveBindings = 0;
          for (var r = 0; r !== t; ++r) {
            e[r].reset()
          };
          for (var r = 0; r !== n; ++r) {
            i[r].useCount = 0
          };
          return this
        },
        update: function(e) {
          e *= this.timeScale;
          for (var t = this._actions, i = this._nActiveActions, n = this.time += e, r = Math.sign(e), o = this._accuIndex ^= 1, a = 0; a !== i; ++a) {
            var s = t[a];
            s.enabled && s._update(n, e, r, o)
          };
          for (var h = this._bindings, l = this._nActiveBindings, a = 0; a !== l; ++a) {
            h[a].apply(o)
          };
          return this
        },
        getRoot: function() {
          return this._root
        },
        uncacheClip: function(e) {
          var t = this._actions,
            i = e.name,
            n = this._actionsByClip,
            r = n[i];
          if (void(0) !== r) {
            for (var o = r.knownActions, a = 0, s = o.length; a !== s; ++a) {
              var h = o[a];
              this._deactivateAction(h);
              var l = h._cacheIndex,
                c = t[t.length - 1];
              h._cacheIndex = null, h._byClipCacheIndex = null, c._cacheIndex = l, t[l] = c, t.pop(), this._removeInactiveBindingsForAction(h)
            };
            delete n[i]
          }
        },
        uncacheRoot: function(e) {
          var t = e.uuid,
            i = this._actionsByClip;
          for (var n in i) {
            var r = i[n].actionByRoot,
              o = r[t];
            void(0) !== o && (this._deactivateAction(o), this._removeInactiveAction(o))
          };
          var a = this._bindingsByRootAndName,
            s = a[t];
          if (void(0) !== s) {
            for (var h in s) {
              var l = s[h];
              l.restoreOriginalState(), this._removeInactiveBinding(l)
            }
          }
        },
        uncacheAction: function(e, t) {
          var i = this.existingAction(e, t);
          null !== i && (this._deactivateAction(i), this._removeInactiveAction(i))
        }
      }, n.EventDispatcher.prototype.apply(n.AnimationMixer.prototype), n.AnimationMixer._Action = function(e, t, i) {
        this._mixer = e, this._clip = t, this._localRoot = i || null;
        for (var r = t.tracks, o = r.length, a = new Array(o), s = {
            endingStart: n.ZeroCurvatureEnding,
            endingEnd: n.ZeroCurvatureEnding
          }, h = 0; h !== o; ++h) {
          var l = r[h].createInterpolant(null);
          a[h] = l, l.settings = s
        };
        this._interpolantSettings = s, this._interpolants = a, this._propertyBindings = new Array(o), this._cacheIndex = null, this._byClipCacheIndex = null, this._timeScaleInterpolant = null, this._weightInterpolant = null, this.loop = n.LoopRepeat, this._loopCount = -1, this._startTime = null, this.time = 0, this.timeScale = 1, this._effectiveTimeScale = 1, this.weight = 1, this._effectiveWeight = 1, this.repetitions = 1 / 0, this.paused = !1, this.enabled = !0, this.clampWhenFinished = !1, this.zeroSlopeAtStart = !0, this.zeroSlopeAtEnd = !0
      }, n.AnimationMixer._Action.prototype = {
        constructor: n.AnimationMixer._Action,
        play: function() {
          return this._mixer._activateAction(this), this
        },
        stop: function() {
          return this._mixer._deactivateAction(this), this.reset()
        },
        reset: function() {
          return this.paused = !1, this.enabled = !0, this.time = 0, this._loopCount = -1, this._startTime = null, this.stopFading().stopWarping()
        },
        isRunning: function() {
          this._startTime;
          return this.enabled && !this.paused && 0 !== this.timeScale && null === this._startTime && this._mixer._isActiveAction(this)
        },
        isScheduled: function() {
          return this._mixer._isActiveAction(this)
        },
        startAt: function(e) {
          return this._startTime = e, this
        },
        setLoop: function(e, t) {
          return this.loop = e, this.repetitions = t, this
        },
        setEffectiveWeight: function(e) {
          return this.weight = e, this._effectiveWeight = this.enabled ? e : 0, this.stopFading()
        },
        getEffectiveWeight: function() {
          return this._effectiveWeight
        },
        fadeIn: function(e) {
          return this._scheduleFading(e, 0, 1)
        },
        fadeOut: function(e) {
          return this._scheduleFading(e, 1, 0)
        },
        crossFadeFrom: function(e, t, i) {
          this._mixer;
          if (e.fadeOut(t), this.fadeIn(t), i) {
            var n = this._clip.duration,
              r = e._clip.duration,
              o = r / n,
              a = n / r;
            e.warp(1, o, t), this.warp(a, 1, t)
          };
          return this
        },
        crossFadeTo: function(e, t, i) {
          return e.crossFadeFrom(this, t, i)
        },
        stopFading: function() {
          var e = this._weightInterpolant;
          return null !== e && (this._weightInterpolant = null, this._mixer._takeBackControlInterpolant(e)), this
        },
        setEffectiveTimeScale: function(e) {
          return this.timeScale = e, this._effectiveTimeScale = this.paused ? 0 : e, this.stopWarping()
        },
        getEffectiveTimeScale: function() {
          return this._effectiveTimeScale
        },
        setDuration: function(e) {
          return this.timeScale = this._clip.duration / e, this.stopWarping()
        },
        syncWith: function(e) {
          return this.time = e.time, this.timeScale = e.timeScale, this.stopWarping()
        },
        halt: function(e) {
          return this.warp(this._currentTimeScale, 0, e)
        },
        warp: function(e, t, i) {
          var n = this._mixer,
            r = n.time,
            o = this._timeScaleInterpolant,
            a = this.timeScale;
          null === o && (o = n._lendControlInterpolant(), this._timeScaleInterpolant = o);
          var s = o.parameterPositions,
            h = o.sampleValues;
          return s[0] = r, s[1] = r + i, h[0] = e / a, h[1] = t / a, this
        },
        stopWarping: function() {
          var e = this._timeScaleInterpolant;
          return null !== e && (this._timeScaleInterpolant = null, this._mixer._takeBackControlInterpolant(e)), this
        },
        getMixer: function() {
          return this._mixer
        },
        getClip: function() {
          return this._clip
        },
        getRoot: function() {
          return this._localRoot || this._mixer._root
        },
        _update: function(e, t, i, n) {
          var r = this._startTime;
          if (null !== r) {
            var o = (e - r) * i;
            if (0 > o || 0 === i) {
              return
            };
            this._startTime = null, t = i * o
          };
          t *= this._updateTimeScale(e);
          var a = this._updateTime(t),
            s = this._updateWeight(e);
          if (s > 0) {
            for (var h = this._interpolants, l = this._propertyBindings, c = 0, u = h.length; c !== u; ++c) {
              h[c].evaluate(a), l[c].accumulate(n, s)
            }
          }
        },
        _updateWeight: function(e) {
          var t = 0;
          if (this.enabled) {
            t = this.weight;
            var i = this._weightInterpolant;
            if (null !== i) {
              var n = i.evaluate(e)[0];
              t *= n, e > i.parameterPositions[1] && (this.stopFading(), 0 === n && (this.enabled = !1))
            }
          };
          return this._effectiveWeight = t, t
        },
        _updateTimeScale: function(e) {
          var t = 0;
          if (!this.paused) {
            t = this.timeScale;
            var i = this._timeScaleInterpolant;
            if (null !== i) {
              var n = i.evaluate(e)[0];
              t *= n, e > i.parameterPositions[1] && (this.stopWarping(), 0 === t ? this.pause = !0 : this.timeScale = t)
            }
          };
          return this._effectiveTimeScale = t, t
        },
        _updateTime: function(e) {
          var t = this.time + e;
          if (0 === e) {
            return t
          };
          var i = this._clip.duration,
            r = this.loop,
            o = this._loopCount,
            a = !1;
          switch (r) {
            case n.LoopOnce:
              if (-1 === o && (this.loopCount = 0, this._setEndings(!0, !0, !1)), t >= i) {
                t = i
              } else {
                if (!(0 > t)) {
                  break
                };
                t = 0
              };
              this.clampWhenFinished ? this.pause = !0 : this.enabled = !1, this._mixer.dispatchEvent({
                type: "finished",
                action: this,
                direction: 0 > e ? -1 : 1
              });
              break;
            case n.LoopPingPong:
              a = !0;
            case n.LoopRepeat:
              if (-1 === o && (e > 0 ? (o = 0, this._setEndings(!0, 0 === this.repetitions, a)) : this._setEndings(0 === this.repetitions, !0, a)), t >= i || 0 > t) {
                var s = Math.floor(t / i);
                t -= i * s, o += Math.abs(s);
                var h = this.repetitions - o;
                if (0 > h) {
                  this.clampWhenFinished ? this.paused = !0 : this.enabled = !1, t = e > 0 ? i : 0, this._mixer.dispatchEvent({
                    type: "finished",
                    action: this,
                    direction: e > 0 ? 1 : -1
                  });
                  break
                };
                if (0 === h) {
                  var l = 0 > e;
                  this._setEndings(l, !l, a)
                } else {
                  this._setEndings(!1, !1, a)
                };
                this._loopCount = o, this._mixer.dispatchEvent({
                  type: "loop",
                  action: this,
                  loopDelta: s
                })
              };
              if (r === n.LoopPingPong && 1 === (1 & o)) {
                return this.time = t, i - t
              }
          };
          return this.time = t, t
        },
        _setEndings: function(e, t, i) {
          var r = this._interpolantSettings;
          i ? (r.endingStart = n.ZeroSlopeEnding, r.endingEnd = n.ZeroSlopeEnding) : (r.endingStart = e ? this.zeroSlopeAtStart ? n.ZeroSlopeEnding : n.ZeroCurvatureEnding : n.WrapAroundEnding, r.endingEnd = t ? this.zeroSlopeAtEnd ? n.ZeroSlopeEnding : n.ZeroCurvatureEnding : n.WrapAroundEnding)
        },
        _scheduleFading: function(e, t, i) {
          var n = this._mixer,
            r = n.time,
            o = this._weightInterpolant;
          null === o && (o = n._lendControlInterpolant(), this._weightInterpolant = o);
          var a = o.parameterPositions,
            s = o.sampleValues;
          return a[0] = r, s[0] = t, a[1] = r + e, s[1] = i, this
        }
      }, Object.assign(n.AnimationMixer.prototype, {
        _bindAction: function(e, t) {
          var i = e._localRoot || this._root,
            r = e._clip.tracks,
            o = r.length,
            a = e._propertyBindings,
            s = e._interpolants,
            h = i.uuid,
            l = this._bindingsByRootAndName,
            c = l[h];
          void(0) === c && (c = {}, l[h] = c);
          for (var u = 0; u !== o; ++u) {
            var d = r[u],
              p = d.name,
              f = c[p];
            if (void(0) !== f) {
              a[u] = f
            } else {
              if (f = a[u], void(0) !== f) {
                null === f._cacheIndex && (++f.referenceCount, this._addInactiveBinding(f, h, p));
                continue
              };
              var m = t && t._propertyBindings[u].binding.parsedPath;
              f = new n.PropertyMixer(n.PropertyBinding.create(i, p, m), d.ValueTypeName, d.getValueSize()), ++f.referenceCount, this._addInactiveBinding(f, h, p), a[u] = f
            };
            s[u].resultBuffer = f.buffer
          }
        },
        _activateAction: function(e) {
          if (!this._isActiveAction(e)) {
            if (null === e._cacheIndex) {
              var t = (e._localRoot || this._root).uuid,
                i = e._clip.name,
                n = this._actionsByClip[i];
              this._bindAction(e, n && n.knownActions[0]), this._addInactiveAction(e, i, t)
            };
            for (var r = e._propertyBindings, o = 0, a = r.length; o !== a; ++o) {
              var s = r[o];
              0 === s.useCount++ && (this._lendBinding(s), s.saveOriginalState())
            };
            this._lendAction(e)
          }
        },
        _deactivateAction: function(e) {
          if (this._isActiveAction(e)) {
            for (var t = e._propertyBindings, i = 0, n = t.length; i !== n; ++i) {
              var r = t[i];
              0 === --r.useCount && (r.restoreOriginalState(), this._takeBackBinding(r))
            };
            this._takeBackAction(e)
          }
        },
        _initMemoryManager: function() {
          this._actions = [], this._nActiveActions = 0, this._actionsByClip = {}, this._bindings = [], this._nActiveBindings = 0, this._bindingsByRootAndName = {}, this._controlInterpolants = [], this._nActiveControlInterpolants = 0;
          var e = this;
          this.stats = {
            actions: {
              get total() {
                return e._actions.length
              },
              get inUse() {
                return e._nActiveActions
              }
            },
            bindings: {
              get total() {
                return e._bindings.length
              },
              get inUse() {
                return e._nActiveBindings
              }
            },
            controlInterpolants: {
              get total() {
                return e._controlInterpolants.length
              },
              get inUse() {
                return e._nActiveControlInterpolants
              }
            }
          }
        },
        _isActiveAction: function(e) {
          var t = e._cacheIndex;
          return null !== t && t < this._nActiveActions
        },
        _addInactiveAction: function(e, t, i) {
          var n = this._actions,
            r = this._actionsByClip,
            o = r[t];
          if (void(0) === o) {
            o = {
              knownActions: [e],
              actionByRoot: {}
            }, e._byClipCacheIndex = 0, r[t] = o
          } else {
            var a = o.knownActions;
            e._byClipCacheIndex = a.length, a.push(e)
          };
          e._cacheIndex = n.length, n.push(e), o.actionByRoot[i] = e
        },
        _removeInactiveAction: function(e) {
          var t = this._actions,
            i = t[t.length - 1],
            n = e._cacheIndex;
          i._cacheIndex = n, t[n] = i, t.pop(), e._cacheIndex = null;
          var r = e._clip.name,
            o = this._actionsByClip,
            a = o[r],
            s = a.knownActions,
            h = s[s.length - 1],
            l = e._byClipCacheIndex;
          h._byClipCacheIndex = l, s[l] = h, s.pop(), e._byClipCacheIndex = null;
          var c = a.actionByRoot,
            u = (t._localRoot || this._root).uuid;
          delete c[u], 0 === s.length && delete o[r], this._removeInactiveBindingsForAction(e)
        },
        _removeInactiveBindingsForAction: function(e) {
          for (var t = e._propertyBindings, i = 0, n = t.length; i !== n; ++i) {
            var r = t[i];
            0 === --r.referenceCount && this._removeInactiveBinding(r)
          }
        },
        _lendAction: function(e) {
          var t = this._actions,
            i = e._cacheIndex,
            n = this._nActiveActions++,
            r = t[n];
          e._cacheIndex = n, t[n] = e, r._cacheIndex = i, t[i] = r
        },
        _takeBackAction: function(e) {
          var t = this._actions,
            i = e._cacheIndex,
            n = --this._nActiveActions,
            r = t[n];
          e._cacheIndex = n, t[n] = e, r._cacheIndex = i, t[i] = r
        },
        _addInactiveBinding: function(e, t, i) {
          var n = this._bindingsByRootAndName,
            r = n[t],
            o = this._bindings;
          void(0) === r && (r = {}, n[t] = r), r[i] = e, e._cacheIndex = o.length, o.push(e)
        },
        _removeInactiveBinding: function(e) {
          var t = this._bindings,
            i = e.binding,
            n = i.rootNode.uuid,
            r = i.path,
            o = this._bindingsByRootAndName,
            a = o[n],
            s = t[t.length - 1],
            h = e._cacheIndex;
          s._cacheIndex = h, t[h] = s, t.pop(), delete a[r];
          e: {
            for (var l in a) {
              break e
            };delete o[n]
          }
        },
        _lendBinding: function(e) {
          var t = this._bindings,
            i = e._cacheIndex,
            n = this._nActiveBindings++,
            r = t[n];
          e._cacheIndex = n, t[n] = e, r._cacheIndex = i, t[i] = r
        },
        _takeBackBinding: function(e) {
          var t = this._bindings,
            i = e._cacheIndex,
            n = --this._nActiveBindings,
            r = t[n];
          e._cacheIndex = n, t[n] = e, r._cacheIndex = i, t[i] = r
        },
        _lendControlInterpolant: function() {
          var e = this._controlInterpolants,
            t = this._nActiveControlInterpolants++,
            i = e[t];
          return void(0) === i && (i = new n.LinearInterpolant(new Float32Array(2), new Float32Array(2), 1, this._controlInterpolantsResultBuffer), i.__cacheIndex = t, e[t] = i), i
        },
        _takeBackControlInterpolant: function(e) {
          var t = this._controlInterpolants,
            i = e.__cacheIndex,
            n = --this._nActiveControlInterpolants,
            r = t[n];
          e.__cacheIndex = n, t[n] = e, r.__cacheIndex = i, t[i] = r
        },
        _controlInterpolantsResultBuffer: new Float32Array(1)
      }), n.AnimationObjectGroup = function(e) {
        this.uuid = n.Math.generateUUID(), this._objects = Array.prototype.slice.call(arguments), this.nCachedObjects_ = 0;
        var t = {};
        this._indicesByUUID = t;
        for (var i = 0, r = arguments.length; i !== r; ++i) {
          t[arguments[i].uuid] = i
        };
        this._paths = [], this._parsedPaths = [], this._bindings = [], this._bindingsIndicesByPath = {};
        var o = this;
        this.stats = {
          objects: {
            get total() {
              return o._objects.length
            },
            get inUse() {
              return this.total - o.nCachedObjects_
            }
          },
          get bindingsPerObject() {
            return o._bindings.length
          }
        }
      }, n.AnimationObjectGroup.prototype = {
        constructor: n.AnimationObjectGroup,
        add: function(e) {
          for (var t = this._objects, i = t.length, r = this.nCachedObjects_, o = this._indicesByUUID, a = this._paths, s = this._parsedPaths, h = this._bindings, l = h.length, c = 0, u = arguments.length; c !== u; ++c) {
            var d = arguments[c],
              p = d.uuid,
              f = o[p];
            if (void(0) === f) {
              f = i++, o[p] = f, t.push(d);
              for (var m = 0, g = l; m !== g; ++m) {
                h[m].push(new n.PropertyBinding(d, a[m], s[m]))
              }
            } else {
              if (r > f) {
                var v = t[f],
                  y = --r,
                  b = t[y];
                o[b.uuid] = f, t[f] = b, o[p] = y, t[y] = d;
                for (var m = 0, g = l; m !== g; ++m) {
                  var w = h[m],
                    _ = w[y],
                    x = w[f];
                  w[f] = _, void(0) === x && (x = new n.PropertyBinding(d, a[m], s[m])), w[y] = x
                }
              } else {
                t[f] !== v && console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")
              }
            }
          };
          this.nCachedObjects_ = r
        },
        remove: function(e) {
          for (var t = this._objects, i = (t.length, this.nCachedObjects_), n = this._indicesByUUID, r = this._bindings, o = r.length, a = 0, s = arguments.length; a !== s; ++a) {
            var h = arguments[a],
              l = h.uuid,
              c = n[l];
            if (void(0) !== c && c >= i) {
              var u = i++,
                d = t[u];
              n[d.uuid] = c, t[c] = d, n[l] = u, t[u] = h;
              for (var p = 0, f = o; p !== f; ++p) {
                var m = r[p],
                  g = m[u],
                  v = m[c];
                m[c] = g, m[u] = v
              }
            }
          };
          this.nCachedObjects_ = i
        },
        uncache: function(e) {
          for (var t = this._objects, i = t.length, n = this.nCachedObjects_, r = this._indicesByUUID, o = this._bindings, a = o.length, s = 0, h = arguments.length; s !== h; ++s) {
            var l = arguments[s],
              c = l.uuid,
              u = r[c];
            if (void(0) !== u) {
              if (delete r[c], n > u) {
                var d = --n,
                  p = t[d],
                  f = --i,
                  m = t[f];
                r[p.uuid] = u, t[u] = p, r[m.uuid] = d, t[d] = m, t.pop();
                for (var g = 0, v = a; g !== v; ++g) {
                  var y = o[g],
                    b = y[d],
                    w = y[f];
                  y[u] = b, y[d] = w, y.pop()
                }
              } else {
                var f = --i,
                  m = t[f];
                r[m.uuid] = u, t[u] = m, t.pop();
                for (var g = 0, v = a; g !== v; ++g) {
                  var y = o[g];
                  y[u] = y[f], y.pop()
                }
              }
            }
          };
          this.nCachedObjects_ = n
        },
        subscribe_: function(e, t) {
          var i = this._bindingsIndicesByPath,
            r = i[e],
            o = this._bindings;
          if (void(0) !== r) {
            return o[r]
          };
          var a = this._paths,
            s = this._parsedPaths,
            h = this._objects,
            l = h.length,
            c = this.nCachedObjects_,
            u = new Array(l);
          r = o.length, i[e] = r, a.push(e), s.push(t), o.push(u);
          for (var d = c, p = h.length; d !== p; ++d) {
            var f = h[d];
            u[d] = new n.PropertyBinding(f, e, t)
          };
          return u
        },
        unsubscribe_: function(e) {
          var t = this._bindingsIndicesByPath,
            i = t[e];
          if (void(0) !== i) {
            var n = this._paths,
              r = this._parsedPaths,
              o = this._bindings,
              a = o.length - 1,
              s = o[a],
              h = e[a];
            t[h] = i, o[i] = s, o.pop(), r[i] = r[a], r.pop(), n[i] = n[a], n.pop()
          }
        }
      }, n.AnimationUtils = {
        arraySlice: function(e, t, i) {
          return n.AnimationUtils.isTypedArray(e) ? new e.constructor(e.subarray(t, i)) : e.slice(t, i)
        },
        convertArray: function(e, t, i) {
          return !e || !i && e.constructor === t ? e : "number" == typeof t.BYTES_PER_ELEMENT ? new t(e) : Array.prototype.slice.call(e)
        },
        isTypedArray: function(e) {
          return ArrayBuffer.isView(e) && !(e instanceof DataView)
        },
        getKeyframeOrder: function(e) {
          function t(t, i) {
            return e[t] - e[i]
          }
          for (var i = e.length, n = new Array(i), r = 0; r !== i; ++r) {
            n[r] = r
          };
          return n.sort(t), n
        },
        sortedArray: function(e, t, i) {
          for (var n = e.length, r = new e.constructor(n), o = 0, a = 0; a !== n; ++o) {
            for (var s = i[o] * t, h = 0; h !== t; ++h) {
              r[a++] = e[s + h]
            }
          };
          return r
        },
        flattenJSON: function(e, t, i, n) {
          for (var r = 1, o = e[0]; void(0) !== o && void(0) === o[n];) {
            o = e[r++]
          };
          if (void(0) !== o) {
            var a = o[n];
            if (void(0) !== a) {
              if (Array.isArray(a)) {
                do {
                  a = o[n], void(0) !== a && (t.push(o.time), i.push.apply(i, a)), o = e[r++]
                } while (void(0) !== o);
              } else {
                if (void(0) !== a.toArray) {
                  do {
                    a = o[n], void(0) !== a && (t.push(o.time), a.toArray(i, i.length)), o = e[r++]
                  } while (void(0) !== o);
                } else {
                  do {
                    a = o[n], void(0) !== a && (t.push(o.time), i.push(a)), o = e[r++]
                  } while (void(0) !== o);
                }
              }
            }
          }
        }
      }, n.KeyframeTrack = function(e, t, i, r) {
        if (void(0) === e) {
          throw new Error("track name is undefined")
        };
        if (void(0) === t || 0 === t.length) {
          throw new Error("no keyframes in track named " + e)
        };
        this.name = e, this.times = n.AnimationUtils.convertArray(t, this.TimeBufferType), this.values = n.AnimationUtils.convertArray(i, this.ValueBufferType), this.setInterpolation(r || this.DefaultInterpolation), this.validate(), this.optimize()
      }, n.KeyframeTrack.prototype = {
        constructor: n.KeyframeTrack,
        TimeBufferType: Float32Array,
        ValueBufferType: Float32Array,
        DefaultInterpolation: n.InterpolateLinear,
        InterpolantFactoryMethodDiscrete: function(e) {
          return new n.DiscreteInterpolant(this.times, this.values, this.getValueSize(), e)
        },
        InterpolantFactoryMethodLinear: function(e) {
          return new n.LinearInterpolant(this.times, this.values, this.getValueSize(), e)
        },
        InterpolantFactoryMethodSmooth: function(e) {
          return new n.CubicInterpolant(this.times, this.values, this.getValueSize(), e)
        },
        setInterpolation: function(e) {
          var t = void(0);
          switch (e) {
            case n.InterpolateDiscrete:
              t = this.InterpolantFactoryMethodDiscrete;
              break;
            case n.InterpolateLinear:
              t = this.InterpolantFactoryMethodLinear;
              break;
            case n.InterpolateSmooth:
              t = this.InterpolantFactoryMethodSmooth
          };
          if (void(0) === t) {
            var i = "unsupported interpolation for " + this.ValueTypeName + " keyframe track named " + this.name;
            if (void(0) === this.createInterpolant) {
              if (e === this.DefaultInterpolation) {
                throw new Error(i)
              };
              this.setInterpolation(this.DefaultInterpolation)
            };
            return void(console.warn(i))
          };
          this.createInterpolant = t
        },
        getInterpolation: function() {
          switch (this.createInterpolant) {
            case this.InterpolantFactoryMethodDiscrete:
              return n.InterpolateDiscrete;
            case this.InterpolantFactoryMethodLinear:
              return n.InterpolateLinear;
            case this.InterpolantFactoryMethodSmooth:
              return n.InterpolateSmooth
          }
        },
        getValueSize: function() {
          return this.values.length / this.times.length
        },
        shift: function(e) {
          if (0 !== e) {
            for (var t = this.times, i = 0, n = t.length; i !== n; ++i) {
              t[i] += e
            }
          };
          return this
        },
        scale: function(e) {
          if (1 !== e) {
            for (var t = this.times, i = 0, n = t.length; i !== n; ++i) {
              t[i] *= e
            }
          };
          return this
        },
        trim: function(e, t) {
          for (var i = this.times, r = i.length, o = 0, a = r - 1; o !== r && i[o] < e;) {
            ++o
          };
          for (; - 1 !== a && i[a] > t;) {
            --a
          };
          if (++a, 0 !== o || a !== r) {
            o >= a && (a = Math.max(a, 1), o = a - 1);
            var s = this.getValueSize();
            this.times = n.AnimationUtils.arraySlice(i, o, a), this.values = n.AnimationUtils.arraySlice(this.values, o * s, a * s)
          };
          return this
        },
        validate: function() {
          var e = !0,
            t = this.getValueSize();
          t - Math.floor(t) !== 0 && (console.error("invalid value size in track", this), e = !1);
          var i = this.times,
            r = this.values,
            o = i.length;
          0 === o && (console.error("track is empty", this), e = !1);
          for (var a = null, s = 0; s !== o; s++) {
            var h = i[s];
            if ("number" == typeof h && isNaN(h)) {
              console.error("time is not a valid number", this, s, h), e = !1;
              break
            };
            if (null !== a && a > h) {
              console.error("out of order keys", this, s, h, a), e = !1;
              break
            };
            a = h
          };
          if (void(0) !== r && n.AnimationUtils.isTypedArray(r)) {
            for (var s = 0, l = r.length; s !== l; ++s) {
              var c = r[s];
              if (isNaN(c)) {
                console.error("value is not a valid number", this, s, c), e = !1;
                break
              }
            }
          };
          return e
        },
        optimize: function() {
          for (var e = this.times, t = this.values, i = this.getValueSize(), r = 1, o = 1, a = e.length - 1; a >= o; ++o) {
            var s = !1,
              h = e[o],
              l = e[o + 1];
            if (h !== l && (1 !== o || h !== h[0])) {
              for (var c = o * i, u = c - i, d = c + i, p = 0; p !== i; ++p) {
                var f = t[c + p];
                if (f !== t[u + p] || f !== t[d + p]) {
                  s = !0;
                  break
                }
              }
            };
            if (s) {
              if (o !== r) {
                e[r] = e[o];
                for (var m = o * i, g = r * i, p = 0; p !== i; ++p) {
                  t[g + p] = t[m + p]
                }
              };
              ++r
            }
          };
          return r !== e.length && (this.times = n.AnimationUtils.arraySlice(e, 0, r), this.values = n.AnimationUtils.arraySlice(t, 0, r * i)), this
        }
      }, Object.assign(n.KeyframeTrack, {
        parse: function(e) {
          if (void(0) === e.type) {
            throw new Error("track type undefined, can not parse")
          };
          var t = n.KeyframeTrack._getTrackTypeForValueTypeName(e.type);
          if (void(0) === e.times) {
            console.warn("legacy JSON format detected, converting");
            var i = [],
              r = [];
            n.AnimationUtils.flattenJSON(e.keys, i, r, "value"), e.times = i, e.values = r
          };
          return void(0) !== t.parse ? t.parse(e) : new t(e.name, e.times, e.values, e.interpolation)
        },
        toJSON: function(e) {
          var t, i = e.constructor;
          if (void(0) !== i.toJSON) {
            t = i.toJSON(e)
          } else {
            t = {
              name: e.name,
              times: n.AnimationUtils.convertArray(e.times, Array),
              values: n.AnimationUtils.convertArray(e.values, Array)
            };
            var r = e.getInterpolation();
            r !== e.DefaultInterpolation && (t.interpolation = r)
          };
          return t.type = e.ValueTypeName, t
        },
        _getTrackTypeForValueTypeName: function(e) {
          switch (e.toLowerCase()) {
            case "scalar":
              ;
            case "double":
              ;
            case "float":
              ;
            case "number":
              ;
            case "integer":
              return n.NumberKeyframeTrack;
            case "vector":
              ;
            case "vector2":
              ;
            case "vector3":
              ;
            case "vector4":
              return n.VectorKeyframeTrack;
            case "color":
              return n.ColorKeyframeTrack;
            case "quaternion":
              return n.QuaternionKeyframeTrack;
            case "bool":
              ;
            case "boolean":
              return n.BooleanKeyframeTrack;
            case "string":
              return n.StringKeyframeTrack
          };
          throw new Error("Unsupported typeName: " + e)
        }
      }), n.PropertyBinding = function(e, t, i) {
        this.path = t, this.parsedPath = i || n.PropertyBinding.parseTrackName(t), this.node = n.PropertyBinding.findNode(e, this.parsedPath.nodeName) || e, this.rootNode = e
      }, n.PropertyBinding.prototype = {
        constructor: n.PropertyBinding,
        getValue: function(e, t) {
          this.bind(), this.getValue(e, t)
        },
        setValue: function(e, t) {
          this.bind(), this.setValue(e, t)
        },
        bind: function() {
          var e = this.node,
            t = this.parsedPath,
            i = t.objectName,
            r = t.propertyName,
            o = t.propertyIndex;
          if (e || (e = n.PropertyBinding.findNode(this.rootNode, t.nodeName) || this.rootNode, this.node = e), this.getValue = this._getValue_unavailable, this.setValue = this._setValue_unavailable, !e) {
            return void(console.error("  trying to update node for track: " + this.path + " but it wasn't found."))
          };
          if (i) {
            var a = t.objectIndex;
            switch (i) {
              case "materials":
                if (!e.material) {
                  return void(console.error("  can not bind to material as node does not have a material", this))
                };
                if (!e.material.materials) {
                  return void(console.error("  can not bind to material.materials as node.material does not have a materials array", this))
                };
                e = e.material.materials;
                break;
              case "bones":
                if (!e.skeleton) {
                  return void(console.error("  can not bind to bones as node does not have a skeleton", this))
                };
                e = e.skeleton.bones;
                for (var s = 0; s < e.length; s++) {
                  if (e[s].name === a) {
                    a = s;
                    break
                  }
                };
                break;
              default:
                if (void(0) === e[i]) {
                  return void(console.error("  can not bind to objectName of node, undefined", this))
                };
                e = e[i]
            };
            if (void(0) !== a) {
              if (void(0) === e[a]) {
                return void(console.error("  trying to bind to objectIndex of objectName, but is undefined:", this, e))
              };
              e = e[a]
            }
          };
          var h = e[r];
          if (!h) {
            var l = t.nodeName;
            return void(console.error("  trying to update property for track: " + l + "." + r + " but it wasn't found.", e))
          };
          var c = this.Versioning.None;
          void(0) !== e.needsUpdate ? (c = this.Versioning.NeedsUpdate, this.targetObject = e) : void(0) !== e.matrixWorldNeedsUpdate && (c = this.Versioning.MatrixWorldNeedsUpdate, this.targetObject = e);
          var u = this.BindingType.Direct;
          if (void(0) !== o) {
            if ("morphTargetInfluences" === r) {
              if (!e.geometry) {
                return void(console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry", this))
              };
              if (!e.geometry.morphTargets) {
                return void(console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets", this))
              };
              for (var s = 0; s < this.node.geometry.morphTargets.length; s++) {
                if (e.geometry.morphTargets[s].name === o) {
                  o = s;
                  break
                }
              }
            };
            u = this.BindingType.ArrayElement, this.resolvedProperty = h, this.propertyIndex = o
          } else {
            void(0) !== h.fromArray && void(0) !== h.toArray ? (u = this.BindingType.HasFromToArray, this.resolvedProperty = h) : void(0) !== h.length ? (u = this.BindingType.EntireArray, this.resolvedProperty = h) : this.propertyName = r
          };
          this.getValue = this.GetterByBindingType[u], this.setValue = this.SetterByBindingTypeAndVersioning[u][c]
        },
        unbind: function() {
          this.node = null, this.getValue = this._getValue_unbound, this.setValue = this._setValue_unbound
        }
      }, Object.assign(n.PropertyBinding.prototype, {
        _getValue_unavailable: function() {},
        _setValue_unavailable: function() {},
        _getValue_unbound: n.PropertyBinding.prototype.getValue,
        _setValue_unbound: n.PropertyBinding.prototype.setValue,
        BindingType: {
          Direct: 0,
          EntireArray: 1,
          ArrayElement: 2,
          HasFromToArray: 3
        },
        Versioning: {
          None: 0,
          NeedsUpdate: 1,
          MatrixWorldNeedsUpdate: 2
        },
        GetterByBindingType: [function(e, t) {
          e[t] = this.node[this.propertyName]
        }, function(e, t) {
          for (var i = this.resolvedProperty, n = 0, r = i.length; n !== r; ++n) {
            e[t++] = i[n]
          }
        }, function(e, t) {
          e[t] = this.resolvedProperty[this.propertyIndex]
        }, function(e, t) {
          this.resolvedProperty.toArray(e, t)
        }],
        SetterByBindingTypeAndVersioning: [
          [function(e, t) {
            this.node[this.propertyName] = e[t]
          }, function(e, t) {
            this.node[this.propertyName] = e[t], this.targetObject.needsUpdate = !0
          }, function(e, t) {
            this.node[this.propertyName] = e[t], this.targetObject.matrixWorldNeedsUpdate = !0
          }],
          [function(e, t) {
            for (var i = this.resolvedProperty, n = 0, r = i.length; n !== r; ++n) {
              i[n] = e[t++]
            }
          }, function(e, t) {
            for (var i = this.resolvedProperty, n = 0, r = i.length; n !== r; ++n) {
              i[n] = e[t++]
            };
            this.targetObject.needsUpdate = !0
          }, function(e, t) {
            for (var i = this.resolvedProperty, n = 0, r = i.length; n !== r; ++n) {
              i[n] = e[t++]
            };
            this.targetObject.matrixWorldNeedsUpdate = !0
          }],
          [function(e, t) {
            this.resolvedProperty[this.propertyIndex] = e[t]
          }, function(e, t) {
            this.resolvedProperty[this.propertyIndex] = e[t], this.targetObject.needsUpdate = !0
          }, function(e, t) {
            this.resolvedProperty[this.propertyIndex] = e[t], this.targetObject.matrixWorldNeedsUpdate = !0
          }],
          [function(e, t) {
            this.resolvedProperty.fromArray(e, t)
          }, function(e, t) {
            this.resolvedProperty.fromArray(e, t), this.targetObject.needsUpdate = !0
          }, function(e, t) {
            this.resolvedProperty.fromArray(e, t), this.targetObject.matrixWorldNeedsUpdate = !0
          }]
        ]
      }), n.PropertyBinding.Composite = function(e, t, i) {
        var r = i || n.PropertyBinding.parseTrackName(t);
        this._targetGroup = e, this._bindings = e.subscribe_(t, r)
      }, n.PropertyBinding.Composite.prototype = {
        constructor: n.PropertyBinding.Composite,
        getValue: function(e, t) {
          this.bind();
          var i = this._targetGroup.nCachedObjects_,
            n = this._bindings[i];
          void(0) !== n && n.getValue(e, t)
        },
        setValue: function(e, t) {
          for (var i = this._bindings, n = this._targetGroup.nCachedObjects_, r = i.length; n !== r; ++n) {
            i[n].setValue(e, t)
          }
        },
        bind: function() {
          for (var e = this._bindings, t = this._targetGroup.nCachedObjects_, i = e.length; t !== i; ++t) {
            e[t].bind()
          }
        },
        unbind: function() {
          for (var e = this._bindings, t = this._targetGroup.nCachedObjects_, i = e.length; t !== i; ++t) {
            e[t].unbind()
          }
        }
      }, n.PropertyBinding.create = function(e, t, i) {
        return e instanceof n.AnimationObjectGroup ? new n.PropertyBinding.Composite(e, t, i) : new n.PropertyBinding(e, t, i)
      }, n.PropertyBinding.parseTrackName = function(e) {
        var t = /^(([\w]+\/)*)([\w-\d]+)?(\.([\w]+)(\[([\w\d\[\]\_.:\- ]+)\])?)?(\.([\w.]+)(\[([\w\d\[\]\_. ]+)\])?)$/,
          i = t.exec(e);
        if (!i) {
          throw new Error("cannot parse trackName at all: " + e)
        };
        i.index === t.lastIndex && t.lastIndex++;
        var n = {
          nodeName: i[3],
          objectName: i[5],
          objectIndex: i[7],
          propertyName: i[9],
          propertyIndex: i[11]
        };
        if (null === n.propertyName || 0 === n.propertyName.length) {
          throw new Error("can not parse propertyName from trackName: " + e)
        };
        return n
      }, n.PropertyBinding.findNode = function(e, t) {
        if (!t || "" === t || "root" === t || "." === t || -1 === t || t === e.name || t === e.uuid) {
          return e
        };
        if (e.skeleton) {
          var i = function(e) {
              for (var i = 0; i < e.bones.length; i++) {
                var n = e.bones[i];
                if (n.name === t) {
                  return n
                }
              };
              return null
            },
            n = i(e.skeleton);
          if (n) {
            return n
          }
        };
        if (e.children) {
          var r = function(e) {
              for (var i = 0; i < e.length; i++) {
                var n = e[i];
                if (n.name === t || n.uuid === t) {
                  return n
                };
                var o = r(n.children);
                if (o) {
                  return o
                }
              };
              return null
            },
            o = r(e.children);
          if (o) {
            return o
          }
        };
        return null
      }, n.PropertyMixer = function(e, t, i) {
        this.binding = e, this.valueSize = i;
        var n, r = Float64Array;
        switch (t) {
          case "quaternion":
            n = this._slerp;
            break;
          case "string":
            ;
          case "bool":
            r = Array, n = this._select;
            break;
          default:
            n = this._lerp
        };
        this.buffer = new r(4 * i), this._mixBufferRegion = n, this.cumulativeWeight = 0, this.useCount = 0, this.referenceCount = 0
      }, n.PropertyMixer.prototype = {
        constructor: n.PropertyMixer,
        accumulate: function(e, t) {
          var i = this.buffer,
            n = this.valueSize,
            r = e * n + n,
            o = this.cumulativeWeight;
          if (0 === o) {
            for (var a = 0; a !== n; ++a) {
              i[r + a] = i[a]
            };
            o = t
          } else {
            o += t;
            var s = t / o;
            this._mixBufferRegion(i, r, 0, s, n)
          };
          this.cumulativeWeight = o
        },
        apply: function(e) {
          var t = this.valueSize,
            i = this.buffer,
            n = e * t + t,
            r = this.cumulativeWeight,
            o = this.binding;
          if (this.cumulativeWeight = 0, 1 > r) {
            var a = 3 * t;
            this._mixBufferRegion(i, n, a, 1 - r, t)
          };
          for (var s = t, h = t + t; s !== h; ++s) {
            if (i[s] !== i[s + t]) {
              o.setValue(i, n);
              break
            }
          }
        },
        saveOriginalState: function() {
          var e = this.binding,
            t = this.buffer,
            i = this.valueSize,
            n = 3 * i;
          e.getValue(t, n);
          for (var r = i, o = n; r !== o; ++r) {
            t[r] = t[n + r % i]
          };
          this.cumulativeWeight = 0
        },
        restoreOriginalState: function() {
          var e = 3 * this.valueSize;
          this.binding.setValue(this.buffer, e)
        },
        _select: function(e, t, i, n, r) {
          if (n >= 0.5) {
            for (var o = 0; o !== r; ++o) {
              e[t + o] = e[i + o]
            }
          }
        },
        _slerp: function(e, t, i, r, o) {
          n.Quaternion.slerpFlat(e, t, e, t, e, i, r)
        },
        _lerp: function(e, t, i, n, r) {
          for (var o = 1 - n, a = 0; a !== r; ++a) {
            var s = t + a;
            e[s] = e[s] * o + e[i + a] * n
          }
        }
      }, n.BooleanKeyframeTrack = function(e, t, i) {
        n.KeyframeTrack.call(this, e, t, i)
      }, n.BooleanKeyframeTrack.prototype = Object.assign(Object.create(n.KeyframeTrack.prototype), {
        constructor: n.BooleanKeyframeTrack,
        ValueTypeName: "bool",
        ValueBufferType: Array,
        DefaultInterpolation: n.IntepolateDiscrete,
        InterpolantFactoryMethodLinear: void(0),
        InterpolantFactoryMethodSmooth: void(0)
      }), n.NumberKeyframeTrack = function(e, t, i, r) {
        n.KeyframeTrack.call(this, e, t, i, r)
      }, n.NumberKeyframeTrack.prototype = Object.assign(Object.create(n.KeyframeTrack.prototype), {
        constructor: n.NumberKeyframeTrack,
        ValueTypeName: "number"
      }), n.QuaternionKeyframeTrack = function(e, t, i, r) {
        n.KeyframeTrack.call(this, e, t, i, r)
      }, n.QuaternionKeyframeTrack.prototype = Object.assign(Object.create(n.KeyframeTrack.prototype), {
        constructor: n.QuaternionKeyframeTrack,
        ValueTypeName: "quaternion",
        DefaultInterpolation: n.InterpolateLinear,
        InterpolantFactoryMethodLinear: function(e) {
          return new n.QuaternionLinearInterpolant(this.times, this.values, this.getValueSize(), e)
        },
        InterpolantFactoryMethodSmooth: void(0)
      }), n.StringKeyframeTrack = function(e, t, i, r) {
        n.KeyframeTrack.call(this, e, t, i, r)
      }, n.StringKeyframeTrack.prototype = Object.assign(Object.create(n.KeyframeTrack.prototype), {
        constructor: n.StringKeyframeTrack,
        ValueTypeName: "string",
        ValueBufferType: Array,
        DefaultInterpolation: n.IntepolateDiscrete,
        InterpolantFactoryMethodLinear: void(0),
        InterpolantFactoryMethodSmooth: void(0)
      }), n.VectorKeyframeTrack = function(e, t, i, r) {
        n.KeyframeTrack.call(this, e, t, i, r)
      }, n.VectorKeyframeTrack.prototype = Object.assign(Object.create(n.KeyframeTrack.prototype), {
        constructor: n.VectorKeyframeTrack,
        ValueTypeName: "vector"
      }), n.Audio = function(e) {
        n.Object3D.call(this), this.type = "Audio", this.context = e.context, this.source = this.context.createBufferSource(), this.source.onended = this.onEnded.bind(this), this.gain = this.context.createGain(), this.gain.connect(e.getInput()), this.autoplay = !1, this.startTime = 0, this.playbackRate = 1, this.isPlaying = !1, this.hasPlaybackControl = !0, this.sourceType = "empty", this.filter = null
      }, n.Audio.prototype = Object.create(n.Object3D.prototype), n.Audio.prototype.constructor = n.Audio, n.Audio.prototype.getOutput = function() {
        return this.gain
      }, n.Audio.prototype.load = function(e) {
        var t = new n.AudioBuffer(this.context);
        return t.load(e), this.setBuffer(t), this
      }, n.Audio.prototype.setNodeSource = function(e) {
        return this.hasPlaybackControl = !1, this.sourceType = "audioNode", this.source = e, this.connect(), this
      }, n.Audio.prototype.setBuffer = function(e) {
        var t = this;
        return e.onReady(function(e) {
          t.source.buffer = e, t.sourceType = "buffer", t.autoplay && t.play()
        }), this
      }, n.Audio.prototype.play = function() {
        if (this.isPlaying === !0) {
          return void(console.warn("THREE.Audio: Audio is already playing."))
        };
        if (this.hasPlaybackControl === !1) {
          return void(console.warn("THREE.Audio: this Audio has no playback control."))
        };
        var e = this.context.createBufferSource();
        e.buffer = this.source.buffer, e.loop = this.source.loop, e.onended = this.source.onended, e.start(0, this.startTime), e.playbackRate.value = this.playbackRate, this.isPlaying = !0, this.source = e, this.connect()
      }, n.Audio.prototype.pause = function() {
        return this.hasPlaybackControl === !1 ? void(console.warn("THREE.Audio: this Audio has no playback control.")) : (this.source.stop(), void((this.startTime = this.context.currentTime)))
      }, n.Audio.prototype.stop = function() {
        return this.hasPlaybackControl === !1 ? void(console.warn("THREE.Audio: this Audio has no playback control.")) : (this.source.stop(), void((this.startTime = 0)))
      }, n.Audio.prototype.connect = function() {
        null !== this.filter ? (this.source.connect(this.filter), this.filter.connect(this.getOutput())) : this.source.connect(this.getOutput())
      }, n.Audio.prototype.disconnect = function() {
        null !== this.filter ? (this.source.disconnect(this.filter), this.filter.disconnect(this.getOutput())) : this.source.disconnect(this.getOutput())
      }, n.Audio.prototype.getFilter = function() {
        return this.filter
      }, n.Audio.prototype.setFilter = function(e) {
        void(0) === e && (e = null), this.isPlaying === !0 ? (this.disconnect(), this.filter = e, this.connect()) : this.filter = e
      }, n.Audio.prototype.setPlaybackRate = function(e) {
        return this.hasPlaybackControl === !1 ? void(console.warn("THREE.Audio: this Audio has no playback control.")) : (this.playbackRate = e, void((this.isPlaying === !0 && (this.source.playbackRate.value = this.playbackRate))))
      }, n.Audio.prototype.getPlaybackRate = function() {
        return this.playbackRate
      }, n.Audio.prototype.onEnded = function() {
        this.isPlaying = !1
      }, n.Audio.prototype.setLoop = function(e) {
        return this.hasPlaybackControl === !1 ? void(console.warn("THREE.Audio: this Audio has no playback control.")) : void((this.source.loop = e))
      }, n.Audio.prototype.getLoop = function() {
        return this.hasPlaybackControl === !1 ? (console.warn("THREE.Audio: this Audio has no playback control."), !1) : this.source.loop
      }, n.Audio.prototype.setVolume = function(e) {
        this.gain.gain.value = e
      }, n.Audio.prototype.getVolume = function() {
        return this.gain.gain.value
      }, n.AudioAnalyser = function(e, t) {
        this.analyser = e.context.createAnalyser(), this.analyser.fftSize = void(0) !== t ? t : 2048, this.data = new Uint8Array(this.analyser.frequencyBinCount), e.getOutput().connect(this.analyser)
      }, n.AudioAnalyser.prototype = {
        constructor: n.AudioAnalyser,
        getData: function() {
          return this.analyser.getByteFrequencyData(this.data), this.data
        }
      }, n.AudioBuffer = function(e) {
        this.context = e, this.ready = !1, this.readyCallbacks = []
      }, n.AudioBuffer.prototype.load = function(e) {
        var t = this,
          i = new XMLHttpRequest;
        return i.open("GET", e, !0), i.responseType = "arraybuffer", i.onload = function(e) {
          t.context.decodeAudioData(this.response, function(e) {
            t.buffer = e, t.ready = !0;
            for (var i = 0; i < t.readyCallbacks.length; i++) {
              t.readyCallbacks[i](t.buffer)
            };
            t.readyCallbacks = []
          })
        }, i.send(), this
      }, n.AudioBuffer.prototype.onReady = function(e) {
        this.ready ? e(this.buffer) : this.readyCallbacks.push(e)
      }, n.PositionalAudio = function(e) {
        n.Audio.call(this, e), this.panner = this.context.createPanner(), this.panner.connect(this.gain)
      }, n.PositionalAudio.prototype = Object.create(n.Audio.prototype), n.PositionalAudio.prototype.constructor = n.PositionalAudio, n.PositionalAudio.prototype.getOutput = function() {
        return this.panner
      }, n.PositionalAudio.prototype.setRefDistance = function(e) {
        this.panner.refDistance = e
      }, n.PositionalAudio.prototype.getRefDistance = function() {
        return this.panner.refDistance
      }, n.PositionalAudio.prototype.setRolloffFactor = function(e) {
        this.panner.rolloffFactor = e
      }, n.PositionalAudio.prototype.getRolloffFactor = function() {
        return this.panner.rolloffFactor
      }, n.PositionalAudio.prototype.setDistanceModel = function(e) {
        this.panner.distanceModel = e
      }, n.PositionalAudio.prototype.getDistanceModel = function() {
        return this.panner.distanceModel
      }, n.PositionalAudio.prototype.setMaxDistance = function(e) {
        this.panner.maxDistance = e
      }, n.PositionalAudio.prototype.getMaxDistance = function() {
        return this.panner.maxDistance
      }, n.PositionalAudio.prototype.updateMatrixWorld = function() {
        var e = new n.Vector3;
        return function(t) {
          n.Object3D.prototype.updateMatrixWorld.call(this, t), e.setFromMatrixPosition(this.matrixWorld), this.panner.setPosition(e.x, e.y, e.z)
        }
      }(), n.AudioListener = function() {
        n.Object3D.call(this), this.type = "AudioListener", this.context = new(window.AudioContext || window.webkitAudioContext), this.gain = this.context.createGain(), this.gain.connect(this.context.destination), this.filter = null
      }, n.AudioListener.prototype = Object.create(n.Object3D.prototype), n.AudioListener.prototype.constructor = n.AudioListener, n.AudioListener.prototype.getInput = function() {
        return this.gain
      }, n.AudioListener.prototype.removeFilter = function() {
        null !== this.filter && (this.gain.disconnect(this.filter), this.filter.disconnect(this.context.destination), this.gain.connect(this.context.destination), this.filter = null)
      }, n.AudioListener.prototype.setFilter = function(e) {
        null !== this.filter ? (this.gain.disconnect(this.filter), this.filter.disconnect(this.context.destination)) : this.gain.disconnect(this.context.destination), this.filter = e, this.gain.connect(this.filter), this.filter.connect(this.context.destination)
      }, n.AudioListener.prototype.getFilter = function() {
        return this.filter
      }, n.AudioListener.prototype.setMasterVolume = function(e) {
        this.gain.gain.value = e
      }, n.AudioListener.prototype.getMasterVolume = function() {
        return this.gain.gain.value
      }, n.AudioListener.prototype.updateMatrixWorld = function() {
        var e = new n.Vector3,
          t = new n.Quaternion,
          i = new n.Vector3,
          r = new n.Vector3;
        return function(o) {
          n.Object3D.prototype.updateMatrixWorld.call(this, o);
          var a = this.context.listener,
            s = this.up;
          this.matrixWorld.decompose(e, t, i), r["set"](0, 0, -1).applyQuaternion(t), a.setPosition(e.x, e.y, e.z), a.setOrientation(r.x, r.y, r.z, s.x, s.y, s.z)
        }
      }(), n.Camera = function() {
        n.Object3D.call(this), this.type = "Camera", this.matrixWorldInverse = new n.Matrix4, this.projectionMatrix = new n.Matrix4
      }, n.Camera.prototype = Object.create(n.Object3D.prototype), n.Camera.prototype.constructor = n.Camera, n.Camera.prototype.getWorldDirection = function() {
        var e = new n.Quaternion;
        return function(t) {
          var i = t || new n.Vector3;
          return this.getWorldQuaternion(e), i["set"](0, 0, -1).applyQuaternion(e)
        }
      }(), n.Camera.prototype.lookAt = function() {
        var e = new n.Matrix4;
        return function(t) {
          e.lookAt(this.position, t, this.up), this.quaternion.setFromRotationMatrix(e)
        }
      }(), n.Camera.prototype.clone = function() {
        return (new this.constructor).copy(this)
      }, n.Camera.prototype.copy = function(e) {
        return n.Object3D.prototype.copy.call(this, e), this.matrixWorldInverse.copy(e.matrixWorldInverse), this.projectionMatrix.copy(e.projectionMatrix), this
      }, n.CubeCamera = function(e, t, i) {
        n.Object3D.call(this), this.type = "CubeCamera";
        var r = 90,
          o = 1,
          a = new n.PerspectiveCamera(r, o, e, t);
        a.up["set"](0, -1, 0), a.lookAt(new n.Vector3(1, 0, 0)), this.add(a);
        var s = new n.PerspectiveCamera(r, o, e, t);
        s.up["set"](0, -1, 0), s.lookAt(new n.Vector3(-1, 0, 0)), this.add(s);
        var h = new n.PerspectiveCamera(r, o, e, t);
        h.up["set"](0, 0, 1), h.lookAt(new n.Vector3(0, 1, 0)), this.add(h);
        var l = new n.PerspectiveCamera(r, o, e, t);
        l.up["set"](0, 0, -1), l.lookAt(new n.Vector3(0, -1, 0)), this.add(l);
        var c = new n.PerspectiveCamera(r, o, e, t);
        c.up["set"](0, -1, 0), c.lookAt(new n.Vector3(0, 0, 1)), this.add(c);
        var u = new n.PerspectiveCamera(r, o, e, t);
        u.up["set"](0, -1, 0), u.lookAt(new n.Vector3(0, 0, -1)), this.add(u);
        var d = {
          format: n.RGBFormat,
          magFilter: n.LinearFilter,
          minFilter: n.LinearFilter
        };
        this.renderTarget = new n.WebGLRenderTargetCube(i, i, d), this.updateCubeMap = function(e, t) {
          null === this.parent && this.updateMatrixWorld();
          var i = this.renderTarget,
            n = i.texture.generateMipmaps;
          i.texture.generateMipmaps = !1, i.activeCubeFace = 0, e.render(t, a, i), i.activeCubeFace = 1, e.render(t, s, i), i.activeCubeFace = 2, e.render(t, h, i), i.activeCubeFace = 3, e.render(t, l, i), i.activeCubeFace = 4, e.render(t, c, i), i.texture.generateMipmaps = n, i.activeCubeFace = 5, e.render(t, u, i), e.setRenderTarget(null)
        }
      }, n.CubeCamera.prototype = Object.create(n.Object3D.prototype), n.CubeCamera.prototype.constructor = n.CubeCamera, n.OrthographicCamera = function(e, t, i, r, o, a) {
        n.Camera.call(this), this.type = "OrthographicCamera", this.zoom = 1, this.left = e, this.right = t, this.top = i, this.bottom = r, this.near = void(0) !== o ? o : 0.1, this.far = void(0) !== a ? a : 2e3, this.updateProjectionMatrix()
      }, n.OrthographicCamera.prototype = Object.create(n.Camera.prototype), n.OrthographicCamera.prototype.constructor = n.OrthographicCamera, n.OrthographicCamera.prototype.updateProjectionMatrix = function() {
        var e = (this.right - this.left) / (2 * this.zoom),
          t = (this.top - this.bottom) / (2 * this.zoom),
          i = (this.right + this.left) / 2,
          n = (this.top + this.bottom) / 2;
        this.projectionMatrix.makeOrthographic(i - e, i + e, n + t, n - t, this.near, this.far)
      }, n.OrthographicCamera.prototype.copy = function(e) {
        return n.Camera.prototype.copy.call(this, e), this.left = e.left, this.right = e.right, this.top = e.top, this.bottom = e.bottom, this.near = e.near, this.far = e.far, this.zoom = e.zoom, this
      }, n.OrthographicCamera.prototype.toJSON = function(e) {
        var t = n.Object3D.prototype.toJSON.call(this, e);
        return t.object.zoom = this.zoom, t.object.left = this.left, t.object.right = this.right, t.object.top = this.top, t.object.bottom = this.bottom, t.object.near = this.near, t.object.far = this.far, t
      }, n.PerspectiveCamera = function(e, t, i, r) {
        n.Camera.call(this), this.type = "PerspectiveCamera", this.focalLength = 10, this.zoom = 1, this.fov = void(0) !== e ? e : 50, this.aspect = void(0) !== t ? t : 1, this.near = void(0) !== i ? i : 0.1, this.far = void(0) !== r ? r : 2e3, this.updateProjectionMatrix()
      }, n.PerspectiveCamera.prototype = Object.create(n.Camera.prototype), n.PerspectiveCamera.prototype.constructor = n.PerspectiveCamera, n.PerspectiveCamera.prototype.setLens = function(e, t) {
        void(0) === t && (t = 24), this.fov = 2 * n.Math.radToDeg(Math.atan(t / (2 * e))), this.updateProjectionMatrix()
      }, n.PerspectiveCamera.prototype.setViewOffset = function(e, t, i, n, r, o) {
        this.fullWidth = e, this.fullHeight = t, this.x = i, this.y = n, this.width = r, this.height = o, this.updateProjectionMatrix()
      }, n.PerspectiveCamera.prototype.updateProjectionMatrix = function() {
        var e = n.Math.radToDeg(2 * Math.atan(Math.tan(0.5 * n.Math.degToRad(this.fov)) / this.zoom));
        if (this.fullWidth) {
          var t = this.fullWidth / this.fullHeight,
            i = Math.tan(n.Math.degToRad(0.5 * e)) * this.near,
            r = -i,
            o = t * r,
            a = t * i,
            s = Math.abs(a - o),
            h = Math.abs(i - r);
          this.projectionMatrix.makeFrustum(o + this.x * s / this.fullWidth, o + (this.x + this.width) * s / this.fullWidth, i - (this.y + this.height) * h / this.fullHeight, i - this.y * h / this.fullHeight, this.near, this.far)
        } else {
          this.projectionMatrix.makePerspective(e, this.aspect, this.near, this.far)
        }
      }, n.PerspectiveCamera.prototype.copy = function(e) {
        return n.Camera.prototype.copy.call(this, e), this.focalLength = e.focalLength, this.zoom = e.zoom, this.fov = e.fov, this.aspect = e.aspect, this.near = e.near, this.far = e.far, this
      }, n.PerspectiveCamera.prototype.toJSON = function(e) {
        var t = n.Object3D.prototype.toJSON.call(this, e);
        return t.object.focalLength = this.focalLength, t.object.zoom = this.zoom, t.object.fov = this.fov, t.object.aspect = this.aspect, t.object.near = this.near, t.object.far = this.far, t
      }, n.StereoCamera = function() {
        this.type = "StereoCamera", this.aspect = 1, this.cameraL = new n.PerspectiveCamera, this.cameraL.layers.enable(1), this.cameraL.matrixAutoUpdate = !1, this.cameraR = new n.PerspectiveCamera, this.cameraR.layers.enable(2), this.cameraR.matrixAutoUpdate = !1
      }, n.StereoCamera.prototype = {
        constructor: n.StereoCamera,
        update: function() {
          var e, t, i, r, o, a = new n.Matrix4,
            s = new n.Matrix4;
          return function(h) {
            var l = e !== h.focalLength || t !== h.fov || i !== h.aspect * this.aspect || r !== h.near || o !== h.far;
            if (l) {
              e = h.focalLength, t = h.fov, i = h.aspect * this.aspect, r = h.near, o = h.far;
              var c, u, d = h.projectionMatrix.clone(),
                p = 0.032,
                f = p * r / e,
                m = r * Math.tan(n.Math.degToRad(0.5 * t));
              s.elements[12] = -p, a.elements[12] = p, c = -m * i + f, u = m * i + f, d.elements[0] = 2 * r / (u - c), d.elements[8] = (u + c) / (u - c), this.cameraL.projectionMatrix.copy(d), c = -m * i - f, u = m * i - f, d.elements[0] = 2 * r / (u - c), d.elements[8] = (u + c) / (u - c), this.cameraR.projectionMatrix.copy(d)
            };
            this.cameraL.matrixWorld.copy(h.matrixWorld).multiply(s), this.cameraR.matrixWorld.copy(h.matrixWorld).multiply(a)
          }
        }()
      }, n.Light = function(e, t) {
        n.Object3D.call(this), this.type = "Light", this.color = new n.Color(e), this.intensity = void(0) !== t ? t : 1, this.receiveShadow = void(0)
      }, n.Light.prototype = Object.create(n.Object3D.prototype), n.Light.prototype.constructor = n.Light, n.Light.prototype.copy = function(e) {
        return n.Object3D.prototype.copy.call(this, e), this.color.copy(e.color), this.intensity = e.intensity, this
      }, n.Light.prototype.toJSON = function(e) {
        var t = n.Object3D.prototype.toJSON.call(this, e);
        return t.object.color = this.color.getHex(), t.object.intensity = this.intensity, void(0) !== this.groundColor && (t.object.groundColor = this.groundColor.getHex()), void(0) !== this.distance && (t.object.distance = this.distance), void(0) !== this.angle && (t.object.angle = this.angle), void(0) !== this.decay && (t.object.decay = this.decay), void(0) !== this.penumbra && (t.object.penumbra = this.penumbra), t
      }, n.LightShadow = function(e) {
        this.camera = e, this.bias = 0, this.radius = 1, this.mapSize = new n.Vector2(512, 512), this.map = null, this.matrix = new n.Matrix4
      }, n.LightShadow.prototype = {
        constructor: n.LightShadow,
        copy: function(e) {
          return this.camera = e.camera.clone(), this.bias = e.bias, this.radius = e.radius, this.mapSize.copy(e.mapSize), this
        },
        clone: function() {
          return (new this.constructor).copy(this)
        }
      }, n.AmbientLight = function(e, t) {
        n.Light.call(this, e, t), this.type = "AmbientLight", this.castShadow = void(0)
      }, n.AmbientLight.prototype = Object.create(n.Light.prototype), n.AmbientLight.prototype.constructor = n.AmbientLight, n.DirectionalLight = function(e, t) {
        n.Light.call(this, e, t), this.type = "DirectionalLight", this.position["set"](0, 1, 0), this.updateMatrix(), this.target = new n.Object3D, this.shadow = new n.LightShadow(new n.OrthographicCamera(-5, 5, 5, -5, 0.5, 500))
      }, n.DirectionalLight.prototype = Object.create(n.Light.prototype), n.DirectionalLight.prototype.constructor = n.DirectionalLight, n.DirectionalLight.prototype.copy = function(e) {
        return n.Light.prototype.copy.call(this, e), this.target = e.target.clone(), this.shadow = e.shadow.clone(), this
      }, n.HemisphereLight = function(e, t, i) {
        n.Light.call(this, e, i), this.type = "HemisphereLight", this.castShadow = void(0), this.position["set"](0, 1, 0), this.updateMatrix(), this.groundColor = new n.Color(t)
      }, n.HemisphereLight.prototype = Object.create(n.Light.prototype), n.HemisphereLight.prototype.constructor = n.HemisphereLight, n.HemisphereLight.prototype.copy = function(e) {
        return n.Light.prototype.copy.call(this, e), this.groundColor.copy(e.groundColor), this
      }, n.PointLight = function(e, t, i, r) {
        n.Light.call(this, e, t), this.type = "PointLight", this.distance = void(0) !== i ? i : 0, this.decay = void(0) !== r ? r : 1, this.shadow = new n.LightShadow(new n.PerspectiveCamera(90, 1, 0.5, 500))
      }, n.PointLight.prototype = Object.create(n.Light.prototype), n.PointLight.prototype.constructor = n.PointLight, Object.defineProperty(n.PointLight.prototype, "power", {
        get: function() {
          return 4 * this.intensity * Math.PI
        },
        set: function(e) {
          this.intensity = e / (4 * Math.PI)
        }
      }), n.PointLight.prototype.copy = function(e) {
        return n.Light.prototype.copy.call(this, e), this.distance = e.distance, this.decay = e.decay, this.shadow = e.shadow.clone(), this
      }, n.SpotLight = function(e, t, i, r, o, a) {
        n.Light.call(this, e, t), this.type = "SpotLight", this.position["set"](0, 1, 0), this.updateMatrix(), this.target = new n.Object3D, this.distance = void(0) !== i ? i : 0, this.angle = void(0) !== r ? r : Math.PI / 3, this.penumbra = void(0) !== o ? o : 0, this.decay = void(0) !== a ? a : 1, this.shadow = new n.LightShadow(new n.PerspectiveCamera(50, 1, 0.5, 500))
      }, n.SpotLight.prototype = Object.create(n.Light.prototype), n.SpotLight.prototype.constructor = n.SpotLight, Object.defineProperty(n.SpotLight.prototype, "power", {
        get: function() {
          return this.intensity * Math.PI
        },
        set: function(e) {
          this.intensity = e / Math.PI
        }
      }), n.SpotLight.prototype.copy = function(e) {
        return n.Light.prototype.copy.call(this, e), this.distance = e.distance, this.angle = e.angle, this.penumbra = e.penumbra, this.decay = e.decay, this.target = e.target.clone(), this.shadow = e.shadow.clone(), this
      }, n.Cache = {
        enabled: !1,
        files: {},
        add: function(e, t) {
          this.enabled !== !1 && (this.files[e] = t)
        },
        get: function(e) {
          return this.enabled !== !1 ? this.files[e] : void(0)
        },
        remove: function(e) {
          delete this.files[e]
        },
        clear: function() {
          this.files = {}
        }
      }, n.Loader = function() {
        this.onLoadStart = function() {}, this.onLoadProgress = function() {}, this.onLoadComplete = function() {}
      }, n.Loader.prototype = {
        constructor: n.Loader,
        crossOrigin: void(0),
        extractUrlBase: function(e) {
          var t = e.split("/");
          return 1 === t.length ? "./" : (t.pop(), t.join("/") + "/")
        },
        initMaterials: function(e, t, i) {
          for (var n = [], r = 0; r < e.length; ++r) {
            n[r] = this.createMaterial(e[r], t, i)
          };
          return n
        },
        createMaterial: function() {
          var e, t, i;
          return function(r, o, a) {
            function s(e, i, r, s, l) {
              var c, u = o + e,
                d = n.Loader.Handlers["get"](u);
              null !== d ? c = d.load(u) : (t.setCrossOrigin(a), c = t.load(u)), void(0) !== i && (c.repeat.fromArray(i), 1 !== i[0] && (c.wrapS = n.RepeatWrapping), 1 !== i[1] && (c.wrapT = n.RepeatWrapping)), void(0) !== r && c.offset.fromArray(r), void(0) !== s && ("repeat" === s[0] && (c.wrapS = n.RepeatWrapping), "mirror" === s[0] && (c.wrapS = n.MirroredRepeatWrapping), "repeat" === s[1] && (c.wrapT = n.RepeatWrapping), "mirror" === s[1] && (c.wrapT = n.MirroredRepeatWrapping)), void(0) !== l && (c.anisotropy = l);
              var p = n.Math.generateUUID();
              return h[p] = c, p
            }
            void(0) === e && (e = new n.Color), void(0) === t && (t = new n.TextureLoader), void(0) === i && (i = new n.MaterialLoader);
            var h = {},
              l = {
                uuid: n.Math.generateUUID(),
                type: "MeshLambertMaterial"
              };
            for (var c in r) {
              var u = r[c];
              switch (c) {
                case "DbgColor":
                  ;
                case "DbgIndex":
                  ;
                case "opticalDensity":
                  ;
                case "illumination":
                  break;
                case "DbgName":
                  l.name = u;
                  break;
                case "blending":
                  l.blending = n[u];
                  break;
                case "colorAmbient":
                  ;
                case "mapAmbient":
                  console.warn("THREE.Loader.createMaterial:", c, "is no longer supported.");
                  break;
                case "colorDiffuse":
                  l.color = e.fromArray(u).getHex();
                  break;
                case "colorSpecular":
                  l.specular = e.fromArray(u).getHex();
                  break;
                case "colorEmissive":
                  l.emissive = e.fromArray(u).getHex();
                  break;
                case "specularCoef":
                  l.shininess = u;
                  break;
                case "shading":
                  "basic" === u.toLowerCase() && (l.type = "MeshBasicMaterial"), "phong" === u.toLowerCase() && (l.type = "MeshPhongMaterial");
                  break;
                case "mapDiffuse":
                  l.map = s(u, r.mapDiffuseRepeat, r.mapDiffuseOffset, r.mapDiffuseWrap, r.mapDiffuseAnisotropy);
                  break;
                case "mapDiffuseRepeat":
                  ;
                case "mapDiffuseOffset":
                  ;
                case "mapDiffuseWrap":
                  ;
                case "mapDiffuseAnisotropy":
                  break;
                case "mapLight":
                  l.lightMap = s(u, r.mapLightRepeat, r.mapLightOffset, r.mapLightWrap, r.mapLightAnisotropy);
                  break;
                case "mapLightRepeat":
                  ;
                case "mapLightOffset":
                  ;
                case "mapLightWrap":
                  ;
                case "mapLightAnisotropy":
                  break;
                case "mapAO":
                  l.aoMap = s(u, r.mapAORepeat, r.mapAOOffset, r.mapAOWrap, r.mapAOAnisotropy);
                  break;
                case "mapAORepeat":
                  ;
                case "mapAOOffset":
                  ;
                case "mapAOWrap":
                  ;
                case "mapAOAnisotropy":
                  break;
                case "mapBump":
                  l.bumpMap = s(u, r.mapBumpRepeat, r.mapBumpOffset, r.mapBumpWrap, r.mapBumpAnisotropy);
                  break;
                case "mapBumpScale":
                  l.bumpScale = u;
                  break;
                case "mapBumpRepeat":
                  ;
                case "mapBumpOffset":
                  ;
                case "mapBumpWrap":
                  ;
                case "mapBumpAnisotropy":
                  break;
                case "mapNormal":
                  l.normalMap = s(u, r.mapNormalRepeat, r.mapNormalOffset, r.mapNormalWrap, r.mapNormalAnisotropy);
                  break;
                case "mapNormalFactor":
                  l.normalScale = [u, u];
                  break;
                case "mapNormalRepeat":
                  ;
                case "mapNormalOffset":
                  ;
                case "mapNormalWrap":
                  ;
                case "mapNormalAnisotropy":
                  break;
                case "mapSpecular":
                  l.specularMap = s(u, r.mapSpecularRepeat, r.mapSpecularOffset, r.mapSpecularWrap, r.mapSpecularAnisotropy);
                  break;
                case "mapSpecularRepeat":
                  ;
                case "mapSpecularOffset":
                  ;
                case "mapSpecularWrap":
                  ;
                case "mapSpecularAnisotropy":
                  break;
                case "mapAlpha":
                  l.alphaMap = s(u, r.mapAlphaRepeat, r.mapAlphaOffset, r.mapAlphaWrap, r.mapAlphaAnisotropy);
                  break;
                case "mapAlphaRepeat":
                  ;
                case "mapAlphaOffset":
                  ;
                case "mapAlphaWrap":
                  ;
                case "mapAlphaAnisotropy":
                  break;
                case "flipSided":
                  l.side = n.BackSide;
                  break;
                case "doubleSided":
                  l.side = n.DoubleSide;
                  break;
                case "transparency":
                  console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"), l.opacity = u;
                  break;
                case "depthTest":
                  ;
                case "depthWrite":
                  ;
                case "colorWrite":
                  ;
                case "opacity":
                  ;
                case "reflectivity":
                  ;
                case "transparent":
                  ;
                case "visible":
                  ;
                case "wireframe":
                  l[c] = u;
                  break;
                case "vertexColors":
                  u === !0 && (l.vertexColors = n.VertexColors), "face" === u && (l.vertexColors = n.FaceColors);
                  break;
                default:
                  console.error("THREE.Loader.createMaterial: Unsupported", c, u)
              }
            };
            return "MeshBasicMaterial" === l.type && delete l.emissive, "MeshPhongMaterial" !== l.type && delete l.specular, l.opacity < 1 && (l.transparent = !0), i.setTextures(h), i.parse(l)
          }
        }()
      }, n.Loader.Handlers = {
        handlers: [],
        add: function(e, t) {
          this.handlers.push(e, t)
        },
        get: function(e) {
          for (var t = this.handlers, i = 0, n = t.length; n > i; i += 2) {
            var r = t[i],
              o = t[i + 1];
            if (r.test(e)) {
              return o
            }
          };
          return null
        }
      }, n.XHRLoader = function(e) {
        this.manager = void(0) !== e ? e : n.DefaultLoadingManager
      }, n.XHRLoader.prototype = {
        constructor: n.XHRLoader,
        load: function(e, t, i, r) {
          void(0) !== this.path && (e = this.path + e);
          var o = this,
            a = n.Cache["get"](e);
          if (void(0) !== a) {
            return t && setTimeout(function() {
              t(a)
            }, 0), a
          };
          var s = new XMLHttpRequest;
          return s.overrideMimeType("text/plain"), s.open("GET", e, !0), s.addEventListener("load", function(i) {
            var a = i.target.response;
            n.Cache.add(e, a), 200 === this.status ? (t && t(a), o.manager.itemEnd(e)) : 0 === this.status ? (console.warn("THREE.XHRLoader: HTTP Status 0 received."), t && t(a), o.manager.itemEnd(e)) : (r && r(i), o.manager.itemError(e))
          }, !1), void(0) !== i && s.addEventListener("progress", function(e) {
            i(e)
          }, !1), s.addEventListener("error", function(t) {
            r && r(t), o.manager.itemError(e)
          }, !1), void(0) !== this.responseType && (s.responseType = this.responseType), void(0) !== this.withCredentials && (s.withCredentials = this.withCredentials), s.send(null), o.manager.itemStart(e), s
        },
        setPath: function(e) {
          this.path = e
        },
        setResponseType: function(e) {
          this.responseType = e
        },
        setWithCredentials: function(e) {
          this.withCredentials = e
        }
      }, n.FontLoader = function(e) {
        this.manager = void(0) !== e ? e : n.DefaultLoadingManager
      }, n.FontLoader.prototype = {
        constructor: n.FontLoader,
        load: function(e, t, i, r) {
          var o = new n.XHRLoader(this.manager);
          o.load(e, function(e) {
            t(new n.Font(JSON.parse(e.substring(65, e.length - 2))))
          }, i, r)
        }
      }, n.ImageLoader = function(e) {
        this.manager = void(0) !== e ? e : n.DefaultLoadingManager
      }, n.ImageLoader.prototype = {
        constructor: n.ImageLoader,
        load: function(e, t, i, r) {
          void(0) !== this.path && (e = this.path + e);
          var o = this,
            a = n.Cache["get"](e);
          if (void(0) !== a) {
            return o.manager.itemStart(e), t ? setTimeout(function() {
              t(a), o.manager.itemEnd(e)
            }, 0) : o.manager.itemEnd(e), a
          };
          var s = document.createElement("img");
          return s.addEventListener("load", function(i) {
            n.Cache.add(e, this), t && t(this), o.manager.itemEnd(e)
          }, !1), void(0) !== i && s.addEventListener("progress", function(e) {
            i(e)
          }, !1), s.addEventListener("error", function(t) {
            r && r(t), o.manager.itemError(e)
          }, !1), void(0) !== this.crossOrigin && (s.crossOrigin = this.crossOrigin), o.manager.itemStart(e), s.src = e, s
        },
        setCrossOrigin: function(e) {
          this.crossOrigin = e
        },
        setPath: function(e) {
          this.path = e
        }
      }, n.JSONLoader = function(e) {
        "boolean" == typeof e && (console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."), e = void(0)), this.manager = void(0) !== e ? e : n.DefaultLoadingManager, this.withCredentials = !1
      }, n.JSONLoader.prototype = {
        constructor: n.JSONLoader,
        get statusDomElement() {
          return void(0) === this._statusDomElement && (this._statusDomElement = document.createElement("div")), console.warn("THREE.JSONLoader: .statusDomElement has been removed."), this._statusDomElement
        },
        load: function(e, t, i, r) {
          var o = this,
            a = this.texturePath && "string" == typeof this.texturePath ? this.texturePath : n.Loader.prototype.extractUrlBase(e),
            s = new n.XHRLoader(this.manager);
          s.setWithCredentials(this.withCredentials), s.load(e, function(i) {
            var n = JSON.parse(i),
              r = n.metadata;
            if (void(0) !== r) {
              var s = r.type;
              if (void(0) !== s) {
                if ("object" === s.toLowerCase()) {
                  return void(console.error("THREE.JSONLoader: " + e + " should be loaded with THREE.ObjectLoader instead."))
                };
                if ("scene" === s.toLowerCase()) {
                  return void(console.error("THREE.JSONLoader: " + e + " should be loaded with THREE.SceneLoader instead."))
                }
              }
            };
            var h = o.parse(n, a);
            t(h.geometry, h.materials)
          }, i, r)
        },
        setTexturePath: function(e) {
          this.texturePath = e
        },
        parse: function(e, t) {
          function i(t) {
            function i(e, t) {
              return e & 1 << t
            }
            var r, o, a, h, l, c, u, d, p, f, m, g, v, y, b, w, _, x, M, E, S, T, P, A, L, C, R, I = e.faces,
              D = e.vertices,
              O = e.normals,
              k = e.colors,
              B = 0;
            if (void(0) !== e.uvs) {
              for (r = 0; r < e.uvs.length; r++) {
                e.uvs[r].length && B++
              };
              for (r = 0; B > r; r++) {
                s.faceVertexUvs[r] = []
              }
            };
            for (h = 0, l = D.length; l > h;) {
              x = new n.Vector3, x.x = D[h++] * t, x.y = D[h++] * t, x.z = D[h++] * t, s.vertices.push(x)
            };
            for (h = 0, l = I.length; l > h;) {
              if (f = I[h++], m = i(f, 0), g = i(f, 1), v = i(f, 3), y = i(f, 4), b = i(f, 5), w = i(f, 6), _ = i(f, 7), m) {
                if (E = new n.Face3, E.a = I[h], E.b = I[h + 1], E.c = I[h + 3], S = new n.Face3, S.a = I[h + 1], S.b = I[h + 2], S.c = I[h + 3], h += 4, g && (p = I[h++], E.materialIndex = p, S.materialIndex = p), a = s.faces.length, v) {
                  for (r = 0; B > r; r++) {
                    for (A = e.uvs[r], s.faceVertexUvs[r][a] = [], s.faceVertexUvs[r][a + 1] = [], o = 0; 4 > o; o++) {
                      d = I[h++], C = A[2 * d], R = A[2 * d + 1], L = new n.Vector2(C, R), 2 !== o && s.faceVertexUvs[r][a].push(L), 0 !== o && s.faceVertexUvs[r][a + 1].push(L)
                    }
                  }
                };
                if (y && (u = 3 * I[h++], E.normal["set"](O[u++], O[u++], O[u]), S.normal.copy(E.normal)), b) {
                  for (r = 0; 4 > r; r++) {
                    u = 3 * I[h++], P = new n.Vector3(O[u++], O[u++], O[u]), 2 !== r && E.vertexNormals.push(P), 0 !== r && S.vertexNormals.push(P)
                  }
                };
                if (w && (c = I[h++], T = k[c], E.color.setHex(T), S.color.setHex(T)), _) {
                  for (r = 0; 4 > r; r++) {
                    c = I[h++], T = k[c], 2 !== r && E.vertexColors.push(new n.Color(T)), 0 !== r && S.vertexColors.push(new n.Color(T))
                  }
                };
                s.faces.push(E), s.faces.push(S)
              } else {
                if (M = new n.Face3, M.a = I[h++], M.b = I[h++], M.c = I[h++], g && (p = I[h++], M.materialIndex = p), a = s.faces.length, v) {
                  for (r = 0; B > r; r++) {
                    for (A = e.uvs[r], s.faceVertexUvs[r][a] = [], o = 0; 3 > o; o++) {
                      d = I[h++], C = A[2 * d], R = A[2 * d + 1], L = new n.Vector2(C, R), s.faceVertexUvs[r][a].push(L)
                    }
                  }
                };
                if (y && (u = 3 * I[h++], M.normal["set"](O[u++], O[u++], O[u])), b) {
                  for (r = 0; 3 > r; r++) {
                    u = 3 * I[h++], P = new n.Vector3(O[u++], O[u++], O[u]), M.vertexNormals.push(P)
                  }
                };
                if (w && (c = I[h++], M.color.setHex(k[c])), _) {
                  for (r = 0; 3 > r; r++) {
                    c = I[h++], M.vertexColors.push(new n.Color(k[c]))
                  }
                };
                s.faces.push(M)
              }
            }
          }

          function r() {
            var t = void(0) !== e.influencesPerVertex ? e.influencesPerVertex : 2;
            if (e.skinWeights) {
              for (var i = 0, r = e.skinWeights.length; r > i; i += t) {
                var o = e.skinWeights[i],
                  a = t > 1 ? e.skinWeights[i + 1] : 0,
                  h = t > 2 ? e.skinWeights[i + 2] : 0,
                  l = t > 3 ? e.skinWeights[i + 3] : 0;
                s.skinWeights.push(new n.Vector4(o, a, h, l))
              }
            };
            if (e.skinIndices) {
              for (var i = 0, r = e.skinIndices.length; r > i; i += t) {
                var c = e.skinIndices[i],
                  u = t > 1 ? e.skinIndices[i + 1] : 0,
                  d = t > 2 ? e.skinIndices[i + 2] : 0,
                  p = t > 3 ? e.skinIndices[i + 3] : 0;
                s.skinIndices.push(new n.Vector4(c, u, d, p))
              }
            };
            s.bones = e.bones, s.bones && s.bones.length > 0 && (s.skinWeights.length !== s.skinIndices.length || s.skinIndices.length !== s.vertices.length) && console.warn("When skinning, number of vertices (" + s.vertices.length + "), skinIndices (" + s.skinIndices.length + "), and skinWeights (" + s.skinWeights.length + ") should match.")
          }

          function o(t) {
            if (void(0) !== e.morphTargets) {
              for (var i = 0, r = e.morphTargets.length; r > i; i++) {
                s.morphTargets[i] = {}, s.morphTargets[i].name = e.morphTargets[i].name, s.morphTargets[i].vertices = [];
                for (var o = s.morphTargets[i].vertices, a = e.morphTargets[i].vertices, h = 0, l = a.length; l > h; h += 3) {
                  var c = new n.Vector3;
                  c.x = a[h] * t, c.y = a[h + 1] * t, c.z = a[h + 2] * t, o.push(c)
                }
              }
            };
            if (void(0) !== e.morphColors && e.morphColors.length > 0) {
              console.warn("THREE.JSONLoader: \"morphColors\" no longer supported. Using them as face colors.");
              for (var u = s.faces, d = e.morphColors[0].colors, i = 0, r = u.length; r > i; i++) {
                u[i].color.fromArray(d, 3 * i)
              }
            }
          }

          function a() {
            var t = [],
              i = [];
            void(0) !== e.animation && i.push(e.animation), void(0) !== e.animations && (e.animations.length ? i = i.concat(e.animations) : i.push(e.animations));
            for (var r = 0; r < i.length; r++) {
              var o = n.AnimationClip.parseAnimation(i[r], s.bones);
              o && t.push(o)
            };
            if (s.morphTargets) {
              var a = n.AnimationClip.CreateClipsFromMorphTargetSequences(s.morphTargets, 10);
              t = t.concat(a)
            };
            t.length > 0 && (s.animations = t)
          }
          var s = new n.Geometry,
            h = void(0) !== e.scale ? 1 / e.scale : 1;
          if (i(h), r(), o(h), a(), s.computeFaceNormals(), s.computeBoundingSphere(), void(0) === e.materials || 0 === e.materials.length) {
            return {
              geometry: s
            }
          };
          var l = n.Loader.prototype.initMaterials(e.materials, t, this.crossOrigin);
          return {
            geometry: s,
            materials: l
          }
        }
      }, n.LoadingManager = function(e, t, i) {
        var n = this,
          r = !1,
          o = 0,
          a = 0;
        this.onStart = void(0), this.onLoad = e, this.onProgress = t, this.onError = i, this.itemStart = function(e) {
          a++, r === !1 && void(0) !== n.onStart && n.onStart(e, o, a), r = !0
        }, this.itemEnd = function(e) {
          o++, void(0) !== n.onProgress && n.onProgress(e, o, a), o === a && (r = !1, void(0) !== n.onLoad && n.onLoad())
        }, this.itemError = function(e) {
          void(0) !== n.onError && n.onError(e)
        }
      }, n.DefaultLoadingManager = new n.LoadingManager, n.BufferGeometryLoader = function(e) {
        this.manager = void(0) !== e ? e : n.DefaultLoadingManager
      }, n.BufferGeometryLoader.prototype = {
        constructor: n.BufferGeometryLoader,
        load: function(e, t, i, r) {
          var o = this,
            a = new n.XHRLoader(o.manager);
          a.load(e, function(e) {
            t(o.parse(JSON.parse(e)))
          }, i, r)
        },
        parse: function(e) {
          var t = new n.BufferGeometry,
            i = e.data.index,
            r = {
              Int8Array: Int8Array,
              Uint8Array: Uint8Array,
              Uint8ClampedArray: Uint8ClampedArray,
              Int16Array: Int16Array,
              Uint16Array: Uint16Array,
              Int32Array: Int32Array,
              Uint32Array: Uint32Array,
              Float32Array: Float32Array,
              Float64Array: Float64Array
            };
          if (void(0) !== i) {
            var o = new r[i.type](i.array);
            t.setIndex(new n.BufferAttribute(o, 1))
          };
          var a = e.data.attributes;
          for (var s in a) {
            var h = a[s],
              o = new r[h.type](h.array);
            t.addAttribute(s, new n.BufferAttribute(o, h.itemSize))
          };
          var l = e.data.groups || e.data.drawcalls || e.data.offsets;
          if (void(0) !== l) {
            for (var c = 0, u = l.length; c !== u; ++c) {
              var d = l[c];
              t.addGroup(d.start, d.count, d.materialIndex)
            }
          };
          var p = e.data.boundingSphere;
          if (void(0) !== p) {
            var f = new n.Vector3;
            void(0) !== p.center && f.fromArray(p.center), t.boundingSphere = new n.Sphere(f, p.radius)
          };
          return t
        }
      }, n.MaterialLoader = function(e) {
        this.manager = void(0) !== e ? e : n.DefaultLoadingManager, this.textures = {}
      }, n.MaterialLoader.prototype = {
        constructor: n.MaterialLoader,
        load: function(e, t, i, r) {
          var o = this,
            a = new n.XHRLoader(o.manager);
          a.load(e, function(e) {
            t(o.parse(JSON.parse(e)))
          }, i, r)
        },
        setTextures: function(e) {
          this.textures = e
        },
        getTexture: function(e) {
          var t = this.textures;
          return void(0) === t[e] && console.warn("THREE.MaterialLoader: Undefined texture", e), t[e]
        },
        parse: function(e) {
          var t = new n[e.type];
          if (void(0) !== e.uuid && (t.uuid = e.uuid), void(0) !== e.name && (t.name = e.name), void(0) !== e.color && t.color.setHex(e.color), void(0) !== e.roughness && (t.roughness = e.roughness), void(0) !== e.metalness && (t.metalness = e.metalness), void(0) !== e.emissive && t.emissive.setHex(e.emissive), void(0) !== e.specular && t.specular.setHex(e.specular), void(0) !== e.shininess && (t.shininess = e.shininess), void(0) !== e.uniforms && (t.uniforms = e.uniforms), void(0) !== e.vertexShader && (t.vertexShader = e.vertexShader), void(0) !== e.fragmentShader && (t.fragmentShader = e.fragmentShader), void(0) !== e.vertexColors && (t.vertexColors = e.vertexColors), void(0) !== e.shading && (t.shading = e.shading), void(0) !== e.blending && (t.blending = e.blending), void(0) !== e.side && (t.side = e.side), void(0) !== e.opacity && (t.opacity = e.opacity), void(0) !== e.transparent && (t.transparent = e.transparent), void(0) !== e.alphaTest && (t.alphaTest = e.alphaTest), void(0) !== e.depthTest && (t.depthTest = e.depthTest), void(0) !== e.depthWrite && (t.depthWrite = e.depthWrite), void(0) !== e.colorWrite && (t.colorWrite = e.colorWrite), void(0) !== e.wireframe && (t.wireframe = e.wireframe), void(0) !== e.wireframeLinewidth && (t.wireframeLinewidth = e.wireframeLinewidth), void(0) !== e.size && (t.size = e.size), void(0) !== e.sizeAttenuation && (t.sizeAttenuation = e.sizeAttenuation), void(0) !== e.map && (t.map = this.getTexture(e.map)), void(0) !== e.alphaMap && (t.alphaMap = this.getTexture(e.alphaMap), t.transparent = !0), void(0) !== e.bumpMap && (t.bumpMap = this.getTexture(e.bumpMap)), void(0) !== e.bumpScale && (t.bumpScale = e.bumpScale), void(0) !== e.normalMap && (t.normalMap = this.getTexture(e.normalMap)), void(0) !== e.normalScale) {
            var i = e.normalScale;
            Array.isArray(i) === !1 && (i = [i, i]), t.normalScale = (new n.Vector2).fromArray(i)
          };
          if (void(0) !== e.displacementMap && (t.displacementMap = this.getTexture(e.displacementMap)), void(0) !== e.displacementScale && (t.displacementScale = e.displacementScale), void(0) !== e.displacementBias && (t.displacementBias = e.displacementBias), void(0) !== e.roughnessMap && (t.roughnessMap = this.getTexture(e.roughnessMap)), void(0) !== e.metalnessMap && (t.metalnessMap = this.getTexture(e.metalnessMap)), void(0) !== e.emissiveMap && (t.emissiveMap = this.getTexture(e.emissiveMap)), void(0) !== e.emissiveIntensity && (t.emissiveIntensity = e.emissiveIntensity), void(0) !== e.specularMap && (t.specularMap = this.getTexture(e.specularMap)), void(0) !== e.envMap && (t.envMap = this.getTexture(e.envMap), t.combine = n.MultiplyOperation), e.reflectivity && (t.reflectivity = e.reflectivity), void(0) !== e.lightMap && (t.lightMap = this.getTexture(e.lightMap)), void(0) !== e.lightMapIntensity && (t.lightMapIntensity = e.lightMapIntensity), void(0) !== e.aoMap && (t.aoMap = this.getTexture(e.aoMap)), void(0) !== e.aoMapIntensity && (t.aoMapIntensity = e.aoMapIntensity), void(0) !== e.materials) {
            for (var r = 0, o = e.materials.length; o > r; r++) {
              t.materials.push(this.parse(e.materials[r]))
            }
          };
          return t
        }
      }, n.ObjectLoader = function(e) {
        this.manager = void(0) !== e ? e : n.DefaultLoadingManager, this.texturePath = ""
      }, n.ObjectLoader.prototype = {
        constructor: n.ObjectLoader,
        load: function(e, t, i, r) {
          "" === this.texturePath && (this.texturePath = e.substring(0, e.lastIndexOf("/") + 1));
          var o = this,
            a = new n.XHRLoader(o.manager);
          a.load(e, function(e) {
            o.parse(JSON.parse(e), t)
          }, i, r)
        },
        setTexturePath: function(e) {
          this.texturePath = e
        },
        setCrossOrigin: function(e) {
          this.crossOrigin = e
        },
        parse: function(e, t) {
          var i = this.parseGeometries(e.geometries),
            n = this.parseImages(e.images, function() {
              void(0) !== t && t(a)
            }),
            r = this.parseTextures(e.textures, n),
            o = this.parseMaterials(e.materials, r),
            a = this.parseObject(e.object, i, o);
          return e.animations && (a.animations = this.parseAnimations(e.animations)), (void(0) === e.images || 0 === e.images.length) && void(0) !== t && t(a), a
        },
        parseGeometries: function(e) {
          var t = {};
          if (void(0) !== e) {
            for (var i = new n.JSONLoader, r = new n.BufferGeometryLoader, o = 0, a = e.length; a > o; o++) {
              var s, h = e[o];
              switch (h.type) {
                case "PlaneGeometry":
                  ;
                case "PlaneBufferGeometry":
                  s = new n[h.type](h.width, h.height, h.widthSegments, h.heightSegments);
                  break;
                case "BoxGeometry":
                  ;
                case "BoxBufferGeometry":
                  ;
                case "CubeGeometry":
                  s = new n[h.type](h.width, h.height, h.depth, h.widthSegments, h.heightSegments, h.depthSegments);
                  break;
                case "CircleGeometry":
                  ;
                case "CircleBufferGeometry":
                  s = new n[h.type](h.radius, h.segments, h.thetaStart, h.thetaLength);
                  break;
                case "CylinderGeometry":
                  ;
                case "CylinderBufferGeometry":
                  s = new n[h.type](h.radiusTop, h.radiusBottom, h.height, h.radialSegments, h.heightSegments, h.openEnded, h.thetaStart, h.thetaLength);
                  break;
                case "SphereGeometry":
                  ;
                case "SphereBufferGeometry":
                  s = new n[h.type](h.radius, h.widthSegments, h.heightSegments, h.phiStart, h.phiLength, h.thetaStart, h.thetaLength);
                  break;
                case "DodecahedronGeometry":
                  s = new n.DodecahedronGeometry(h.radius, h.detail);
                  break;
                case "IcosahedronGeometry":
                  s = new n.IcosahedronGeometry(h.radius, h.detail);
                  break;
                case "OctahedronGeometry":
                  s = new n.OctahedronGeometry(h.radius, h.detail);
                  break;
                case "TetrahedronGeometry":
                  s = new n.TetrahedronGeometry(h.radius, h.detail);
                  break;
                case "RingGeometry":
                  ;
                case "RingBufferGeometry":
                  s = new n[h.type](h.innerRadius, h.outerRadius, h.thetaSegments, h.phiSegments, h.thetaStart, h.thetaLength);
                  break;
                case "TorusGeometry":
                  ;
                case "TorusBufferGeometry":
                  s = new n[h.type](h.radius, h.tube, h.radialSegments, h.tubularSegments, h.arc);
                  break;
                case "TorusKnotGeometry":
                  ;
                case "TorusKnotBufferGeometry":
                  s = new n[h.type](h.radius, h.tube, h.tubularSegments, h.radialSegments, h.p, h.q);
                  break;
                case "LatheGeometry":
                  s = new n.LatheGeometry(h.points, h.segments, h.phiStart, h.phiLength);
                  break;
                case "BufferGeometry":
                  s = r.parse(h);
                  break;
                case "Geometry":
                  s = i.parse(h.data, this.texturePath).geometry;
                  break;
                default:
                  console.warn("THREE.ObjectLoader: Unsupported geometry type \"" + h.type + "\"");
                  continue
              };
              s.uuid = h.uuid, void(0) !== h.name && (s.name = h.name), t[h.uuid] = s
            }
          };
          return t
        },
        parseMaterials: function(e, t) {
          var i = {};
          if (void(0) !== e) {
            var r = new n.MaterialLoader;
            r.setTextures(t);
            for (var o = 0, a = e.length; a > o; o++) {
              var s = r.parse(e[o]);
              i[s.uuid] = s
            }
          };
          return i
        },
        parseAnimations: function(e) {
          for (var t = [], i = 0; i < e.length; i++) {
            var r = n.AnimationClip.parse(e[i]);
            t.push(r)
          };
          return t
        },
        parseImages: function(e, t) {
          function i(e) {
            return r.manager.itemStart(e), s.load(e, function() {
              r.manager.itemEnd(e)
            })
          }
          var r = this,
            o = {};
          if (void(0) !== e && e.length > 0) {
            var a = new n.LoadingManager(t),
              s = new n.ImageLoader(a);
            s.setCrossOrigin(this.crossOrigin);
            for (var h = 0, l = e.length; l > h; h++) {
              var c = e[h],
                u = /^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url) ? c.url : r.texturePath + c.url;
              o[c.uuid] = i(u)
            }
          };
          return o
        },
        parseTextures: function(e, t) {
          function i(e) {
            return "number" == typeof e ? e : (console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.", e), n[e])
          }
          var r = {};
          if (void(0) !== e) {
            for (var o = 0, a = e.length; a > o; o++) {
              var s = e[o];
              void(0) === s.image && console.warn("THREE.ObjectLoader: No \"image\" specified for", s.uuid), void(0) === t[s.image] && console.warn("THREE.ObjectLoader: Undefined image", s.image);
              var h = new n.Texture(t[s.image]);
              h.needsUpdate = !0, h.uuid = s.uuid, void(0) !== s.name && (h.name = s.name), void(0) !== s.mapping && (h.mapping = i(s.mapping)), void(0) !== s.offset && (h.offset = new n.Vector2(s.offset[0], s.offset[1])), void(0) !== s.repeat && (h.repeat = new n.Vector2(s.repeat[0], s.repeat[1])), void(0) !== s.minFilter && (h.minFilter = i(s.minFilter)), void(0) !== s.magFilter && (h.magFilter = i(s.magFilter)), void(0) !== s.anisotropy && (h.anisotropy = s.anisotropy), Array.isArray(s.wrap) && (h.wrapS = i(s.wrap[0]), h.wrapT = i(s.wrap[1])), r[s.uuid] = h
            }
          };
          return r
        },
        parseObject: function() {
          var e = new n.Matrix4;
          return function(t, i, r) {
            function o(e) {
              return void(0) === i[e] && console.warn("THREE.ObjectLoader: Undefined geometry", e), i[e]
            }

            function a(e) {
              return void(0) === e ? void(0) : (void(0) === r[e] && console.warn("THREE.ObjectLoader: Undefined material", e), r[e])
            }
            var s;
            switch (t.type) {
              case "Scene":
                s = new n.Scene;
                break;
              case "PerspectiveCamera":
                s = new n.PerspectiveCamera(t.fov, t.aspect, t.near, t.far);
                break;
              case "OrthographicCamera":
                s = new n.OrthographicCamera(t.left, t.right, t.top, t.bottom, t.near, t.far);
                break;
              case "AmbientLight":
                s = new n.AmbientLight(t.color, t.intensity);
                break;
              case "DirectionalLight":
                s = new n.DirectionalLight(t.color, t.intensity);
                break;
              case "PointLight":
                s = new n.PointLight(t.color, t.intensity, t.distance, t.decay);
                break;
              case "SpotLight":
                s = new n.SpotLight(t.color, t.intensity, t.distance, t.angle, t.penumbra, t.decay);
                break;
              case "HemisphereLight":
                s = new n.HemisphereLight(t.color, t.groundColor, t.intensity);
                break;
              case "Mesh":
                var h = o(t.geometry),
                  l = a(t.material);
                s = h.bones && h.bones.length > 0 ? new n.SkinnedMesh(h, l) : new n.Mesh(h, l);
                break;
              case "LOD":
                s = new n.LOD;
                break;
              case "Line":
                s = new n.Line(o(t.geometry), a(t.material), t.mode);
                break;
              case "PointCloud":
                ;
              case "Points":
                s = new n.Points(o(t.geometry), a(t.material));
                break;
              case "Sprite":
                s = new n.Sprite(a(t.material));
                break;
              case "Group":
                s = new n.Group;
                break;
              default:
                s = new n.Object3D
            };
            if (s.uuid = t.uuid, void(0) !== t.name && (s.name = t.name), void(0) !== t.matrix ? (e.fromArray(t.matrix), e.decompose(s.position, s.quaternion, s.scale)) : (void(0) !== t.position && s.position.fromArray(t.position), void(0) !== t.rotation && s.rotation.fromArray(t.rotation), void(0) !== t.scale && s.scale.fromArray(t.scale)), void(0) !== t.castShadow && (s.castShadow = t.castShadow), void(0) !== t.receiveShadow && (s.receiveShadow = t.receiveShadow), void(0) !== t.visible && (s.visible = t.visible), void(0) !== t.userData && (s.userData = t.userData), void(0) !== t.children) {
              for (var c in t.children) {
                s.add(this.parseObject(t.children[c], i, r))
              }
            };
            if ("LOD" === t.type) {
              for (var u = t.levels, d = 0; d < u.length; d++) {
                var p = u[d],
                  c = s.getObjectByProperty("uuid", p.object);
                void(0) !== c && s.addLevel(c, p.distance)
              }
            };
            return s
          }
        }()
      }, n.TextureLoader = function(e) {
        this.manager = void(0) !== e ? e : n.DefaultLoadingManager
      }, n.TextureLoader.prototype = {
        constructor: n.TextureLoader,
        load: function(e, t, i, r) {
          var o = new n.Texture,
            a = new n.ImageLoader(this.manager);
          return a.setCrossOrigin(this.crossOrigin), a.setPath(this.path), a.load(e, function(e) {
            o.image = e, o.needsUpdate = !0, void(0) !== t && t(o)
          }, i, r), o
        },
        setCrossOrigin: function(e) {
          this.crossOrigin = e
        },
        setPath: function(e) {
          this.path = e
        }
      }, n.CubeTextureLoader = function(e) {
        this.manager = void(0) !== e ? e : n.DefaultLoadingManager
      }, n.CubeTextureLoader.prototype = {
        constructor: n.CubeTextureLoader,
        load: function(e, t, i, r) {
          function o(i) {
            s.load(e[i], function(e) {
              a.images[i] = e, h++, 6 === h && (a.needsUpdate = !0, t && t(a))
            }, void(0), r)
          }
          var a = new n.CubeTexture,
            s = new n.ImageLoader(this.manager);
          s.setCrossOrigin(this.crossOrigin), s.setPath(this.path);
          for (var h = 0, l = 0; l < e.length; ++l) {
            o(l)
          };
          return a
        },
        setCrossOrigin: function(e) {
          this.crossOrigin = e
        },
        setPath: function(e) {
          this.path = e
        }
      }, n.DataTextureLoader = n.BinaryTextureLoader = function(e) {
        this.manager = void(0) !== e ? e : n.DefaultLoadingManager, this._parser = null
      }, n.BinaryTextureLoader.prototype = {
        constructor: n.BinaryTextureLoader,
        load: function(e, t, i, r) {
          var o = this,
            a = new n.DataTexture,
            s = new n.XHRLoader(this.manager);
          return s.setResponseType("arraybuffer"), s.load(e, function(e) {
            var i = o._parser(e);
            i && (void(0) !== i.image ? a.image = i.image : void(0) !== i.data && (a.image.width = i.width, a.image.height = i.height, a.image.data = i.data), a.wrapS = void(0) !== i.wrapS ? i.wrapS : n.ClampToEdgeWrapping, a.wrapT = void(0) !== i.wrapT ? i.wrapT : n.ClampToEdgeWrapping, a.magFilter = void(0) !== i.magFilter ? i.magFilter : n.LinearFilter, a.minFilter = void(0) !== i.minFilter ? i.minFilter : n.LinearMipMapLinearFilter, a.anisotropy = void(0) !== i.anisotropy ? i.anisotropy : 1, void(0) !== i.format && (a.format = i.format), void(0) !== i.type && (a.type = i.type), void(0) !== i.mipmaps && (a.mipmaps = i.mipmaps), 1 === i.mipmapCount && (a.minFilter = n.LinearFilter), a.needsUpdate = !0, t && t(a, i))
          }, i, r), a
        }
      }, n.CompressedTextureLoader = function(e) {
        this.manager = void(0) !== e ? e : n.DefaultLoadingManager, this._parser = null
      }, n.CompressedTextureLoader.prototype = {
        constructor: n.CompressedTextureLoader,
        load: function(e, t, i, r) {
          function o(o) {
            l.load(e[o], function(e) {
              var i = a._parser(e, !0);
              s[o] = {
                width: i.width,
                height: i.height,
                format: i.format,
                mipmaps: i.mipmaps
              }, c += 1, 6 === c && (1 === i.mipmapCount && (h.minFilter = n.LinearFilter), h.format = i.format, h.needsUpdate = !0, t && t(h))
            }, i, r)
          }
          var a = this,
            s = [],
            h = new n.CompressedTexture;
          h.image = s;
          var l = new n.XHRLoader(this.manager);
          if (l.setPath(this.path), l.setResponseType("arraybuffer"), Array.isArray(e)) {
            for (var c = 0, u = 0, d = e.length; d > u; ++u) {
              o(u)
            }
          } else {
            l.load(e, function(e) {
              var i = a._parser(e, !0);
              if (i.isCubemap) {
                for (var r = i.mipmaps.length / i.mipmapCount, o = 0; r > o; o++) {
                  s[o] = {
                    mipmaps: []
                  };
                  for (var l = 0; l < i.mipmapCount; l++) {
                    s[o].mipmaps.push(i.mipmaps[o * i.mipmapCount + l]), s[o].format = i.format, s[o].width = i.width, s[o].height = i.height
                  }
                }
              } else {
                h.image.width = i.width, h.image.height = i.height, h.mipmaps = i.mipmaps
              };
              1 === i.mipmapCount && (h.minFilter = n.LinearFilter), h.format = i.format, h.needsUpdate = !0, t && t(h)
            }, i, r)
          };
          return h
        },
        setPath: function(e) {
          this.path = e
        }
      }, n.Material = function() {
        Object.defineProperty(this, "id", {
          value: n.MaterialIdCount++
        }), this.uuid = n.Math.generateUUID(), this.name = "", this.type = "Material", this.side = n.FrontSide, this.opacity = 1, this.transparent = !1, this.blending = n.NormalBlending, this.blendSrc = n.SrcAlphaFactor, this.blendDst = n.OneMinusSrcAlphaFactor, this.blendEquation = n.AddEquation, this.blendSrcAlpha = null, this.blendDstAlpha = null, this.blendEquationAlpha = null, this.depthFunc = n.LessEqualDepth, this.depthTest = !0, this.depthWrite = !0, this.colorWrite = !0, this.precision = null, this.polygonOffset = !1, this.polygonOffsetFactor = 0, this.polygonOffsetUnits = 0, this.alphaTest = 0, this.premultipliedAlpha = !1, this.overdraw = 0, this.visible = !0, this._needsUpdate = !0
      }, n.Material.prototype = {
        constructor: n.Material,
        get needsUpdate() {
          return this._needsUpdate
        },
        set needsUpdate(e) {
          e === !0 && this.update(), this._needsUpdate = e
        },
        setValues: function(e) {
          if (void(0) !== e) {
            for (var t in e) {
              var i = e[t];
              if (void(0) !== i) {
                var r = this[t];
                void(0) !== r ? r instanceof n.Color ? r["set"](i) : r instanceof n.Vector3 && i instanceof n.Vector3 ? r.copy(i) : this[t] = "overdraw" === t ? Number(i) : i : console.warn("THREE." + this.type + ": '" + t + "' is not a property of this material.")
              } else {
                console.warn("THREE.Material: '" + t + "' parameter is undefined.")
              }
            }
          }
        },
        toJSON: function(e) {
          function t(e) {
            var t = [];
            for (var i in e) {
              var n = e[i];
              delete n.metadata, t.push(n)
            };
            return t
          }
          var i = void(0) === e;
          i && (e = {
            textures: {},
            images: {}
          });
          var r = {
            metadata: {
              version: 4.4,
              type: "Material",
              generator: "Material.toJSON"
            }
          };
          if (r.uuid = this.uuid, r.type = this.type, "" !== this.name && (r.name = this.name), this.color instanceof n.Color && (r.color = this.color.getHex()), 0.5 !== this.roughness && (r.roughness = this.roughness), 0.5 !== this.metalness && (r.metalness = this.metalness), this.emissive instanceof n.Color && (r.emissive = this.emissive.getHex()), this.specular instanceof n.Color && (r.specular = this.specular.getHex()), void(0) !== this.shininess && (r.shininess = this.shininess), this.map instanceof n.Texture && (r.map = this.map.toJSON(e).uuid), this.alphaMap instanceof n.Texture && (r.alphaMap = this.alphaMap.toJSON(e).uuid), this.lightMap instanceof n.Texture && (r.lightMap = this.lightMap.toJSON(e).uuid), this.bumpMap instanceof n.Texture && (r.bumpMap = this.bumpMap.toJSON(e).uuid, r.bumpScale = this.bumpScale), this.normalMap instanceof n.Texture && (r.normalMap = this.normalMap.toJSON(e).uuid, r.normalScale = this.normalScale.toArray()), this.displacementMap instanceof n.Texture && (r.displacementMap = this.displacementMap.toJSON(e).uuid, r.displacementScale = this.displacementScale, r.displacementBias = this.displacementBias), this.roughnessMap instanceof n.Texture && (r.roughnessMap = this.roughnessMap.toJSON(e).uuid), this.metalnessMap instanceof n.Texture && (r.metalnessMap = this.metalnessMap.toJSON(e).uuid), this.emissiveMap instanceof n.Texture && (r.emissiveMap = this.emissiveMap.toJSON(e).uuid), this.specularMap instanceof n.Texture && (r.specularMap = this.specularMap.toJSON(e).uuid), this.envMap instanceof n.Texture && (r.envMap = this.envMap.toJSON(e).uuid, r.reflectivity = this.reflectivity), void(0) !== this.size && (r.size = this.size), void(0) !== this.sizeAttenuation && (r.sizeAttenuation = this.sizeAttenuation), void(0) !== this.vertexColors && this.vertexColors !== n.NoColors && (r.vertexColors = this.vertexColors), void(0) !== this.shading && this.shading !== n.SmoothShading && (r.shading = this.shading), void(0) !== this.blending && this.blending !== n.NormalBlending && (r.blending = this.blending), void(0) !== this.side && this.side !== n.FrontSide && (r.side = this.side), this.opacity < 1 && (r.opacity = this.opacity), this.transparent === !0 && (r.transparent = this.transparent), this.alphaTest > 0 && (r.alphaTest = this.alphaTest), this.premultipliedAlpha === !0 && (r.premultipliedAlpha = this.premultipliedAlpha), this.wireframe === !0 && (r.wireframe = this.wireframe), this.wireframeLinewidth > 1 && (r.wireframeLinewidth = this.wireframeLinewidth), i) {
            var o = t(e.textures),
              a = t(e.images);
            o.length > 0 && (r.textures = o), a.length > 0 && (r.images = a)
          };
          return r
        },
        clone: function() {
          return (new this.constructor).copy(this)
        },
        copy: function(e) {
          return this.name = e.name, this.side = e.side, this.opacity = e.opacity, this.transparent = e.transparent, this.blending = e.blending, this.blendSrc = e.blendSrc, this.blendDst = e.blendDst, this.blendEquation = e.blendEquation, this.blendSrcAlpha = e.blendSrcAlpha, this.blendDstAlpha = e.blendDstAlpha, this.blendEquationAlpha = e.blendEquationAlpha, this.depthFunc = e.depthFunc, this.depthTest = e.depthTest, this.depthWrite = e.depthWrite, this.colorWrite = e.colorWrite, this.precision = e.precision, this.polygonOffset = e.polygonOffset, this.polygonOffsetFactor = e.polygonOffsetFactor, this.polygonOffsetUnits = e.polygonOffsetUnits, this.alphaTest = e.alphaTest, this.premultipliedAlpha = e.premultipliedAlpha, this.overdraw = e.overdraw, this.visible = e.visible, this
        },
        update: function() {
          this.dispatchEvent({
            type: "update"
          })
        },
        dispose: function() {
          this.dispatchEvent({
            type: "dispose"
          })
        }
      }, n.EventDispatcher.prototype.apply(n.Material.prototype), n.MaterialIdCount = 0, n.LineBasicMaterial = function(e) {
        n.Material.call(this), this.type = "LineBasicMaterial", this.color = new n.Color(16777215), this.linewidth = 1, this.linecap = "round", this.linejoin = "round", this.blending = n.NormalBlending, this.vertexColors = n.NoColors, this.fog = !0, this.setValues(e)
      }, n.LineBasicMaterial.prototype = Object.create(n.Material.prototype), n.LineBasicMaterial.prototype.constructor = n.LineBasicMaterial, n.LineBasicMaterial.prototype.copy = function(e) {
        return n.Material.prototype.copy.call(this, e), this.color.copy(e.color), this.linewidth = e.linewidth, this.linecap = e.linecap, this.linejoin = e.linejoin, this.vertexColors = e.vertexColors, this.fog = e.fog, this
      }, n.LineDashedMaterial = function(e) {
        n.Material.call(this), this.type = "LineDashedMaterial", this.color = new n.Color(16777215), this.linewidth = 1, this.scale = 1, this.dashSize = 3, this.gapSize = 1, this.blending = n.NormalBlending, this.vertexColors = n.NoColors, this.fog = !0, this.setValues(e)
      }, n.LineDashedMaterial.prototype = Object.create(n.Material.prototype), n.LineDashedMaterial.prototype.constructor = n.LineDashedMaterial, n.LineDashedMaterial.prototype.copy = function(e) {
        return n.Material.prototype.copy.call(this, e), this.color.copy(e.color), this.linewidth = e.linewidth, this.scale = e.scale, this.dashSize = e.dashSize, this.gapSize = e.gapSize, this.vertexColors = e.vertexColors, this.fog = e.fog, this
      }, n.MeshBasicMaterial = function(e) {
        n.Material.call(this), this.type = "MeshBasicMaterial", this.color = new n.Color(16777215), this.map = null, this.aoMap = null, this.aoMapIntensity = 1, this.specularMap = null, this.alphaMap = null, this.envMap = null, this.combine = n.MultiplyOperation, this.reflectivity = 1, this.refractionRatio = 0.98, this.fog = !0, this.shading = n.SmoothShading, this.blending = n.NormalBlending, this.wireframe = !1, this.wireframeLinewidth = 1, this.wireframeLinecap = "round", this.wireframeLinejoin = "round", this.vertexColors = n.NoColors, this.skinning = !1, this.morphTargets = !1, this.setValues(e)
      }, n.MeshBasicMaterial.prototype = Object.create(n.Material.prototype), n.MeshBasicMaterial.prototype.constructor = n.MeshBasicMaterial, n.MeshBasicMaterial.prototype.copy = function(e) {
        return n.Material.prototype.copy.call(this, e), this.color.copy(e.color), this.map = e.map, this.aoMap = e.aoMap, this.aoMapIntensity = e.aoMapIntensity, this.specularMap = e.specularMap, this.alphaMap = e.alphaMap, this.envMap = e.envMap, this.combine = e.combine, this.reflectivity = e.reflectivity, this.refractionRatio = e.refractionRatio, this.fog = e.fog, this.shading = e.shading, this.wireframe = e.wireframe, this.wireframeLinewidth = e.wireframeLinewidth, this.wireframeLinecap = e.wireframeLinecap, this.wireframeLinejoin = e.wireframeLinejoin, this.vertexColors = e.vertexColors, this.skinning = e.skinning, this.morphTargets = e.morphTargets, this
      }, n.MeshLambertMaterial = function(e) {
        n.Material.call(this), this.type = "MeshLambertMaterial", this.color = new n.Color(16777215), this.map = null, this.lightMap = null, this.lightMapIntensity = 1, this.aoMap = null, this.aoMapIntensity = 1, this.emissive = new n.Color(0), this.emissiveIntensity = 1, this.emissiveMap = null, this.specularMap = null, this.alphaMap = null, this.envMap = null, this.combine = n.MultiplyOperation, this.reflectivity = 1, this.refractionRatio = 0.98, this.fog = !0, this.blending = n.NormalBlending, this.wireframe = !1, this.wireframeLinewidth = 1, this.wireframeLinecap = "round", this.wireframeLinejoin = "round", this.vertexColors = n.NoColors, this.skinning = !1, this.morphTargets = !1, this.morphNormals = !1, this.setValues(e)
      }, n.MeshLambertMaterial.prototype = Object.create(n.Material.prototype), n.MeshLambertMaterial.prototype.constructor = n.MeshLambertMaterial, n.MeshLambertMaterial.prototype.copy = function(e) {
        return n.Material.prototype.copy.call(this, e), this.color.copy(e.color), this.map = e.map, this.lightMap = e.lightMap, this.lightMapIntensity = e.lightMapIntensity, this.aoMap = e.aoMap, this.aoMapIntensity = e.aoMapIntensity, this.emissive.copy(e.emissive), this.emissiveMap = e.emissiveMap, this.emissiveIntensity = e.emissiveIntensity, this.specularMap = e.specularMap, this.alphaMap = e.alphaMap, this.envMap = e.envMap, this.combine = e.combine, this.reflectivity = e.reflectivity, this.refractionRatio = e.refractionRatio, this.fog = e.fog, this.wireframe = e.wireframe, this.wireframeLinewidth = e.wireframeLinewidth, this.wireframeLinecap = e.wireframeLinecap, this.wireframeLinejoin = e.wireframeLinejoin, this.vertexColors = e.vertexColors, this.skinning = e.skinning, this.morphTargets = e.morphTargets, this.morphNormals = e.morphNormals, this
      }, n.MeshPhongMaterial = function(e) {
        n.Material.call(this), this.type = "MeshPhongMaterial", this.color = new n.Color(16777215), this.specular = new n.Color(1118481), this.shininess = 30, this.map = null, this.lightMap = null, this.lightMapIntensity = 1, this.aoMap = null, this.aoMapIntensity = 1, this.emissive = new n.Color(0), this.emissiveIntensity = 1, this.emissiveMap = null, this.bumpMap = null, this.bumpScale = 1, this.normalMap = null, this.normalScale = new n.Vector2(1, 1), this.displacementMap = null, this.displacementScale = 1, this.displacementBias = 0, this.specularMap = null, this.alphaMap = null, this.envMap = null, this.combine = n.MultiplyOperation, this.reflectivity = 1, this.refractionRatio = 0.98, this.fog = !0, this.shading = n.SmoothShading, this.blending = n.NormalBlending, this.wireframe = !1, this.wireframeLinewidth = 1, this.wireframeLinecap = "round", this.wireframeLinejoin = "round", this.vertexColors = n.NoColors, this.skinning = !1, this.morphTargets = !1, this.morphNormals = !1, this.setValues(e)
      }, n.MeshPhongMaterial.prototype = Object.create(n.Material.prototype), n.MeshPhongMaterial.prototype.constructor = n.MeshPhongMaterial, n.MeshPhongMaterial.prototype.copy = function(e) {
        return n.Material.prototype.copy.call(this, e), this.color.copy(e.color), this.specular.copy(e.specular), this.shininess = e.shininess, this.map = e.map, this.lightMap = e.lightMap, this.lightMapIntensity = e.lightMapIntensity, this.aoMap = e.aoMap, this.aoMapIntensity = e.aoMapIntensity, this.emissive.copy(e.emissive), this.emissiveMap = e.emissiveMap, this.emissiveIntensity = e.emissiveIntensity, this.bumpMap = e.bumpMap, this.bumpScale = e.bumpScale, this.normalMap = e.normalMap, this.normalScale.copy(e.normalScale), this.displacementMap = e.displacementMap, this.displacementScale = e.displacementScale, this.displacementBias = e.displacementBias, this.specularMap = e.specularMap, this.alphaMap = e.alphaMap, this.envMap = e.envMap, this.combine = e.combine, this.reflectivity = e.reflectivity, this.refractionRatio = e.refractionRatio, this.fog = e.fog, this.shading = e.shading, this.wireframe = e.wireframe, this.wireframeLinewidth = e.wireframeLinewidth, this.wireframeLinecap = e.wireframeLinecap, this.wireframeLinejoin = e.wireframeLinejoin, this.vertexColors = e.vertexColors, this.skinning = e.skinning, this.morphTargets = e.morphTargets, this.morphNormals = e.morphNormals, this
      }, n.MeshStandardMaterial = function(e) {
        n.Material.call(this), this.type = "MeshStandardMaterial", this.color = new n.Color(16777215), this.roughness = 0.5, this.metalness = 0.5, this.map = null, this.lightMap = null, this.lightMapIntensity = 1, this.aoMap = null, this.aoMapIntensity = 1, this.emissive = new n.Color(0), this.emissiveIntensity = 1, this.emissiveMap = null, this.bumpMap = null, this.bumpScale = 1, this.normalMap = null, this.normalScale = new n.Vector2(1, 1), this.displacementMap = null, this.displacementScale = 1, this.displacementBias = 0, this.roughnessMap = null, this.metalnessMap = null, this.alphaMap = null, this.envMap = null, this.envMapIntensity = 1, this.refractionRatio = 0.98, this.fog = !0, this.shading = n.SmoothShading, this.blending = n.NormalBlending, this.wireframe = !1, this.wireframeLinewidth = 1, this.wireframeLinecap = "round", this.wireframeLinejoin = "round", this.vertexColors = n.NoColors, this.skinning = !1, this.morphTargets = !1, this.morphNormals = !1, this.setValues(e)
      }, n.MeshStandardMaterial.prototype = Object.create(n.Material.prototype), n.MeshStandardMaterial.prototype.constructor = n.MeshStandardMaterial, n.MeshStandardMaterial.prototype.copy = function(e) {
        return n.Material.prototype.copy.call(this, e), this.color.copy(e.color), this.roughness = e.roughness, this.metalness = e.metalness, this.map = e.map, this.lightMap = e.lightMap, this.lightMapIntensity = e.lightMapIntensity, this.aoMap = e.aoMap, this.aoMapIntensity = e.aoMapIntensity, this.emissive.copy(e.emissive), this.emissiveMap = e.emissiveMap, this.emissiveIntensity = e.emissiveIntensity, this.bumpMap = e.bumpMap, this.bumpScale = e.bumpScale, this.normalMap = e.normalMap, this.normalScale.copy(e.normalScale), this.displacementMap = e.displacementMap, this.displacementScale = e.displacementScale, this.displacementBias = e.displacementBias, this.roughnessMap = e.roughnessMap, this.metalnessMap = e.metalnessMap, this.alphaMap = e.alphaMap, this.envMap = e.envMap, this.envMapIntensity = e.envMapIntensity, this.refractionRatio = e.refractionRatio, this.fog = e.fog, this.shading = e.shading, this.wireframe = e.wireframe, this.wireframeLinewidth = e.wireframeLinewidth, this.wireframeLinecap = e.wireframeLinecap, this.wireframeLinejoin = e.wireframeLinejoin, this.vertexColors = e.vertexColors, this.skinning = e.skinning, this.morphTargets = e.morphTargets, this.morphNormals = e.morphNormals, this
      }, n.MeshDepthMaterial = function(e) {
        n.Material.call(this), this.type = "MeshDepthMaterial", this.morphTargets = !1, this.wireframe = !1, this.wireframeLinewidth = 1, this.setValues(e)
      }, n.MeshDepthMaterial.prototype = Object.create(n.Material.prototype), n.MeshDepthMaterial.prototype.constructor = n.MeshDepthMaterial, n.MeshDepthMaterial.prototype.copy = function(e) {
        return n.Material.prototype.copy.call(this, e), this.wireframe = e.wireframe, this.wireframeLinewidth = e.wireframeLinewidth, this
      }, n.MeshNormalMaterial = function(e) {
        n.Material.call(this, e), this.type = "MeshNormalMaterial", this.wireframe = !1, this.wireframeLinewidth = 1, this.morphTargets = !1, this.setValues(e)
      }, n.MeshNormalMaterial.prototype = Object.create(n.Material.prototype), n.MeshNormalMaterial.prototype.constructor = n.MeshNormalMaterial, n.MeshNormalMaterial.prototype.copy = function(e) {
        return n.Material.prototype.copy.call(this, e), this.wireframe = e.wireframe, this.wireframeLinewidth = e.wireframeLinewidth, this
      }, n.MultiMaterial = function(e) {
        this.uuid = n.Math.generateUUID(), this.type = "MultiMaterial", this.materials = e instanceof Array ? e : [], this.visible = !0
      }, n.MultiMaterial.prototype = {
        constructor: n.MultiMaterial,
        toJSON: function(e) {
          for (var t = {
              metadata: {
                version: 4.2,
                type: "material",
                generator: "MaterialExporter"
              },
              uuid: this.uuid,
              type: this.type,
              materials: []
            }, i = this.materials, n = 0, r = i.length; r > n; n++) {
            var o = i[n].toJSON(e);
            delete o.metadata, t.materials.push(o)
          };
          return t.visible = this.visible, t
        },
        clone: function() {
          for (var e = new this.constructor, t = 0; t < this.materials.length; t++) {
            e.materials.push(this.materials[t].clone())
          };
          return e.visible = this.visible, e
        }
      }, n.PointsMaterial = function(e) {
        n.Material.call(this), this.type = "PointsMaterial", this.color = new n.Color(16777215), this.map = null, this.size = 1, this.sizeAttenuation = !0, this.blending = n.NormalBlending, this.vertexColors = n.NoColors, this.fog = !0, this.setValues(e)
      }, n.PointsMaterial.prototype = Object.create(n.Material.prototype), n.PointsMaterial.prototype.constructor = n.PointsMaterial, n.PointsMaterial.prototype.copy = function(e) {
        return n.Material.prototype.copy.call(this, e), this.color.copy(e.color), this.map = e.map, this.size = e.size, this.sizeAttenuation = e.sizeAttenuation, this.vertexColors = e.vertexColors, this.fog = e.fog, this
      }, n.ShaderMaterial = function(e) {
        n.Material.call(this), this.type = "ShaderMaterial", this.defines = {}, this.uniforms = {}, this.vertexShader = "void main() {\x0A\x09gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\x0A}", this.fragmentShader = "void main() {\x0A\x09gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\x0A}", this.shading = n.SmoothShading, this.linewidth = 1, this.wireframe = !1, this.wireframeLinewidth = 1, this.fog = !1, this.lights = !1, this.vertexColors = n.NoColors, this.skinning = !1, this.morphTargets = !1, this.morphNormals = !1, this.extensions = {
          derivatives: !1,
          fragDepth: !1,
          drawBuffers: !1,
          shaderTextureLOD: !1
        }, this.defaultAttributeValues = {
          color: [1, 1, 1],
          uv: [0, 0],
          uv2: [0, 0]
        }, this.index0AttributeName = void(0), void(0) !== e && (void(0) !== e.attributes && console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."), this.setValues(e))
      }, n.ShaderMaterial.prototype = Object.create(n.Material.prototype), n.ShaderMaterial.prototype.constructor = n.ShaderMaterial, n.ShaderMaterial.prototype.copy = function(e) {
        return n.Material.prototype.copy.call(this, e), this.fragmentShader = e.fragmentShader, this.vertexShader = e.vertexShader, this.uniforms = n.UniformsUtils.clone(e.uniforms), this.defines = e.defines, this.shading = e.shading, this.wireframe = e.wireframe, this.wireframeLinewidth = e.wireframeLinewidth, this.fog = e.fog, this.lights = e.lights, this.vertexColors = e.vertexColors, this.skinning = e.skinning, this.morphTargets = e.morphTargets, this.morphNormals = e.morphNormals, this.extensions = e.extensions, this
      }, n.ShaderMaterial.prototype.toJSON = function(e) {
        var t = n.Material.prototype.toJSON.call(this, e);
        return t.uniforms = this.uniforms, t.vertexShader = this.vertexShader, t.fragmentShader = this.fragmentShader, t
      }, n.RawShaderMaterial = function(e) {
        n.ShaderMaterial.call(this, e), this.type = "RawShaderMaterial"
      }, n.RawShaderMaterial.prototype = Object.create(n.ShaderMaterial.prototype), n.RawShaderMaterial.prototype.constructor = n.RawShaderMaterial, n.SpriteMaterial = function(e) {
        n.Material.call(this), this.type = "SpriteMaterial", this.color = new n.Color(16777215), this.map = null, this.rotation = 0, this.fog = !1, this.setValues(e)
      }, n.SpriteMaterial.prototype = Object.create(n.Material.prototype), n.SpriteMaterial.prototype.constructor = n.SpriteMaterial, n.SpriteMaterial.prototype.copy = function(e) {
        return n.Material.prototype.copy.call(this, e), this.color.copy(e.color), this.map = e.map, this.rotation = e.rotation, this.fog = e.fog, this
      }, n.Texture = function(e, t, i, r, o, a, s, h, l) {
        Object.defineProperty(this, "id", {
          value: n.TextureIdCount++
        }), this.uuid = n.Math.generateUUID(), this.name = "", this.sourceFile = "", this.image = void(0) !== e ? e : n.Texture.DEFAULT_IMAGE, this.mipmaps = [], this.mapping = void(0) !== t ? t : n.Texture.DEFAULT_MAPPING, this.wrapS = void(0) !== i ? i : n.ClampToEdgeWrapping, this.wrapT = void(0) !== r ? r : n.ClampToEdgeWrapping, this.magFilter = void(0) !== o ? o : n.LinearFilter, this.minFilter = void(0) !== a ? a : n.LinearMipMapLinearFilter, this.anisotropy = void(0) !== l ? l : 1, this.format = void(0) !== s ? s : n.RGBAFormat, this.type = void(0) !== h ? h : n.UnsignedByteType, this.offset = new n.Vector2(0, 0), this.repeat = new n.Vector2(1, 1), this.generateMipmaps = !0, this.premultiplyAlpha = !1, this.flipY = !0, this.unpackAlignment = 4, this.encoding = n.LinearEncoding, this.version = 0, this.onUpdate = null
      }, n.Texture.DEFAULT_IMAGE = void(0), n.Texture.DEFAULT_MAPPING = n.UVMapping, n.Texture.prototype = {
        constructor: n.Texture,
        set needsUpdate(e) {
          e === !0 && this.version++
        },
        clone: function() {
          return (new this.constructor).copy(this)
        },
        copy: function(e) {
          return this.image = e.image, this.mipmaps = e.mipmaps.slice(0), this.mapping = e.mapping, this.wrapS = e.wrapS, this.wrapT = e.wrapT, this.magFilter = e.magFilter, this.minFilter = e.minFilter, this.anisotropy = e.anisotropy, this.format = e.format, this.type = e.type, this.offset.copy(e.offset), this.repeat.copy(e.repeat), this.generateMipmaps = e.generateMipmaps, this.premultiplyAlpha = e.premultiplyAlpha, this.flipY = e.flipY, this.unpackAlignment = e.unpackAlignment, this.encoding = e.encoding, this
        },
        toJSON: function(e) {
          function t(e) {
            var t;
            return void(0) !== e.toDataURL ? t = e : (t = document.createElement("canvas"), t.width = e.width, t.height = e.height, t.getContext("2d").drawImage(e, 0, 0, e.width, e.height)), t.width > 2048 || t.height > 2048 ? t.toDataURL("image/jpeg", 0.6) : t.toDataURL("image/png")
          }
          if (void(0) !== e.textures[this.uuid]) {
            return e.textures[this.uuid]
          };
          var i = {
            metadata: {
              version: 4.4,
              type: "Texture",
              generator: "Texture.toJSON"
            },
            uuid: this.uuid,
            name: this.name,
            mapping: this.mapping,
            repeat: [this.repeat.x, this.repeat.y],
            offset: [this.offset.x, this.offset.y],
            wrap: [this.wrapS, this.wrapT],
            minFilter: this.minFilter,
            magFilter: this.magFilter,
            anisotropy: this.anisotropy
          };
          if (void(0) !== this.image) {
            var r = this.image;
            void(0) === r.uuid && (r.uuid = n.Math.generateUUID()), void(0) === e.images[r.uuid] && (e.images[r.uuid] = {
              uuid: r.uuid,
              url: t(r)
            }), i.image = r.uuid
          };
          return e.textures[this.uuid] = i, i
        },
        dispose: function() {
          this.dispatchEvent({
            type: "dispose"
          })
        },
        transformUv: function(e) {
          if (this.mapping === n.UVMapping) {
            if (e.multiply(this.repeat), e.add(this.offset), e.x < 0 || e.x > 1) {
              switch (this.wrapS) {
                case n.RepeatWrapping:
                  e.x = e.x - Math.floor(e.x);
                  break;
                case n.ClampToEdgeWrapping:
                  e.x = e.x < 0 ? 0 : 1;
                  break;
                case n.MirroredRepeatWrapping:
                  e.x = 1 === Math.abs(Math.floor(e.x) % 2) ? Math.ceil(e.x) - e.x : e.x - Math.floor(e.x)
              }
            };
            if (e.y < 0 || e.y > 1) {
              switch (this.wrapT) {
                case n.RepeatWrapping:
                  e.y = e.y - Math.floor(e.y);
                  break;
                case n.ClampToEdgeWrapping:
                  e.y = e.y < 0 ? 0 : 1;
                  break;
                case n.MirroredRepeatWrapping:
                  e.y = 1 === Math.abs(Math.floor(e.y) % 2) ? Math.ceil(e.y) - e.y : e.y - Math.floor(e.y)
              }
            };
            this.flipY && (e.y = 1 - e.y)
          }
        }
      }, n.EventDispatcher.prototype.apply(n.Texture.prototype), n.TextureIdCount = 0, n.CanvasTexture = function(e, t, i, r, o, a, s, h, l) {
        n.Texture.call(this, e, t, i, r, o, a, s, h, l), this.needsUpdate = !0
      }, n.CanvasTexture.prototype = Object.create(n.Texture.prototype), n.CanvasTexture.prototype.constructor = n.CanvasTexture, n.CubeTexture = function(e, t, i, r, o, a, s, h, l) {
        e = void(0) !== e ? e : [], t = void(0) !== t ? t : n.CubeReflectionMapping, n.Texture.call(this, e, t, i, r, o, a, s, h, l), this.flipY = !1
      }, n.CubeTexture.prototype = Object.create(n.Texture.prototype), n.CubeTexture.prototype.constructor = n.CubeTexture, Object.defineProperty(n.CubeTexture.prototype, "images", {
        get: function() {
          return this.image
        },
        set: function(e) {
          this.image = e
        }
      }), n.CompressedTexture = function(e, t, i, r, o, a, s, h, l, c, u) {
        n.Texture.call(this, null, a, s, h, l, c, r, o, u), this.image = {
          width: t,
          height: i
        }, this.mipmaps = e, this.flipY = !1, this.generateMipmaps = !1
      }, n.CompressedTexture.prototype = Object.create(n.Texture.prototype), n.CompressedTexture.prototype.constructor = n.CompressedTexture, n.DataTexture = function(e, t, i, r, o, a, s, h, l, c, u) {
        n.Texture.call(this, null, a, s, h, l, c, r, o, u), this.image = {
          data: e,
          width: t,
          height: i
        }, this.magFilter = void(0) !== l ? l : n.NearestFilter, this.minFilter = void(0) !== c ? c : n.NearestFilter, this.flipY = !1, this.generateMipmaps = !1
      }, n.DataTexture.prototype = Object.create(n.Texture.prototype), n.DataTexture.prototype.constructor = n.DataTexture, n.VideoTexture = function(e, t, i, r, o, a, s, h, l) {
        function c() {
          requestAnimationFrame(c), e.readyState === e.HAVE_ENOUGH_DATA && (u.needsUpdate = !0)
        }
        n.Texture.call(this, e, t, i, r, o, a, s, h, l), this.generateMipmaps = !1;
        var u = this;
        c()
      }, n.VideoTexture.prototype = Object.create(n.Texture.prototype), n.VideoTexture.prototype.constructor = n.VideoTexture, n.Group = function() {
        n.Object3D.call(this), this.type = "Group"
      }, n.Group.prototype = Object.create(n.Object3D.prototype), n.Group.prototype.constructor = n.Group, n.Points = function(e, t) {
        n.Object3D.call(this), this.type = "Points", this.geometry = void(0) !== e ? e : new n.Geometry, this.material = void(0) !== t ? t : new n.PointsMaterial({
          color: 16777215 * Math.random()
        })
      }, n.Points.prototype = Object.create(n.Object3D.prototype), n.Points.prototype.constructor = n.Points, n.Points.prototype.raycast = function() {
        var e = new n.Matrix4,
          t = new n.Ray,
          i = new n.Sphere;
        return function(r, o) {
          function a(e, i) {
            var n = t.distanceSqToPoint(e);
            if (d > n) {
              var a = t.closestPointToPoint(e);
              a.applyMatrix4(l);
              var h = r.ray.origin.distanceTo(a);
              if (h < r.near || h > r.far) {
                return
              };
              o.push({
                distance: h,
                distanceToRay: Math.sqrt(n),
                point: a.clone(),
                index: i,
                face: null,
                object: s
              })
            }
          }
          var s = this,
            h = this.geometry,
            l = this.matrixWorld,
            c = r.params.Points.threshold;
          if (null === h.boundingSphere && h.computeBoundingSphere(), i.copy(h.boundingSphere), i.applyMatrix4(l), r.ray.intersectsSphere(i) !== !1) {
            e.getInverse(l), t.copy(r.ray).applyMatrix4(e);
            var u = c / ((this.scale.x + this.scale.y + this.scale.z) / 3),
              d = u * u,
              p = new n.Vector3;
            if (h instanceof n.BufferGeometry) {
              var f = h.index,
                m = h.attributes,
                g = m.position.array;
              if (null !== f) {
                for (var v = f.array, y = 0, b = v.length; b > y; y++) {
                  var w = v[y];
                  p.fromArray(g, 3 * w), a(p, w)
                }
              } else {
                for (var y = 0, _ = g.length / 3; _ > y; y++) {
                  p.fromArray(g, 3 * y), a(p, y)
                }
              }
            } else {
              for (var x = h.vertices, y = 0, _ = x.length; _ > y; y++) {
                a(x[y], y)
              }
            }
          }
        }
      }(), n.Points.prototype.clone = function() {
        return new this.constructor(this.geometry, this.material).copy(this)
      }, n.Line = function(e, t, i) {
        return 1 === i ? (console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."), new n.LineSegments(e, t)) : (n.Object3D.call(this), this.type = "Line", this.geometry = void(0) !== e ? e : new n.Geometry, void((this.material = void(0) !== t ? t : new n.LineBasicMaterial({
          color: 16777215 * Math.random()
        }))))
      }, n.Line.prototype = Object.create(n.Object3D.prototype), n.Line.prototype.constructor = n.Line, n.Line.prototype.raycast = function() {
        var e = new n.Matrix4,
          t = new n.Ray,
          i = new n.Sphere;
        return function(r, o) {
          var a = r.linePrecision,
            s = a * a,
            h = this.geometry,
            l = this.matrixWorld;
          if (null === h.boundingSphere && h.computeBoundingSphere(), i.copy(h.boundingSphere), i.applyMatrix4(l), r.ray.intersectsSphere(i) !== !1) {
            e.getInverse(l), t.copy(r.ray).applyMatrix4(e);
            var c = new n.Vector3,
              u = new n.Vector3,
              d = new n.Vector3,
              p = new n.Vector3,
              f = this instanceof n.LineSegments ? 2 : 1;
            if (h instanceof n.BufferGeometry) {
              var m = h.index,
                g = h.attributes,
                v = g.position.array;
              if (null !== m) {
                for (var y = m.array, b = 0, w = y.length - 1; w > b; b += f) {
                  var _ = y[b],
                    x = y[b + 1];
                  c.fromArray(v, 3 * _), u.fromArray(v, 3 * x);
                  var M = t.distanceSqToSegment(c, u, p, d);
                  if (!(M > s)) {
                    p.applyMatrix4(this.matrixWorld);
                    var E = r.ray.origin.distanceTo(p);
                    E < r.near || E > r.far || o.push({
                      distance: E,
                      point: d.clone().applyMatrix4(this.matrixWorld),
                      index: b,
                      face: null,
                      faceIndex: null,
                      object: this
                    })
                  }
                }
              } else {
                for (var b = 0, w = v.length / 3 - 1; w > b; b += f) {
                  c.fromArray(v, 3 * b), u.fromArray(v, 3 * b + 3);
                  var M = t.distanceSqToSegment(c, u, p, d);
                  if (!(M > s)) {
                    p.applyMatrix4(this.matrixWorld);
                    var E = r.ray.origin.distanceTo(p);
                    E < r.near || E > r.far || o.push({
                      distance: E,
                      point: d.clone().applyMatrix4(this.matrixWorld),
                      index: b,
                      face: null,
                      faceIndex: null,
                      object: this
                    })
                  }
                }
              }
            } else {
              if (h instanceof n.Geometry) {
                for (var S = h.vertices, T = S.length, b = 0; T - 1 > b; b += f) {
                  var M = t.distanceSqToSegment(S[b], S[b + 1], p, d);
                  if (!(M > s)) {
                    p.applyMatrix4(this.matrixWorld);
                    var E = r.ray.origin.distanceTo(p);
                    E < r.near || E > r.far || o.push({
                      distance: E,
                      point: d.clone().applyMatrix4(this.matrixWorld),
                      index: b,
                      face: null,
                      faceIndex: null,
                      object: this
                    })
                  }
                }
              }
            }
          }
        }
      }(), n.Line.prototype.clone = function() {
        return new this.constructor(this.geometry, this.material).copy(this)
      }, n.LineStrip = 0, n.LinePieces = 1, n.LineSegments = function(e, t) {
        n.Line.call(this, e, t), this.type = "LineSegments"
      }, n.LineSegments.prototype = Object.create(n.Line.prototype), n.LineSegments.prototype.constructor = n.LineSegments, n.Mesh = function(e, t) {
        n.Object3D.call(this), this.type = "Mesh", this.geometry = void(0) !== e ? e : new n.Geometry, this.material = void(0) !== t ? t : new n.MeshBasicMaterial({
          color: 16777215 * Math.random()
        }), this.drawMode = n.TrianglesDrawMode, this.updateMorphTargets()
      }, n.Mesh.prototype = Object.create(n.Object3D.prototype), n.Mesh.prototype.constructor = n.Mesh, n.Mesh.prototype.setDrawMode = function(e) {
        this.drawMode = e
      }, n.Mesh.prototype.updateMorphTargets = function() {
        if (void(0) !== this.geometry.morphTargets && this.geometry.morphTargets.length > 0) {
          this.morphTargetBase = -1, this.morphTargetInfluences = [], this.morphTargetDictionary = {};
          for (var e = 0, t = this.geometry.morphTargets.length; t > e; e++) {
            this.morphTargetInfluences.push(0), this.morphTargetDictionary[this.geometry.morphTargets[e].name] = e
          }
        }
      }, n.Mesh.prototype.getMorphTargetIndexByName = function(e) {
        return void(0) !== this.morphTargetDictionary[e] ? this.morphTargetDictionary[e] : (console.warn("THREE.Mesh.getMorphTargetIndexByName: morph target " + e + " does not exist. Returning 0."), 0)
      }, n.Mesh.prototype.raycast = function() {
        function e(e, t, i, r, o, a, s) {
          return n.Triangle.barycoordFromPoint(e, t, i, r, g), o.multiplyScalar(g.x), a.multiplyScalar(g.y), s.multiplyScalar(g.z), o.add(a).add(s), o.clone()
        }

        function t(e, t, i, r, o, a, s) {
          var h, l = e.material;
          if (h = l.side === n.BackSide ? i.intersectTriangle(a, o, r, !0, s) : i.intersectTriangle(r, o, a, l.side !== n.DoubleSide, s), null === h) {
            return null
          };
          y.copy(s), y.applyMatrix4(e.matrixWorld);
          var c = t.ray.origin.distanceTo(y);
          return c < t.near || c > t.far ? null : {
            distance: c,
            point: y.clone(),
            object: e
          }
        }

        function i(i, r, o, a, c, u, d, g) {
          s.fromArray(a, 3 * u), h.fromArray(a, 3 * d), l.fromArray(a, 3 * g);
          var y = t(i, r, o, s, h, l, v);
          return y && (c && (p.fromArray(c, 2 * u), f.fromArray(c, 2 * d), m.fromArray(c, 2 * g), y.uv = e(v, s, h, l, p, f, m)), y.face = new n.Face3(u, d, g, n.Triangle.normal(s, h, l)), y.faceIndex = u), y
        }
        var r = new n.Matrix4,
          o = new n.Ray,
          a = new n.Sphere,
          s = new n.Vector3,
          h = new n.Vector3,
          l = new n.Vector3,
          c = new n.Vector3,
          u = new n.Vector3,
          d = new n.Vector3,
          p = new n.Vector2,
          f = new n.Vector2,
          m = new n.Vector2,
          g = new n.Vector3,
          v = new n.Vector3,
          y = new n.Vector3;
        return function(g, y) {
          var b = this.geometry,
            w = this.material,
            _ = this.matrixWorld;
          if (void(0) !== w && (null === b.boundingSphere && b.computeBoundingSphere(), a.copy(b.boundingSphere), a.applyMatrix4(_), g.ray.intersectsSphere(a) !== !1 && (r.getInverse(_), o.copy(g.ray).applyMatrix4(r), null === b.boundingBox || o.intersectsBox(b.boundingBox) !== !1))) {
            var x, M;
            if (b instanceof n.BufferGeometry) {
              var E, S, T, P = b.index,
                A = b.attributes,
                L = A.position.array;
              if (void(0) !== A.uv && (x = A.uv.array), null !== P) {
                for (var C = P.array, R = 0, I = C.length; I > R; R += 3) {
                  E = C[R], S = C[R + 1], T = C[R + 2], M = i(this, g, o, L, x, E, S, T), M && (M.faceIndex = Math.floor(R / 3), y.push(M))
                }
              } else {
                for (var R = 0, I = L.length; I > R; R += 9) {
                  E = R / 3, S = E + 1, T = E + 2, M = i(this, g, o, L, x, E, S, T), M && (M.index = E, y.push(M))
                }
              }
            } else {
              if (b instanceof n.Geometry) {
                var D, O, k, B = w instanceof n.MultiMaterial,
                  F = B === !0 ? w.materials : null,
                  N = b.vertices,
                  U = b.faces,
                  V = b.faceVertexUvs[0];
                V.length > 0 && (x = V);
                for (var z = 0, G = U.length; G > z; z++) {
                  var j = U[z],
                    H = B === !0 ? F[j.materialIndex] : w;
                  if (void(0) !== H) {
                    if (D = N[j.a], O = N[j.b], k = N[j.c], H.morphTargets === !0) {
                      var W = b.morphTargets,
                        Y = this.morphTargetInfluences;
                      s["set"](0, 0, 0), h["set"](0, 0, 0), l["set"](0, 0, 0);
                      for (var X = 0, q = W.length; q > X; X++) {
                        var Z = Y[X];
                        if (0 !== Z) {
                          var $ = W[X].vertices;
                          s.addScaledVector(c.subVectors($[j.a], D), Z), h.addScaledVector(u.subVectors($[j.b], O), Z), l.addScaledVector(d.subVectors($[j.c], k), Z)
                        }
                      };
                      s.add(D), h.add(O), l.add(k), D = s, O = h, k = l
                    };
                    if (M = t(this, g, o, D, O, k, v)) {
                      if (x) {
                        var Q = x[z];
                        p.copy(Q[0]), f.copy(Q[1]), m.copy(Q[2]), M.uv = e(v, D, O, k, p, f, m)
                      };
                      M.face = j, M.faceIndex = z, y.push(M)
                    }
                  }
                }
              }
            }
          }
        }
      }(), n.Mesh.prototype.clone = function() {
        return new this.constructor(this.geometry, this.material).copy(this)
      }, n.Bone = function(e) {
        n.Object3D.call(this), this.type = "Bone", this.skin = e
      }, n.Bone.prototype = Object.create(n.Object3D.prototype), n.Bone.prototype.constructor = n.Bone, n.Bone.prototype.copy = function(e) {
        return n.Object3D.prototype.copy.call(this, e), this.skin = e.skin, this
      }, n.Skeleton = function(e, t, i) {
        if (this.useVertexTexture = void(0) !== i ? i : !0, this.identityMatrix = new n.Matrix4, e = e || [], this.bones = e.slice(0), this.useVertexTexture) {
          var r = Math.sqrt(4 * this.bones.length);
          r = n.Math.nextPowerOfTwo(Math.ceil(r)), r = Math.max(r, 4), this.boneTextureWidth = r, this.boneTextureHeight = r, this.boneMatrices = new Float32Array(this.boneTextureWidth * this.boneTextureHeight * 4), this.boneTexture = new n.DataTexture(this.boneMatrices, this.boneTextureWidth, this.boneTextureHeight, n.RGBAFormat, n.FloatType)
        } else {
          this.boneMatrices = new Float32Array(16 * this.bones.length)
        };
        if (void(0) === t) {
          this.calculateInverses()
        } else {
          if (this.bones.length === t.length) {
            this.boneInverses = t.slice(0)
          } else {
            console.warn("THREE.Skeleton bonInverses is the wrong length."), this.boneInverses = [];
            for (var o = 0, a = this.bones.length; a > o; o++) {
              this.boneInverses.push(new n.Matrix4)
            }
          }
        }
      }, n.Skeleton.prototype.calculateInverses = function() {
        this.boneInverses = [];
        for (var e = 0, t = this.bones.length; t > e; e++) {
          var i = new n.Matrix4;
          this.bones[e] && i.getInverse(this.bones[e].matrixWorld), this.boneInverses.push(i)
        }
      }, n.Skeleton.prototype.pose = function() {
        for (var e, t = 0, i = this.bones.length; i > t; t++) {
          e = this.bones[t], e && e.matrixWorld.getInverse(this.boneInverses[t])
        };
        for (var t = 0, i = this.bones.length; i > t; t++) {
          e = this.bones[t], e && (e.parent ? (e.matrix.getInverse(e.parent.matrixWorld), e.matrix.multiply(e.matrixWorld)) : e.matrix.copy(e.matrixWorld), e.matrix.decompose(e.position, e.quaternion, e.scale))
        }
      }, n.Skeleton.prototype.update = function() {
        var e = new n.Matrix4;
        return function() {
          for (var t = 0, i = this.bones.length; i > t; t++) {
            var n = this.bones[t] ? this.bones[t].matrixWorld : this.identityMatrix;
            e.multiplyMatrices(n, this.boneInverses[t]), e.flattenToArrayOffset(this.boneMatrices, 16 * t)
          };
          this.useVertexTexture && (this.boneTexture.needsUpdate = !0)
        }
      }(), n.Skeleton.prototype.clone = function() {
        return new n.Skeleton(this.bones, this.boneInverses, this.useVertexTexture)
      }, n.SkinnedMesh = function(e, t, i) {
        n.Mesh.call(this, e, t), this.type = "SkinnedMesh", this.bindMode = "attached", this.bindMatrix = new n.Matrix4, this.bindMatrixInverse = new n.Matrix4;
        var r = [];
        if (this.geometry && void(0) !== this.geometry.bones) {
          for (var o, a, s = 0, h = this.geometry.bones.length; h > s; ++s) {
            a = this.geometry.bones[s], o = new n.Bone(this), r.push(o), o.name = a.name, o.position.fromArray(a.pos), o.quaternion.fromArray(a.rotq), void(0) !== a.scl && o.scale.fromArray(a.scl)
          };
          for (var s = 0, h = this.geometry.bones.length; h > s; ++s) {
            a = this.geometry.bones[s], -1 !== a.parent && null !== a.parent ? r[a.parent].add(r[s]) : this.add(r[s])
          }
        };
        this.normalizeSkinWeights(), this.updateMatrixWorld(!0), this.bind(new n.Skeleton(r, void(0), i), this.matrixWorld)
      }, n.SkinnedMesh.prototype = Object.create(n.Mesh.prototype), n.SkinnedMesh.prototype.constructor = n.SkinnedMesh, n.SkinnedMesh.prototype.bind = function(e, t) {
        this.skeleton = e, void(0) === t && (this.updateMatrixWorld(!0), this.skeleton.calculateInverses(), t = this.matrixWorld), this.bindMatrix.copy(t), this.bindMatrixInverse.getInverse(t)
      }, n.SkinnedMesh.prototype.pose = function() {
        this.skeleton.pose()
      }, n.SkinnedMesh.prototype.normalizeSkinWeights = function() {
        if (this.geometry instanceof n.Geometry) {
          for (var e = 0; e < this.geometry.skinWeights.length; e++) {
            var t = this.geometry.skinWeights[e],
              i = 1 / t.lengthManhattan();
            i !== 1 / 0 ? t.multiplyScalar(i) : t["set"](1, 0, 0, 0)
          }
        } else {
          if (this.geometry instanceof n.BufferGeometry) {
            for (var r = new n.Vector4, o = this.geometry.attributes.skinWeight, e = 0; e < o.count; e++) {
              r.x = o.getX(e), r.y = o.getY(e), r.z = o.getZ(e), r.w = o.getW(e);
              var i = 1 / r.lengthManhattan();
              i !== 1 / 0 ? r.multiplyScalar(i) : r["set"](1, 0, 0, 0), o.setXYZW(e, r.x, r.y, r.z, r.w)
            }
          }
        }
      }, n.SkinnedMesh.prototype.updateMatrixWorld = function(e) {
        n.Mesh.prototype.updateMatrixWorld.call(this, !0), "attached" === this.bindMode ? this.bindMatrixInverse.getInverse(this.matrixWorld) : "detached" === this.bindMode ? this.bindMatrixInverse.getInverse(this.bindMatrix) : console.warn("THREE.SkinnedMesh unrecognized bindMode: " + this.bindMode)
      }, n.SkinnedMesh.prototype.clone = function() {
        return new this.constructor(this.geometry, this.material, this.useVertexTexture).copy(this)
      }, n.LOD = function() {
        n.Object3D.call(this), this.type = "LOD", Object.defineProperties(this, {
          levels: {
            enumerable: !0,
            value: []
          },
          objects: {
            get: function() {
              return console.warn("THREE.LOD: .objects has been renamed to .levels."), this.levels
            }
          }
        })
      }, n.LOD.prototype = Object.create(n.Object3D.prototype), n.LOD.prototype.constructor = n.LOD, n.LOD.prototype.addLevel = function(e, t) {
        void(0) === t && (t = 0), t = Math.abs(t);
        for (var i = this.levels, n = 0; n < i.length && !(t < i[n].distance); n++) {;
        };
        i.splice(n, 0, {
          distance: t,
          object: e
        }), this.add(e)
      }, n.LOD.prototype.getObjectForDistance = function(e) {
        for (var t = this.levels, i = 1, n = t.length; n > i && !(e < t[i].distance); i++) {;
        };
        return t[i - 1].object
      }, n.LOD.prototype.raycast = function() {
        var e = new n.Vector3;
        return function(t, i) {
          e.setFromMatrixPosition(this.matrixWorld);
          var n = t.ray.origin.distanceTo(e);
          this.getObjectForDistance(n).raycast(t, i)
        }
      }(), n.LOD.prototype.update = function() {
        var e = new n.Vector3,
          t = new n.Vector3;
        return function(i) {
          var n = this.levels;
          if (n.length > 1) {
            e.setFromMatrixPosition(i.matrixWorld), t.setFromMatrixPosition(this.matrixWorld);
            var r = e.distanceTo(t);
            n[0].object.visible = !0;
            for (var o = 1, a = n.length; a > o && r >= n[o].distance; o++) {
              n[o - 1].object.visible = !1, n[o].object.visible = !0
            };
            for (; a > o; o++) {
              n[o].object.visible = !1
            }
          }
        }
      }(), n.LOD.prototype.copy = function(e) {
        n.Object3D.prototype.copy.call(this, e, !1);
        for (var t = e.levels, i = 0, r = t.length; r > i; i++) {
          var o = t[i];
          this.addLevel(o.object.clone(), o.distance)
        };
        return this
      }, n.LOD.prototype.toJSON = function(e) {
        var t = n.Object3D.prototype.toJSON.call(this, e);
        t.object.levels = [];
        for (var i = this.levels, r = 0, o = i.length; o > r; r++) {
          var a = i[r];
          t.object.levels.push({
            object: a.object.uuid,
            distance: a.distance
          })
        };
        return t
      }, n.Sprite = function() {
        var e = new Uint16Array([0, 1, 2, 0, 2, 3]),
          t = new Float32Array([-0.5, -0.5, 0, 0.5, -0.5, 0, 0.5, 0.5, 0, -0.5, 0.5, 0]),
          i = new Float32Array([0, 0, 1, 0, 1, 1, 0, 1]),
          r = new n.BufferGeometry;
        return r.setIndex(new n.BufferAttribute(e, 1)), r.addAttribute("position", new n.BufferAttribute(t, 3)), r.addAttribute("uv", new n.BufferAttribute(i, 2)),
          function(e) {
            n.Object3D.call(this), this.type = "Sprite", this.geometry = r, this.material = void(0) !== e ? e : new n.SpriteMaterial
          }
      }(), n.Sprite.prototype = Object.create(n.Object3D.prototype), n.Sprite.prototype.constructor = n.Sprite, n.Sprite.prototype.raycast = function() {
        var e = new n.Vector3;
        return function(t, i) {
          e.setFromMatrixPosition(this.matrixWorld);
          var n = t.ray.distanceSqToPoint(e),
            r = this.scale.x * this.scale.y;
          n > r || i.push({
            distance: Math.sqrt(n),
            point: this.position,
            face: null,
            object: this
          })
        }
      }(), n.Sprite.prototype.clone = function() {
        return new this.constructor(this.material).copy(this)
      }, n.Particle = n.Sprite, n.LensFlare = function(e, t, i, r, o) {
        n.Object3D.call(this), this.lensFlares = [], this.positionScreen = new n.Vector3, this.customUpdateCallback = void(0), void(0) !== e && this.add(e, t, i, r, o)
      }, n.LensFlare.prototype = Object.create(n.Object3D.prototype), n.LensFlare.prototype.constructor = n.LensFlare, n.LensFlare.prototype.add = function(e, t, i, r, o, a) {
        void(0) === t && (t = -1), void(0) === i && (i = 0), void(0) === a && (a = 1), void(0) === o && (o = new n.Color(16777215)), void(0) === r && (r = n.NormalBlending), i = Math.min(i, Math.max(0, i)), this.lensFlares.push({
          texture: e,
          size: t,
          distance: i,
          x: 0,
          y: 0,
          z: 0,
          scale: 1,
          rotation: 0,
          opacity: a,
          color: o,
          blending: r
        })
      }, n.LensFlare.prototype.updateLensFlares = function() {
        var e, t, i = this.lensFlares.length,
          n = 2 * -this.positionScreen.x,
          r = 2 * -this.positionScreen.y;
        for (e = 0; i > e; e++) {
          t = this.lensFlares[e], t.x = this.positionScreen.x + n * t.distance, t.y = this.positionScreen.y + r * t.distance, t.wantedRotation = t.x * Math.PI * 0.25, t.rotation += 0.25 * (t.wantedRotation - t.rotation)
        }
      }, n.LensFlare.prototype.copy = function(e) {
        n.Object3D.prototype.copy.call(this, e), this.positionScreen.copy(e.positionScreen), this.customUpdateCallback = e.customUpdateCallback;
        for (var t = 0, i = e.lensFlares.length; i > t; t++) {
          this.lensFlares.push(e.lensFlares[t])
        };
        return this
      }, n.Scene = function() {
        n.Object3D.call(this), this.type = "Scene", this.fog = null, this.overrideMaterial = null, this.autoUpdate = !0
      }, n.Scene.prototype = Object.create(n.Object3D.prototype), n.Scene.prototype.constructor = n.Scene, n.Scene.prototype.copy = function(e, t) {
        return n.Object3D.prototype.copy.call(this, e, t), null !== e.fog && (this.fog = e.fog.clone()), null !== e.overrideMaterial && (this.overrideMaterial = e.overrideMaterial.clone()), this.autoUpdate = e.autoUpdate, this.matrixAutoUpdate = e.matrixAutoUpdate, this
      }, n.Fog = function(e, t, i) {
        this.name = "", this.color = new n.Color(e), this.near = void(0) !== t ? t : 1, this.far = void(0) !== i ? i : 1e3
      }, n.Fog.prototype.clone = function() {
        return new n.Fog(this.color.getHex(), this.near, this.far)
      }, n.FogExp2 = function(e, t) {
        this.name = "", this.color = new n.Color(e), this.density = void(0) !== t ? t : 25e-5
      }, n.FogExp2.prototype.clone = function() {
        return new n.FogExp2(this.color.getHex(), this.density)
      }, n.ShaderChunk = {}, n.ShaderChunk.alphamap_fragment = "#ifdef USE_ALPHAMAP\x0A\x09diffuseColor.a *= texture2D( alphaMap, vUv ).g;\x0A#endif\x0A", n.ShaderChunk.alphamap_pars_fragment = "#ifdef USE_ALPHAMAP\x0A\x09uniform sampler2D alphaMap;\x0A#endif\x0A", n.ShaderChunk.alphatest_fragment = "#ifdef ALPHATEST\x0A\x09if ( diffuseColor.a < ALPHATEST ) discard;\x0A#endif\x0A", n.ShaderChunk.aomap_fragment = "#ifdef USE_AOMAP\x0A\x09float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\x0A\x09reflectedLight.indirectDiffuse *= ambientOcclusion;\x0A\x09#if defined( USE_ENVMAP ) && defined( STANDARD )\x0A\x09\x09float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\x0A\x09\x09reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\x0A\x09#endif\x0A#endif\x0A", n.ShaderChunk.aomap_pars_fragment = "#ifdef USE_AOMAP\x0A\x09uniform sampler2D aoMap;\x0A\x09uniform float aoMapIntensity;\x0A#endif", n.ShaderChunk.begin_vertex = "\x0Avec3 transformed = vec3( position );\x0A", n.ShaderChunk.beginnormal_vertex = "\x0Avec3 objectNormal = vec3( normal );\x0A", n.ShaderChunk.bsdfs = "bool testLightInRange( const in float lightDistance, const in float cutoffDistance ) {\x0A\x09return any( bvec2( cutoffDistance == 0.0, lightDistance < cutoffDistance ) );\x0A}\x0Afloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\x0A\x09\x09if( decayExponent > 0.0 ) {\x0A#if defined ( PHYSICALLY_CORRECT_LIGHTS )\x0A\x09\x09\x09float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\x0A\x09\x09\x09float maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\x0A\x09\x09\x09return distanceFalloff * maxDistanceCutoffFactor;\x0A#else\x0A\x09\x09\x09return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\x0A#endif\x0A\x09\x09}\x0A\x09\x09return 1.0;\x0A}\x0Avec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\x0A\x09return RECIPROCAL_PI * diffuseColor;\x0A}\x0Avec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\x0A\x09float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\x0A\x09return ( 1.0 - specularColor ) * fresnel + specularColor;\x0A}\x0Afloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\x0A\x09float a2 = pow2( alpha );\x0A\x09float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\x0A\x09float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\x0A\x09return 1.0 / ( gl * gv );\x0A}\x0Afloat D_GGX( const in float alpha, const in float dotNH ) {\x0A\x09float a2 = pow2( alpha );\x0A\x09float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\x0A\x09return RECIPROCAL_PI * a2 / pow2( denom );\x0A}\x0Avec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\x0A\x09float alpha = pow2( roughness );\x0A\x09vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\x0A\x09float dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\x0A\x09float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\x0A\x09float dotNH = saturate( dot( geometry.normal, halfDir ) );\x0A\x09float dotLH = saturate( dot( incidentLight.direction, halfDir ) );\x0A\x09vec3 F = F_Schlick( specularColor, dotLH );\x0A\x09float G = G_GGX_Smith( alpha, dotNL, dotNV );\x0A\x09float D = D_GGX( alpha, dotNH );\x0A\x09return F * ( G * D );\x0A}\x0Avec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\x0A\x09float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\x0A\x09const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\x0A\x09const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\x0A\x09vec4 r = roughness * c0 + c1;\x0A\x09float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\x0A\x09vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\x0A\x09return specularColor * AB.x + AB.y;\x0A}\x0Afloat G_BlinnPhong_Implicit( ) {\x0A\x09return 0.25;\x0A}\x0Afloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\x0A\x09return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\x0A}\x0Avec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\x0A\x09vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\x0A\x09float dotNH = saturate( dot( geometry.normal, halfDir ) );\x0A\x09float dotLH = saturate( dot( incidentLight.direction, halfDir ) );\x0A\x09vec3 F = F_Schlick( specularColor, dotLH );\x0A\x09float G = G_BlinnPhong_Implicit( );\x0A\x09float D = D_BlinnPhong( shininess, dotNH );\x0A\x09return F * ( G * D );\x0A}\x0Afloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\x0A\x09return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\x0A}\x0Afloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\x0A\x09return sqrt( 2.0 / ( blinnExponent + 2.0 ) );\x0A}\x0A", n.ShaderChunk.bumpmap_pars_fragment = "#ifdef USE_BUMPMAP\x0A\x09uniform sampler2D bumpMap;\x0A\x09uniform float bumpScale;\x0A\x09vec2 dHdxy_fwd() {\x0A\x09\x09vec2 dSTdx = dFdx( vUv );\x0A\x09\x09vec2 dSTdy = dFdy( vUv );\x0A\x09\x09float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\x0A\x09\x09float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\x0A\x09\x09float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\x0A\x09\x09return vec2( dBx, dBy );\x0A\x09}\x0A\x09vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\x0A\x09\x09vec3 vSigmaX = dFdx( surf_pos );\x0A\x09\x09vec3 vSigmaY = dFdy( surf_pos );\x0A\x09\x09vec3 vN = surf_norm;\x0A\x09\x09vec3 R1 = cross( vSigmaY, vN );\x0A\x09\x09vec3 R2 = cross( vN, vSigmaX );\x0A\x09\x09float fDet = dot( vSigmaX, R1 );\x0A\x09\x09vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\x0A\x09\x09return normalize( abs( fDet ) * surf_norm - vGrad );\x0A\x09}\x0A#endif\x0A", n.ShaderChunk.color_fragment = "#ifdef USE_COLOR\x0A\x09diffuseColor.rgb *= vColor;\x0A#endif", n.ShaderChunk.color_pars_fragment = "#ifdef USE_COLOR\x0A\x09varying vec3 vColor;\x0A#endif\x0A", n.ShaderChunk.color_pars_vertex = "#ifdef USE_COLOR\x0A\x09varying vec3 vColor;\x0A#endif", n.ShaderChunk.color_vertex = "#ifdef USE_COLOR\x0A\x09vColor.xyz = color.xyz;\x0A#endif", n.ShaderChunk.common = "#define PI 3.14159\x0A#define PI2 6.28318\x0A#define RECIPROCAL_PI 0.31830988618\x0A#define RECIPROCAL_PI2 0.15915494\x0A#define LOG2 1.442695\x0A#define EPSILON 1e-6\x0A#define saturate(a) clamp( a, 0.0, 1.0 )\x0A#define whiteCompliment(a) ( 1.0 - saturate( a ) )\x0Afloat pow2( const in float x ) { return x*x; }\x0Afloat pow3( const in float x ) { return x*x*x; }\x0Afloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\x0Afloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\x0Astruct IncidentLight {\x0A\x09vec3 color;\x0A\x09vec3 direction;\x0A\x09bool visible;\x0A};\x0Astruct ReflectedLight {\x0A\x09vec3 directDiffuse;\x0A\x09vec3 directSpecular;\x0A\x09vec3 indirectDiffuse;\x0A\x09vec3 indirectSpecular;\x0A};\x0Astruct GeometricContext {\x0A\x09vec3 position;\x0A\x09vec3 normal;\x0A\x09vec3 viewDir;\x0A};\x0Avec3 transformDirection( in vec3 dir, in mat4 matrix ) {\x0A\x09return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\x0A}\x0Avec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\x0A\x09return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\x0A}\x0Avec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\x0A\x09float distance = dot( planeNormal, point - pointOnPlane );\x0A\x09return - distance * planeNormal + point;\x0A}\x0Afloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\x0A\x09return sign( dot( point - pointOnPlane, planeNormal ) );\x0A}\x0Avec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\x0A\x09return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\x0A}\x0A", n.ShaderChunk.cube_uv_reflection_fragment = "#ifdef ENVMAP_TYPE_CUBE_UV\x0Aconst float cubeUV_textureSize = 1024.0;\x0Aint getFaceFromDirection(vec3 direction) {\x0A    vec3 absDirection = abs(direction);\x0A    int face = -1;\x0A    if( absDirection.x > absDirection.z ) {\x0A        if(absDirection.x > absDirection.y )\x0A            face = direction.x > 0.0 ? 0 : 3;\x0A        else\x0A            face = direction.y > 0.0 ? 1 : 4;\x0A    }\x0A    else {\x0A        if(absDirection.z > absDirection.y )\x0A            face = direction.z > 0.0 ? 2 : 5;\x0A        else\x0A            face = direction.y > 0.0 ? 1 : 4;\x0A    }\x0A    return face;\x0A}\x0Aconst float cubeUV_maxLods1 = log2(cubeUV_textureSize*0.25) - 1.0;\x0Aconst float cubeUV_rangeClamp = exp2((6.0 - 1.0) * 2.0);\x0Avec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\x0A    float scale = exp2(cubeUV_maxLods1 - roughnessLevel);\x0A    float dxRoughness = dFdx(roughness);\x0A    float dyRoughness = dFdy(roughness);\x0A    vec3 dx = dFdx( vec * scale * dxRoughness );\x0A    vec3 dy = dFdy( vec * scale * dyRoughness );\x0A    float d = max( dot( dx, dx ), dot( dy, dy ) );\x0A    d = clamp(d, 1.0, cubeUV_rangeClamp);\x0A    float mipLevel = 0.5 * log2(d);\x0A    return vec2(floor(mipLevel), fract(mipLevel));\x0A}\x0Aconst float cubeUV_maxLods2 = log2(cubeUV_textureSize*0.25) - 2.0;\x0Aconst float cubeUV_rcpTextureSize = 1.0 / cubeUV_textureSize;\x0Avec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\x0A    mipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\x0A    float a = 16.0 * cubeUV_rcpTextureSize;\x0A    vec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\x0A    vec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\x0A    float powScale = exp2_packed.x * exp2_packed.y;\x0A    float scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\x0A    float mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\x0A    bool bRes = mipLevel == 0.0;\x0A    scale =  bRes && (scale < a) ? a : scale;\x0A    vec3 r;\x0A    vec2 offset;\x0A    int face = getFaceFromDirection(direction);\x0A    float rcpPowScale = 1.0 / powScale;\x0A    if( face == 0) {\x0A        r = vec3(direction.x, -direction.z, direction.y);\x0A        offset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\x0A        offset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\x0A    }\x0A    else if( face == 1) {\x0A        r = vec3(direction.y, direction.x, direction.z);\x0A        offset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\x0A        offset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\x0A    }\x0A    else if( face == 2) {\x0A        r = vec3(direction.z, direction.x, direction.y);\x0A        offset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\x0A        offset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\x0A    }\x0A    else if( face == 3) {\x0A        r = vec3(direction.x, direction.z, direction.y);\x0A        offset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\x0A        offset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\x0A    }\x0A    else if( face == 4) {\x0A        r = vec3(direction.y, direction.x, -direction.z);\x0A        offset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\x0A        offset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\x0A    }\x0A    else {\x0A        r = vec3(direction.z, -direction.x, direction.y);\x0A        offset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\x0A        offset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\x0A    }\x0A    r = normalize(r);\x0A    float texelOffset = 0.5 * cubeUV_rcpTextureSize;\x0A    vec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\x0A    vec2 base = offset + vec2( texelOffset );\x0A    return base + s * ( scale - 2.0 * texelOffset );\x0A}\x0Aconst float cubeUV_maxLods3 = log2(cubeUV_textureSize*0.25) - 3.0;\x0Avec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\x0A    float roughnessVal = roughness* cubeUV_maxLods3;\x0A    float r1 = floor(roughnessVal);\x0A    float r2 = r1 + 1.0;\x0A    float t = fract(roughnessVal);\x0A    vec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\x0A    float s = mipInfo.y;\x0A    float level0 = mipInfo.x;\x0A    float level1 = level0 + 1.0;\x0A    level1 = level1 > 5.0 ? 5.0 : level1;\x0A    level0 += min( floor( s + 0.5 ), 5.0 );\x0A    vec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\x0A    vec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\x0A    vec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\x0A    vec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\x0A    vec4 result = mix(color10, color20, t);\x0A    return vec4(result.rgb, 1.0);\x0A}\x0A#endif\x0A", n.ShaderChunk.defaultnormal_vertex = "#ifdef FLIP_SIDED\x0A\x09objectNormal = -objectNormal;\x0A#endif\x0Avec3 transformedNormal = normalMatrix * objectNormal;\x0A", n.ShaderChunk.displacementmap_vertex = "#ifdef USE_DISPLACEMENTMAP\x0A\x09transformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\x0A#endif\x0A", n.ShaderChunk.displacementmap_pars_vertex = "#ifdef USE_DISPLACEMENTMAP\x0A\x09uniform sampler2D displacementMap;\x0A\x09uniform float displacementScale;\x0A\x09uniform float displacementBias;\x0A#endif\x0A", n.ShaderChunk.emissivemap_fragment = "#ifdef USE_EMISSIVEMAP\x0A\x09vec4 emissiveColor = texture2D( emissiveMap, vUv );\x0A\x09emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\x0A\x09totalEmissiveRadiance *= emissiveColor.rgb;\x0A#endif\x0A", n.ShaderChunk.emissivemap_pars_fragment = "#ifdef USE_EMISSIVEMAP\x0A\x09uniform sampler2D emissiveMap;\x0A#endif\x0A", n.ShaderChunk.encodings_pars_fragment = "\x0Avec4 LinearToLinear( in vec4 value ) {\x0A  return value;\x0A}\x0Avec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\x0A  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\x0A}\x0Avec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\x0A  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\x0A}\x0Avec4 sRGBToLinear( in vec4 value ) {\x0A  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\x0A}\x0Avec4 LinearTosRGB( in vec4 value ) {\x0A  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\x0A}\x0Avec4 RGBEToLinear( in vec4 value ) {\x0A  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\x0A}\x0Avec4 LinearToRGBE( in vec4 value ) {\x0A  float maxComponent = max( max( value.r, value.g ), value.b );\x0A  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\x0A  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\x0A}\x0Avec4 RGBMToLinear( in vec4 value, in float maxRange ) {\x0A  return vec4( value.xyz * value.w * maxRange, 1.0 );\x0A}\x0Avec4 LinearToRGBM( in vec4 value, in float maxRange ) {\x0A  float maxRGB = max( value.x, max( value.g, value.b ) );\x0A  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\x0A  M            = ceil( M * 255.0 ) / 255.0;\x0A  return vec4( value.rgb / ( M * maxRange ), M );\x0A}\x0Avec4 RGBDToLinear( in vec4 value, in float maxRange ) {\x0A    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\x0A}\x0Avec4 LinearToRGBD( in vec4 value, in float maxRange ) {\x0A    float maxRGB = max( value.x, max( value.g, value.b ) );\x0A    float D      = max( maxRange / maxRGB, 1.0 );\x0A    D            = min( floor( D ) / 255.0, 1.0 );\x0A    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\x0A}\x0Aconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\x0Avec4 LinearToLogLuv( in vec4 value )  {\x0A  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\x0A  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\x0A  vec4 vResult;\x0A  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\x0A  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\x0A  vResult.w = fract(Le);\x0A  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\x0A  return vResult;\x0A}\x0Aconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\x0Avec4 LogLuvToLinear( in vec4 value ) {\x0A  float Le = value.z * 255.0 + value.w;\x0A  vec3 Xp_Y_XYZp;\x0A  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\x0A  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\x0A  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\x0A  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\x0A  return vec4( max(vRGB, 0.0), 1.0 );\x0A}\x0A", n.ShaderChunk.encodings_fragment = "  gl_FragColor = linearToOutputTexel( gl_FragColor );\x0A", n.ShaderChunk.envmap_fragment = "#ifdef USE_ENVMAP\x0A\x09#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\x0A\x09\x09vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\x0A\x09\x09vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\x0A\x09\x09#ifdef ENVMAP_MODE_REFLECTION\x0A\x09\x09\x09vec3 reflectVec = reflect( cameraToVertex, worldNormal );\x0A\x09\x09#else\x0A\x09\x09\x09vec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\x0A\x09\x09#endif\x0A\x09#else\x0A\x09\x09vec3 reflectVec = vReflect;\x0A\x09#endif\x0A\x09#ifdef DOUBLE_SIDED\x0A\x09\x09float flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\x0A\x09#else\x0A\x09\x09float flipNormal = 1.0;\x0A\x09#endif\x0A\x09#ifdef ENVMAP_TYPE_CUBE\x0A\x09\x09vec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\x0A\x09#elif defined( ENVMAP_TYPE_EQUIREC )\x0A\x09\x09vec2 sampleUV;\x0A\x09\x09sampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\x0A\x09\x09sampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\x0A\x09\x09vec4 envColor = texture2D( envMap, sampleUV );\x0A\x09#elif defined( ENVMAP_TYPE_SPHERE )\x0A\x09\x09vec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\x0A\x09\x09vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\x0A\x09#endif\x0A\x09envColor = envMapTexelToLinear( envColor );\x0A\x09#ifdef ENVMAP_BLENDING_MULTIPLY\x0A\x09\x09outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\x0A\x09#elif defined( ENVMAP_BLENDING_MIX )\x0A\x09\x09outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\x0A\x09#elif defined( ENVMAP_BLENDING_ADD )\x0A\x09\x09outgoingLight += envColor.xyz * specularStrength * reflectivity;\x0A\x09#endif\x0A#endif\x0A", n.ShaderChunk.envmap_pars_fragment = "#if defined( USE_ENVMAP ) || defined( STANDARD )\x0A\x09uniform float reflectivity;\x0A\x09uniform float envMapIntenstiy;\x0A#endif\x0A#ifdef USE_ENVMAP\x0A\x09#ifdef ENVMAP_TYPE_CUBE\x0A\x09\x09uniform samplerCube envMap;\x0A\x09#else\x0A\x09\x09uniform sampler2D envMap;\x0A\x09#endif\x0A\x09uniform float flipEnvMap;\x0A\x09#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( STANDARD )\x0A\x09\x09uniform float refractionRatio;\x0A\x09#else\x0A\x09\x09varying vec3 vReflect;\x0A\x09#endif\x0A#endif\x0A", n.ShaderChunk.envmap_pars_vertex = "#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG ) && ! defined( STANDARD )\x0A\x09varying vec3 vReflect;\x0A\x09uniform float refractionRatio;\x0A#endif\x0A", n.ShaderChunk.envmap_vertex = "#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG ) && ! defined( STANDARD )\x0A\x09vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\x0A\x09vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\x0A\x09#ifdef ENVMAP_MODE_REFLECTION\x0A\x09\x09vReflect = reflect( cameraToVertex, worldNormal );\x0A\x09#else\x0A\x09\x09vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\x0A\x09#endif\x0A#endif\x0A", n.ShaderChunk.fog_fragment = "#ifdef USE_FOG\x0A\x09#ifdef USE_LOGDEPTHBUF_EXT\x0A\x09\x09float depth = gl_FragDepthEXT / gl_FragCoord.w;\x0A\x09#else\x0A\x09\x09float depth = gl_FragCoord.z / gl_FragCoord.w;\x0A\x09#endif\x0A\x09#ifdef FOG_EXP2\x0A\x09\x09float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\x0A\x09#else\x0A\x09\x09float fogFactor = smoothstep( fogNear, fogFar, depth );\x0A\x09#endif\x0A\x09gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\x0A#endif\x0A", n.ShaderChunk.fog_pars_fragment = "#ifdef USE_FOG\x0A\x09uniform vec3 fogColor;\x0A\x09#ifdef FOG_EXP2\x0A\x09\x09uniform float fogDensity;\x0A\x09#else\x0A\x09\x09uniform float fogNear;\x0A\x09\x09uniform float fogFar;\x0A\x09#endif\x0A#endif", n.ShaderChunk.lightmap_fragment = "#ifdef USE_LIGHTMAP\x0A\x09reflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\x0A#endif\x0A", n.ShaderChunk.lightmap_pars_fragment = "#ifdef USE_LIGHTMAP\x0A\x09uniform sampler2D lightMap;\x0A\x09uniform float lightMapIntensity;\x0A#endif", n.ShaderChunk.lights_lambert_vertex = "vec3 diffuse = vec3( 1.0 );\x0AGeometricContext geometry;\x0Ageometry.position = mvPosition.xyz;\x0Ageometry.normal = normalize( transformedNormal );\x0Ageometry.viewDir = normalize( -mvPosition.xyz );\x0AGeometricContext backGeometry;\x0AbackGeometry.position = geometry.position;\x0AbackGeometry.normal = -geometry.normal;\x0AbackGeometry.viewDir = geometry.viewDir;\x0AvLightFront = vec3( 0.0 );\x0A#ifdef DOUBLE_SIDED\x0A\x09vLightBack = vec3( 0.0 );\x0A#endif\x0AIncidentLight directLight;\x0Afloat dotNL;\x0Avec3 directLightColor_Diffuse;\x0A#if NUM_POINT_LIGHTS > 0\x0A\x09for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\x0A\x09\x09directLight = getPointDirectLightIrradiance( pointLights[ i ], geometry );\x0A\x09\x09dotNL = dot( geometry.normal, directLight.direction );\x0A\x09\x09directLightColor_Diffuse = PI * directLight.color;\x0A\x09\x09vLightFront += saturate( dotNL ) * directLightColor_Diffuse;\x0A\x09\x09#ifdef DOUBLE_SIDED\x0A\x09\x09\x09vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\x0A\x09\x09#endif\x0A\x09}\x0A#endif\x0A#if NUM_SPOT_LIGHTS > 0\x0A\x09for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\x0A\x09\x09directLight = getSpotDirectLightIrradiance( spotLights[ i ], geometry );\x0A\x09\x09dotNL = dot( geometry.normal, directLight.direction );\x0A\x09\x09directLightColor_Diffuse = PI * directLight.color;\x0A\x09\x09vLightFront += saturate( dotNL ) * directLightColor_Diffuse;\x0A\x09\x09#ifdef DOUBLE_SIDED\x0A\x09\x09\x09vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\x0A\x09\x09#endif\x0A\x09}\x0A#endif\x0A#if NUM_DIR_LIGHTS > 0\x0A\x09for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\x0A\x09\x09directLight = getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry );\x0A\x09\x09dotNL = dot( geometry.normal, directLight.direction );\x0A\x09\x09directLightColor_Diffuse = PI * directLight.color;\x0A\x09\x09vLightFront += saturate( dotNL ) * directLightColor_Diffuse;\x0A\x09\x09#ifdef DOUBLE_SIDED\x0A\x09\x09\x09vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\x0A\x09\x09#endif\x0A\x09}\x0A#endif\x0A#if NUM_HEMI_LIGHTS > 0\x0A\x09for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\x0A\x09\x09vLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\x0A\x09\x09#ifdef DOUBLE_SIDED\x0A\x09\x09\x09vLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\x0A\x09\x09#endif\x0A\x09}\x0A#endif\x0A", n.ShaderChunk.lights_pars = "uniform vec3 ambientLightColor;\x0Avec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\x0A\x09vec3 irradiance = ambientLightColor;\x0A\x09#ifndef PHYSICALLY_CORRECT_LIGHTS\x0A\x09\x09irradiance *= PI;\x0A\x09#endif\x0A\x09return irradiance;\x0A}\x0A#if NUM_DIR_LIGHTS > 0\x0A\x09struct DirectionalLight {\x0A\x09\x09vec3 direction;\x0A\x09\x09vec3 color;\x0A\x09\x09int shadow;\x0A\x09\x09float shadowBias;\x0A\x09\x09float shadowRadius;\x0A\x09\x09vec2 shadowMapSize;\x0A\x09};\x0A\x09uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\x0A\x09IncidentLight getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry ) {\x0A\x09\x09IncidentLight directLight;\x0A\x09\x09directLight.color = directionalLight.color;\x0A\x09\x09directLight.direction = directionalLight.direction;\x0A\x09\x09directLight.visible = true;\x0A\x09\x09return directLight;\x0A\x09}\x0A#endif\x0A#if NUM_POINT_LIGHTS > 0\x0A\x09struct PointLight {\x0A\x09\x09vec3 position;\x0A\x09\x09vec3 color;\x0A\x09\x09float distance;\x0A\x09\x09float decay;\x0A\x09\x09int shadow;\x0A\x09\x09float shadowBias;\x0A\x09\x09float shadowRadius;\x0A\x09\x09vec2 shadowMapSize;\x0A\x09};\x0A\x09uniform PointLight pointLights[ NUM_POINT_LIGHTS ];\x0A\x09IncidentLight getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry ) {\x0A\x09\x09IncidentLight directLight;\x0A\x09\x09vec3 lVector = pointLight.position - geometry.position;\x0A\x09\x09directLight.direction = normalize( lVector );\x0A\x09\x09float lightDistance = length( lVector );\x0A\x09\x09if ( testLightInRange( lightDistance, pointLight.distance ) ) {\x0A\x09\x09\x09directLight.color = pointLight.color;\x0A\x09\x09\x09directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\x0A\x09\x09\x09directLight.visible = true;\x0A\x09\x09} else {\x0A\x09\x09\x09directLight.color = vec3( 0.0 );\x0A\x09\x09\x09directLight.visible = false;\x0A\x09\x09}\x0A\x09\x09return directLight;\x0A\x09}\x0A#endif\x0A#if NUM_SPOT_LIGHTS > 0\x0A\x09struct SpotLight {\x0A\x09\x09vec3 position;\x0A\x09\x09vec3 direction;\x0A\x09\x09vec3 color;\x0A\x09\x09float distance;\x0A\x09\x09float decay;\x0A\x09\x09float coneCos;\x0A\x09\x09float penumbraCos;\x0A\x09\x09int shadow;\x0A\x09\x09float shadowBias;\x0A\x09\x09float shadowRadius;\x0A\x09\x09vec2 shadowMapSize;\x0A\x09};\x0A\x09uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\x0A\x09IncidentLight getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry ) {\x0A\x09\x09IncidentLight directLight;\x0A\x09\x09vec3 lVector = spotLight.position - geometry.position;\x0A\x09\x09directLight.direction = normalize( lVector );\x0A\x09\x09float lightDistance = length( lVector );\x0A\x09\x09float angleCos = dot( directLight.direction, spotLight.direction );\x0A\x09\x09if ( all( bvec2( angleCos > spotLight.coneCos, testLightInRange( lightDistance, spotLight.distance ) ) ) ) {\x0A\x09\x09\x09float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\x0A\x09\x09\x09directLight.color = spotLight.color;\x0A\x09\x09\x09directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\x0A\x09\x09\x09directLight.visible = true;\x0A\x09\x09} else {\x0A\x09\x09\x09directLight.color = vec3( 0.0 );\x0A\x09\x09\x09directLight.visible = false;\x0A\x09\x09}\x0A\x09\x09return directLight;\x0A\x09}\x0A#endif\x0A#if NUM_HEMI_LIGHTS > 0\x0A\x09struct HemisphereLight {\x0A\x09\x09vec3 direction;\x0A\x09\x09vec3 skyColor;\x0A\x09\x09vec3 groundColor;\x0A\x09};\x0A\x09uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\x0A\x09vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\x0A\x09\x09float dotNL = dot( geometry.normal, hemiLight.direction );\x0A\x09\x09float hemiDiffuseWeight = 0.5 * dotNL + 0.5;\x0A\x09\x09vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\x0A\x09\x09#ifndef PHYSICALLY_CORRECT_LIGHTS\x0A\x09\x09\x09irradiance *= PI;\x0A\x09\x09#endif\x0A\x09\x09return irradiance;\x0A\x09}\x0A#endif\x0A#if defined( USE_ENVMAP ) && defined( STANDARD )\x0A\x09vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\x0A\x09\x09#ifdef DOUBLE_SIDED\x0A\x09\x09\x09float flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\x0A\x09\x09#else\x0A\x09\x09\x09float flipNormal = 1.0;\x0A\x09\x09#endif\x0A\x09\x09vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\x0A\x09\x09#ifdef ENVMAP_TYPE_CUBE\x0A\x09\x09\x09vec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\x0A\x09\x09\x09#ifdef TEXTURE_LOD_EXT\x0A\x09\x09\x09\x09vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\x0A\x09\x09\x09#else\x0A\x09\x09\x09\x09vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\x0A\x09\x09\x09#endif\x0A\x09\x09#elif defined( ENVMAP_TYPE_CUBE_UV )\x0A\x09\x09\x09vec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\x0A\x09\x09\x09vec4 envMapColor = textureCubeUV( queryVec, 1.0 );\x0A\x09\x09#else\x0A\x09\x09\x09vec4 envMapColor = vec4( 0.0 );\x0A\x09\x09#endif\x0A\x09\x09envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\x0A\x09\x09return PI * envMapColor.rgb * envMapIntensity;\x0A\x09}\x0A\x09float getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\x0A\x09\x09float maxMIPLevelScalar = float( maxMIPLevel );\x0A\x09\x09float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\x0A\x09\x09return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\x0A\x09}\x0A\x09vec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\x0A\x09\x09#ifdef ENVMAP_MODE_REFLECTION\x0A\x09\x09\x09vec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\x0A\x09\x09#else\x0A\x09\x09\x09vec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\x0A\x09\x09#endif\x0A\x09\x09#ifdef DOUBLE_SIDED\x0A\x09\x09\x09float flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\x0A\x09\x09#else\x0A\x09\x09\x09float flipNormal = 1.0;\x0A\x09\x09#endif\x0A\x09\x09reflectVec = inverseTransformDirection( reflectVec, viewMatrix );\x0A\x09\x09float specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\x0A\x09\x09#ifdef ENVMAP_TYPE_CUBE\x0A\x09\x09\x09vec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\x0A\x09\x09\x09#ifdef TEXTURE_LOD_EXT\x0A\x09\x09\x09\x09vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\x0A\x09\x09\x09#else\x0A\x09\x09\x09\x09vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\x0A\x09\x09\x09#endif\x0A\x09\x09#elif defined( ENVMAP_TYPE_CUBE_UV )\x0A\x09\x09\x09vec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\x0A\x09\x09\x09vec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\x0A\x09\x09#elif defined( ENVMAP_TYPE_EQUIREC )\x0A\x09\x09\x09vec2 sampleUV;\x0A\x09\x09\x09sampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\x0A\x09\x09\x09sampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\x0A\x09\x09\x09#ifdef TEXTURE_LOD_EXT\x0A\x09\x09\x09\x09vec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\x0A\x09\x09\x09#else\x0A\x09\x09\x09\x09vec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\x0A\x09\x09\x09#endif\x0A\x09\x09#elif defined( ENVMAP_TYPE_SPHERE )\x0A\x09\x09\x09vec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\x0A\x09\x09\x09#ifdef TEXTURE_LOD_EXT\x0A\x09\x09\x09\x09vec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\x0A\x09\x09\x09#else\x0A\x09\x09\x09\x09vec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\x0A\x09\x09\x09#endif\x0A\x09\x09#endif\x0A\x09\x09envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\x0A\x09\x09return envMapColor.rgb * envMapIntensity;\x0A\x09}\x0A#endif\x0A", n.ShaderChunk.lights_phong_fragment = "BlinnPhongMaterial material;\x0Amaterial.diffuseColor = diffuseColor.rgb;\x0Amaterial.specularColor = specular;\x0Amaterial.specularShininess = shininess;\x0Amaterial.specularStrength = specularStrength;\x0A", n.ShaderChunk.lights_phong_pars_fragment = "#ifdef USE_ENVMAP\x0A\x09varying vec3 vWorldPosition;\x0A#endif\x0Avarying vec3 vViewPosition;\x0A#ifndef FLAT_SHADED\x0A\x09varying vec3 vNormal;\x0A#endif\x0Astruct BlinnPhongMaterial {\x0A\x09vec3\x09diffuseColor;\x0A\x09vec3\x09specularColor;\x0A\x09float\x09specularShininess;\x0A\x09float\x09specularStrength;\x0A};\x0Avoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\x0A\x09float dotNL = saturate( dot( geometry.normal, directLight.direction ) );\x0A\x09vec3 irradiance = dotNL * directLight.color;\x0A\x09#ifndef PHYSICALLY_CORRECT_LIGHTS\x0A\x09\x09irradiance *= PI;\x0A\x09#endif\x0A\x09reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\x0A\x09reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\x0A}\x0Avoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\x0A\x09reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\x0A}\x0A#define RE_Direct\x09\x09\x09\x09RE_Direct_BlinnPhong\x0A#define RE_IndirectDiffuse\x09\x09RE_IndirectDiffuse_BlinnPhong\x0A#define Material_LightProbeLOD( material )\x09(0)\x0A", n.ShaderChunk.lights_phong_pars_vertex = "#ifdef USE_ENVMAP\x0A\x09varying vec3 vWorldPosition;\x0A#endif\x0A", n.ShaderChunk.lights_phong_vertex = "#ifdef USE_ENVMAP\x0A\x09vWorldPosition = worldPosition.xyz;\x0A#endif\x0A", n.ShaderChunk.lights_standard_fragment = "StandardMaterial material;\x0Amaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\x0Amaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\x0Amaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\x0A", n.ShaderChunk.lights_standard_pars_fragment = "struct StandardMaterial {\x0A\x09vec3\x09diffuseColor;\x0A\x09float\x09specularRoughness;\x0A\x09vec3\x09specularColor;\x0A};\x0Avoid RE_Direct_Standard( const in IncidentLight directLight, const in GeometricContext geometry, const in StandardMaterial material, inout ReflectedLight reflectedLight ) {\x0A\x09float dotNL = saturate( dot( geometry.normal, directLight.direction ) );\x0A\x09vec3 irradiance = dotNL * directLight.color;\x0A\x09#ifndef PHYSICALLY_CORRECT_LIGHTS\x0A\x09\x09irradiance *= PI;\x0A\x09#endif\x0A\x09reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\x0A\x09reflectedLight.directSpecular += irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\x0A}\x0Avoid RE_IndirectDiffuse_Standard( const in vec3 irradiance, const in GeometricContext geometry, const in StandardMaterial material, inout ReflectedLight reflectedLight ) {\x0A\x09reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\x0A}\x0Avoid RE_IndirectSpecular_Standard( const in vec3 radiance, const in GeometricContext geometry, const in StandardMaterial material, inout ReflectedLight reflectedLight ) {\x0A\x09reflectedLight.indirectSpecular += radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\x0A}\x0A#define RE_Direct\x09\x09\x09\x09RE_Direct_Standard\x0A#define RE_IndirectDiffuse\x09\x09RE_IndirectDiffuse_Standard\x0A#define RE_IndirectSpecular\x09\x09RE_IndirectSpecular_Standard\x0A#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\x0Afloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\x0A\x09return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\x0A}\x0A", n.ShaderChunk.lights_template = "\x0AGeometricContext geometry;\x0Ageometry.position = - vViewPosition;\x0Ageometry.normal = normal;\x0Ageometry.viewDir = normalize( vViewPosition );\x0AIncidentLight directLight;\x0A#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\x0A\x09PointLight pointLight;\x0A\x09for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\x0A\x09\x09pointLight = pointLights[ i ];\x0A\x09\x09directLight = getPointDirectLightIrradiance( pointLight, geometry );\x0A\x09\x09#ifdef USE_SHADOWMAP\x0A\x09\x09directLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\x0A\x09\x09#endif\x0A\x09\x09RE_Direct( directLight, geometry, material, reflectedLight );\x0A\x09}\x0A#endif\x0A#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\x0A\x09SpotLight spotLight;\x0A\x09for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\x0A\x09\x09spotLight = spotLights[ i ];\x0A\x09\x09directLight = getSpotDirectLightIrradiance( spotLight, geometry );\x0A\x09\x09#ifdef USE_SHADOWMAP\x0A\x09\x09directLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\x0A\x09\x09#endif\x0A\x09\x09RE_Direct( directLight, geometry, material, reflectedLight );\x0A\x09}\x0A#endif\x0A#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\x0A\x09DirectionalLight directionalLight;\x0A\x09for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\x0A\x09\x09directionalLight = directionalLights[ i ];\x0A\x09\x09directLight = getDirectionalDirectLightIrradiance( directionalLight, geometry );\x0A\x09\x09#ifdef USE_SHADOWMAP\x0A\x09\x09directLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\x0A\x09\x09#endif\x0A\x09\x09RE_Direct( directLight, geometry, material, reflectedLight );\x0A\x09}\x0A#endif\x0A#if defined( RE_IndirectDiffuse )\x0A\x09vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\x0A\x09#ifdef USE_LIGHTMAP\x0A\x09\x09vec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\x0A\x09\x09#ifndef PHYSICALLY_CORRECT_LIGHTS\x0A\x09\x09\x09lightMapIrradiance *= PI;\x0A\x09\x09#endif\x0A\x09\x09irradiance += lightMapIrradiance;\x0A\x09#endif\x0A\x09#if ( NUM_HEMI_LIGHTS > 0 )\x0A\x09\x09for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\x0A\x09\x09\x09irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\x0A\x09\x09}\x0A\x09#endif\x0A\x09#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\x0A\x09 \x09irradiance += getLightProbeIndirectIrradiance( geometry, 8 );\x0A\x09#endif\x0A\x09RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\x0A#endif\x0A#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\x0A\x09vec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\x0A\x09RE_IndirectSpecular( radiance, geometry, material, reflectedLight );\x0A#endif\x0A", n.ShaderChunk.logdepthbuf_fragment = "#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\x0A\x09gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\x0A#endif", n.ShaderChunk.logdepthbuf_pars_fragment = "#ifdef USE_LOGDEPTHBUF\x0A\x09uniform float logDepthBufFC;\x0A\x09#ifdef USE_LOGDEPTHBUF_EXT\x0A\x09\x09varying float vFragDepth;\x0A\x09#endif\x0A#endif\x0A", n.ShaderChunk.logdepthbuf_pars_vertex = "#ifdef USE_LOGDEPTHBUF\x0A\x09#ifdef USE_LOGDEPTHBUF_EXT\x0A\x09\x09varying float vFragDepth;\x0A\x09#endif\x0A\x09uniform float logDepthBufFC;\x0A#endif", n.ShaderChunk.logdepthbuf_vertex = "#ifdef USE_LOGDEPTHBUF\x0A\x09gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\x0A\x09#ifdef USE_LOGDEPTHBUF_EXT\x0A\x09\x09vFragDepth = 1.0 + gl_Position.w;\x0A\x09#else\x0A\x09\x09gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\x0A\x09#endif\x0A#endif\x0A", n.ShaderChunk.map_fragment = "#ifdef USE_MAP\x0A\x09vec4 texelColor = texture2D( map, vUv );\x0A\x09texelColor = mapTexelToLinear( texelColor );\x0A\x09diffuseColor *= texelColor;\x0A#endif\x0A", n.ShaderChunk.map_pars_fragment = "#ifdef USE_MAP\x0A\x09uniform sampler2D map;\x0A#endif\x0A", n.ShaderChunk.map_particle_fragment = "#ifdef USE_MAP\x0A\x09vec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\x0A\x09diffuseColor *= mapTexelToLinear( mapTexel );\x0A#endif\x0A", n.ShaderChunk.map_particle_pars_fragment = "#ifdef USE_MAP\x0A\x09uniform vec4 offsetRepeat;\x0A\x09uniform sampler2D map;\x0A#endif\x0A", n.ShaderChunk.metalnessmap_fragment = "float metalnessFactor = metalness;\x0A#ifdef USE_METALNESSMAP\x0A\x09vec4 texelMetalness = texture2D( metalnessMap, vUv );\x0A\x09metalnessFactor *= texelMetalness.r;\x0A#endif\x0A", n.ShaderChunk.metalnessmap_pars_fragment = "#ifdef USE_METALNESSMAP\x0A\x09uniform sampler2D metalnessMap;\x0A#endif", n.ShaderChunk.morphnormal_vertex = "#ifdef USE_MORPHNORMALS\x0A\x09objectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\x0A\x09objectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\x0A\x09objectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\x0A\x09objectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\x0A#endif\x0A", n.ShaderChunk.morphtarget_pars_vertex = "#ifdef USE_MORPHTARGETS\x0A\x09#ifndef USE_MORPHNORMALS\x0A\x09uniform float morphTargetInfluences[ 8 ];\x0A\x09#else\x0A\x09uniform float morphTargetInfluences[ 4 ];\x0A\x09#endif\x0A#endif", n.ShaderChunk.morphtarget_vertex = "#ifdef USE_MORPHTARGETS\x0A\x09transformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\x0A\x09transformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\x0A\x09transformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\x0A\x09transformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\x0A\x09#ifndef USE_MORPHNORMALS\x0A\x09transformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\x0A\x09transformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\x0A\x09transformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\x0A\x09transformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\x0A\x09#endif\x0A#endif\x0A", n.ShaderChunk.normal_fragment = "#ifdef FLAT_SHADED\x0A\x09vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\x0A\x09vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\x0A\x09vec3 normal = normalize( cross( fdx, fdy ) );\x0A#else\x0A\x09vec3 normal = normalize( vNormal );\x0A\x09#ifdef DOUBLE_SIDED\x0A\x09\x09normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\x0A\x09#endif\x0A#endif\x0A#ifdef USE_NORMALMAP\x0A\x09normal = perturbNormal2Arb( -vViewPosition, normal );\x0A#elif defined( USE_BUMPMAP )\x0A\x09normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\x0A#endif\x0A", n.ShaderChunk.normalmap_pars_fragment = "#ifdef USE_NORMALMAP\x0A\x09uniform sampler2D normalMap;\x0A\x09uniform vec2 normalScale;\x0A\x09vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\x0A\x09\x09vec3 q0 = dFdx( eye_pos.xyz );\x0A\x09\x09vec3 q1 = dFdy( eye_pos.xyz );\x0A\x09\x09vec2 st0 = dFdx( vUv.st );\x0A\x09\x09vec2 st1 = dFdy( vUv.st );\x0A\x09\x09vec3 S = normalize( q0 * st1.t - q1 * st0.t );\x0A\x09\x09vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\x0A\x09\x09vec3 N = normalize( surf_norm );\x0A\x09\x09vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\x0A\x09\x09mapN.xy = normalScale * mapN.xy;\x0A\x09\x09mat3 tsn = mat3( S, T, N );\x0A\x09\x09return normalize( tsn * mapN );\x0A\x09}\x0A#endif\x0A", n.ShaderChunk.premultiplied_alpha_fragment = "#ifdef PREMULTIPLIED_ALPHA\x0A\x09gl_FragColor.rgb *= gl_FragColor.a;\x0A#endif\x0A", n.ShaderChunk.project_vertex = "#ifdef USE_SKINNING\x0A\x09vec4 mvPosition = modelViewMatrix * skinned;\x0A#else\x0A\x09vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\x0A#endif\x0Agl_Position = projectionMatrix * mvPosition;\x0A", n.ShaderChunk.roughnessmap_fragment = "float roughnessFactor = roughness;\x0A#ifdef USE_ROUGHNESSMAP\x0A\x09vec4 texelRoughness = texture2D( roughnessMap, vUv );\x0A\x09roughnessFactor *= texelRoughness.r;\x0A#endif\x0A", n.ShaderChunk.roughnessmap_pars_fragment = "#ifdef USE_ROUGHNESSMAP\x0A\x09uniform sampler2D roughnessMap;\x0A#endif", n.ShaderChunk.shadowmap_pars_fragment = "#ifdef USE_SHADOWMAP\x0A\x09#if NUM_DIR_LIGHTS > 0\x0A\x09\x09uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\x0A\x09\x09varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\x0A\x09#endif\x0A\x09#if NUM_SPOT_LIGHTS > 0\x0A\x09\x09uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\x0A\x09\x09varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\x0A\x09#endif\x0A\x09#if NUM_POINT_LIGHTS > 0\x0A\x09\x09uniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\x0A\x09\x09varying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\x0A\x09#endif\x0A\x09float unpackDepth( const in vec4 rgba_depth ) {\x0A\x09\x09const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\x0A\x09\x09return dot( rgba_depth, bit_shift );\x0A\x09}\x0A\x09float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\x0A\x09\x09return step( compare, unpackDepth( texture2D( depths, uv ) ) );\x0A\x09}\x0A\x09float texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\x0A\x09\x09const vec2 offset = vec2( 0.0, 1.0 );\x0A\x09\x09vec2 texelSize = vec2( 1.0 ) / size;\x0A\x09\x09vec2 centroidUV = floor( uv * size + 0.5 ) / size;\x0A\x09\x09float lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\x0A\x09\x09float lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\x0A\x09\x09float rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\x0A\x09\x09float rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\x0A\x09\x09vec2 f = fract( uv * size + 0.5 );\x0A\x09\x09float a = mix( lb, lt, f.y );\x0A\x09\x09float b = mix( rb, rt, f.y );\x0A\x09\x09float c = mix( a, b, f.x );\x0A\x09\x09return c;\x0A\x09}\x0A\x09float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\x0A\x09\x09shadowCoord.xyz /= shadowCoord.w;\x0A\x09\x09shadowCoord.z += shadowBias;\x0A\x09\x09bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\x0A\x09\x09bool inFrustum = all( inFrustumVec );\x0A\x09\x09bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\x0A\x09\x09bool frustumTest = all( frustumTestVec );\x0A\x09\x09if ( frustumTest ) {\x0A\x09\x09#if defined( SHADOWMAP_TYPE_PCF )\x0A\x09\x09\x09vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\x0A\x09\x09\x09float dx0 = - texelSize.x * shadowRadius;\x0A\x09\x09\x09float dy0 = - texelSize.y * shadowRadius;\x0A\x09\x09\x09float dx1 = + texelSize.x * shadowRadius;\x0A\x09\x09\x09float dy1 = + texelSize.y * shadowRadius;\x0A\x09\x09\x09return (\x0A\x09\x09\x09\x09texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\x0A\x09\x09\x09\x09texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\x0A\x09\x09\x09\x09texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\x0A\x09\x09\x09\x09texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\x0A\x09\x09\x09\x09texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\x0A\x09\x09\x09\x09texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\x0A\x09\x09\x09\x09texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\x0A\x09\x09\x09\x09texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\x0A\x09\x09\x09\x09texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\x0A\x09\x09\x09) * ( 1.0 / 9.0 );\x0A\x09\x09#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\x0A\x09\x09\x09vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\x0A\x09\x09\x09float dx0 = - texelSize.x * shadowRadius;\x0A\x09\x09\x09float dy0 = - texelSize.y * shadowRadius;\x0A\x09\x09\x09float dx1 = + texelSize.x * shadowRadius;\x0A\x09\x09\x09float dy1 = + texelSize.y * shadowRadius;\x0A\x09\x09\x09return (\x0A\x09\x09\x09\x09texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\x0A\x09\x09\x09\x09texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\x0A\x09\x09\x09\x09texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\x0A\x09\x09\x09\x09texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\x0A\x09\x09\x09\x09texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\x0A\x09\x09\x09\x09texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\x0A\x09\x09\x09\x09texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\x0A\x09\x09\x09\x09texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\x0A\x09\x09\x09\x09texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\x0A\x09\x09\x09) * ( 1.0 / 9.0 );\x0A\x09\x09#else\x0A\x09\x09\x09return texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\x0A\x09\x09#endif\x0A\x09\x09}\x0A\x09\x09return 1.0;\x0A\x09}\x0A\x09vec2 cubeToUV( vec3 v, float texelSizeY ) {\x0A\x09\x09vec3 absV = abs( v );\x0A\x09\x09float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\x0A\x09\x09absV *= scaleToCube;\x0A\x09\x09v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\x0A\x09\x09vec2 planar = v.xy;\x0A\x09\x09float almostATexel = 1.5 * texelSizeY;\x0A\x09\x09float almostOne = 1.0 - almostATexel;\x0A\x09\x09if ( absV.z >= almostOne ) {\x0A\x09\x09\x09if ( v.z > 0.0 )\x0A\x09\x09\x09\x09planar.x = 4.0 - v.x;\x0A\x09\x09} else if ( absV.x >= almostOne ) {\x0A\x09\x09\x09float signX = sign( v.x );\x0A\x09\x09\x09planar.x = v.z * signX + 2.0 * signX;\x0A\x09\x09} else if ( absV.y >= almostOne ) {\x0A\x09\x09\x09float signY = sign( v.y );\x0A\x09\x09\x09planar.x = v.x + 2.0 * signY + 2.0;\x0A\x09\x09\x09planar.y = v.z * signY - 2.0;\x0A\x09\x09}\x0A\x09\x09return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\x0A\x09}\x0A\x09float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\x0A\x09\x09vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\x0A\x09\x09vec3 lightToPosition = shadowCoord.xyz;\x0A\x09\x09vec3 bd3D = normalize( lightToPosition );\x0A\x09\x09float dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\x0A\x09\x09#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\x0A\x09\x09\x09vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\x0A\x09\x09\x09return (\x0A\x09\x09\x09\x09texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\x0A\x09\x09\x09\x09texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\x0A\x09\x09\x09\x09texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\x0A\x09\x09\x09\x09texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\x0A\x09\x09\x09\x09texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\x0A\x09\x09\x09\x09texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\x0A\x09\x09\x09\x09texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\x0A\x09\x09\x09\x09texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\x0A\x09\x09\x09\x09texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\x0A\x09\x09\x09) * ( 1.0 / 9.0 );\x0A\x09\x09#else\x0A\x09\x09\x09return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\x0A\x09\x09#endif\x0A\x09}\x0A#endif\x0A", n.ShaderChunk.shadowmap_pars_vertex = "#ifdef USE_SHADOWMAP\x0A\x09#if NUM_DIR_LIGHTS > 0\x0A\x09\x09uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\x0A\x09\x09varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\x0A\x09#endif\x0A\x09#if NUM_SPOT_LIGHTS > 0\x0A\x09\x09uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\x0A\x09\x09varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\x0A\x09#endif\x0A\x09#if NUM_POINT_LIGHTS > 0\x0A\x09\x09uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\x0A\x09\x09varying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\x0A\x09#endif\x0A#endif\x0A", n.ShaderChunk.shadowmap_vertex = "#ifdef USE_SHADOWMAP\x0A\x09#if NUM_DIR_LIGHTS > 0\x0A\x09for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\x0A\x09\x09vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\x0A\x09}\x0A\x09#endif\x0A\x09#if NUM_SPOT_LIGHTS > 0\x0A\x09for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\x0A\x09\x09vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\x0A\x09}\x0A\x09#endif\x0A\x09#if NUM_POINT_LIGHTS > 0\x0A\x09for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\x0A\x09\x09vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\x0A\x09}\x0A\x09#endif\x0A#endif\x0A", n.ShaderChunk.shadowmask_pars_fragment = "float getShadowMask() {\x0A\x09float shadow = 1.0;\x0A\x09#ifdef USE_SHADOWMAP\x0A\x09#if NUM_DIR_LIGHTS > 0\x0A\x09DirectionalLight directionalLight;\x0A\x09for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\x0A\x09\x09directionalLight = directionalLights[ i ];\x0A\x09\x09shadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\x0A\x09}\x0A\x09#endif\x0A\x09#if NUM_SPOT_LIGHTS > 0\x0A\x09SpotLight spotLight;\x0A\x09for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\x0A\x09\x09spotLight = spotLights[ i ];\x0A\x09\x09shadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\x0A\x09}\x0A\x09#endif\x0A\x09#if NUM_POINT_LIGHTS > 0\x0A\x09PointLight pointLight;\x0A\x09for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\x0A\x09\x09pointLight = pointLights[ i ];\x0A\x09\x09shadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\x0A\x09}\x0A\x09#endif\x0A\x09#endif\x0A\x09return shadow;\x0A}\x0A", n.ShaderChunk.skinbase_vertex = "#ifdef USE_SKINNING\x0A\x09mat4 boneMatX = getBoneMatrix( skinIndex.x );\x0A\x09mat4 boneMatY = getBoneMatrix( skinIndex.y );\x0A\x09mat4 boneMatZ = getBoneMatrix( skinIndex.z );\x0A\x09mat4 boneMatW = getBoneMatrix( skinIndex.w );\x0A#endif", n.ShaderChunk.skinning_pars_vertex = "#ifdef USE_SKINNING\x0A\x09uniform mat4 bindMatrix;\x0A\x09uniform mat4 bindMatrixInverse;\x0A\x09#ifdef BONE_TEXTURE\x0A\x09\x09uniform sampler2D boneTexture;\x0A\x09\x09uniform int boneTextureWidth;\x0A\x09\x09uniform int boneTextureHeight;\x0A\x09\x09mat4 getBoneMatrix( const in float i ) {\x0A\x09\x09\x09float j = i * 4.0;\x0A\x09\x09\x09float x = mod( j, float( boneTextureWidth ) );\x0A\x09\x09\x09float y = floor( j / float( boneTextureWidth ) );\x0A\x09\x09\x09float dx = 1.0 / float( boneTextureWidth );\x0A\x09\x09\x09float dy = 1.0 / float( boneTextureHeight );\x0A\x09\x09\x09y = dy * ( y + 0.5 );\x0A\x09\x09\x09vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\x0A\x09\x09\x09vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\x0A\x09\x09\x09vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\x0A\x09\x09\x09vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\x0A\x09\x09\x09mat4 bone = mat4( v1, v2, v3, v4 );\x0A\x09\x09\x09return bone;\x0A\x09\x09}\x0A\x09#else\x0A\x09\x09uniform mat4 boneGlobalMatrices[ MAX_BONES ];\x0A\x09\x09mat4 getBoneMatrix( const in float i ) {\x0A\x09\x09\x09mat4 bone = boneGlobalMatrices[ int(i) ];\x0A\x09\x09\x09return bone;\x0A\x09\x09}\x0A\x09#endif\x0A#endif\x0A", n.ShaderChunk.skinning_vertex = "#ifdef USE_SKINNING\x0A\x09vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\x0A\x09vec4 skinned = vec4( 0.0 );\x0A\x09skinned += boneMatX * skinVertex * skinWeight.x;\x0A\x09skinned += boneMatY * skinVertex * skinWeight.y;\x0A\x09skinned += boneMatZ * skinVertex * skinWeight.z;\x0A\x09skinned += boneMatW * skinVertex * skinWeight.w;\x0A\x09skinned  = bindMatrixInverse * skinned;\x0A#endif\x0A", n.ShaderChunk.skinnormal_vertex = "#ifdef USE_SKINNING\x0A\x09mat4 skinMatrix = mat4( 0.0 );\x0A\x09skinMatrix += skinWeight.x * boneMatX;\x0A\x09skinMatrix += skinWeight.y * boneMatY;\x0A\x09skinMatrix += skinWeight.z * boneMatZ;\x0A\x09skinMatrix += skinWeight.w * boneMatW;\x0A\x09skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\x0A\x09objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\x0A#endif\x0A", n.ShaderChunk.specularmap_fragment = "float specularStrength;\x0A#ifdef USE_SPECULARMAP\x0A\x09vec4 texelSpecular = texture2D( specularMap, vUv );\x0A\x09specularStrength = texelSpecular.r;\x0A#else\x0A\x09specularStrength = 1.0;\x0A#endif", n.ShaderChunk.specularmap_pars_fragment = "#ifdef USE_SPECULARMAP\x0A\x09uniform sampler2D specularMap;\x0A#endif", n.ShaderChunk.tonemapping_fragment = "#if defined( TONE_MAPPING )\x0A  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\x0A#endif\x0A", n.ShaderChunk.tonemapping_pars_fragment = "#define saturate(a) clamp( a, 0.0, 1.0 )\x0Auniform float toneMappingExposure;\x0Auniform float toneMappingWhitePoint;\x0Avec3 LinearToneMapping( vec3 color ) {\x0A  return toneMappingExposure * color;\x0A}\x0Avec3 ReinhardToneMapping( vec3 color ) {\x0A  color *= toneMappingExposure;\x0A  return saturate( color / ( vec3( 1.0 ) + color ) );\x0A}\x0A#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\x0Avec3 Uncharted2ToneMapping( vec3 color ) {\x0A  color *= toneMappingExposure;\x0A  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\x0A}\x0Avec3 OptimizedCineonToneMapping( vec3 color ) {\x0A  color *= toneMappingExposure;\x0A  color = max( vec3( 0.0 ), color - 0.004 );\x0A  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\x0A}\x0A", n.ShaderChunk.uv2_pars_fragment = "#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\x0A\x09varying vec2 vUv2;\x0A#endif", n.ShaderChunk.uv2_pars_vertex = "#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\x0A\x09attribute vec2 uv2;\x0A\x09varying vec2 vUv2;\x0A#endif", n.ShaderChunk.uv2_vertex = "#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\x0A\x09vUv2 = uv2;\x0A#endif", n.ShaderChunk.uv_pars_fragment = "#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\x0A\x09varying vec2 vUv;\x0A#endif", n.ShaderChunk.uv_pars_vertex = "#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\x0A\x09varying vec2 vUv;\x0A\x09uniform vec4 offsetRepeat;\x0A#endif\x0A", n.ShaderChunk.uv_vertex = "#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\x0A\x09vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\x0A#endif", n.ShaderChunk.worldpos_vertex = "#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( STANDARD ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\x0A\x09#ifdef USE_SKINNING\x0A\x09\x09vec4 worldPosition = modelMatrix * skinned;\x0A\x09#else\x0A\x09\x09vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\x0A\x09#endif\x0A#endif\x0A", n.UniformsUtils = {
        merge: function(e) {
          for (var t = {}, i = 0; i < e.length; i++) {
            var n = this.clone(e[i]);
            for (var r in n) {
              t[r] = n[r]
            }
          };
          return t
        },
        clone: function(e) {
          var t = {};
          for (var i in e) {
            t[i] = {};
            for (var r in e[i]) {
              var o = e[i][r];
              t[i][r] = o instanceof n.Color || o instanceof n.Vector2 || o instanceof n.Vector3 || o instanceof n.Vector4 || o instanceof n.Matrix3 || o instanceof n.Matrix4 || o instanceof n.Texture ? o.clone() : Array.isArray(o) ? o.slice() : o
            }
          };
          return t
        }
      }, n.UniformsLib = {
        common: {
          diffuse: {
            type: "c",
            value: new n.Color(15658734)
          },
          opacity: {
            type: "f",
            value: 1
          },
          map: {
            type: "t",
            value: null
          },
          offsetRepeat: {
            type: "v4",
            value: new n.Vector4(0, 0, 1, 1)
          },
          specularMap: {
            type: "t",
            value: null
          },
          alphaMap: {
            type: "t",
            value: null
          },
          envMap: {
            type: "t",
            value: null
          },
          flipEnvMap: {
            type: "f",
            value: -1
          },
          reflectivity: {
            type: "f",
            value: 1
          },
          refractionRatio: {
            type: "f",
            value: 0.98
          }
        },
        aomap: {
          aoMap: {
            type: "t",
            value: null
          },
          aoMapIntensity: {
            type: "f",
            value: 1
          }
        },
        lightmap: {
          lightMap: {
            type: "t",
            value: null
          },
          lightMapIntensity: {
            type: "f",
            value: 1
          }
        },
        emissivemap: {
          emissiveMap: {
            type: "t",
            value: null
          }
        },
        bumpmap: {
          bumpMap: {
            type: "t",
            value: null
          },
          bumpScale: {
            type: "f",
            value: 1
          }
        },
        normalmap: {
          normalMap: {
            type: "t",
            value: null
          },
          normalScale: {
            type: "v2",
            value: new n.Vector2(1, 1)
          }
        },
        displacementmap: {
          displacementMap: {
            type: "t",
            value: null
          },
          displacementScale: {
            type: "f",
            value: 1
          },
          displacementBias: {
            type: "f",
            value: 0
          }
        },
        roughnessmap: {
          roughnessMap: {
            type: "t",
            value: null
          }
        },
        metalnessmap: {
          metalnessMap: {
            type: "t",
            value: null
          }
        },
        fog: {
          fogDensity: {
            type: "f",
            value: 25e-5
          },
          fogNear: {
            type: "f",
            value: 1
          },
          fogFar: {
            type: "f",
            value: 2e3
          },
          fogColor: {
            type: "c",
            value: new n.Color(16777215)
          }
        },
        lights: {
          ambientLightColor: {
            type: "fv",
            value: []
          },
          directionalLights: {
            type: "sa",
            value: [],
            properties: {
              direction: {
                type: "v3"
              },
              color: {
                type: "c"
              },
              shadow: {
                type: "i"
              },
              shadowBias: {
                type: "f"
              },
              shadowRadius: {
                type: "f"
              },
              shadowMapSize: {
                type: "v2"
              }
            }
          },
          directionalShadowMap: {
            type: "tv",
            value: []
          },
          directionalShadowMatrix: {
            type: "m4v",
            value: []
          },
          spotLights: {
            type: "sa",
            value: [],
            properties: {
              color: {
                type: "c"
              },
              position: {
                type: "v3"
              },
              direction: {
                type: "v3"
              },
              distance: {
                type: "f"
              },
              coneCos: {
                type: "f"
              },
              penumbraCos: {
                type: "f"
              },
              decay: {
                type: "f"
              },
              shadow: {
                type: "i"
              },
              shadowBias: {
                type: "f"
              },
              shadowRadius: {
                type: "f"
              },
              shadowMapSize: {
                type: "v2"
              }
            }
          },
          spotShadowMap: {
            type: "tv",
            value: []
          },
          spotShadowMatrix: {
            type: "m4v",
            value: []
          },
          pointLights: {
            type: "sa",
            value: [],
            properties: {
              color: {
                type: "c"
              },
              position: {
                type: "v3"
              },
              decay: {
                type: "f"
              },
              distance: {
                type: "f"
              },
              shadow: {
                type: "i"
              },
              shadowBias: {
                type: "f"
              },
              shadowRadius: {
                type: "f"
              },
              shadowMapSize: {
                type: "v2"
              }
            }
          },
          pointShadowMap: {
            type: "tv",
            value: []
          },
          pointShadowMatrix: {
            type: "m4v",
            value: []
          },
          hemisphereLights: {
            type: "sa",
            value: [],
            properties: {
              direction: {
                type: "v3"
              },
              skyColor: {
                type: "c"
              },
              groundColor: {
                type: "c"
              }
            }
          }
        },
        points: {
          diffuse: {
            type: "c",
            value: new n.Color(15658734)
          },
          opacity: {
            type: "f",
            value: 1
          },
          size: {
            type: "f",
            value: 1
          },
          scale: {
            type: "f",
            value: 1
          },
          map: {
            type: "t",
            value: null
          },
          offsetRepeat: {
            type: "v4",
            value: new n.Vector4(0, 0, 1, 1)
          }
        }
      }, n.ShaderChunk.cube_frag = "uniform samplerCube tCube;\x0Auniform float tFlip;\x0Avarying vec3 vWorldPosition;\x0A#include <common>\x0A#include <logdepthbuf_pars_fragment>\x0Avoid main() {\x0A\x09gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\x0A\x09#include <logdepthbuf_fragment>\x0A}\x0A", n.ShaderChunk.cube_vert = "varying vec3 vWorldPosition;\x0A#include <common>\x0A#include <logdepthbuf_pars_vertex>\x0Avoid main() {\x0A\x09vWorldPosition = transformDirection( position, modelMatrix );\x0A\x09gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\x0A\x09#include <logdepthbuf_vertex>\x0A}\x0A", n.ShaderChunk.depth_frag = "uniform float mNear;\x0Auniform float mFar;\x0Auniform float opacity;\x0A#include <common>\x0A#include <logdepthbuf_pars_fragment>\x0Avoid main() {\x0A\x09#include <logdepthbuf_fragment>\x0A\x09#ifdef USE_LOGDEPTHBUF_EXT\x0A\x09\x09float depth = gl_FragDepthEXT / gl_FragCoord.w;\x0A\x09#else\x0A\x09\x09float depth = gl_FragCoord.z / gl_FragCoord.w;\x0A\x09#endif\x0A\x09float color = 1.0 - smoothstep( mNear, mFar, depth );\x0A\x09gl_FragColor = vec4( vec3( color ), opacity );\x0A}\x0A", n.ShaderChunk.depth_vert = "#include <common>\x0A#include <morphtarget_pars_vertex>\x0A#include <logdepthbuf_pars_vertex>\x0Avoid main() {\x0A\x09#include <begin_vertex>\x0A\x09#include <morphtarget_vertex>\x0A\x09#include <project_vertex>\x0A\x09#include <logdepthbuf_vertex>\x0A}\x0A", n.ShaderChunk.depthRGBA_frag = "#include <common>\x0A#include <logdepthbuf_pars_fragment>\x0Avec4 pack_depth( const in float depth ) {\x0A\x09const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\x0A\x09const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\x0A\x09vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\x0A\x09res -= res.xxyz * bit_mask;\x0A\x09return res;\x0A}\x0Avoid main() {\x0A\x09#include <logdepthbuf_fragment>\x0A\x09#ifdef USE_LOGDEPTHBUF_EXT\x0A\x09\x09gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\x0A\x09#else\x0A\x09\x09gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\x0A\x09#endif\x0A}\x0A", n.ShaderChunk.depthRGBA_vert = "#include <common>\x0A#include <morphtarget_pars_vertex>\x0A#include <skinning_pars_vertex>\x0A#include <logdepthbuf_pars_vertex>\x0Avoid main() {\x0A\x09#include <skinbase_vertex>\x0A\x09#include <begin_vertex>\x0A\x09#include <morphtarget_vertex>\x0A\x09#include <skinning_vertex>\x0A\x09#include <project_vertex>\x0A\x09#include <logdepthbuf_vertex>\x0A}\x0A", n.ShaderChunk.distanceRGBA_frag = "uniform vec3 lightPos;\x0Avarying vec4 vWorldPosition;\x0A#include <common>\x0Avec4 pack1K ( float depth ) {\x0A\x09depth /= 1000.0;\x0A\x09const vec4 bitSh = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\x0A\x09const vec4 bitMsk = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\x0A\x09vec4 res = mod( depth * bitSh * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\x0A\x09res -= res.xxyz * bitMsk;\x0A\x09return res;\x0A}\x0Afloat unpack1K ( vec4 color ) {\x0A\x09const vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\x0A\x09return dot( color, bitSh ) * 1000.0;\x0A}\x0Avoid main () {\x0A\x09gl_FragColor = pack1K( length( vWorldPosition.xyz - lightPos.xyz ) );\x0A}\x0A", n.ShaderChunk.distanceRGBA_vert = "varying vec4 vWorldPosition;\x0A#include <common>\x0A#include <morphtarget_pars_vertex>\x0A#include <skinning_pars_vertex>\x0Avoid main() {\x0A\x09#include <skinbase_vertex>\x0A\x09#include <begin_vertex>\x0A\x09#include <morphtarget_vertex>\x0A\x09#include <skinning_vertex>\x0A\x09#include <project_vertex>\x0A\x09#include <worldpos_vertex>\x0A\x09vWorldPosition = worldPosition;\x0A}\x0A", n.ShaderChunk.equirect_frag = "uniform sampler2D tEquirect;\x0Auniform float tFlip;\x0Avarying vec3 vWorldPosition;\x0A#include <common>\x0A#include <logdepthbuf_pars_fragment>\x0Avoid main() {\x0A\x09vec3 direction = normalize( vWorldPosition );\x0A\x09vec2 sampleUV;\x0A\x09sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\x0A\x09sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\x0A\x09gl_FragColor = texture2D( tEquirect, sampleUV );\x0A\x09#include <logdepthbuf_fragment>\x0A}\x0A", n.ShaderChunk.equirect_vert = "varying vec3 vWorldPosition;\x0A#include <common>\x0A#include <logdepthbuf_pars_vertex>\x0Avoid main() {\x0A\x09vWorldPosition = transformDirection( position, modelMatrix );\x0A\x09gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\x0A\x09#include <logdepthbuf_vertex>\x0A}\x0A", n.ShaderChunk.linedashed_frag = "uniform vec3 diffuse;\x0Auniform float opacity;\x0Auniform float dashSize;\x0Auniform float totalSize;\x0Avarying float vLineDistance;\x0A#include <common>\x0A#include <color_pars_fragment>\x0A#include <fog_pars_fragment>\x0A#include <logdepthbuf_pars_fragment>\x0Avoid main() {\x0A\x09if ( mod( vLineDistance, totalSize ) > dashSize ) {\x0A\x09\x09discard;\x0A\x09}\x0A\x09vec3 outgoingLight = vec3( 0.0 );\x0A\x09vec4 diffuseColor = vec4( diffuse, opacity );\x0A\x09#include <logdepthbuf_fragment>\x0A\x09#include <color_fragment>\x0A\x09outgoingLight = diffuseColor.rgb;\x0A\x09gl_FragColor = vec4( outgoingLight, diffuseColor.a );\x0A\x09#include <premultiplied_alpha_fragment>\x0A\x09#include <tonemapping_fragment>\x0A\x09#include <encodings_fragment>\x0A\x09#include <fog_fragment>\x0A}\x0A", n.ShaderChunk.linedashed_vert = "uniform float scale;\x0Aattribute float lineDistance;\x0Avarying float vLineDistance;\x0A#include <common>\x0A#include <color_pars_vertex>\x0A#include <logdepthbuf_pars_vertex>\x0Avoid main() {\x0A\x09#include <color_vertex>\x0A\x09vLineDistance = scale * lineDistance;\x0A\x09vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\x0A\x09gl_Position = projectionMatrix * mvPosition;\x0A\x09#include <logdepthbuf_vertex>\x0A}\x0A", n.ShaderChunk.meshbasic_frag = "uniform vec3 diffuse;\x0Auniform float opacity;\x0A#ifndef FLAT_SHADED\x0A\x09varying vec3 vNormal;\x0A#endif\x0A#include <common>\x0A#include <color_pars_fragment>\x0A#include <uv_pars_fragment>\x0A#include <uv2_pars_fragment>\x0A#include <map_pars_fragment>\x0A#include <alphamap_pars_fragment>\x0A#include <aomap_pars_fragment>\x0A#include <envmap_pars_fragment>\x0A#include <fog_pars_fragment>\x0A#include <specularmap_pars_fragment>\x0A#include <logdepthbuf_pars_fragment>\x0Avoid main() {\x0A\x09vec4 diffuseColor = vec4( diffuse, opacity );\x0A\x09#include <logdepthbuf_fragment>\x0A\x09#include <map_fragment>\x0A\x09#include <color_fragment>\x0A\x09#include <alphamap_fragment>\x0A\x09#include <alphatest_fragment>\x0A\x09#include <specularmap_fragment>\x0A\x09ReflectedLight reflectedLight;\x0A\x09reflectedLight.directDiffuse = vec3( 0.0 );\x0A\x09reflectedLight.directSpecular = vec3( 0.0 );\x0A\x09reflectedLight.indirectDiffuse = diffuseColor.rgb;\x0A\x09reflectedLight.indirectSpecular = vec3( 0.0 );\x0A\x09#include <aomap_fragment>\x0A\x09vec3 outgoingLight = reflectedLight.indirectDiffuse;\x0A\x09#include <envmap_fragment>\x0A\x09gl_FragColor = vec4( outgoingLight, diffuseColor.a );\x0A\x09#include <premultiplied_alpha_fragment>\x0A\x09#include <tonemapping_fragment>\x0A\x09#include <encodings_fragment>\x0A\x09#include <fog_fragment>\x0A}\x0A", n.ShaderChunk.meshbasic_vert = "#include <common>\x0A#include <uv_pars_vertex>\x0A#include <uv2_pars_vertex>\x0A#include <envmap_pars_vertex>\x0A#include <color_pars_vertex>\x0A#include <morphtarget_pars_vertex>\x0A#include <skinning_pars_vertex>\x0A#include <logdepthbuf_pars_vertex>\x0Avoid main() {\x0A\x09#include <uv_vertex>\x0A\x09#include <uv2_vertex>\x0A\x09#include <color_vertex>\x0A\x09#include <skinbase_vertex>\x0A\x09#ifdef USE_ENVMAP\x0A\x09#include <beginnormal_vertex>\x0A\x09#include <morphnormal_vertex>\x0A\x09#include <skinnormal_vertex>\x0A\x09#include <defaultnormal_vertex>\x0A\x09#endif\x0A\x09#include <begin_vertex>\x0A\x09#include <morphtarget_vertex>\x0A\x09#include <skinning_vertex>\x0A\x09#include <project_vertex>\x0A\x09#include <logdepthbuf_vertex>\x0A\x09#include <worldpos_vertex>\x0A\x09#include <envmap_vertex>\x0A}\x0A", n.ShaderChunk.meshlambert_frag = "uniform vec3 diffuse;\x0Auniform vec3 emissive;\x0Auniform float opacity;\x0Avarying vec3 vLightFront;\x0A#ifdef DOUBLE_SIDED\x0A\x09varying vec3 vLightBack;\x0A#endif\x0A#include <common>\x0A#include <color_pars_fragment>\x0A#include <uv_pars_fragment>\x0A#include <uv2_pars_fragment>\x0A#include <map_pars_fragment>\x0A#include <alphamap_pars_fragment>\x0A#include <aomap_pars_fragment>\x0A#include <lightmap_pars_fragment>\x0A#include <emissivemap_pars_fragment>\x0A#include <envmap_pars_fragment>\x0A#include <bsdfs>\x0A#include <lights_pars>\x0A#include <fog_pars_fragment>\x0A#include <shadowmap_pars_fragment>\x0A#include <shadowmask_pars_fragment>\x0A#include <specularmap_pars_fragment>\x0A#include <logdepthbuf_pars_fragment>\x0Avoid main() {\x0A\x09vec4 diffuseColor = vec4( diffuse, opacity );\x0A\x09ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\x0A\x09vec3 totalEmissiveRadiance = emissive;\x0A\x09#include <logdepthbuf_fragment>\x0A\x09#include <map_fragment>\x0A\x09#include <color_fragment>\x0A\x09#include <alphamap_fragment>\x0A\x09#include <alphatest_fragment>\x0A\x09#include <specularmap_fragment>\x0A\x09#include <emissivemap_fragment>\x0A\x09reflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\x0A\x09#include <lightmap_fragment>\x0A\x09reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\x0A\x09#ifdef DOUBLE_SIDED\x0A\x09\x09reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\x0A\x09#else\x0A\x09\x09reflectedLight.directDiffuse = vLightFront;\x0A\x09#endif\x0A\x09reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\x0A\x09#include <aomap_fragment>\x0A\x09vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\x0A\x09#include <envmap_fragment>\x0A\x09gl_FragColor = vec4( outgoingLight, diffuseColor.a );\x0A\x09#include <premultiplied_alpha_fragment>\x0A\x09#include <tonemapping_fragment>\x0A\x09#include <encodings_fragment>\x0A\x09#include <fog_fragment>\x0A}\x0A", n.ShaderChunk.meshlambert_vert = "#define LAMBERT\x0Avarying vec3 vLightFront;\x0A#ifdef DOUBLE_SIDED\x0A\x09varying vec3 vLightBack;\x0A#endif\x0A#include <common>\x0A#include <uv_pars_vertex>\x0A#include <uv2_pars_vertex>\x0A#include <envmap_pars_vertex>\x0A#include <bsdfs>\x0A#include <lights_pars>\x0A#include <color_pars_vertex>\x0A#include <morphtarget_pars_vertex>\x0A#include <skinning_pars_vertex>\x0A#include <shadowmap_pars_vertex>\x0A#include <logdepthbuf_pars_vertex>\x0Avoid main() {\x0A\x09#include <uv_vertex>\x0A\x09#include <uv2_vertex>\x0A\x09#include <color_vertex>\x0A\x09#include <beginnormal_vertex>\x0A\x09#include <morphnormal_vertex>\x0A\x09#include <skinbase_vertex>\x0A\x09#include <skinnormal_vertex>\x0A\x09#include <defaultnormal_vertex>\x0A\x09#include <begin_vertex>\x0A\x09#include <morphtarget_vertex>\x0A\x09#include <skinning_vertex>\x0A\x09#include <project_vertex>\x0A\x09#include <logdepthbuf_vertex>\x0A\x09#include <worldpos_vertex>\x0A\x09#include <envmap_vertex>\x0A\x09#include <lights_lambert_vertex>\x0A\x09#include <shadowmap_vertex>\x0A}\x0A", n.ShaderChunk.meshphong_frag = "#define PHONG\x0Auniform vec3 diffuse;\x0Auniform vec3 emissive;\x0Auniform vec3 specular;\x0Auniform float shininess;\x0Auniform float opacity;\x0A#include <common>\x0A#include <color_pars_fragment>\x0A#include <uv_pars_fragment>\x0A#include <uv2_pars_fragment>\x0A#include <map_pars_fragment>\x0A#include <alphamap_pars_fragment>\x0A#include <aomap_pars_fragment>\x0A#include <lightmap_pars_fragment>\x0A#include <emissivemap_pars_fragment>\x0A#include <envmap_pars_fragment>\x0A#include <fog_pars_fragment>\x0A#include <bsdfs>\x0A#include <lights_pars>\x0A#include <lights_phong_pars_fragment>\x0A#include <shadowmap_pars_fragment>\x0A#include <bumpmap_pars_fragment>\x0A#include <normalmap_pars_fragment>\x0A#include <specularmap_pars_fragment>\x0A#include <logdepthbuf_pars_fragment>\x0Avoid main() {\x0A\x09vec4 diffuseColor = vec4( diffuse, opacity );\x0A\x09ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\x0A\x09vec3 totalEmissiveRadiance = emissive;\x0A\x09#include <logdepthbuf_fragment>\x0A\x09#include <map_fragment>\x0A\x09#include <color_fragment>\x0A\x09#include <alphamap_fragment>\x0A\x09#include <alphatest_fragment>\x0A\x09#include <specularmap_fragment>\x0A\x09#include <normal_fragment>\x0A\x09#include <emissivemap_fragment>\x0A\x09#include <lights_phong_fragment>\x0A\x09#include <lights_template>\x0A\x09#include <aomap_fragment>\x0A\x09vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\x0A\x09#include <envmap_fragment>\x0A\x09gl_FragColor = vec4( outgoingLight, diffuseColor.a );\x0A\x09#include <premultiplied_alpha_fragment>\x0A\x09#include <tonemapping_fragment>\x0A\x09#include <encodings_fragment>\x0A\x09#include <fog_fragment>\x0A}\x0A", n.ShaderChunk.meshphong_vert = "#define PHONG\x0Avarying vec3 vViewPosition;\x0A#ifndef FLAT_SHADED\x0A\x09varying vec3 vNormal;\x0A#endif\x0A#include <common>\x0A#include <uv_pars_vertex>\x0A#include <uv2_pars_vertex>\x0A#include <displacementmap_pars_vertex>\x0A#include <envmap_pars_vertex>\x0A#include <lights_phong_pars_vertex>\x0A#include <color_pars_vertex>\x0A#include <morphtarget_pars_vertex>\x0A#include <skinning_pars_vertex>\x0A#include <shadowmap_pars_vertex>\x0A#include <logdepthbuf_pars_vertex>\x0Avoid main() {\x0A\x09#include <uv_vertex>\x0A\x09#include <uv2_vertex>\x0A\x09#include <color_vertex>\x0A\x09#include <beginnormal_vertex>\x0A\x09#include <morphnormal_vertex>\x0A\x09#include <skinbase_vertex>\x0A\x09#include <skinnormal_vertex>\x0A\x09#include <defaultnormal_vertex>\x0A#ifndef FLAT_SHADED\x0A\x09vNormal = normalize( transformedNormal );\x0A#endif\x0A\x09#include <begin_vertex>\x0A\x09#include <displacementmap_vertex>\x0A\x09#include <morphtarget_vertex>\x0A\x09#include <skinning_vertex>\x0A\x09#include <project_vertex>\x0A\x09#include <logdepthbuf_vertex>\x0A\x09vViewPosition = - mvPosition.xyz;\x0A\x09#include <worldpos_vertex>\x0A\x09#include <envmap_vertex>\x0A\x09#include <lights_phong_vertex>\x0A\x09#include <shadowmap_vertex>\x0A}\x0A", n.ShaderChunk.meshstandard_frag = "#define STANDARD\x0Auniform vec3 diffuse;\x0Auniform vec3 emissive;\x0Auniform float roughness;\x0Auniform float metalness;\x0Auniform float opacity;\x0Auniform float envMapIntensity;\x0Avarying vec3 vViewPosition;\x0A#ifndef FLAT_SHADED\x0A\x09varying vec3 vNormal;\x0A#endif\x0A#include <common>\x0A#include <color_pars_fragment>\x0A#include <uv_pars_fragment>\x0A#include <uv2_pars_fragment>\x0A#include <map_pars_fragment>\x0A#include <alphamap_pars_fragment>\x0A#include <aomap_pars_fragment>\x0A#include <lightmap_pars_fragment>\x0A#include <emissivemap_pars_fragment>\x0A#include <envmap_pars_fragment>\x0A#include <fog_pars_fragment>\x0A#include <bsdfs>\x0A#include <cube_uv_reflection_fragment>\x0A#include <lights_pars>\x0A#include <lights_standard_pars_fragment>\x0A#include <shadowmap_pars_fragment>\x0A#include <bumpmap_pars_fragment>\x0A#include <normalmap_pars_fragment>\x0A#include <roughnessmap_pars_fragment>\x0A#include <metalnessmap_pars_fragment>\x0A#include <logdepthbuf_pars_fragment>\x0Avoid main() {\x0A\x09vec4 diffuseColor = vec4( diffuse, opacity );\x0A\x09ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\x0A\x09vec3 totalEmissiveRadiance = emissive;\x0A\x09#include <logdepthbuf_fragment>\x0A\x09#include <map_fragment>\x0A\x09#include <color_fragment>\x0A\x09#include <alphamap_fragment>\x0A\x09#include <alphatest_fragment>\x0A\x09#include <specularmap_fragment>\x0A\x09#include <roughnessmap_fragment>\x0A\x09#include <metalnessmap_fragment>\x0A\x09#include <normal_fragment>\x0A\x09#include <emissivemap_fragment>\x0A\x09#include <lights_standard_fragment>\x0A\x09#include <lights_template>\x0A\x09#include <aomap_fragment>\x0A\x09vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\x0A\x09gl_FragColor = vec4( outgoingLight, diffuseColor.a );\x0A\x09#include <premultiplied_alpha_fragment>\x0A\x09#include <tonemapping_fragment>\x0A\x09#include <encodings_fragment>\x0A\x09#include <fog_fragment>\x0A}\x0A", n.ShaderChunk.meshstandard_vert = "#define STANDARD\x0Avarying vec3 vViewPosition;\x0A#ifndef FLAT_SHADED\x0A\x09varying vec3 vNormal;\x0A#endif\x0A#include <common>\x0A#include <uv_pars_vertex>\x0A#include <uv2_pars_vertex>\x0A#include <displacementmap_pars_vertex>\x0A#include <envmap_pars_vertex>\x0A#include <color_pars_vertex>\x0A#include <morphtarget_pars_vertex>\x0A#include <skinning_pars_vertex>\x0A#include <shadowmap_pars_vertex>\x0A#include <specularmap_pars_fragment>\x0A#include <logdepthbuf_pars_vertex>\x0Avoid main() {\x0A\x09#include <uv_vertex>\x0A\x09#include <uv2_vertex>\x0A\x09#include <color_vertex>\x0A\x09#include <beginnormal_vertex>\x0A\x09#include <morphnormal_vertex>\x0A\x09#include <skinbase_vertex>\x0A\x09#include <skinnormal_vertex>\x0A\x09#include <defaultnormal_vertex>\x0A#ifndef FLAT_SHADED\x0A\x09vNormal = normalize( transformedNormal );\x0A#endif\x0A\x09#include <begin_vertex>\x0A\x09#include <displacementmap_vertex>\x0A\x09#include <morphtarget_vertex>\x0A\x09#include <skinning_vertex>\x0A\x09#include <project_vertex>\x0A\x09#include <logdepthbuf_vertex>\x0A\x09vViewPosition = - mvPosition.xyz;\x0A\x09#include <worldpos_vertex>\x0A\x09#include <envmap_vertex>\x0A\x09#include <shadowmap_vertex>\x0A}\x0A", n.ShaderChunk.normal_frag = "uniform float opacity;\x0Avarying vec3 vNormal;\x0A#include <common>\x0A#include <logdepthbuf_pars_fragment>\x0Avoid main() {\x0A\x09gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\x0A\x09#include <logdepthbuf_fragment>\x0A}\x0A", n.ShaderChunk.normal_vert = "varying vec3 vNormal;\x0A#include <common>\x0A#include <morphtarget_pars_vertex>\x0A#include <logdepthbuf_pars_vertex>\x0Avoid main() {\x0A\x09vNormal = normalize( normalMatrix * normal );\x0A\x09#include <begin_vertex>\x0A\x09#include <morphtarget_vertex>\x0A\x09#include <project_vertex>\x0A\x09#include <logdepthbuf_vertex>\x0A}\x0A", n.ShaderChunk.points_frag = "uniform vec3 diffuse;\x0Auniform float opacity;\x0A#include <common>\x0A#include <color_pars_fragment>\x0A#include <map_particle_pars_fragment>\x0A#include <fog_pars_fragment>\x0A#include <shadowmap_pars_fragment>\x0A#include <logdepthbuf_pars_fragment>\x0Avoid main() {\x0A\x09vec3 outgoingLight = vec3( 0.0 );\x0A\x09vec4 diffuseColor = vec4( diffuse, opacity );\x0A\x09#include <logdepthbuf_fragment>\x0A\x09#include <map_particle_fragment>\x0A\x09#include <color_fragment>\x0A\x09#include <alphatest_fragment>\x0A\x09outgoingLight = diffuseColor.rgb;\x0A\x09gl_FragColor = vec4( outgoingLight, diffuseColor.a );\x0A\x09#include <premultiplied_alpha_fragment>\x0A\x09#include <tonemapping_fragment>\x0A\x09#include <encodings_fragment>\x0A\x09#include <fog_fragment>\x0A}\x0A", n.ShaderChunk.points_vert = "uniform float size;\x0Auniform float scale;\x0A#include <common>\x0A#include <color_pars_vertex>\x0A#include <shadowmap_pars_vertex>\x0A#include <logdepthbuf_pars_vertex>\x0Avoid main() {\x0A\x09#include <color_vertex>\x0A\x09#include <begin_vertex>\x0A\x09#include <project_vertex>\x0A\x09#ifdef USE_SIZEATTENUATION\x0A\x09\x09gl_PointSize = size * ( scale / - mvPosition.z );\x0A\x09#else\x0A\x09\x09gl_PointSize = size;\x0A\x09#endif\x0A\x09#include <logdepthbuf_vertex>\x0A\x09#include <worldpos_vertex>\x0A\x09#include <shadowmap_vertex>\x0A}\x0A", n.ShaderLib = {
        basic: {
          uniforms: n.UniformsUtils.merge([n.UniformsLib.common, n.UniformsLib.aomap, n.UniformsLib.fog]),
          vertexShader: n.ShaderChunk.meshbasic_vert,
          fragmentShader: n.ShaderChunk.meshbasic_frag
        },
        lambert: {
          uniforms: n.UniformsUtils.merge([n.UniformsLib.common, n.UniformsLib.aomap, n.UniformsLib.lightmap, n.UniformsLib.emissivemap, n.UniformsLib.fog, n.UniformsLib.lights, {
            emissive: {
              type: "c",
              value: new n.Color(0)
            }
          }]),
          vertexShader: n.ShaderChunk.meshlambert_vert,
          fragmentShader: n.ShaderChunk.meshlambert_frag
        },
        phong: {
          uniforms: n.UniformsUtils.merge([n.UniformsLib.common, n.UniformsLib.aomap, n.UniformsLib.lightmap, n.UniformsLib.emissivemap, n.UniformsLib.bumpmap, n.UniformsLib.normalmap, n.UniformsLib.displacementmap, n.UniformsLib.fog, n.UniformsLib.lights, {
            emissive: {
              type: "c",
              value: new n.Color(0)
            },
            specular: {
              type: "c",
              value: new n.Color(1118481)
            },
            shininess: {
              type: "f",
              value: 30
            }
          }]),
          vertexShader: n.ShaderChunk.meshphong_vert,
          fragmentShader: n.ShaderChunk.meshphong_frag
        },
        standard: {
          uniforms: n.UniformsUtils.merge([n.UniformsLib.common, n.UniformsLib.aomap, n.UniformsLib.lightmap, n.UniformsLib.emissivemap, n.UniformsLib.bumpmap, n.UniformsLib.normalmap, n.UniformsLib.displacementmap, n.UniformsLib.roughnessmap, n.UniformsLib.metalnessmap, n.UniformsLib.fog, n.UniformsLib.lights, {
            emissive: {
              type: "c",
              value: new n.Color(0)
            },
            roughness: {
              type: "f",
              value: 0.5
            },
            metalness: {
              type: "f",
              value: 0
            },
            envMapIntensity: {
              type: "f",
              value: 1
            }
          }]),
          vertexShader: n.ShaderChunk.meshstandard_vert,
          fragmentShader: n.ShaderChunk.meshstandard_frag
        },
        points: {
          uniforms: n.UniformsUtils.merge([n.UniformsLib.points, n.UniformsLib.fog]),
          vertexShader: n.ShaderChunk.points_vert,
          fragmentShader: n.ShaderChunk.points_frag
        },
        dashed: {
          uniforms: n.UniformsUtils.merge([n.UniformsLib.common, n.UniformsLib.fog, {
            scale: {
              type: "f",
              value: 1
            },
            dashSize: {
              type: "f",
              value: 1
            },
            totalSize: {
              type: "f",
              value: 2
            }
          }]),
          vertexShader: n.ShaderChunk.linedashed_vert,
          fragmentShader: n.ShaderChunk.linedashed_frag
        },
        depth: {
          uniforms: {
            mNear: {
              type: "f",
              value: 1
            },
            mFar: {
              type: "f",
              value: 2e3
            },
            opacity: {
              type: "f",
              value: 1
            }
          },
          vertexShader: n.ShaderChunk.depth_vert,
          fragmentShader: n.ShaderChunk.depth_frag
        },
        normal: {
          uniforms: {
            opacity: {
              type: "f",
              value: 1
            }
          },
          vertexShader: n.ShaderChunk.normal_vert,
          fragmentShader: n.ShaderChunk.normal_frag
        },
        cube: {
          uniforms: {
            tCube: {
              type: "t",
              value: null
            },
            tFlip: {
              type: "f",
              value: -1
            }
          },
          vertexShader: n.ShaderChunk.cube_vert,
          fragmentShader: n.ShaderChunk.cube_frag
        },
        equirect: {
          uniforms: {
            tEquirect: {
              type: "t",
              value: null
            },
            tFlip: {
              type: "f",
              value: -1
            }
          },
          vertexShader: n.ShaderChunk.equirect_vert,
          fragmentShader: n.ShaderChunk.equirect_frag
        },
        depthRGBA: {
          uniforms: {},
          vertexShader: n.ShaderChunk.depthRGBA_vert,
          fragmentShader: n.ShaderChunk.depthRGBA_frag
        },
        distanceRGBA: {
          uniforms: {
            lightPos: {
              type: "v3",
              value: new n.Vector3(0, 0, 0)
            }
          },
          vertexShader: n.ShaderChunk.distanceRGBA_vert,
          fragmentShader: n.ShaderChunk.distanceRGBA_frag
        }
      }, n.WebGLRenderer = function(e) {
        function t() {
          return null === be ? Ie : 1
        }

        function i(e, t, i, n) {
          se === !0 && (e *= n, t *= n, i *= n), Xe.clearColor(e, t, i, n)
        }

        function r() {
          Xe.init(), Xe.scissor(Ee.copy(De).multiplyScalar(Ie)), Xe.viewport(Te.copy(ke).multiplyScalar(Ie)), i(Ae.r, Ae.g, Ae.b, Le)
        }

        function o() {
          ye = null, Me = null, xe = "", _e = -1, Xe.reset()
        }

        function a(e) {
          e.preventDefault(), o(), r(), qe.clear()
        }

        function s(e) {
          var t = e.target;
          t.removeEventListener("dispose", s), c(t), Ve.textures--
        }

        function h(e) {
          var t = e.target;
          t.removeEventListener("dispose", h), u(t), Ve.textures--
        }

        function l(e) {
          var t = e.target;
          t.removeEventListener("dispose", l), d(t)
        }

        function c(e) {
          var t = qe["get"](e);
          if (e.image && t.__image__webglTextureCube) {
            Ge.deleteTexture(t.__image__webglTextureCube)
          } else {
            if (void(0) === t.__webglInit) {
              return
            };
            Ge.deleteTexture(t.__webglTexture)
          };
          qe["delete"](e)
        }

        function u(e) {
          var t = qe["get"](e),
            i = qe["get"](e.texture);
          if (e && void(0) !== i.__webglTexture) {
            if (Ge.deleteTexture(i.__webglTexture), e instanceof n.WebGLRenderTargetCube) {
              for (var r = 0; 6 > r; r++) {
                Ge.deleteFramebuffer(t.__webglFramebuffer[r]), Ge.deleteRenderbuffer(t.__webglDepthbuffer[r])
              }
            } else {
              Ge.deleteFramebuffer(t.__webglFramebuffer), Ge.deleteRenderbuffer(t.__webglDepthbuffer)
            };
            qe["delete"](e.texture), qe["delete"](e)
          }
        }

        function d(e) {
          p(e), qe["delete"](e)
        }

        function p(e) {
          var t = qe["get"](e).program;
          e.program = void(0), void(0) !== t && $e.releaseProgram(t)
        }

        function f(e, t, i, r) {
          var o;
          if (i instanceof n.InstancedBufferGeometry && (o = We["get"]("ANGLE_instanced_arrays"), null === o)) {
            return void(console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."))
          };
          void(0) === r && (r = 0), Xe.initAttributes();
          var a = i.attributes,
            s = t.getAttributes(),
            h = e.defaultAttributeValues;
          for (var l in s) {
            var c = s[l];
            if (c >= 0) {
              var u = a[l];
              if (void(0) !== u) {
                var d = u.itemSize,
                  p = Ze.getAttributeBuffer(u);
                if (u instanceof n.InterleavedBufferAttribute) {
                  var f = u.data,
                    m = f.stride,
                    g = u.offset;
                  f instanceof n.InstancedInterleavedBuffer ? (Xe.enableAttributeAndDivisor(c, f.meshPerAttribute, o), void(0) === i.maxInstancedCount && (i.maxInstancedCount = f.meshPerAttribute * f.count)) : Xe.enableAttribute(c), Ge.bindBuffer(Ge.ARRAY_BUFFER, p), Ge.vertexAttribPointer(c, d, Ge.FLOAT, !1, m * f.array.BYTES_PER_ELEMENT, (r * m + g) * f.array.BYTES_PER_ELEMENT)
                } else {
                  u instanceof n.InstancedBufferAttribute ? (Xe.enableAttributeAndDivisor(c, u.meshPerAttribute, o), void(0) === i.maxInstancedCount && (i.maxInstancedCount = u.meshPerAttribute * u.count)) : Xe.enableAttribute(c), Ge.bindBuffer(Ge.ARRAY_BUFFER, p), Ge.vertexAttribPointer(c, d, Ge.FLOAT, !1, 0, r * d * 4)
                }
              } else {
                if (void(0) !== h) {
                  var v = h[l];
                  if (void(0) !== v) {
                    switch (v.length) {
                      case 2:
                        Ge.vertexAttrib2fv(c, v);
                        break;
                      case 3:
                        Ge.vertexAttrib3fv(c, v);
                        break;
                      case 4:
                        Ge.vertexAttrib4fv(c, v);
                        break;
                      default:
                        Ge.vertexAttrib1fv(c, v)
                    }
                  }
                }
              }
            }
          };
          Xe.disableUnusedAttributes()
        }

        function m(e, t) {
          return Math.abs(t[0]) - Math.abs(e[0])
        }

        function g(e, t) {
          return e.object.renderOrder !== t.object.renderOrder ? e.object.renderOrder - t.object.renderOrder : e.material.id !== t.material.id ? e.material.id - t.material.id : e.z !== t.z ? e.z - t.z : e.id - t.id
        }

        function v(e, t) {
          return e.object.renderOrder !== t.object.renderOrder ? e.object.renderOrder - t.object.renderOrder : e.z !== t.z ? t.z - e.z : e.id - t.id
        }

        function y(e, t, i, n, r) {
          var o, a;
          i.transparent ? (o = de, a = ++pe) : (o = ce, a = ++ue);
          var s = o[a];
          void(0) !== s ? (s.id = e.id, s.object = e, s.geometry = t, s.material = i, s.z = Ne.z, s.group = r) : (s = {
            id: e.id,
            object: e,
            geometry: t,
            material: i,
            z: Ne.z,
            group: r
          }, o.push(s))
        }

        function b(e, t) {
          if (e.visible !== !1) {
            if (e.layers.test(t.layers)) {
              if (e instanceof n.Light) {
                le.push(e)
              } else {
                if (e instanceof n.Sprite) {
                  (e.frustumCulled === !1 || Be.intersectsObject(e) === !0) && me.push(e)
                } else {
                  if (e instanceof n.LensFlare) {
                    ge.push(e)
                  } else {
                    if (e instanceof n.ImmediateRenderObject) {
                      ve.sortObjects === !0 && (Ne.setFromMatrixPosition(e.matrixWorld), Ne.applyProjection(Fe)), y(e, null, e.material, Ne.z, null)
                    } else {
                      if ((e instanceof n.Mesh || e instanceof n.Line || e instanceof n.Points) && (e instanceof n.SkinnedMesh && e.skeleton.update(), e.frustumCulled === !1 || Be.intersectsObject(e) === !0)) {
                        var i = e.material;
                        if (i.visible === !0) {
                          ve.sortObjects === !0 && (Ne.setFromMatrixPosition(e.matrixWorld), Ne.applyProjection(Fe));
                          var r = Ze.update(e);
                          if (i instanceof n.MultiMaterial) {
                            for (var o = r.groups, a = i.materials, s = 0, h = o.length; h > s; s++) {
                              var l = o[s],
                                c = a[l.materialIndex];
                              c.visible === !0 && y(e, r, c, Ne.z, l)
                            }
                          } else {
                            y(e, r, i, Ne.z, null)
                          }
                        }
                      }
                    }
                  }
                }
              }
            };
            for (var u = e.children, s = 0, h = u.length; h > s; s++) {
              b(u[s], t)
            }
          }
        }

        function w(e, t, i, r) {
          for (var o = 0, a = e.length; a > o; o++) {
            var s = e[o],
              h = s.object,
              l = s.geometry,
              c = void(0) === r ? s.material : r,
              u = s.group;
            if (h.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse, h.matrixWorld), h.normalMatrix.getNormalMatrix(h.modelViewMatrix), h instanceof n.ImmediateRenderObject) {
              x(c);
              var d = E(t, i, c, h);
              xe = "", h.render(function(e) {
                ve.renderBufferImmediate(e, d, c)
              })
            } else {
              ve.renderBufferDirect(t, i, l, c, h, u)
            }
          }
        }

        function _(e, t, i) {
          var r = qe["get"](e),
            o = $e.getParameters(e, Ue, t, i),
            a = $e.getProgramCode(e, o),
            s = r.program,
            h = !0;
          if (void(0) === s) {
            e.addEventListener("dispose", l)
          } else {
            if (s.code !== a) {
              p(e)
            } else {
              if (void(0) !== o.shaderID) {
                return
              };
              h = !1
            }
          };
          if (h) {
            if (o.shaderID) {
              var c = n.ShaderLib[o.shaderID];
              r.__webglShader = {
                name: e.type,
                uniforms: n.UniformsUtils.clone(c.uniforms),
                vertexShader: c.vertexShader,
                fragmentShader: c.fragmentShader
              }
            } else {
              r.__webglShader = {
                name: e.type,
                uniforms: e.uniforms,
                vertexShader: e.vertexShader,
                fragmentShader: e.fragmentShader
              }
            };
            e.__webglShader = r.__webglShader, s = $e.acquireProgram(e, o, a), r.program = s, e.program = s
          };
          var u = s.getAttributes();
          if (e.morphTargets) {
            e.numSupportedMorphTargets = 0;
            for (var d = 0; d < ve.maxMorphTargets; d++) {
              u["morphTarget" + d] >= 0 && e.numSupportedMorphTargets++
            }
          };
          if (e.morphNormals) {
            e.numSupportedMorphNormals = 0;
            for (var d = 0; d < ve.maxMorphNormals; d++) {
              u["morphNormal" + d] >= 0 && e.numSupportedMorphNormals++
            }
          };
          r.uniformsList = [];
          var f = r.__webglShader.uniforms,
            m = r.program.getUniforms();
          for (var g in f) {
            var v = m[g];
            v && r.uniformsList.push([r.__webglShader.uniforms[g], v])
          };
          (e instanceof n.MeshPhongMaterial || e instanceof n.MeshLambertMaterial || e instanceof n.MeshStandardMaterial || e.lights) && (r.lightsHash = Ue.hash, f.ambientLightColor.value = Ue.ambient, f.directionalLights.value = Ue.directional, f.spotLights.value = Ue.spot, f.pointLights.value = Ue.point, f.hemisphereLights.value = Ue.hemi, f.directionalShadowMap.value = Ue.directionalShadowMap, f.directionalShadowMatrix.value = Ue.directionalShadowMatrix, f.spotShadowMap.value = Ue.spotShadowMap, f.spotShadowMatrix.value = Ue.spotShadowMatrix, f.pointShadowMap.value = Ue.pointShadowMap, f.pointShadowMatrix.value = Ue.pointShadowMatrix), r.hasDynamicUniforms = !1;
          for (var y = 0, b = r.uniformsList.length; b > y; y++) {
            var w = r.uniformsList[y][0];
            if (w.dynamic === !0) {
              r.hasDynamicUniforms = !0;
              break
            }
          }
        }

        function x(e) {
          M(e), e.transparent === !0 ? Xe.setBlending(e.blending, e.blendEquation, e.blendSrc, e.blendDst, e.blendEquationAlpha, e.blendSrcAlpha, e.blendDstAlpha, e.premultipliedAlpha) : Xe.setBlending(n.NoBlending), Xe.setDepthFunc(e.depthFunc), Xe.setDepthTest(e.depthTest), Xe.setDepthWrite(e.depthWrite), Xe.setColorWrite(e.colorWrite), Xe.setPolygonOffset(e.polygonOffset, e.polygonOffsetFactor, e.polygonOffsetUnits)
        }

        function M(e) {
          e.side !== n.DoubleSide ? Xe.enable(Ge.CULL_FACE) : Xe.disable(Ge.CULL_FACE), Xe.setFlipSided(e.side === n.BackSide)
        }

        function E(e, t, i, r) {
          Pe = 0;
          var o = qe["get"](i);
          void(0) === o.program && (i.needsUpdate = !0), void(0) !== o.lightsHash && o.lightsHash !== Ue.hash && (i.needsUpdate = !0), i.needsUpdate && (_(i, t, r), i.needsUpdate = !1);
          var a = !1,
            s = !1,
            h = !1,
            l = o.program,
            c = l.getUniforms(),
            u = o.__webglShader.uniforms;
          if (l.id !== ye && (Ge.useProgram(l.program), ye = l.id, a = !0, s = !0, h = !0), i.id !== _e && (_e = i.id, s = !0), (a || e !== Me) && (Ge.uniformMatrix4fv(c.projectionMatrix, !1, e.projectionMatrix.elements), Ye.logarithmicDepthBuffer && Ge.uniform1f(c.logDepthBufFC, 2 / (Math.log(e.far + 1) / Math.LN2)), e !== Me && (Me = e, s = !0, h = !0), (i instanceof n.ShaderMaterial || i instanceof n.MeshPhongMaterial || i instanceof n.MeshStandardMaterial || i.envMap) && void(0) !== c.cameraPosition && (Ne.setFromMatrixPosition(e.matrixWorld), Ge.uniform3f(c.cameraPosition, Ne.x, Ne.y, Ne.z)), (i instanceof n.MeshPhongMaterial || i instanceof n.MeshLambertMaterial || i instanceof n.MeshBasicMaterial || i instanceof n.MeshStandardMaterial || i instanceof n.ShaderMaterial || i.skinning) && void(0) !== c.viewMatrix && Ge.uniformMatrix4fv(c.viewMatrix, !1, e.matrixWorldInverse.elements), void(0) !== c.toneMappingExposure && Ge.uniform1f(c.toneMappingExposure, ve.toneMappingExposure), void(0) !== c.toneMappingWhitePoint && Ge.uniform1f(c.toneMappingWhitePoint, ve.toneMappingWhitePoint)), i.skinning) {
            if (r.bindMatrix && void(0) !== c.bindMatrix && Ge.uniformMatrix4fv(c.bindMatrix, !1, r.bindMatrix.elements), r.bindMatrixInverse && void(0) !== c.bindMatrixInverse && Ge.uniformMatrix4fv(c.bindMatrixInverse, !1, r.bindMatrixInverse.elements), Ye.floatVertexTextures && r.skeleton && r.skeleton.useVertexTexture) {
              if (void(0) !== c.boneTexture) {
                var d = B();
                Ge.uniform1i(c.boneTexture, d), ve.setTexture(r.skeleton.boneTexture, d)
              };
              void(0) !== c.boneTextureWidth && Ge.uniform1i(c.boneTextureWidth, r.skeleton.boneTextureWidth), void(0) !== c.boneTextureHeight && Ge.uniform1i(c.boneTextureHeight, r.skeleton.boneTextureHeight)
            } else {
              r.skeleton && r.skeleton.boneMatrices && void(0) !== c.boneGlobalMatrices && Ge.uniformMatrix4fv(c.boneGlobalMatrices, !1, r.skeleton.boneMatrices)
            }
          };
          return s && ((i instanceof n.MeshPhongMaterial || i instanceof n.MeshLambertMaterial || i instanceof n.MeshStandardMaterial || i.lights) && O(u, h), t && i.fog && C(u, t), (i instanceof n.MeshBasicMaterial || i instanceof n.MeshLambertMaterial || i instanceof n.MeshPhongMaterial || i instanceof n.MeshStandardMaterial) && T(u, i), i instanceof n.LineBasicMaterial ? P(u, i) : i instanceof n.LineDashedMaterial ? (P(u, i), A(u, i)) : i instanceof n.PointsMaterial ? L(u, i) : i instanceof n.MeshLambertMaterial ? R(u, i) : i instanceof n.MeshPhongMaterial ? I(u, i) : i instanceof n.MeshStandardMaterial ? D(u, i) : i instanceof n.MeshDepthMaterial ? (u.mNear.value = e.near, u.mFar.value = e.far, u.opacity.value = i.opacity) : i instanceof n.MeshNormalMaterial && (u.opacity.value = i.opacity), N(o.uniformsList)), k(c, r), void(0) !== c.modelMatrix && Ge.uniformMatrix4fv(c.modelMatrix, !1, r.matrixWorld.elements), o.hasDynamicUniforms === !0 && S(o.uniformsList, r, e), l
        }

        function S(e, t, i) {
          for (var n = [], r = 0, o = e.length; o > r; r++) {
            var a = e[r][0],
              s = a.onUpdateCallback;
            void(0) !== s && (s.bind(a)(t, i), n.push(e[r]))
          };
          N(n)
        }

        function T(e, t) {
          e.opacity.value = t.opacity, e.diffuse.value = t.color, t.emissive && e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity), e.map.value = t.map, e.specularMap.value = t.specularMap, e.alphaMap.value = t.alphaMap, t.aoMap && (e.aoMap.value = t.aoMap, e.aoMapIntensity.value = t.aoMapIntensity);
          var i;
          if (t.map ? i = t.map : t.specularMap ? i = t.specularMap : t.displacementMap ? i = t.displacementMap : t.normalMap ? i = t.normalMap : t.bumpMap ? i = t.bumpMap : t.roughnessMap ? i = t.roughnessMap : t.metalnessMap ? i = t.metalnessMap : t.alphaMap ? i = t.alphaMap : t.emissiveMap && (i = t.emissiveMap), void(0) !== i) {
            i instanceof n.WebGLRenderTarget && (i = i.texture);
            var r = i.offset,
              o = i.repeat;
            e.offsetRepeat.value["set"](r.x, r.y, o.x, o.y)
          };
          e.envMap.value = t.envMap, e.flipEnvMap.value = t.envMap instanceof n.WebGLRenderTargetCube ? 1 : -1, e.reflectivity.value = t.reflectivity, e.refractionRatio.value = t.refractionRatio
        }

        function P(e, t) {
          e.diffuse.value = t.color, e.opacity.value = t.opacity
        }

        function A(e, t) {
          e.dashSize.value = t.dashSize, e.totalSize.value = t.dashSize + t.gapSize, e.scale.value = t.scale
        }

        function L(e, t) {
          if (e.diffuse.value = t.color, e.opacity.value = t.opacity, e.size.value = t.size * Ie, e.scale.value = te.clientHeight / 2, e.map.value = t.map, null !== t.map) {
            var i = t.map.offset,
              n = t.map.repeat;
            e.offsetRepeat.value["set"](i.x, i.y, n.x, n.y)
          }
        }

        function C(e, t) {
          e.fogColor.value = t.color, t instanceof n.Fog ? (e.fogNear.value = t.near, e.fogFar.value = t.far) : t instanceof n.FogExp2 && (e.fogDensity.value = t.density)
        }

        function R(e, t) {
          t.lightMap && (e.lightMap.value = t.lightMap, e.lightMapIntensity.value = t.lightMapIntensity), t.emissiveMap && (e.emissiveMap.value = t.emissiveMap)
        }

        function I(e, t) {
          e.specular.value = t.specular, e.shininess.value = Math.max(t.shininess, 1e-4), t.lightMap && (e.lightMap.value = t.lightMap, e.lightMapIntensity.value = t.lightMapIntensity), t.emissiveMap && (e.emissiveMap.value = t.emissiveMap), t.bumpMap && (e.bumpMap.value = t.bumpMap, e.bumpScale.value = t.bumpScale), t.normalMap && (e.normalMap.value = t.normalMap, e.normalScale.value.copy(t.normalScale)), t.displacementMap && (e.displacementMap.value = t.displacementMap, e.displacementScale.value = t.displacementScale, e.displacementBias.value = t.displacementBias)
        }

        function D(e, t) {
          e.roughness.value = t.roughness, e.metalness.value = t.metalness, t.roughnessMap && (e.roughnessMap.value = t.roughnessMap), t.metalnessMap && (e.metalnessMap.value = t.metalnessMap), t.lightMap && (e.lightMap.value = t.lightMap, e.lightMapIntensity.value = t.lightMapIntensity), t.emissiveMap && (e.emissiveMap.value = t.emissiveMap), t.bumpMap && (e.bumpMap.value = t.bumpMap, e.bumpScale.value = t.bumpScale), t.normalMap && (e.normalMap.value = t.normalMap, e.normalScale.value.copy(t.normalScale)), t.displacementMap && (e.displacementMap.value = t.displacementMap, e.displacementScale.value = t.displacementScale, e.displacementBias.value = t.displacementBias), t.envMap && (e.envMapIntensity.value = t.envMapIntensity)
        }

        function O(e, t) {
          e.ambientLightColor.needsUpdate = t, e.directionalLights.needsUpdate = t, e.pointLights.needsUpdate = t, e.spotLights.needsUpdate = t, e.hemisphereLights.needsUpdate = t
        }

        function k(e, t) {
          Ge.uniformMatrix4fv(e.modelViewMatrix, !1, t.modelViewMatrix.elements), e.normalMatrix && Ge.uniformMatrix3fv(e.normalMatrix, !1, t.normalMatrix.elements)
        }

        function B() {
          var e = Pe;
          return e >= Ye.maxTextures && console.warn("WebGLRenderer: trying to use " + e + " texture units while this GPU supports only " + Ye.maxTextures), Pe += 1, e
        }

        function F(e, t, i, r) {
          var o, a;
          if ("1i" === t) {
            Ge.uniform1i(i, r)
          } else {
            if ("1f" === t) {
              Ge.uniform1f(i, r)
            } else {
              if ("2f" === t) {
                Ge.uniform2f(i, r[0], r[1])
              } else {
                if ("3f" === t) {
                  Ge.uniform3f(i, r[0], r[1], r[2])
                } else {
                  if ("4f" === t) {
                    Ge.uniform4f(i, r[0], r[1], r[2], r[3])
                  } else {
                    if ("1iv" === t) {
                      Ge.uniform1iv(i, r)
                    } else {
                      if ("3iv" === t) {
                        Ge.uniform3iv(i, r)
                      } else {
                        if ("1fv" === t) {
                          Ge.uniform1fv(i, r)
                        } else {
                          if ("2fv" === t) {
                            Ge.uniform2fv(i, r)
                          } else {
                            if ("3fv" === t) {
                              Ge.uniform3fv(i, r)
                            } else {
                              if ("4fv" === t) {
                                Ge.uniform4fv(i, r)
                              } else {
                                if ("Matrix2fv" === t) {
                                  Ge.uniformMatrix2fv(i, !1, r)
                                } else {
                                  if ("Matrix3fv" === t) {
                                    Ge.uniformMatrix3fv(i, !1, r)
                                  } else {
                                    if ("Matrix4fv" === t) {
                                      Ge.uniformMatrix4fv(i, !1, r)
                                    } else {
                                      if ("i" === t) {
                                        Ge.uniform1i(i, r)
                                      } else {
                                        if ("f" === t) {
                                          Ge.uniform1f(i, r)
                                        } else {
                                          if ("v2" === t) {
                                            Ge.uniform2f(i, r.x, r.y)
                                          } else {
                                            if ("v3" === t) {
                                              Ge.uniform3f(i, r.x, r.y, r.z)
                                            } else {
                                              if ("v4" === t) {
                                                Ge.uniform4f(i, r.x, r.y, r.z, r.w)
                                              } else {
                                                if ("c" === t) {
                                                  Ge.uniform3f(i, r.r, r.g, r.b)
                                                } else {
                                                  if ("s" === t) {
                                                    var s = e.properties;
                                                    for (var h in s) {
                                                      var l = s[h],
                                                        c = i[h],
                                                        u = r[h];
                                                      F(l, l.type, c, u)
                                                    }
                                                  } else {
                                                    if ("sa" === t) {
                                                      for (var s = e.properties, d = 0, p = r.length; p > d; d++) {
                                                        for (var h in s) {
                                                          var l = s[h],
                                                            c = i[d][h],
                                                            u = r[d][h];
                                                          F(l, l.type, c, u)
                                                        }
                                                      }
                                                    } else {
                                                      if ("iv1" === t) {
                                                        Ge.uniform1iv(i, r)
                                                      } else {
                                                        if ("iv" === t) {
                                                          Ge.uniform3iv(i, r)
                                                        } else {
                                                          if ("fv1" === t) {
                                                            Ge.uniform1fv(i, r)
                                                          } else {
                                                            if ("fv" === t) {
                                                              Ge.uniform3fv(i, r)
                                                            } else {
                                                              if ("v2v" === t) {
                                                                void(0) === e._array && (e._array = new Float32Array(2 * r.length));
                                                                for (var d = 0, f = 0, m = r.length; m > d; d++, f += 2) {
                                                                  e._array[f + 0] = r[d].x, e._array[f + 1] = r[d].y
                                                                };
                                                                Ge.uniform2fv(i, e._array)
                                                              } else {
                                                                if ("v3v" === t) {
                                                                  void(0) === e._array && (e._array = new Float32Array(3 * r.length));
                                                                  for (var d = 0, g = 0, m = r.length; m > d; d++, g += 3) {
                                                                    e._array[g + 0] = r[d].x, e._array[g + 1] = r[d].y, e._array[g + 2] = r[d].z
                                                                  };
                                                                  Ge.uniform3fv(i, e._array)
                                                                } else {
                                                                  if ("v4v" === t) {
                                                                    void(0) === e._array && (e._array = new Float32Array(4 * r.length));
                                                                    for (var d = 0, v = 0, m = r.length; m > d; d++, v += 4) {
                                                                      e._array[v + 0] = r[d].x, e._array[v + 1] = r[d].y, e._array[v + 2] = r[d].z, e._array[v + 3] = r[d].w
                                                                    };
                                                                    Ge.uniform4fv(i, e._array)
                                                                  } else {
                                                                    if ("m2" === t) {
                                                                      Ge.uniformMatrix2fv(i, !1, r.elements)
                                                                    } else {
                                                                      if ("m3" === t) {
                                                                        Ge.uniformMatrix3fv(i, !1, r.elements)
                                                                      } else {
                                                                        if ("m3v" === t) {
                                                                          void(0) === e._array && (e._array = new Float32Array(9 * r.length));
                                                                          for (var d = 0, m = r.length; m > d; d++) {
                                                                            r[d].flattenToArrayOffset(e._array, 9 * d)
                                                                          };
                                                                          Ge.uniformMatrix3fv(i, !1, e._array)
                                                                        } else {
                                                                          if ("m4" === t) {
                                                                            Ge.uniformMatrix4fv(i, !1, r.elements)
                                                                          } else {
                                                                            if ("m4v" === t) {
                                                                              void(0) === e._array && (e._array = new Float32Array(16 * r.length));
                                                                              for (var d = 0, m = r.length; m > d; d++) {
                                                                                r[d].flattenToArrayOffset(e._array, 16 * d)
                                                                              };
                                                                              Ge.uniformMatrix4fv(i, !1, e._array)
                                                                            } else {
                                                                              if ("t" === t) {
                                                                                if (o = r, a = B(), Ge.uniform1i(i, a), !o) {
                                                                                  return
                                                                                };
                                                                                o instanceof n.CubeTexture || Array.isArray(o.image) && 6 === o.image.length ? Y(o, a) : o instanceof n.WebGLRenderTargetCube ? X(o.texture, a) : o instanceof n.WebGLRenderTarget ? ve.setTexture(o.texture, a) : ve.setTexture(o, a)
                                                                              } else {
                                                                                if ("tv" === t) {
                                                                                  void(0) === e._array && (e._array = []);
                                                                                  for (var d = 0, m = e.value.length; m > d; d++) {
                                                                                    e._array[d] = B()
                                                                                  };
                                                                                  Ge.uniform1iv(i, e._array);
                                                                                  for (var d = 0, m = e.value.length; m > d; d++) {
                                                                                    o = e.value[d], a = e._array[d], o && (o instanceof n.CubeTexture || o.image instanceof Array && 6 === o.image.length ? Y(o, a) : o instanceof n.WebGLRenderTarget ? ve.setTexture(o.texture, a) : o instanceof n.WebGLRenderTargetCube ? X(o.texture, a) : ve.setTexture(o, a))
                                                                                  }
                                                                                } else {
                                                                                  console.warn("THREE.WebGLRenderer: Unknown uniform type: " + t)
                                                                                }
                                                                              }
                                                                            }
                                                                          }
                                                                        }
                                                                      }
                                                                    }
                                                                  }
                                                                }
                                                              }
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }

        function N(e) {
          for (var t = 0, i = e.length; i > t; t++) {
            var n = e[t][0];
            if (n.needsUpdate !== !1) {
              var r = n.type,
                o = e[t][1],
                a = n.value;
              F(n, r, o, a)
            }
          }
        }

        function U(e, t) {
          var i, r, o, a, s, h, l = 0,
            c = 0,
            u = 0,
            d = t.matrixWorldInverse,
            p = 0,
            f = 0,
            m = 0,
            g = 0,
            v = 0;
          for (Ue.shadowsPointLight = 0, i = 0, r = e.length; r > i; i++) {
            if (o = e[i], a = o.color, s = o.intensity, h = o.distance, o instanceof n.AmbientLight) {
              l += a.r * s, c += a.g * s, u += a.b * s
            } else {
              if (o instanceof n.DirectionalLight) {
                var y = Qe["get"](o);
                y.color.copy(o.color).multiplyScalar(o.intensity), y.direction.setFromMatrixPosition(o.matrixWorld), Ne.setFromMatrixPosition(o.target.matrixWorld), y.direction.sub(Ne), y.direction.transformDirection(d), y.shadow = o.castShadow, o.castShadow && (y.shadowBias = o.shadow.bias, y.shadowRadius = o.shadow.radius, y.shadowMapSize = o.shadow.mapSize, Ue.shadows[v++] = o), Ue.directionalShadowMap[p] = o.shadow.map, Ue.directionalShadowMatrix[p] = o.shadow.matrix, Ue.directional[p++] = y
              } else {
                if (o instanceof n.SpotLight) {
                  var y = Qe["get"](o);
                  y.position.setFromMatrixPosition(o.matrixWorld), y.position.applyMatrix4(d), y.color.copy(a).multiplyScalar(s), y.distance = h, y.direction.setFromMatrixPosition(o.matrixWorld), Ne.setFromMatrixPosition(o.target.matrixWorld), y.direction.sub(Ne), y.direction.transformDirection(d), y.coneCos = Math.cos(o.angle), y.penumbraCos = Math.cos(o.angle * (1 - o.penumbra)), y.decay = 0 === o.distance ? 0 : o.decay, y.shadow = o.castShadow, o.castShadow && (y.shadowBias = o.shadow.bias, y.shadowRadius = o.shadow.radius, y.shadowMapSize = o.shadow.mapSize, Ue.shadows[v++] = o), Ue.spotShadowMap[m] = o.shadow.map, Ue.spotShadowMatrix[m] = o.shadow.matrix, Ue.spot[m++] = y
                } else {
                  if (o instanceof n.PointLight) {
                    var y = Qe["get"](o);
                    y.position.setFromMatrixPosition(o.matrixWorld), y.position.applyMatrix4(d), y.color.copy(o.color).multiplyScalar(o.intensity), y.distance = o.distance, y.decay = 0 === o.distance ? 0 : o.decay, y.shadow = o.castShadow, o.castShadow && (y.shadowBias = o.shadow.bias, y.shadowRadius = o.shadow.radius, y.shadowMapSize = o.shadow.mapSize, Ue.shadows[v++] = o), Ue.pointShadowMap[f] = o.shadow.map, void(0) === Ue.pointShadowMatrix[f] && (Ue.pointShadowMatrix[f] = new n.Matrix4), Ne.setFromMatrixPosition(o.matrixWorld).negate(), Ue.pointShadowMatrix[f].identity().setPosition(Ne), Ue.point[f++] = y
                  } else {
                    if (o instanceof n.HemisphereLight) {
                      var y = Qe["get"](o);
                      y.direction.setFromMatrixPosition(o.matrixWorld), y.direction.transformDirection(d), y.direction.normalize(), y.skyColor.copy(o.color).multiplyScalar(s), y.groundColor.copy(o.groundColor).multiplyScalar(s), Ue.hemi[g++] = y
                    }
                  }
                }
              }
            }
          };
          Ue.ambient[0] = l, Ue.ambient[1] = c, Ue.ambient[2] = u, Ue.directional.length = p, Ue.spot.length = m, Ue.point.length = f, Ue.hemi.length = g, Ue.shadows.length = v, Ue.hash = p + "," + f + "," + m + "," + g + "," + v
        }

        function V(e, t, i) {
          var r;
          if (i ? (Ge.texParameteri(e, Ge.TEXTURE_WRAP_S, ee(t.wrapS)), Ge.texParameteri(e, Ge.TEXTURE_WRAP_T, ee(t.wrapT)), Ge.texParameteri(e, Ge.TEXTURE_MAG_FILTER, ee(t.magFilter)), Ge.texParameteri(e, Ge.TEXTURE_MIN_FILTER, ee(t.minFilter))) : (Ge.texParameteri(e, Ge.TEXTURE_WRAP_S, Ge.CLAMP_TO_EDGE), Ge.texParameteri(e, Ge.TEXTURE_WRAP_T, Ge.CLAMP_TO_EDGE), (t.wrapS !== n.ClampToEdgeWrapping || t.wrapT !== n.ClampToEdgeWrapping) && console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.", t), Ge.texParameteri(e, Ge.TEXTURE_MAG_FILTER, J(t.magFilter)), Ge.texParameteri(e, Ge.TEXTURE_MIN_FILTER, J(t.minFilter)), t.minFilter !== n.NearestFilter && t.minFilter !== n.LinearFilter && console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.", t)), r = We["get"]("EXT_texture_filter_anisotropic")) {
            if (t.type === n.FloatType && null === We["get"]("OES_texture_float_linear")) {
              return
            };
            if (t.type === n.HalfFloatType && null === We["get"]("OES_texture_half_float_linear")) {
              return
            };
            (t.anisotropy > 1 || qe["get"](t).__currentAnisotropy) && (Ge.texParameterf(e, r.TEXTURE_MAX_ANISOTROPY_EXT, Math.min(t.anisotropy, ve.getMaxAnisotropy())), qe["get"](t).__currentAnisotropy = t.anisotropy)
          }
        }

        function z(e, t, i) {
          void(0) === e.__webglInit && (e.__webglInit = !0, t.addEventListener("dispose", s), e.__webglTexture = Ge.createTexture(), Ve.textures++), Xe.activeTexture(Ge.TEXTURE0 + i), Xe.bindTexture(Ge.TEXTURE_2D, e.__webglTexture), Ge.pixelStorei(Ge.UNPACK_FLIP_Y_WEBGL, t.flipY), Ge.pixelStorei(Ge.UNPACK_PREMULTIPLY_ALPHA_WEBGL, t.premultiplyAlpha), Ge.pixelStorei(Ge.UNPACK_ALIGNMENT, t.unpackAlignment);
          var r = G(t.image, Ye.maxTextureSize);
          H(t) && j(r) === !1 && (r = W(r));
          var o = j(r),
            a = ee(t.format),
            h = ee(t.type);
          V(Ge.TEXTURE_2D, t, o);
          var l, c = t.mipmaps;
          if (t instanceof n.DataTexture) {
            if (c.length > 0 && o) {
              for (var u = 0, d = c.length; d > u; u++) {
                l = c[u], Xe.texImage2D(Ge.TEXTURE_2D, u, a, l.width, l.height, 0, a, h, l.data)
              };
              t.generateMipmaps = !1
            } else {
              Xe.texImage2D(Ge.TEXTURE_2D, 0, a, r.width, r.height, 0, a, h, r.data)
            }
          } else {
            if (t instanceof n.CompressedTexture) {
              for (var u = 0, d = c.length; d > u; u++) {
                l = c[u], t.format !== n.RGBAFormat && t.format !== n.RGBFormat ? Xe.getCompressedTextureFormats().indexOf(a) > -1 ? Xe.compressedTexImage2D(Ge.TEXTURE_2D, u, a, l.width, l.height, 0, l.data) : console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()") : Xe.texImage2D(Ge.TEXTURE_2D, u, a, l.width, l.height, 0, a, h, l.data)
              }
            } else {
              if (c.length > 0 && o) {
                for (var u = 0, d = c.length; d > u; u++) {
                  l = c[u], Xe.texImage2D(Ge.TEXTURE_2D, u, a, a, h, l)
                };
                t.generateMipmaps = !1
              } else {
                Xe.texImage2D(Ge.TEXTURE_2D, 0, a, a, h, r)
              }
            }
          };
          t.generateMipmaps && o && Ge.generateMipmap(Ge.TEXTURE_2D), e.__version = t.version, t.onUpdate && t.onUpdate(t)
        }

        function G(e, t) {
          if (e.width > t || e.height > t) {
            var i = t / Math.max(e.width, e.height),
              n = document.createElement("canvas");
            n.width = Math.floor(e.width * i), n.height = Math.floor(e.height * i);
            var r = n.getContext("2d");
            return r.drawImage(e, 0, 0, e.width, e.height, 0, 0, n.width, n.height), console.warn("THREE.WebGLRenderer: image is too big (" + e.width + "x" + e.height + "). Resized to " + n.width + "x" + n.height, e), n
          };
          return e
        }

        function j(e) {
          return n.Math.isPowerOfTwo(e.width) && n.Math.isPowerOfTwo(e.height)
        }

        function H(e) {
          return e.wrapS !== n.ClampToEdgeWrapping || e.wrapT !== n.ClampToEdgeWrapping ? !0 : e.minFilter !== n.NearestFilter && e.minFilter !== n.LinearFilter ? !0 : !1
        }

        function W(e) {
          if (e instanceof HTMLImageElement || e instanceof HTMLCanvasElement) {
            var t = document.createElement("canvas");
            t.width = n.Math.nearestPowerOfTwo(e.width), t.height = n.Math.nearestPowerOfTwo(e.height);
            var i = t.getContext("2d");
            return i.drawImage(e, 0, 0, t.width, t.height), console.warn("THREE.WebGLRenderer: image is not power of two (" + e.width + "x" + e.height + "). Resized to " + t.width + "x" + t.height, e), t
          };
          return e
        }

        function Y(e, t) {
          var i = qe["get"](e);
          if (6 === e.image.length) {
            if (e.version > 0 && i.__version !== e.version) {
              i.__image__webglTextureCube || (e.addEventListener("dispose", s), i.__image__webglTextureCube = Ge.createTexture(), Ve.textures++), Xe.activeTexture(Ge.TEXTURE0 + t), Xe.bindTexture(Ge.TEXTURE_CUBE_MAP, i.__image__webglTextureCube), Ge.pixelStorei(Ge.UNPACK_FLIP_Y_WEBGL, e.flipY);
              for (var r = e instanceof n.CompressedTexture, o = e.image[0] instanceof n.DataTexture, a = [], h = 0; 6 > h; h++) {
                a[h] = !ve.autoScaleCubemaps || r || o ? o ? e.image[h].image : e.image[h] : G(e.image[h], Ye.maxCubemapSize)
              };
              var l = a[0],
                c = j(l),
                u = ee(e.format),
                d = ee(e.type);
              V(Ge.TEXTURE_CUBE_MAP, e, c);
              for (var h = 0; 6 > h; h++) {
                if (r) {
                  for (var p, f = a[h].mipmaps, m = 0, g = f.length; g > m; m++) {
                    p = f[m], e.format !== n.RGBAFormat && e.format !== n.RGBFormat ? Xe.getCompressedTextureFormats().indexOf(u) > -1 ? Xe.compressedTexImage2D(Ge.TEXTURE_CUBE_MAP_POSITIVE_X + h, m, u, p.width, p.height, 0, p.data) : console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()") : Xe.texImage2D(Ge.TEXTURE_CUBE_MAP_POSITIVE_X + h, m, u, p.width, p.height, 0, u, d, p.data)
                  }
                } else {
                  o ? Xe.texImage2D(Ge.TEXTURE_CUBE_MAP_POSITIVE_X + h, 0, u, a[h].width, a[h].height, 0, u, d, a[h].data) : Xe.texImage2D(Ge.TEXTURE_CUBE_MAP_POSITIVE_X + h, 0, u, u, d, a[h])
                }
              };
              e.generateMipmaps && c && Ge.generateMipmap(Ge.TEXTURE_CUBE_MAP), i.__version = e.version, e.onUpdate && e.onUpdate(e)
            } else {
              Xe.activeTexture(Ge.TEXTURE0 + t), Xe.bindTexture(Ge.TEXTURE_CUBE_MAP, i.__image__webglTextureCube)
            }
          }
        }

        function X(e, t) {
          Xe.activeTexture(Ge.TEXTURE0 + t), Xe.bindTexture(Ge.TEXTURE_CUBE_MAP, qe["get"](e).__webglTexture)
        }

        function q(e, t, i, n) {
          var r = ee(t.texture.format),
            o = ee(t.texture.type);
          Xe.texImage2D(n, 0, r, t.width, t.height, 0, r, o, null), Ge.bindFramebuffer(Ge.FRAMEBUFFER, e), Ge.framebufferTexture2D(Ge.FRAMEBUFFER, i, n, qe["get"](t.texture).__webglTexture, 0), Ge.bindFramebuffer(Ge.FRAMEBUFFER, null)
        }

        function Z(e, t) {
          Ge.bindRenderbuffer(Ge.RENDERBUFFER, e), t.depthBuffer && !t.stencilBuffer ? (Ge.renderbufferStorage(Ge.RENDERBUFFER, Ge.DEPTH_COMPONENT16, t.width, t.height), Ge.framebufferRenderbuffer(Ge.FRAMEBUFFER, Ge.DEPTH_ATTACHMENT, Ge.RENDERBUFFER, e)) : t.depthBuffer && t.stencilBuffer ? (Ge.renderbufferStorage(Ge.RENDERBUFFER, Ge.DEPTH_STENCIL, t.width, t.height), Ge.framebufferRenderbuffer(Ge.FRAMEBUFFER, Ge.DEPTH_STENCIL_ATTACHMENT, Ge.RENDERBUFFER, e)) : Ge.renderbufferStorage(Ge.RENDERBUFFER, Ge.RGBA4, t.width, t.height), Ge.bindRenderbuffer(Ge.RENDERBUFFER, null)
        }

        function $(e) {
          var t = qe["get"](e),
            i = e instanceof n.WebGLRenderTargetCube;
          if (i) {
            t.__webglDepthbuffer = [];
            for (var r = 0; 6 > r; r++) {
              Ge.bindFramebuffer(Ge.FRAMEBUFFER, t.__webglFramebuffer[r]), t.__webglDepthbuffer[r] = Ge.createRenderbuffer(), Z(t.__webglDepthbuffer[r], e)
            }
          } else {
            Ge.bindFramebuffer(Ge.FRAMEBUFFER, t.__webglFramebuffer), t.__webglDepthbuffer = Ge.createRenderbuffer(), Z(t.__webglDepthbuffer, e)
          };
          Ge.bindFramebuffer(Ge.FRAMEBUFFER, null)
        }

        function Q(e) {
          var t = qe["get"](e),
            i = qe["get"](e.texture);
          e.addEventListener("dispose", h), i.__webglTexture = Ge.createTexture(), Ve.textures++;
          var r = e instanceof n.WebGLRenderTargetCube,
            o = n.Math.isPowerOfTwo(e.width) && n.Math.isPowerOfTwo(e.height);
          if (r) {
            t.__webglFramebuffer = [];
            for (var a = 0; 6 > a; a++) {
              t.__webglFramebuffer[a] = Ge.createFramebuffer()
            }
          } else {
            t.__webglFramebuffer = Ge.createFramebuffer()
          };
          if (r) {
            Xe.bindTexture(Ge.TEXTURE_CUBE_MAP, i.__webglTexture), V(Ge.TEXTURE_CUBE_MAP, e.texture, o);
            for (var a = 0; 6 > a; a++) {
              q(t.__webglFramebuffer[a], e, Ge.COLOR_ATTACHMENT0, Ge.TEXTURE_CUBE_MAP_POSITIVE_X + a)
            };
            e.texture.generateMipmaps && o && Ge.generateMipmap(Ge.TEXTURE_CUBE_MAP), Xe.bindTexture(Ge.TEXTURE_CUBE_MAP, null)
          } else {
            Xe.bindTexture(Ge.TEXTURE_2D, i.__webglTexture), V(Ge.TEXTURE_2D, e.texture, o), q(t.__webglFramebuffer, e, Ge.COLOR_ATTACHMENT0, Ge.TEXTURE_2D), e.texture.generateMipmaps && o && Ge.generateMipmap(Ge.TEXTURE_2D), Xe.bindTexture(Ge.TEXTURE_2D, null)
          };
          e.depthBuffer && $(e)
        }

        function K(e) {
          var t = e instanceof n.WebGLRenderTargetCube ? Ge.TEXTURE_CUBE_MAP : Ge.TEXTURE_2D,
            i = qe["get"](e.texture).__webglTexture;
          Xe.bindTexture(t, i), Ge.generateMipmap(t), Xe.bindTexture(t, null)
        }

        function J(e) {
          return e === n.NearestFilter || e === n.NearestMipMapNearestFilter || e === n.NearestMipMapLinearFilter ? Ge.NEAREST : Ge.LINEAR
        }

        function ee(e) {
          var t;
          if (e === n.RepeatWrapping) {
            return Ge.REPEAT
          };
          if (e === n.ClampToEdgeWrapping) {
            return Ge.CLAMP_TO_EDGE
          };
          if (e === n.MirroredRepeatWrapping) {
            return Ge.MIRRORED_REPEAT
          };
          if (e === n.NearestFilter) {
            return Ge.NEAREST
          };
          if (e === n.NearestMipMapNearestFilter) {
            return Ge.NEAREST_MIPMAP_NEAREST
          };
          if (e === n.NearestMipMapLinearFilter) {
            return Ge.NEAREST_MIPMAP_LINEAR
          };
          if (e === n.LinearFilter) {
            return Ge.LINEAR
          };
          if (e === n.LinearMipMapNearestFilter) {
            return Ge.LINEAR_MIPMAP_NEAREST
          };
          if (e === n.LinearMipMapLinearFilter) {
            return Ge.LINEAR_MIPMAP_LINEAR
          };
          if (e === n.UnsignedByteType) {
            return Ge.UNSIGNED_BYTE
          };
          if (e === n.UnsignedShort4444Type) {
            return Ge.UNSIGNED_SHORT_4_4_4_4
          };
          if (e === n.UnsignedShort5551Type) {
            return Ge.UNSIGNED_SHORT_5_5_5_1
          };
          if (e === n.UnsignedShort565Type) {
            return Ge.UNSIGNED_SHORT_5_6_5
          };
          if (e === n.ByteType) {
            return Ge.BYTE
          };
          if (e === n.ShortType) {
            return Ge.SHORT
          };
          if (e === n.UnsignedShortType) {
            return Ge.UNSIGNED_SHORT
          };
          if (e === n.IntType) {
            return Ge.INT
          };
          if (e === n.UnsignedIntType) {
            return Ge.UNSIGNED_INT
          };
          if (e === n.FloatType) {
            return Ge.FLOAT
          };
          if (t = We["get"]("OES_texture_half_float"), null !== t && e === n.HalfFloatType) {
            return t.HALF_FLOAT_OES
          };
          if (e === n.AlphaFormat) {
            return Ge.ALPHA
          };
          if (e === n.RGBFormat) {
            return Ge.RGB
          };
          if (e === n.RGBAFormat) {
            return Ge.RGBA
          };
          if (e === n.LuminanceFormat) {
            return Ge.LUMINANCE
          };
          if (e === n.LuminanceAlphaFormat) {
            return Ge.LUMINANCE_ALPHA
          };
          if (e === n.AddEquation) {
            return Ge.FUNC_ADD
          };
          if (e === n.SubtractEquation) {
            return Ge.FUNC_SUBTRACT
          };
          if (e === n.ReverseSubtractEquation) {
            return Ge.FUNC_REVERSE_SUBTRACT
          };
          if (e === n.ZeroFactor) {
            return Ge.ZERO
          };
          if (e === n.OneFactor) {
            return Ge.ONE
          };
          if (e === n.SrcColorFactor) {
            return Ge.SRC_COLOR
          };
          if (e === n.OneMinusSrcColorFactor) {
            return Ge.ONE_MINUS_SRC_COLOR
          };
          if (e === n.SrcAlphaFactor) {
            return Ge.SRC_ALPHA
          };
          if (e === n.OneMinusSrcAlphaFactor) {
            return Ge.ONE_MINUS_SRC_ALPHA
          };
          if (e === n.DstAlphaFactor) {
            return Ge.DST_ALPHA
          };
          if (e === n.OneMinusDstAlphaFactor) {
            return Ge.ONE_MINUS_DST_ALPHA
          };
          if (e === n.DstColorFactor) {
            return Ge.DST_COLOR
          };
          if (e === n.OneMinusDstColorFactor) {
            return Ge.ONE_MINUS_DST_COLOR
          };
          if (e === n.SrcAlphaSaturateFactor) {
            return Ge.SRC_ALPHA_SATURATE
          };
          if (t = We["get"]("WEBGL_compressed_texture_s3tc"), null !== t) {
            if (e === n.RGB_S3TC_DXT1_Format) {
              return t.COMPRESSED_RGB_S3TC_DXT1_EXT
            };
            if (e === n.RGBA_S3TC_DXT1_Format) {
              return t.COMPRESSED_RGBA_S3TC_DXT1_EXT
            };
            if (e === n.RGBA_S3TC_DXT3_Format) {
              return t.COMPRESSED_RGBA_S3TC_DXT3_EXT
            };
            if (e === n.RGBA_S3TC_DXT5_Format) {
              return t.COMPRESSED_RGBA_S3TC_DXT5_EXT
            }
          };
          if (t = We["get"]("WEBGL_compressed_texture_pvrtc"), null !== t) {
            if (e === n.RGB_PVRTC_4BPPV1_Format) {
              return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG
            };
            if (e === n.RGB_PVRTC_2BPPV1_Format) {
              return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG
            };
            if (e === n.RGBA_PVRTC_4BPPV1_Format) {
              return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG
            };
            if (e === n.RGBA_PVRTC_2BPPV1_Format) {
              return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG
            }
          };
          if (t = We["get"]("WEBGL_compressed_texture_etc1"), null !== t && e === n.RGB_ETC1_Format) {
            return t.COMPRESSED_RGB_ETC1_WEBGL
          };
          if (t = We["get"]("EXT_blend_minmax"), null !== t) {
            if (e === n.MinEquation) {
              return t.MIN_EXT
            };
            if (e === n.MaxEquation) {
              return t.MAX_EXT
            }
          };
          return 0
        }
        console.log("THREE.WebGLRenderer", n.REVISION), e = e || {};
        var te = void(0) !== e.canvas ? e.canvas : document.createElement("canvas"),
          ie = void(0) !== e.context ? e.context : null,
          ne = void(0) !== e.alpha ? e.alpha : !1,
          re = void(0) !== e.depth ? e.depth : !0,
          oe = void(0) !== e.stencil ? e.stencil : !0,
          ae = void(0) !== e.antialias ? e.antialias : !1,
          se = void(0) !== e.premultipliedAlpha ? e.premultipliedAlpha : !0,
          he = void(0) !== e.preserveDrawingBuffer ? e.preserveDrawingBuffer : !1,
          le = [],
          ce = [],
          ue = -1,
          de = [],
          pe = -1,
          fe = new Float32Array(8),
          me = [],
          ge = [];
        this.domElement = te, this.context = null, this.autoClear = !0, this.autoClearColor = !0, this.autoClearDepth = !0, this.autoClearStencil = !0, this.sortObjects = !0, this.gammaFactor = 2, this.gammaInput = !1, this.gammaOutput = !1, this.physicallyCorrectLights = !1, this.toneMapping = n.LinearToneMapping, this.toneMappingExposure = 1, this.toneMappingWhitePoint = 1, this.maxMorphTargets = 8, this.maxMorphNormals = 4, this.autoScaleCubemaps = !0;
        var ve = this,
          ye = null,
          be = null,
          we = null,
          _e = -1,
          xe = "",
          Me = null,
          Ee = new n.Vector4,
          Se = null,
          Te = new n.Vector4,
          Pe = 0,
          Ae = new n.Color(0),
          Le = 0,
          Ce = te.width,
          Re = te.height,
          Ie = 1,
          De = new n.Vector4(0, 0, Ce, Re),
          Oe = !1,
          ke = new n.Vector4(0, 0, Ce, Re),
          Be = new n.Frustum,
          Fe = new n.Matrix4,
          Ne = new n.Vector3,
          Ue = {
            hash: "",
            ambient: [0, 0, 0],
            directional: [],
            directionalShadowMap: [],
            directionalShadowMatrix: [],
            spot: [],
            spotShadowMap: [],
            spotShadowMatrix: [],
            point: [],
            pointShadowMap: [],
            pointShadowMatrix: [],
            hemi: [],
            shadows: [],
            shadowsPointLight: 0
          },
          Ve = {
            geometries: 0,
            textures: 0
          },
          ze = {
            calls: 0,
            vertices: 0,
            faces: 0,
            points: 0
          };
        this.info = {
          render: ze,
          memory: Ve,
          programs: null
        };
        var Ge;
        try {
          var je = {
            alpha: ne,
            depth: re,
            stencil: oe,
            antialias: ae,
            premultipliedAlpha: se,
            preserveDrawingBuffer: he
          };
          if (Ge = ie || te.getContext("webgl", je) || te.getContext("experimental-webgl", je), null === Ge) {
            throw null !== te.getContext("webgl") ? "Error creating WebGL context with your selected attributes." : "Error creating WebGL context."
          };
          void(0) === Ge.getShaderPrecisionFormat && (Ge.getShaderPrecisionFormat = function() {
            return {
              rangeMin: 1,
              rangeMax: 1,
              precision: 1
            }
          }), te.addEventListener("webglcontextlost", a, !1)
        } catch (He) {
          console.error("THREE.WebGLRenderer: " + He)
        };
        var We = new n.WebGLExtensions(Ge);
        We["get"]("OES_texture_float"), We["get"]("OES_texture_float_linear"), We["get"]("OES_texture_half_float"), We["get"]("OES_texture_half_float_linear"), We["get"]("OES_standard_derivatives"), We["get"]("ANGLE_instanced_arrays"), We["get"]("OES_element_index_uint") && (n.BufferGeometry.MaxIndex = 4294967296);
        var Ye = new n.WebGLCapabilities(Ge, We, e),
          Xe = new n.WebGLState(Ge, We, ee),
          qe = new n.WebGLProperties,
          Ze = new n.WebGLObjects(Ge, qe, this.info),
          $e = new n.WebGLPrograms(this, Ye),
          Qe = new n.WebGLLights;
        this.info.programs = $e.programs;
        var Ke = new n.WebGLBufferRenderer(Ge, We, ze),
          Je = new n.WebGLIndexedBufferRenderer(Ge, We, ze);
        r(), this.context = Ge, this.capabilities = Ye, this.extensions = We, this.properties = qe, this.state = Xe;
        var et = new n.WebGLShadowMap(this, Ue, Ze);
        this.shadowMap = et;
        var tt = new n.SpritePlugin(this, me),
          it = new n.LensFlarePlugin(this, ge);
        this.getContext = function() {
          return Ge
        }, this.getContextAttributes = function() {
          return Ge.getContextAttributes()
        }, this.forceContextLoss = function() {
          We["get"]("WEBGL_lose_context").loseContext()
        }, this.getMaxAnisotropy = function() {
          var e;
          return function() {
            if (void(0) !== e) {
              return e
            };
            var t = We["get"]("EXT_texture_filter_anisotropic");
            return e = null !== t ? Ge.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT) : 0
          }
        }(), this.getPrecision = function() {
          return Ye.precision
        }, this.getPixelRatio = function() {
          return Ie
        }, this.setPixelRatio = function(e) {
          void(0) !== e && (Ie = e, this.setSize(ke.z, ke.w, !1))
        }, this.getSize = function() {
          return {
            width: Ce,
            height: Re
          }
        }, this.setSize = function(e, t, i) {
          Ce = e, Re = t, te.width = e * Ie, te.height = t * Ie, i !== !1 && (te.style.width = e + "px", te.style.height = t + "px"), this.setViewport(0, 0, e, t)
        }, this.setViewport = function(e, t, i, n) {
          Xe.viewport(ke["set"](e, t, i, n))
        }, this.setScissor = function(e, t, i, n) {
          Xe.scissor(De["set"](e, t, i, n))
        }, this.setScissorTest = function(e) {
          Xe.setScissorTest(Oe = e)
        }, this.getClearColor = function() {
          return Ae
        }, this.setClearColor = function(e, t) {
          Ae["set"](e), Le = void(0) !== t ? t : 1, i(Ae.r, Ae.g, Ae.b, Le)
        }, this.getClearAlpha = function() {
          return Le
        }, this.setClearAlpha = function(e) {
          Le = e, i(Ae.r, Ae.g, Ae.b, Le)
        }, this.clear = function(e, t, i) {
          var n = 0;
          (void(0) === e || e) && (n |= Ge.COLOR_BUFFER_BIT), (void(0) === t || t) && (n |= Ge.DEPTH_BUFFER_BIT), (void(0) === i || i) && (n |= Ge.STENCIL_BUFFER_BIT), Ge.clear(n)
        }, this.clearColor = function() {
          this.clear(!0, !1, !1)
        }, this.clearDepth = function() {
          this.clear(!1, !0, !1)
        }, this.clearStencil = function() {
          this.clear(!1, !1, !0)
        }, this.clearTarget = function(e, t, i, n) {
          this.setRenderTarget(e), this.clear(t, i, n)
        }, this.resetGLState = o, this.dispose = function() {
          te.removeEventListener("webglcontextlost", a, !1)
        }, this.renderBufferImmediate = function(e, t, i) {
          Xe.initAttributes();
          var r = qe["get"](e);
          e.hasPositions && !r.position && (r.position = Ge.createBuffer()), e.hasNormals && !r.normal && (r.normal = Ge.createBuffer()), e.hasUvs && !r.uv && (r.uv = Ge.createBuffer()), e.hasColors && !r.color && (r.color = Ge.createBuffer());
          var o = t.getAttributes();
          if (e.hasPositions && (Ge.bindBuffer(Ge.ARRAY_BUFFER, r.position), Ge.bufferData(Ge.ARRAY_BUFFER, e.positionArray, Ge.DYNAMIC_DRAW), Xe.enableAttribute(o.position), Ge.vertexAttribPointer(o.position, 3, Ge.FLOAT, !1, 0, 0)), e.hasNormals) {
            if (Ge.bindBuffer(Ge.ARRAY_BUFFER, r.normal), "MeshPhongMaterial" !== i.type && "MeshStandardMaterial" !== i.type && i.shading === n.FlatShading) {
              for (var a = 0, s = 3 * e.count; s > a; a += 9) {
                var h = e.normalArray,
                  l = (h[a + 0] + h[a + 3] + h[a + 6]) / 3,
                  c = (h[a + 1] + h[a + 4] + h[a + 7]) / 3,
                  u = (h[a + 2] + h[a + 5] + h[a + 8]) / 3;
                h[a + 0] = l, h[a + 1] = c, h[a + 2] = u, h[a + 3] = l, h[a + 4] = c, h[a + 5] = u, h[a + 6] = l, h[a + 7] = c, h[a + 8] = u
              }
            };
            Ge.bufferData(Ge.ARRAY_BUFFER, e.normalArray, Ge.DYNAMIC_DRAW), Xe.enableAttribute(o.normal), Ge.vertexAttribPointer(o.normal, 3, Ge.FLOAT, !1, 0, 0)
          };
          e.hasUvs && i.map && (Ge.bindBuffer(Ge.ARRAY_BUFFER, r.uv), Ge.bufferData(Ge.ARRAY_BUFFER, e.uvArray, Ge.DYNAMIC_DRAW), Xe.enableAttribute(o.uv), Ge.vertexAttribPointer(o.uv, 2, Ge.FLOAT, !1, 0, 0)), e.hasColors && i.vertexColors !== n.NoColors && (Ge.bindBuffer(Ge.ARRAY_BUFFER, r.color), Ge.bufferData(Ge.ARRAY_BUFFER, e.colorArray, Ge.DYNAMIC_DRAW), Xe.enableAttribute(o.color), Ge.vertexAttribPointer(o.color, 3, Ge.FLOAT, !1, 0, 0)), Xe.disableUnusedAttributes(), Ge.drawArrays(Ge.TRIANGLES, 0, e.count), e.count = 0
        }, this.renderBufferDirect = function(e, i, r, o, a, s) {
          x(o);
          var h = E(e, i, o, a),
            l = !1,
            c = r.id + "_" + h.id + "_" + o.wireframe;
          c !== xe && (xe = c, l = !0);
          var u = a.morphTargetInfluences;
          if (void(0) !== u) {
            for (var d = [], p = 0, g = u.length; g > p; p++) {
              var v = u[p];
              d.push([v, p])
            };
            d.sort(m), d.length > 8 && (d.length = 8);
            for (var y = r.morphAttributes, p = 0, g = d.length; g > p; p++) {
              var v = d[p];
              if (fe[p] = v[0], 0 !== v[0]) {
                var b = v[1];
                o.morphTargets === !0 && y.position && r.addAttribute("morphTarget" + p, y.position[b]), o.morphNormals === !0 && y.normal && r.addAttribute("morphNormal" + p, y.normal[b])
              } else {
                o.morphTargets === !0 && r.removeAttribute("morphTarget" + p), o.morphNormals === !0 && r.removeAttribute("morphNormal" + p)
              }
            };
            var w = h.getUniforms();
            null !== w.morphTargetInfluences && Ge.uniform1fv(w.morphTargetInfluences, fe), l = !0
          };
          var b = r.index,
            _ = r.attributes.position;
          o.wireframe === !0 && (b = Ze.getWireframeAttribute(r));
          var M;
          null !== b ? (M = Je, M.setIndex(b)) : M = Ke, l && (f(o, h, r), null !== b && Ge.bindBuffer(Ge.ELEMENT_ARRAY_BUFFER, Ze.getAttributeBuffer(b)));
          var S = 0,
            T = 1 / 0;
          null !== b ? T = b.count : void(0) !== _ && (T = _.count);
          var P = r.drawRange.start,
            A = r.drawRange.count,
            L = null !== s ? s.start : 0,
            C = null !== s ? s.count : 1 / 0,
            R = Math.max(S, P, L),
            I = Math.min(S + T, P + A, L + C) - 1,
            D = Math.max(0, I - R + 1);
          if (a instanceof n.Mesh) {
            if (o.wireframe === !0) {
              Xe.setLineWidth(o.wireframeLinewidth * t()), M.setMode(Ge.LINES)
            } else {
              switch (a.drawMode) {
                case n.TrianglesDrawMode:
                  M.setMode(Ge.TRIANGLES);
                  break;
                case n.TriangleStripDrawMode:
                  M.setMode(Ge.TRIANGLE_STRIP);
                  break;
                case n.TriangleFanDrawMode:
                  M.setMode(Ge.TRIANGLE_FAN)
              }
            }
          } else {
            if (a instanceof n.Line) {
              var O = o.linewidth;
              void(0) === O && (O = 1), Xe.setLineWidth(O * t()), M.setMode(a instanceof n.LineSegments ? Ge.LINES : Ge.LINE_STRIP)
            } else {
              a instanceof n.Points && M.setMode(Ge.POINTS)
            }
          };
          r instanceof n.InstancedBufferGeometry ? r.maxInstancedCount > 0 && M.renderInstances(r, R, D) : M.render(R, D)
        }, this.render = function(e, t, i, r) {
          if (t instanceof n.Camera == !1) {
            return void(console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera."))
          };
          var o = e.fog;
          if (xe = "", _e = -1, Me = null, e.autoUpdate === !0 && e.updateMatrixWorld(), null === t.parent && t.updateMatrixWorld(), t.matrixWorldInverse.getInverse(t.matrixWorld), Fe.multiplyMatrices(t.projectionMatrix, t.matrixWorldInverse), Be.setFromMatrix(Fe), le.length = 0, ue = -1, pe = -1, me.length = 0, ge.length = 0, b(e, t), ce.length = ue + 1, de.length = pe + 1, ve.sortObjects === !0 && (ce.sort(g), de.sort(v)), U(le, t), et.render(e, t), ze.calls = 0, ze.vertices = 0, ze.faces = 0, ze.points = 0, void(0) === i && (i = null), this.setRenderTarget(i), (this.autoClear || r) && this.clear(this.autoClearColor, this.autoClearDepth, this.autoClearStencil), e.overrideMaterial) {
            var a = e.overrideMaterial;
            w(ce, t, o, a), w(de, t, o, a)
          } else {
            Xe.setBlending(n.NoBlending), w(ce, t, o), w(de, t, o)
          };
          if (tt.render(e, t), it.render(e, t, Te), i) {
            var s = i.texture;
            s.generateMipmaps && j(i) && s.minFilter !== n.NearestFilter && s.minFilter !== n.LinearFilter && K(i)
          };
          Xe.setDepthTest(!0), Xe.setDepthWrite(!0), Xe.setColorWrite(!0)
        }, this.setFaceCulling = function(e, t) {
          e === n.CullFaceNone ? Xe.disable(Ge.CULL_FACE) : (Ge.frontFace(t === n.FrontFaceDirectionCW ? Ge.CW : Ge.CCW), Ge.cullFace(e === n.CullFaceBack ? Ge.BACK : e === n.CullFaceFront ? Ge.FRONT : Ge.FRONT_AND_BACK), Xe.enable(Ge.CULL_FACE))
        }, this.setTexture = function(e, t) {
          var i = qe["get"](e);
          if (e.version > 0 && i.__version !== e.version) {
            var n = e.image;
            return void(0) === n ? void(console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined", e)) : n.complete === !1 ? void(console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete", e)) : void(z(i, e, t))
          };
          Xe.activeTexture(Ge.TEXTURE0 + t), Xe.bindTexture(Ge.TEXTURE_2D, i.__webglTexture)
        }, this.getCurrentRenderTarget = function() {
          return be
        }, this.setRenderTarget = function(e) {
          be = e, e && void(0) === qe["get"](e).__webglFramebuffer && Q(e);
          var t, i = e instanceof n.WebGLRenderTargetCube;
          if (e) {
            var r = qe["get"](e);
            t = i ? r.__webglFramebuffer[e.activeCubeFace] : r.__webglFramebuffer, Ee.copy(e.scissor), Se = e.scissorTest, Te.copy(e.viewport)
          } else {
            t = null, Ee.copy(De).multiplyScalar(Ie), Se = Oe, Te.copy(ke).multiplyScalar(Ie)
          };
          if (we !== t && (Ge.bindFramebuffer(Ge.FRAMEBUFFER, t), we = t), Xe.scissor(Ee), Xe.setScissorTest(Se), Xe.viewport(Te), i) {
            var o = qe["get"](e.texture);
            Ge.framebufferTexture2D(Ge.FRAMEBUFFER, Ge.COLOR_ATTACHMENT0, Ge.TEXTURE_CUBE_MAP_POSITIVE_X + e.activeCubeFace, o.__webglTexture, e.activeMipMapLevel)
          }
        }, this.readRenderTargetPixels = function(e, t, i, r, o, a) {
          if (e instanceof n.WebGLRenderTarget == !1) {
            return void(console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget."))
          };
          var s = qe["get"](e).__webglFramebuffer;
          if (s) {
            var h = !1;
            s !== we && (Ge.bindFramebuffer(Ge.FRAMEBUFFER, s), h = !0);
            try {
              var l = e.texture;
              if (l.format !== n.RGBAFormat && ee(l.format) !== Ge.getParameter(Ge.IMPLEMENTATION_COLOR_READ_FORMAT)) {
                return void(console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."))
              };
              if (!(l.type === n.UnsignedByteType || ee(l.type) === Ge.getParameter(Ge.IMPLEMENTATION_COLOR_READ_TYPE) || l.type === n.FloatType && We["get"]("WEBGL_color_buffer_float") || l.type === n.HalfFloatType && We["get"]("EXT_color_buffer_half_float"))) {
                return void(console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type."))
              };
              Ge.checkFramebufferStatus(Ge.FRAMEBUFFER) === Ge.FRAMEBUFFER_COMPLETE ? Ge.readPixels(t, i, r, o, ee(l.format), ee(l.type), a) : console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")
            } finally {
              h && Ge.bindFramebuffer(Ge.FRAMEBUFFER, we)
            }
          }
        }
      }, n.WebGLRenderTarget = function(e, t, i) {
        this.uuid = n.Math.generateUUID(), this.width = e, this.height = t, this.scissor = new n.Vector4(0, 0, e, t), this.scissorTest = !1, this.viewport = new n.Vector4(0, 0, e, t), i = i || {}, void(0) === i.minFilter && (i.minFilter = n.LinearFilter), this.texture = new n.Texture(void(0), void(0), i.wrapS, i.wrapT, i.magFilter, i.minFilter, i.format, i.type, i.anisotropy), this.depthBuffer = void(0) !== i.depthBuffer ? i.depthBuffer : !0, this.stencilBuffer = void(0) !== i.stencilBuffer ? i.stencilBuffer : !0
      }, n.WebGLRenderTarget.prototype = {
        constructor: n.WebGLRenderTarget,
        setSize: function(e, t) {
          (this.width !== e || this.height !== t) && (this.width = e, this.height = t, this.dispose()), this.viewport["set"](0, 0, e, t), this.scissor["set"](0, 0, e, t)
        },
        clone: function() {
          return (new this.constructor).copy(this)
        },
        copy: function(e) {
          return this.width = e.width, this.height = e.height, this.viewport.copy(e.viewport), this.texture = e.texture.clone(), this.depthBuffer = e.depthBuffer, this.stencilBuffer = e.stencilBuffer, this
        },
        dispose: function() {
          this.dispatchEvent({
            type: "dispose"
          })
        }
      }, n.EventDispatcher.prototype.apply(n.WebGLRenderTarget.prototype), n.WebGLRenderTargetCube = function(e, t, i) {
        n.WebGLRenderTarget.call(this, e, t, i), this.activeCubeFace = 0, this.activeMipMapLevel = 0
      }, n.WebGLRenderTargetCube.prototype = Object.create(n.WebGLRenderTarget.prototype), n.WebGLRenderTargetCube.prototype.constructor = n.WebGLRenderTargetCube, n.WebGLBufferRenderer = function(e, t, i) {
        function r(e) {
          s = e
        }

        function o(t, n) {
          e.drawArrays(s, t, n), i.calls++, i.vertices += n, s === e.TRIANGLES && (i.faces += n / 3)
        }

        function a(r) {
          var o = t["get"]("ANGLE_instanced_arrays");
          if (null === o) {
            return void(console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."))
          };
          var a = r.attributes.position,
            h = 0;
          a instanceof n.InterleavedBufferAttribute ? (h = a.data.count, o.drawArraysInstancedANGLE(s, 0, h, r.maxInstancedCount)) : (h = a.count, o.drawArraysInstancedANGLE(s, 0, h, r.maxInstancedCount)), i.calls++, i.vertices += h * r.maxInstancedCount, s === e.TRIANGLES && (i.faces += r.maxInstancedCount * h / 3)
        }
        var s;
        this.setMode = r, this.render = o, this.renderInstances = a
      }, n.WebGLIndexedBufferRenderer = function(e, t, i) {
        function n(e) {
          s = e
        }

        function r(i) {
          i.array instanceof Uint32Array && t["get"]("OES_element_index_uint") ? (h = e.UNSIGNED_INT, l = 4) : (h = e.UNSIGNED_SHORT, l = 2)
        }

        function o(t, n) {
          e.drawElements(s, n, h, t * l), i.calls++, i.vertices += n, s === e.TRIANGLES && (i.faces += n / 3)
        }

        function a(n, r, o) {
          var a = t["get"]("ANGLE_instanced_arrays");
          return null === a ? void(console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")) : (a.drawElementsInstancedANGLE(s, o, h, r * l, n.maxInstancedCount), i.calls++, i.vertices += o * n.maxInstancedCount, void((s === e.TRIANGLES && (i.faces += n.maxInstancedCount * o / 3))))
        }
        var s, h, l;
        this.setMode = n, this.setIndex = r, this.render = o, this.renderInstances = a
      }, n.WebGLExtensions = function(e) {
        var t = {};
        this["get"] = function(i) {
          if (void(0) !== t[i]) {
            return t[i]
          };
          var n;
          switch (i) {
            case "EXT_texture_filter_anisotropic":
              n = e.getExtension("EXT_texture_filter_anisotropic") || e.getExtension("MOZ_EXT_texture_filter_anisotropic") || e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");
              break;
            case "WEBGL_compressed_texture_s3tc":
              n = e.getExtension("WEBGL_compressed_texture_s3tc") || e.getExtension("MOZ_WEBGL_compressed_texture_s3tc") || e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");
              break;
            case "WEBGL_compressed_texture_pvrtc":
              n = e.getExtension("WEBGL_compressed_texture_pvrtc") || e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");
              break;
            case "WEBGL_compressed_texture_etc1":
              n = e.getExtension("WEBGL_compressed_texture_etc1");
              break;
            default:
              n = e.getExtension(i)
          };
          return null === n && console.warn("THREE.WebGLRenderer: " + i + " extension not supported."), t[i] = n, n
        }
      }, n.WebGLCapabilities = function(e, t, i) {
        function n(t) {
          if ("highp" === t) {
            if (e.getShaderPrecisionFormat(e.VERTEX_SHADER, e.HIGH_FLOAT).precision > 0 && e.getShaderPrecisionFormat(e.FRAGMENT_SHADER, e.HIGH_FLOAT).precision > 0) {
              return "highp"
            };
            t = "mediump"
          };
          return "mediump" === t && e.getShaderPrecisionFormat(e.VERTEX_SHADER, e.MEDIUM_FLOAT).precision > 0 && e.getShaderPrecisionFormat(e.FRAGMENT_SHADER, e.MEDIUM_FLOAT).precision > 0 ? "mediump" : "lowp"
        }
        this.getMaxPrecision = n, this.precision = void(0) !== i.precision ? i.precision : "highp", this.logarithmicDepthBuffer = void(0) !== i.logarithmicDepthBuffer ? i.logarithmicDepthBuffer : !1, this.maxTextures = e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS), this.maxVertexTextures = e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS), this.maxTextureSize = e.getParameter(e.MAX_TEXTURE_SIZE), this.maxCubemapSize = e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE), this.maxAttributes = e.getParameter(e.MAX_VERTEX_ATTRIBS), this.maxVertexUniforms = e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS), this.maxVaryings = e.getParameter(e.MAX_VARYING_VECTORS), this.maxFragmentUniforms = e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS), this.vertexTextures = this.maxVertexTextures > 0, this.floatFragmentTextures = !!t["get"]("OES_texture_float"), this.floatVertexTextures = this.vertexTextures && this.floatFragmentTextures;
        var r = n(this.precision);
        r !== this.precision && (console.warn("THREE.WebGLRenderer:", this.precision, "not supported, using", r, "instead."), this.precision = r), this.logarithmicDepthBuffer && (this.logarithmicDepthBuffer = !!t["get"]("EXT_frag_depth"))
      }, n.WebGLGeometries = function(e, t, i) {
        function r(e) {
          var t = e.geometry;
          if (void(0) !== c[t.id]) {
            return c[t.id]
          };
          t.addEventListener("dispose", o);
          var r;
          return t instanceof n.BufferGeometry ? r = t : t instanceof n.Geometry && (void(0) === t._bufferGeometry && (t._bufferGeometry = (new n.BufferGeometry).setFromObject(e)), r = t._bufferGeometry), c[t.id] = r, i.memory.geometries++, r
        }

        function o(e) {
          var n = e.target,
            r = c[n.id];
          null !== r.index && s(r.index), h(r.attributes), n.removeEventListener("dispose", o), delete c[n.id];
          var a = t["get"](n);
          a.wireframe && s(a.wireframe), t["delete"](n);
          var l = t["get"](r);
          l.wireframe && s(l.wireframe), t["delete"](r), i.memory.geometries--
        }

        function a(e) {
          return e instanceof n.InterleavedBufferAttribute ? t["get"](e.data).__webglBuffer : t["get"](e).__webglBuffer
        }

        function s(t) {
          var i = a(t);
          void(0) !== i && (e.deleteBuffer(i), l(t))
        }

        function h(e) {
          for (var t in e) {
            s(e[t])
          }
        }

        function l(e) {
          t["delete"](e instanceof n.InterleavedBufferAttribute ? e.data : e)
        }
        var c = {};
        this["get"] = r
      }, n.WebGLLights = function() {
        var e = {};
        this["get"] = function(t) {
          if (void(0) !== e[t.id]) {
            return e[t.id]
          };
          var i;
          switch (t.type) {
            case "DirectionalLight":
              i = {
                direction: new n.Vector3,
                color: new n.Color,
                shadow: !1,
                shadowBias: 0,
                shadowRadius: 1,
                shadowMapSize: new n.Vector2
              };
              break;
            case "SpotLight":
              i = {
                position: new n.Vector3,
                direction: new n.Vector3,
                color: new n.Color,
                distance: 0,
                coneCos: 0,
                penumbraCos: 0,
                decay: 0,
                shadow: !1,
                shadowBias: 0,
                shadowRadius: 1,
                shadowMapSize: new n.Vector2
              };
              break;
            case "PointLight":
              i = {
                position: new n.Vector3,
                color: new n.Color,
                distance: 0,
                decay: 0,
                shadow: !1,
                shadowBias: 0,
                shadowRadius: 1,
                shadowMapSize: new n.Vector2
              };
              break;
            case "HemisphereLight":
              i = {
                direction: new n.Vector3,
                skyColor: new n.Color,
                groundColor: new n.Color
              }
          };
          return e[t.id] = i, i
        }
      }, n.WebGLObjects = function(e, t, i) {
        function r(t) {
          var i = u["get"](t);
          t.geometry instanceof n.Geometry && i.updateFromObject(t);
          var r = i.index,
            a = i.attributes;
          null !== r && o(r, e.ELEMENT_ARRAY_BUFFER);
          for (var s in a) {
            o(a[s], e.ARRAY_BUFFER)
          };
          var h = i.morphAttributes;
          for (var s in h) {
            for (var l = h[s], c = 0, d = l.length; d > c; c++) {
              o(l[c], e.ARRAY_BUFFER)
            }
          };
          return i
        }

        function o(e, i) {
          var r = e instanceof n.InterleavedBufferAttribute ? e.data : e,
            o = t["get"](r);
          void(0) === o.__webglBuffer ? a(o, r, i) : o.version !== r.version && s(o, r, i)
        }

        function a(t, i, n) {
          t.__webglBuffer = e.createBuffer(), e.bindBuffer(n, t.__webglBuffer);
          var r = i.dynamic ? e.DYNAMIC_DRAW : e.STATIC_DRAW;
          e.bufferData(n, i.array, r), t.version = i.version
        }

        function s(t, i, n) {
          e.bindBuffer(n, t.__webglBuffer), i.dynamic === !1 || -1 === i.updateRange.count ? e.bufferSubData(n, 0, i.array) : 0 === i.updateRange.count ? console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually.") : (e.bufferSubData(n, i.updateRange.offset * i.array.BYTES_PER_ELEMENT, i.array.subarray(i.updateRange.offset, i.updateRange.offset + i.updateRange.count)), i.updateRange.count = 0), t.version = i.version
        }

        function h(e) {
          return e instanceof n.InterleavedBufferAttribute ? t["get"](e.data).__webglBuffer : t["get"](e).__webglBuffer
        }

        function l(i) {
          var r = t["get"](i);
          if (void(0) !== r.wireframe) {
            return r.wireframe
          };
          var a = [],
            s = i.index,
            h = i.attributes,
            l = h.position;
          if (null !== s) {
            for (var u = {}, d = s.array, p = 0, f = d.length; f > p; p += 3) {
              var m = d[p + 0],
                g = d[p + 1],
                v = d[p + 2];
              c(u, m, g) && a.push(m, g), c(u, g, v) && a.push(g, v), c(u, v, m) && a.push(v, m)
            }
          } else {
            for (var d = h.position.array, p = 0, f = d.length / 3 - 1; f > p; p += 3) {
              var m = p + 0,
                g = p + 1,
                v = p + 2;
              a.push(m, g, g, v, v, m)
            }
          };
          var y = l.count > 65535 ? Uint32Array : Uint16Array,
            b = new n.BufferAttribute(new y(a), 1);
          return o(b, e.ELEMENT_ARRAY_BUFFER), r.wireframe = b, b
        }

        function c(e, t, i) {
          if (t > i) {
            var n = t;
            t = i, i = n
          };
          var r = e[t];
          return void(0) === r ? (e[t] = [i], !0) : -1 === r.indexOf(i) ? (r.push(i), !0) : !1
        }
        var u = new n.WebGLGeometries(e, t, i);
        this.getAttributeBuffer = h, this.getWireframeAttribute = l, this.update = r
      }, n.WebGLProgram = function() {
        function e(e) {
          switch (e) {
            case n.LinearEncoding:
              return ["Linear", "( value )"];
            case n.sRGBEncoding:
              return ["sRGB", "( value )"];
            case n.RGBEEncoding:
              return ["RGBE", "( value )"];
            case n.RGBM7Encoding:
              return ["RGBM", "( value, 7.0 )"];
            case n.RGBM16Encoding:
              return ["RGBM", "( value, 16.0 )"];
            case n.RGBDEncoding:
              return ["RGBD", "( value, 256.0 )"];
            case n.GammaEncoding:
              return ["Gamma", "( value, float( GAMMA_FACTOR ) )"];
            default:
              throw new Error("unsupported encoding: " + e)
          }
        }

        function t(t, i) {
          var n = e(i);
          return "vec4 " + t + "( vec4 value ) { return " + n[0] + "ToLinear" + n[1] + "; }"
        }

        function i(t, i) {
          var n = e(i);
          return "vec4 " + t + "( vec4 value ) { return LinearTo" + n[0] + n[1] + "; }"
        }

        function r(e, t) {
          var i;
          switch (t) {
            case n.LinearToneMapping:
              i = "Linear";
              break;
            case n.ReinhardToneMapping:
              i = "Reinhard";
              break;
            case n.Uncharted2ToneMapping:
              i = "Uncharted2";
              break;
            case n.CineonToneMapping:
              i = "OptimizedCineon";
              break;
            default:
              throw new Error("unsupported toneMapping: " + t)
          };
          return "vec3 " + e + "( vec3 color ) { return " + i + "ToneMapping( color ); }"
        }

        function o(e, t, i) {
          e = e || {};
          var n = [e.derivatives || t.envMapCubeUV || t.bumpMap || t.normalMap || t.flatShading ? "#extension GL_OES_standard_derivatives : enable" : "", (e.fragDepth || t.logarithmicDepthBuffer) && i["get"]("EXT_frag_depth") ? "#extension GL_EXT_frag_depth : enable" : "", e.drawBuffers && i["get"]("WEBGL_draw_buffers") ? "#extension GL_EXT_draw_buffers : require" : "", (e.shaderTextureLOD || t.envMap) && i["get"]("EXT_shader_texture_lod") ? "#extension GL_EXT_shader_texture_lod : enable" : ""];
          return n.filter(l).join("\x0A")
        }

        function a(e) {
          var t = [];
          for (var i in e) {
            var n = e[i];
            n !== !1 && t.push("#define " + i + " " + n)
          };
          return t.join("\x0A")
        }

        function s(e, t, i) {
          for (var n = {}, r = e.getProgramParameter(t, e.ACTIVE_UNIFORMS), o = 0; r > o; o++) {
            var a = e.getActiveUniform(t, o),
              s = a.name,
              h = e.getUniformLocation(t, s),
              l = f.exec(s);
            if (l) {
              var c = l[1],
                u = l[2],
                d = n[c];
              d || (d = n[c] = {}), d[u] = h
            } else {
              if (l = m.exec(s)) {
                var p = l[1],
                  v = l[2],
                  y = l[3],
                  b = n[p];
                b || (b = n[p] = []);
                var w = b[v];
                w || (w = b[v] = {}), w[y] = h
              } else {
                if (l = g.exec(s)) {
                  var p = l[1];
                  n[p] = h
                } else {
                  n[s] = h
                }
              }
            }
          };
          return n
        }

        function h(e, t, i) {
          for (var n = {}, r = e.getProgramParameter(t, e.ACTIVE_ATTRIBUTES), o = 0; r > o; o++) {
            var a = e.getActiveAttrib(t, o),
              s = a.name;
            n[s] = e.getAttribLocation(t, s)
          };
          return n
        }

        function l(e) {
          return "" !== e
        }

        function c(e, t) {
          return e.replace(/NUM_DIR_LIGHTS/g, t.numDirLights).replace(/NUM_SPOT_LIGHTS/g, t.numSpotLights).replace(/NUM_POINT_LIGHTS/g, t.numPointLights).replace(/NUM_HEMI_LIGHTS/g, t.numHemiLights)
        }

        function u(e) {
          function t(e, t) {
            var i = n.ShaderChunk[t];
            if (void(0) === i) {
              throw new Error("Can not resolve #include <" + t + ">")
            };
            return u(i)
          }
          var i = /#include +<([\w\d.]+)>/g;
          return e.replace(i, t)
        }

        function d(e) {
          function t(e, t, i, n) {
            for (var r = "", o = parseInt(t); o < parseInt(i); o++) {
              r += n.replace(/\[ i \]/g, "[ " + o + " ]")
            };
            return r
          }
          var i = /for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;
          return e.replace(i, t)
        }
        var p = 0,
          f = /^([\w\d_]+)\.([\w\d_]+)$/,
          m = /^([\w\d_]+)\[(\d+)\]\.([\w\d_]+)$/,
          g = /^([\w\d_]+)\[0\]$/;
        return function(e, f, m, g) {
          var v = e.context,
            y = m.extensions,
            b = m.defines,
            w = m.__webglShader.vertexShader,
            _ = m.__webglShader.fragmentShader,
            x = "SHADOWMAP_TYPE_BASIC";
          g.shadowMapType === n.PCFShadowMap ? x = "SHADOWMAP_TYPE_PCF" : g.shadowMapType === n.PCFSoftShadowMap && (x = "SHADOWMAP_TYPE_PCF_SOFT");
          var M = "ENVMAP_TYPE_CUBE",
            E = "ENVMAP_MODE_REFLECTION",
            S = "ENVMAP_BLENDING_MULTIPLY";
          if (g.envMap) {
            switch (m.envMap.mapping) {
              case n.CubeReflectionMapping:
                ;
              case n.CubeRefractionMapping:
                M = "ENVMAP_TYPE_CUBE";
                break;
              case n.CubeUVReflectionMapping:
                ;
              case n.CubeUVRefractionMapping:
                M = "ENVMAP_TYPE_CUBE_UV";
                break;
              case n.EquirectangularReflectionMapping:
                ;
              case n.EquirectangularRefractionMapping:
                M = "ENVMAP_TYPE_EQUIREC";
                break;
              case n.SphericalReflectionMapping:
                M = "ENVMAP_TYPE_SPHERE"
            };
            switch (m.envMap.mapping) {
              case n.CubeRefractionMapping:
                ;
              case n.EquirectangularRefractionMapping:
                E = "ENVMAP_MODE_REFRACTION"
            };
            switch (m.combine) {
              case n.MultiplyOperation:
                S = "ENVMAP_BLENDING_MULTIPLY";
                break;
              case n.MixOperation:
                S = "ENVMAP_BLENDING_MIX";
                break;
              case n.AddOperation:
                S = "ENVMAP_BLENDING_ADD"
            }
          };
          var T, P, A = e.gammaFactor > 0 ? e.gammaFactor : 1,
            L = o(y, g, e.extensions),
            C = a(b),
            R = v.createProgram();
          m instanceof n.RawShaderMaterial ? (T = "", P = "") : (T = ["precision " + g.precision + " float;", "precision " + g.precision + " int;", "#define SHADER_NAME " + m.__webglShader.name, C, g.supportsVertexTextures ? "#define VERTEX_TEXTURES" : "", "#define GAMMA_FACTOR " + A, "#define MAX_BONES " + g.maxBones, g.map ? "#define USE_MAP" : "", g.envMap ? "#define USE_ENVMAP" : "", g.envMap ? "#define " + E : "", g.lightMap ? "#define USE_LIGHTMAP" : "", g.aoMap ? "#define USE_AOMAP" : "", g.emissiveMap ? "#define USE_EMISSIVEMAP" : "", g.bumpMap ? "#define USE_BUMPMAP" : "", g.normalMap ? "#define USE_NORMALMAP" : "", g.displacementMap && g.supportsVertexTextures ? "#define USE_DISPLACEMENTMAP" : "", g.specularMap ? "#define USE_SPECULARMAP" : "", g.roughnessMap ? "#define USE_ROUGHNESSMAP" : "", g.metalnessMap ? "#define USE_METALNESSMAP" : "", g.alphaMap ? "#define USE_ALPHAMAP" : "", g.vertexColors ? "#define USE_COLOR" : "", g.flatShading ? "#define FLAT_SHADED" : "", g.skinning ? "#define USE_SKINNING" : "", g.useVertexTexture ? "#define BONE_TEXTURE" : "", g.morphTargets ? "#define USE_MORPHTARGETS" : "", g.morphNormals && g.flatShading === !1 ? "#define USE_MORPHNORMALS" : "", g.doubleSided ? "#define DOUBLE_SIDED" : "", g.flipSided ? "#define FLIP_SIDED" : "", g.shadowMapEnabled ? "#define USE_SHADOWMAP" : "", g.shadowMapEnabled ? "#define " + x : "", g.pointLightShadows > 0 ? "#define POINT_LIGHT_SHADOWS" : "", g.sizeAttenuation ? "#define USE_SIZEATTENUATION" : "", g.logarithmicDepthBuffer ? "#define USE_LOGDEPTHBUF" : "", g.logarithmicDepthBuffer && e.extensions["get"]("EXT_frag_depth") ? "#define USE_LOGDEPTHBUF_EXT" : "", "uniform mat4 modelMatrix;", "uniform mat4 modelViewMatrix;", "uniform mat4 projectionMatrix;", "uniform mat4 viewMatrix;", "uniform mat3 normalMatrix;", "uniform vec3 cameraPosition;", "attribute vec3 position;", "attribute vec3 normal;", "attribute vec2 uv;", "#ifdef USE_COLOR", "\x09attribute vec3 color;", "#endif", "#ifdef USE_MORPHTARGETS", "\x09attribute vec3 morphTarget0;", "\x09attribute vec3 morphTarget1;", "\x09attribute vec3 morphTarget2;", "\x09attribute vec3 morphTarget3;", "\x09#ifdef USE_MORPHNORMALS", "\x09\x09attribute vec3 morphNormal0;", "\x09\x09attribute vec3 morphNormal1;", "\x09\x09attribute vec3 morphNormal2;", "\x09\x09attribute vec3 morphNormal3;", "\x09#else", "\x09\x09attribute vec3 morphTarget4;", "\x09\x09attribute vec3 morphTarget5;", "\x09\x09attribute vec3 morphTarget6;", "\x09\x09attribute vec3 morphTarget7;", "\x09#endif", "#endif", "#ifdef USE_SKINNING", "\x09attribute vec4 skinIndex;", "\x09attribute vec4 skinWeight;", "#endif", "\x0A"].filter(l).join("\x0A"), P = [L, "precision " + g.precision + " float;", "precision " + g.precision + " int;", "#define SHADER_NAME " + m.__webglShader.name, C, g.alphaTest ? "#define ALPHATEST " + g.alphaTest : "", "#define GAMMA_FACTOR " + A, g.useFog && g.fog ? "#define USE_FOG" : "", g.useFog && g.fogExp ? "#define FOG_EXP2" : "", g.map ? "#define USE_MAP" : "", g.envMap ? "#define USE_ENVMAP" : "", g.envMap ? "#define " + M : "", g.envMap ? "#define " + E : "", g.envMap ? "#define " + S : "", g.lightMap ? "#define USE_LIGHTMAP" : "", g.aoMap ? "#define USE_AOMAP" : "", g.emissiveMap ? "#define USE_EMISSIVEMAP" : "", g.bumpMap ? "#define USE_BUMPMAP" : "", g.normalMap ? "#define USE_NORMALMAP" : "", g.specularMap ? "#define USE_SPECULARMAP" : "", g.roughnessMap ? "#define USE_ROUGHNESSMAP" : "", g.metalnessMap ? "#define USE_METALNESSMAP" : "", g.alphaMap ? "#define USE_ALPHAMAP" : "", g.vertexColors ? "#define USE_COLOR" : "", g.flatShading ? "#define FLAT_SHADED" : "", g.doubleSided ? "#define DOUBLE_SIDED" : "", g.flipSided ? "#define FLIP_SIDED" : "", g.shadowMapEnabled ? "#define USE_SHADOWMAP" : "", g.shadowMapEnabled ? "#define " + x : "", g.pointLightShadows > 0 ? "#define POINT_LIGHT_SHADOWS" : "", g.premultipliedAlpha ? "#define PREMULTIPLIED_ALPHA" : "", g.physicallyCorrectLights ? "#define PHYSICALLY_CORRECT_LIGHTS" : "", g.logarithmicDepthBuffer ? "#define USE_LOGDEPTHBUF" : "", g.logarithmicDepthBuffer && e.extensions["get"]("EXT_frag_depth") ? "#define USE_LOGDEPTHBUF_EXT" : "", g.envMap && e.extensions["get"]("EXT_shader_texture_lod") ? "#define TEXTURE_LOD_EXT" : "", "uniform mat4 viewMatrix;", "uniform vec3 cameraPosition;", g.toneMapping !== n.NoToneMapping ? "#define TONE_MAPPING" : "", g.toneMapping !== n.NoToneMapping ? n.ShaderChunk.tonemapping_pars_fragment : "", g.toneMapping !== n.NoToneMapping ? r("toneMapping", g.toneMapping) : "", g.outputEncoding || g.mapEncoding || g.envMapEncoding || g.emissiveMapEncoding ? n.ShaderChunk.encodings_pars_fragment : "", g.mapEncoding ? t("mapTexelToLinear", g.mapEncoding) : "", g.envMapEncoding ? t("envMapTexelToLinear", g.envMapEncoding) : "", g.emissiveMapEncoding ? t("emissiveMapTexelToLinear", g.emissiveMapEncoding) : "", g.outputEncoding ? i("linearToOutputTexel", g.outputEncoding) : "", "\x0A"].filter(l).join("\x0A")), w = u(w, g), w = c(w, g), _ = u(_, g), _ = c(_, g), m instanceof n.ShaderMaterial == !1 && (w = d(w), _ = d(_));
          var I = T + w,
            D = P + _,
            O = n.WebGLShader(v, v.VERTEX_SHADER, I),
            k = n.WebGLShader(v, v.FRAGMENT_SHADER, D);
          v.attachShader(R, O), v.attachShader(R, k), void(0) !== m.index0AttributeName ? v.bindAttribLocation(R, 0, m.index0AttributeName) : g.morphTargets === !0 && v.bindAttribLocation(R, 0, "position"), v.linkProgram(R);
          var B = v.getProgramInfoLog(R),
            F = v.getShaderInfoLog(O),
            N = v.getShaderInfoLog(k),
            U = !0,
            V = !0;
          v.getProgramParameter(R, v.LINK_STATUS) === !1 ? (U = !1, console.error("THREE.WebGLProgram: shader error: ", v.getError(), "gl.VALIDATE_STATUS", v.getProgramParameter(R, v.VALIDATE_STATUS), "gl.getProgramInfoLog", B, F, N)) : "" !== B ? console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()", B) : ("" === F || "" === N) && (V = !1), V && (this.diagnostics = {
            runnable: U,
            material: m,
            programLog: B,
            vertexShader: {
              log: F,
              prefix: T
            },
            fragmentShader: {
              log: N,
              prefix: P
            }
          }), v.deleteShader(O), v.deleteShader(k);
          var z;
          this.getUniforms = function() {
            return void(0) === z && (z = s(v, R)), z
          };
          var G;
          return this.getAttributes = function() {
            return void(0) === G && (G = h(v, R)), G
          }, this.destroy = function() {
            v.deleteProgram(R), this.program = void(0)
          }, Object.defineProperties(this, {
            uniforms: {
              get: function() {
                return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."), this.getUniforms()
              }
            },
            attributes: {
              get: function() {
                return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."), this.getAttributes()
              }
            }
          }), this.id = p++, this.code = f, this.usedTimes = 1, this.program = R, this.vertexShader = O, this.fragmentShader = k, this
        }
      }(), n.WebGLPrograms = function(e, t) {
        function i(e) {
          if (t.floatVertexTextures && e && e.skeleton && e.skeleton.useVertexTexture) {
            return 1024
          };
          var i = t.maxVertexUniforms,
            r = Math.floor((i - 20) / 4),
            o = r;
          return void(0) !== e && e instanceof n.SkinnedMesh && (o = Math.min(e.skeleton.bones.length, o), o < e.skeleton.bones.length && console.warn("WebGLRenderer: too many bones - " + e.skeleton.bones.length + ", this GPU supports just " + o + " (try OpenGL instead of ANGLE)")), o
        }

        function r(e, t) {
          var i;
          return e ? e instanceof n.Texture ? i = e.encoding : e instanceof n.WebGLRenderTarget && (i = e.texture.encoding) : i = n.LinearEncoding, i === n.LinearEncoding && t && (i = n.GammaEncoding), i
        }
        var o = [],
          a = {
            MeshDepthMaterial: "depth",
            MeshNormalMaterial: "normal",
            MeshBasicMaterial: "basic",
            MeshLambertMaterial: "lambert",
            MeshPhongMaterial: "phong",
            MeshStandardMaterial: "standard",
            LineBasicMaterial: "basic",
            LineDashedMaterial: "dashed",
            PointsMaterial: "points"
          },
          s = ["precision", "supportsVertexTextures", "map", "mapEncoding", "envMap", "envMapMode", "envMapEncoding", "lightMap", "aoMap", "emissiveMap", "emissiveMapEncoding", "bumpMap", "normalMap", "displacementMap", "specularMap", "roughnessMap", "metalnessMap", "alphaMap", "combine", "vertexColors", "fog", "useFog", "fogExp", "flatShading", "sizeAttenuation", "logarithmicDepthBuffer", "skinning", "maxBones", "useVertexTexture", "morphTargets", "morphNormals", "maxMorphTargets", "maxMorphNormals", "premultipliedAlpha", "numDirLights", "numPointLights", "numSpotLights", "numHemiLights", "shadowMapEnabled", "pointLightShadows", "toneMapping", "physicallyCorrectLights", "shadowMapType", "alphaTest", "doubleSided", "flipSided"];
        this.getParameters = function(o, s, h, l) {
          var c = a[o.type],
            u = i(l),
            d = e.getPrecision();
          null !== o.precision && (d = t.getMaxPrecision(o.precision), d !== o.precision && console.warn("THREE.WebGLProgram.getParameters:", o.precision, "not supported, using", d, "instead."));
          var p = {
            shaderID: c,
            precision: d,
            supportsVertexTextures: t.vertexTextures,
            outputEncoding: r(e.getCurrentRenderTarget(), e.gammaOutput),
            map: !!o.map,
            mapEncoding: r(o.map, e.gammaInput),
            envMap: !!o.envMap,
            envMapMode: o.envMap && o.envMap.mapping,
            envMapEncoding: r(o.envMap, e.gammaInput),
            envMapCubeUV: !!o.envMap && (o.envMap.mapping === n.CubeUVReflectionMapping || o.envMap.mapping === n.CubeUVRefractionMapping),
            lightMap: !!o.lightMap,
            aoMap: !!o.aoMap,
            emissiveMap: !!o.emissiveMap,
            emissiveMapEncoding: r(o.emissiveMap, e.gammaInput),
            bumpMap: !!o.bumpMap,
            normalMap: !!o.normalMap,
            displacementMap: !!o.displacementMap,
            roughnessMap: !!o.roughnessMap,
            metalnessMap: !!o.metalnessMap,
            specularMap: !!o.specularMap,
            alphaMap: !!o.alphaMap,
            combine: o.combine,
            vertexColors: o.vertexColors,
            fog: h,
            useFog: o.fog,
            fogExp: h instanceof n.FogExp2,
            flatShading: o.shading === n.FlatShading,
            sizeAttenuation: o.sizeAttenuation,
            logarithmicDepthBuffer: t.logarithmicDepthBuffer,
            skinning: o.skinning,
            maxBones: u,
            useVertexTexture: t.floatVertexTextures && l && l.skeleton && l.skeleton.useVertexTexture,
            morphTargets: o.morphTargets,
            morphNormals: o.morphNormals,
            maxMorphTargets: e.maxMorphTargets,
            maxMorphNormals: e.maxMorphNormals,
            numDirLights: s.directional.length,
            numPointLights: s.point.length,
            numSpotLights: s.spot.length,
            numHemiLights: s.hemi.length,
            pointLightShadows: s.shadowsPointLight,
            shadowMapEnabled: e.shadowMap.enabled && l.receiveShadow && s.shadows.length > 0,
            shadowMapType: e.shadowMap.type,
            toneMapping: e.toneMapping,
            physicallyCorrectLights: e.physicallyCorrectLights,
            premultipliedAlpha: o.premultipliedAlpha,
            alphaTest: o.alphaTest,
            doubleSided: o.side === n.DoubleSide,
            flipSided: o.side === n.BackSide
          };
          return p
        }, this.getProgramCode = function(e, t) {
          var i = [];
          if (t.shaderID ? i.push(t.shaderID) : (i.push(e.fragmentShader), i.push(e.vertexShader)), void(0) !== e.defines) {
            for (var n in e.defines) {
              i.push(n), i.push(e.defines[n])
            }
          };
          for (var r = 0; r < s.length; r++) {
            var o = s[r];
            i.push(o), i.push(t[o])
          };
          return i.join()
        }, this.acquireProgram = function(t, i, r) {
          for (var a, s = 0, h = o.length; h > s; s++) {
            var l = o[s];
            if (l.code === r) {
              a = l, ++a.usedTimes;
              break
            }
          };
          return void(0) === a && (a = new n.WebGLProgram(e, r, t, i), o.push(a)), a
        }, this.releaseProgram = function(e) {
          if (0 === --e.usedTimes) {
            var t = o.indexOf(e);
            o[t] = o[o.length - 1], o.pop(), e.destroy()
          }
        }, this.programs = o
      }, n.WebGLProperties = function() {
        var e = {};
        this["get"] = function(t) {
          var i = t.uuid,
            n = e[i];
          return void(0) === n && (n = {}, e[i] = n), n
        }, this["delete"] = function(t) {
          delete e[t.uuid]
        }, this.clear = function() {
          e = {}
        }
      }, n.WebGLShader = function() {
        function e(e) {
          for (var t = e.split("\x0A"), i = 0; i < t.length; i++) {
            t[i] = i + 1 + ": " + t[i]
          };
          return t.join("\x0A")
        }
        return function(t, i, n) {
          var r = t.createShader(i);
          return t.shaderSource(r, n), t.compileShader(r), t.getShaderParameter(r, t.COMPILE_STATUS) === !1 && console.error("THREE.WebGLShader: Shader couldn't compile."), "" !== t.getShaderInfoLog(r) && console.warn("THREE.WebGLShader: gl.getShaderInfoLog()", i === t.VERTEX_SHADER ? "vertex" : "fragment", t.getShaderInfoLog(r), e(n)), r
        }
      }(), n.WebGLShadowMap = function(e, t, i) {
        function r(e, t, i, r) {
          var o = e.geometry,
            a = null,
            s = v,
            h = e.customDepthMaterial;
          if (i && (s = y, h = e.customDistanceMaterial), h) {
            a = h
          } else {
            var l = void(0) !== o.morphTargets && o.morphTargets.length > 0 && t.morphTargets,
              c = e instanceof n.SkinnedMesh && t.skinning,
              u = 0;
            l && (u |= f), c && (u |= m), a = s[u]
          };
          return a.visible = t.visible, a.wireframe = t.wireframe, a.wireframeLinewidth = t.wireframeLinewidth, i && void(0) !== a.uniforms.lightPos && a.uniforms.lightPos.value.copy(r), a
        }

        function o(e, t, i) {
          if (e.visible !== !1) {
            if (e.layers.test(t.layers) && (e instanceof n.Mesh || e instanceof n.Line || e instanceof n.Points) && e.castShadow && (e.frustumCulled === !1 || h.intersectsObject(e) === !0)) {
              var r = e.material;
              r.visible === !0 && (e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse, e.matrixWorld), p.push(e))
            };
            for (var a = e.children, s = 0, l = a.length; l > s; s++) {
              o(a[s], t, i)
            }
          }
        }
        for (var a = e.context, s = e.state, h = new n.Frustum, l = new n.Matrix4, c = new n.Vector2, u = new n.Vector3, d = new n.Vector3, p = [], f = 1, m = 2, g = (f | m) + 1, v = new Array(g), y = new Array(g), b = [new n.Vector3(1, 0, 0), new n.Vector3(-1, 0, 0), new n.Vector3(0, 0, 1), new n.Vector3(0, 0, -1), new n.Vector3(0, 1, 0), new n.Vector3(0, -1, 0)], w = [new n.Vector3(0, 1, 0), new n.Vector3(0, 1, 0), new n.Vector3(0, 1, 0), new n.Vector3(0, 1, 0), new n.Vector3(0, 0, 1), new n.Vector3(0, 0, -1)], _ = [new n.Vector4, new n.Vector4, new n.Vector4, new n.Vector4, new n.Vector4, new n.Vector4], x = n.ShaderLib.depthRGBA, M = n.UniformsUtils.clone(x.uniforms), E = n.ShaderLib.distanceRGBA, S = n.UniformsUtils.clone(E.uniforms), T = 0; T !== g; ++T) {
          var P = 0 !== (T & f),
            A = 0 !== (T & m),
            L = new n.ShaderMaterial({
              uniforms: M,
              vertexShader: x.vertexShader,
              fragmentShader: x.fragmentShader,
              morphTargets: P,
              skinning: A
            });
          v[T] = L;
          var C = new n.ShaderMaterial({
            defines: {
              USE_SHADOWMAP: ""
            },
            uniforms: S,
            vertexShader: E.vertexShader,
            fragmentShader: E.fragmentShader,
            morphTargets: P,
            skinning: A
          });
          y[T] = C
        };
        var R = this;
        this.enabled = !1, this.autoUpdate = !0, this.needsUpdate = !1, this.type = n.PCFShadowMap, this.cullFace = n.CullFaceFront, this.render = function(f, m) {
          var g, v, y = t.shadows;
          if (0 !== y.length && R.enabled !== !1 && (R.autoUpdate !== !1 || R.needsUpdate !== !1)) {
            s.clearColor(1, 1, 1, 1), s.disable(a.BLEND), s.enable(a.CULL_FACE), a.frontFace(a.CCW), a.cullFace(R.cullFace === n.CullFaceFront ? a.FRONT : a.BACK), s.setDepthTest(!0), s.setScissorTest(!1);
            for (var x = 0, M = y.length; M > x; x++) {
              var E = y[x],
                S = E.shadow,
                T = S.camera;
              if (c.copy(S.mapSize), E instanceof n.PointLight) {
                g = 6, v = !0;
                var P = c.x,
                  A = c.y;
                _[0]["set"](2 * P, A, P, A), _[1]["set"](0, A, P, A), _[2]["set"](3 * P, A, P, A), _[3]["set"](P, A, P, A), _[4]["set"](3 * P, 0, P, A), _[5]["set"](P, 0, P, A), c.x *= 4, c.y *= 2
              } else {
                g = 1, v = !1
              };
              if (null === S.map) {
                var L = {
                  minFilter: n.NearestFilter,
                  magFilter: n.NearestFilter,
                  format: n.RGBAFormat
                };
                S.map = new n.WebGLRenderTarget(c.x, c.y, L), E instanceof n.SpotLight && (T.aspect = c.x / c.y), T.updateProjectionMatrix()
              };
              var C = S.map,
                I = S.matrix;
              d.setFromMatrixPosition(E.matrixWorld), T.position.copy(d), e.setRenderTarget(C), e.clear();
              for (var D = 0; g > D; D++) {
                if (v) {
                  u.copy(T.position), u.add(b[D]), T.up.copy(w[D]), T.lookAt(u);
                  var O = _[D];
                  s.viewport(O)
                } else {
                  u.setFromMatrixPosition(E.target.matrixWorld), T.lookAt(u)
                };
                T.updateMatrixWorld(), T.matrixWorldInverse.getInverse(T.matrixWorld), I["set"](0.5, 0, 0, 0.5, 0, 0.5, 0, 0.5, 0, 0, 0.5, 0.5, 0, 0, 0, 1), I.multiply(T.projectionMatrix), I.multiply(T.matrixWorldInverse), l.multiplyMatrices(T.projectionMatrix, T.matrixWorldInverse), h.setFromMatrix(l), p.length = 0, o(f, m, T);
                for (var k = 0, B = p.length; B > k; k++) {
                  var F = p[k],
                    N = i.update(F),
                    U = F.material;
                  if (U instanceof n.MultiMaterial) {
                    for (var V = N.groups, z = U.materials, G = 0, j = V.length; j > G; G++) {
                      var H = V[G],
                        W = z[H.materialIndex];
                      if (W.visible === !0) {
                        var Y = r(F, W, v, d);
                        e.renderBufferDirect(T, null, N, Y, F, H)
                      }
                    }
                  } else {
                    var Y = r(F, U, v, d);
                    e.renderBufferDirect(T, null, N, Y, F, null)
                  }
                }
              }
            };
            var X = e.getClearColor(),
              q = e.getClearAlpha();
            e.setClearColor(X, q), s.enable(a.BLEND), R.cullFace === n.CullFaceFront && a.cullFace(a.BACK), R.needsUpdate = !1
          }
        }
      }, n.WebGLState = function(e, t, i) {
        var r = this,
          o = new n.Vector4,
          a = new Uint8Array(16),
          s = new Uint8Array(16),
          h = new Uint8Array(16),
          l = {},
          c = null,
          u = null,
          d = null,
          p = null,
          f = null,
          m = null,
          g = null,
          v = null,
          y = !1,
          b = null,
          w = null,
          _ = null,
          x = null,
          M = null,
          E = null,
          S = null,
          T = null,
          P = null,
          A = null,
          L = null,
          C = null,
          R = null,
          I = null,
          D = null,
          O = e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),
          k = void(0),
          B = {},
          F = new n.Vector4,
          N = null,
          U = null,
          V = new n.Vector4,
          z = new n.Vector4,
          G = e.createTexture();
        e.bindTexture(e.TEXTURE_2D, G), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MIN_FILTER, e.LINEAR), e.texImage2D(e.TEXTURE_2D, 0, e.RGB, 1, 1, 0, e.RGB, e.UNSIGNED_BYTE, new Uint8Array(3)), this.init = function() {
          this.clearColor(0, 0, 0, 1), this.clearDepth(1), this.clearStencil(0), this.enable(e.DEPTH_TEST), e.depthFunc(e.LEQUAL), e.frontFace(e.CCW), e.cullFace(e.BACK), this.enable(e.CULL_FACE), this.enable(e.BLEND), e.blendEquation(e.FUNC_ADD), e.blendFunc(e.SRC_ALPHA, e.ONE_MINUS_SRC_ALPHA)
        }, this.initAttributes = function() {
          for (var e = 0, t = a.length; t > e; e++) {
            a[e] = 0
          }
        }, this.enableAttribute = function(i) {
          if (a[i] = 1, 0 === s[i] && (e.enableVertexAttribArray(i), s[i] = 1), 0 !== h[i]) {
            var n = t["get"]("ANGLE_instanced_arrays");
            n.vertexAttribDivisorANGLE(i, 0), h[i] = 0
          }
        }, this.enableAttributeAndDivisor = function(t, i, n) {
          a[t] = 1, 0 === s[t] && (e.enableVertexAttribArray(t), s[t] = 1), h[t] !== i && (n.vertexAttribDivisorANGLE(t, i), h[t] = i)
        }, this.disableUnusedAttributes = function() {
          for (var t = 0, i = s.length; i > t; t++) {
            s[t] !== a[t] && (e.disableVertexAttribArray(t), s[t] = 0)
          }
        }, this.enable = function(t) {
          l[t] !== !0 && (e.enable(t), l[t] = !0)
        }, this.disable = function(t) {
          l[t] !== !1 && (e.disable(t), l[t] = !1)
        }, this.getCompressedTextureFormats = function() {
          if (null === c && (c = [], t["get"]("WEBGL_compressed_texture_pvrtc") || t["get"]("WEBGL_compressed_texture_s3tc") || t["get"]("WEBGL_compressed_texture_etc1"))) {
            for (var i = e.getParameter(e.COMPRESSED_TEXTURE_FORMATS), n = 0; n < i.length; n++) {
              c.push(i[n])
            }
          };
          return c
        }, this.setBlending = function(t, r, o, a, s, h, l, c) {
          t === n.NoBlending ? this.disable(e.BLEND) : this.enable(e.BLEND), (t !== u || c !== y) && (t === n.AdditiveBlending ? c ? (e.blendEquationSeparate(e.FUNC_ADD, e.FUNC_ADD), e.blendFuncSeparate(e.ONE, e.ONE, e.ONE, e.ONE)) : (e.blendEquation(e.FUNC_ADD), e.blendFunc(e.SRC_ALPHA, e.ONE)) : t === n.SubtractiveBlending ? c ? (e.blendEquationSeparate(e.FUNC_ADD, e.FUNC_ADD), e.blendFuncSeparate(e.ZERO, e.ZERO, e.ONE_MINUS_SRC_COLOR, e.ONE_MINUS_SRC_ALPHA)) : (e.blendEquation(e.FUNC_ADD), e.blendFunc(e.ZERO, e.ONE_MINUS_SRC_COLOR)) : t === n.MultiplyBlending ? c ? (e.blendEquationSeparate(e.FUNC_ADD, e.FUNC_ADD), e.blendFuncSeparate(e.ZERO, e.ZERO, e.SRC_COLOR, e.SRC_ALPHA)) : (e.blendEquation(e.FUNC_ADD), e.blendFunc(e.ZERO, e.SRC_COLOR)) : c ? (e.blendEquationSeparate(e.FUNC_ADD, e.FUNC_ADD), e.blendFuncSeparate(e.ONE, e.ONE_MINUS_SRC_ALPHA, e.ONE, e.ONE_MINUS_SRC_ALPHA)) : (e.blendEquationSeparate(e.FUNC_ADD, e.FUNC_ADD), e.blendFuncSeparate(e.SRC_ALPHA, e.ONE_MINUS_SRC_ALPHA, e.ONE, e.ONE_MINUS_SRC_ALPHA)), u = t, y = c), t === n.CustomBlending ? (s = s || r, h = h || o, l = l || a, (r !== d || s !== m) && (e.blendEquationSeparate(i(r), i(s)), d = r, m = s), (o !== p || a !== f || h !== g || l !== v) && (e.blendFuncSeparate(i(o), i(a), i(h), i(l)), p = o, f = a, g = h, v = l)) : (d = null, p = null, f = null, m = null, g = null, v = null)
        }, this.setDepthFunc = function(t) {
          if (b !== t) {
            if (t) {
              switch (t) {
                case n.NeverDepth:
                  e.depthFunc(e.NEVER);
                  break;
                case n.AlwaysDepth:
                  e.depthFunc(e.ALWAYS);
                  break;
                case n.LessDepth:
                  e.depthFunc(e.LESS);
                  break;
                case n.LessEqualDepth:
                  e.depthFunc(e.LEQUAL);
                  break;
                case n.EqualDepth:
                  e.depthFunc(e.EQUAL);
                  break;
                case n.GreaterEqualDepth:
                  e.depthFunc(e.GEQUAL);
                  break;
                case n.GreaterDepth:
                  e.depthFunc(e.GREATER);
                  break;
                case n.NotEqualDepth:
                  e.depthFunc(e.NOTEQUAL);
                  break;
                default:
                  e.depthFunc(e.LEQUAL)
              }
            } else {
              e.depthFunc(e.LEQUAL)
            };
            b = t
          }
        }, this.setDepthTest = function(t) {
          t ? this.enable(e.DEPTH_TEST) : this.disable(e.DEPTH_TEST)
        }, this.setDepthWrite = function(t) {
          w !== t && (e.depthMask(t), w = t)
        }, this.setColorWrite = function(t) {
          _ !== t && (e.colorMask(t, t, t, t), _ = t)
        }, this.setStencilFunc = function(t, i, n) {
          (M !== t || E !== i || S !== n) && (e.stencilFunc(t, i, n), M = t, E = i, S = n)
        }, this.setStencilOp = function(t, i, n) {
          (T !== t || P !== i || A !== n) && (e.stencilOp(t, i, n), T = t, P = i, A = n)
        }, this.setStencilTest = function(t) {
          t ? this.enable(e.STENCIL_TEST) : this.disable(e.STENCIL_TEST)
        }, this.setStencilWrite = function(t) {
          x !== t && (e.stencilMask(t), x = t)
        }, this.setFlipSided = function(t) {
          L !== t && (e.frontFace(t ? e.CW : e.CCW), L = t)
        }, this.setLineWidth = function(t) {
          t !== C && (e.lineWidth(t), C = t)
        }, this.setPolygonOffset = function(t, i, n) {
          t ? this.enable(e.POLYGON_OFFSET_FILL) : this.disable(e.POLYGON_OFFSET_FILL), !t || R === i && I === n || (e.polygonOffset(i, n), R = i, I = n)
        }, this.getScissorTest = function() {
          return D
        }, this.setScissorTest = function(t) {
          D = t, t ? this.enable(e.SCISSOR_TEST) : this.disable(e.SCISSOR_TEST)
        }, this.activeTexture = function(t) {
          void(0) === t && (t = e.TEXTURE0 + O - 1), k !== t && (e.activeTexture(t), k = t)
        }, this.bindTexture = function(t, i) {
          void(0) === k && r.activeTexture();
          var n = B[k];
          void(0) === n && (n = {
            type: void(0),
            texture: void(0)
          }, B[k] = n), (n.type !== t || n.texture !== i) && (e.bindTexture(t, i || G), n.type = t, n.texture = i)
        }, this.compressedTexImage2D = function() {
          try {
            e.compressedTexImage2D.apply(e, arguments)
          } catch (t) {
            console.error(t)
          }
        }, this.texImage2D = function() {
          try {
            e.texImage2D.apply(e, arguments)
          } catch (t) {
            console.error(t)
          }
        }, this.clearColor = function(t, i, n, r) {
          o["set"](t, i, n, r), F.equals(o) === !1 && (e.clearColor(t, i, n, r), F.copy(o))
        }, this.clearDepth = function(t) {
          N !== t && (e.clearDepth(t), N = t)
        }, this.clearStencil = function(t) {
          U !== t && (e.clearStencil(t), U = t)
        }, this.scissor = function(t) {
          V.equals(t) === !1 && (e.scissor(t.x, t.y, t.z, t.w), V.copy(t))
        }, this.viewport = function(t) {
          z.equals(t) === !1 && (e.viewport(t.x, t.y, t.z, t.w), z.copy(t))
        }, this.reset = function() {
          for (var t = 0; t < s.length; t++) {
            1 === s[t] && (e.disableVertexAttribArray(t), s[t] = 0)
          };
          l = {}, c = null, k = void(0), B = {}, u = null, _ = null, w = null, x = null, L = null
        }
      }, n.LensFlarePlugin = function(e, t) {
        function i() {
          var e = new Float32Array([-1, -1, 0, 0, 1, -1, 1, 0, 1, 1, 1, 1, -1, 1, 0, 1]),
            t = new Uint16Array([0, 1, 2, 0, 2, 3]);
          o = p.createBuffer(), a = p.createBuffer(), p.bindBuffer(p.ARRAY_BUFFER, o), p.bufferData(p.ARRAY_BUFFER, e, p.STATIC_DRAW), p.bindBuffer(p.ELEMENT_ARRAY_BUFFER, a), p.bufferData(p.ELEMENT_ARRAY_BUFFER, t, p.STATIC_DRAW), u = p.createTexture(), d = p.createTexture(), f.bindTexture(p.TEXTURE_2D, u), p.texImage2D(p.TEXTURE_2D, 0, p.RGB, 16, 16, 0, p.RGB, p.UNSIGNED_BYTE, null), p.texParameteri(p.TEXTURE_2D, p.TEXTURE_WRAP_S, p.CLAMP_TO_EDGE), p.texParameteri(p.TEXTURE_2D, p.TEXTURE_WRAP_T, p.CLAMP_TO_EDGE), p.texParameteri(p.TEXTURE_2D, p.TEXTURE_MAG_FILTER, p.NEAREST), p.texParameteri(p.TEXTURE_2D, p.TEXTURE_MIN_FILTER, p.NEAREST), f.bindTexture(p.TEXTURE_2D, d), p.texImage2D(p.TEXTURE_2D, 0, p.RGBA, 16, 16, 0, p.RGBA, p.UNSIGNED_BYTE, null), p.texParameteri(p.TEXTURE_2D, p.TEXTURE_WRAP_S, p.CLAMP_TO_EDGE), p.texParameteri(p.TEXTURE_2D, p.TEXTURE_WRAP_T, p.CLAMP_TO_EDGE), p.texParameteri(p.TEXTURE_2D, p.TEXTURE_MAG_FILTER, p.NEAREST), p.texParameteri(p.TEXTURE_2D, p.TEXTURE_MIN_FILTER, p.NEAREST), c = p.getParameter(p.MAX_VERTEX_TEXTURE_IMAGE_UNITS) > 0;
          var i;
          i = c ? {
            vertexShader: ["uniform lowp int renderType;", "uniform vec3 screenPosition;", "uniform vec2 scale;", "uniform float rotation;", "uniform sampler2D occlusionMap;", "attribute vec2 position;", "attribute vec2 uv;", "varying vec2 vUV;", "varying float vVisibility;", "void main() {", "vUV = uv;", "vec2 pos = position;", "if ( renderType == 2 ) {", "vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );", "visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );", "visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );", "visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );", "visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );", "visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );", "visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );", "visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );", "visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );", "vVisibility =        visibility.r / 9.0;", "vVisibility *= 1.0 - visibility.g / 9.0;", "vVisibility *=       visibility.b / 9.0;", "vVisibility *= 1.0 - visibility.a / 9.0;", "pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;", "pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;", "}", "gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );", "}"].join("\x0A"),
            fragmentShader: ["uniform lowp int renderType;", "uniform sampler2D map;", "uniform float opacity;", "uniform vec3 color;", "varying vec2 vUV;", "varying float vVisibility;", "void main() {", "if ( renderType == 0 ) {", "gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );", "} else if ( renderType == 1 ) {", "gl_FragColor = texture2D( map, vUV );", "} else {", "vec4 texture = texture2D( map, vUV );", "texture.a *= opacity * vVisibility;", "gl_FragColor = texture;", "gl_FragColor.rgb *= color;", "}", "}"].join("\x0A")
          } : {
            vertexShader: ["uniform lowp int renderType;", "uniform vec3 screenPosition;", "uniform vec2 scale;", "uniform float rotation;", "attribute vec2 position;", "attribute vec2 uv;", "varying vec2 vUV;", "void main() {", "vUV = uv;", "vec2 pos = position;", "if ( renderType == 2 ) {", "pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;", "pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;", "}", "gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );", "}"].join("\x0A"),
            fragmentShader: ["precision mediump float;", "uniform lowp int renderType;", "uniform sampler2D map;", "uniform sampler2D occlusionMap;", "uniform float opacity;", "uniform vec3 color;", "varying vec2 vUV;", "void main() {", "if ( renderType == 0 ) {", "gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );", "} else if ( renderType == 1 ) {", "gl_FragColor = texture2D( map, vUV );", "} else {", "float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;", "visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;", "visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;", "visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;", "visibility = ( 1.0 - visibility / 4.0 );", "vec4 texture = texture2D( map, vUV );", "texture.a *= opacity * visibility;", "gl_FragColor = texture;", "gl_FragColor.rgb *= color;", "}", "}"].join("\x0A")
          }, s = r(i), h = {
            vertex: p.getAttribLocation(s, "position"),
            uv: p.getAttribLocation(s, "uv")
          }, l = {
            renderType: p.getUniformLocation(s, "renderType"),
            map: p.getUniformLocation(s, "map"),
            occlusionMap: p.getUniformLocation(s, "occlusionMap"),
            opacity: p.getUniformLocation(s, "opacity"),
            color: p.getUniformLocation(s, "color"),
            scale: p.getUniformLocation(s, "scale"),
            rotation: p.getUniformLocation(s, "rotation"),
            screenPosition: p.getUniformLocation(s, "screenPosition")
          }
        }

        function r(t) {
          var i = p.createProgram(),
            n = p.createShader(p.FRAGMENT_SHADER),
            r = p.createShader(p.VERTEX_SHADER),
            o = "precision " + e.getPrecision() + " float;\x0A";
          return p.shaderSource(n, o + t.fragmentShader), p.shaderSource(r, o + t.vertexShader), p.compileShader(n), p.compileShader(r), p.attachShader(i, n), p.attachShader(i, r), p.linkProgram(i), i
        }
        var o, a, s, h, l, c, u, d, p = e.context,
          f = e.state;
        this.render = function(r, m, g) {
          if (0 !== t.length) {
            var v = new n.Vector3,
              y = g.w / g.z,
              b = 0.5 * g.z,
              w = 0.5 * g.w,
              _ = 16 / g.w,
              x = new n.Vector2(_ * y, _),
              M = new n.Vector3(1, 1, 0),
              E = new n.Vector2(1, 1);
            void(0) === s && i(), p.useProgram(s), f.initAttributes(), f.enableAttribute(h.vertex), f.enableAttribute(h.uv), f.disableUnusedAttributes(), p.uniform1i(l.occlusionMap, 0), p.uniform1i(l.map, 1), p.bindBuffer(p.ARRAY_BUFFER, o), p.vertexAttribPointer(h.vertex, 2, p.FLOAT, !1, 16, 0), p.vertexAttribPointer(h.uv, 2, p.FLOAT, !1, 16, 8), p.bindBuffer(p.ELEMENT_ARRAY_BUFFER, a), f.disable(p.CULL_FACE), f.setDepthWrite(!1);
            for (var S = 0, T = t.length; T > S; S++) {
              _ = 16 / g.w, x["set"](_ * y, _);
              var P = t[S];
              if (v["set"](P.matrixWorld.elements[12], P.matrixWorld.elements[13], P.matrixWorld.elements[14]), v.applyMatrix4(m.matrixWorldInverse), v.applyProjection(m.projectionMatrix), M.copy(v), E.x = M.x * b + b, E.y = M.y * w + w, c || E.x > 0 && E.x < g.z && E.y > 0 && E.y < g.w) {
                f.activeTexture(p.TEXTURE0), f.bindTexture(p.TEXTURE_2D, null), f.activeTexture(p.TEXTURE1), f.bindTexture(p.TEXTURE_2D, u), p.copyTexImage2D(p.TEXTURE_2D, 0, p.RGB, g.x + E.x - 8, g.y + E.y - 8, 16, 16, 0), p.uniform1i(l.renderType, 0), p.uniform2f(l.scale, x.x, x.y), p.uniform3f(l.screenPosition, M.x, M.y, M.z), f.disable(p.BLEND), f.enable(p.DEPTH_TEST), p.drawElements(p.TRIANGLES, 6, p.UNSIGNED_SHORT, 0), f.activeTexture(p.TEXTURE0), f.bindTexture(p.TEXTURE_2D, d), p.copyTexImage2D(p.TEXTURE_2D, 0, p.RGBA, g.x + E.x - 8, g.y + E.y - 8, 16, 16, 0), p.uniform1i(l.renderType, 1), f.disable(p.DEPTH_TEST), f.activeTexture(p.TEXTURE1), f.bindTexture(p.TEXTURE_2D, u), p.drawElements(p.TRIANGLES, 6, p.UNSIGNED_SHORT, 0), P.positionScreen.copy(M), P.customUpdateCallback ? P.customUpdateCallback(P) : P.updateLensFlares(), p.uniform1i(l.renderType, 2), f.enable(p.BLEND);
                for (var A = 0, L = P.lensFlares.length; L > A; A++) {
                  var C = P.lensFlares[A];
                  C.opacity > 0.001 && C.scale > 0.001 && (M.x = C.x, M.y = C.y, M.z = C.z, _ = C.size * C.scale / g.w, x.x = _ * y, x.y = _, p.uniform3f(l.screenPosition, M.x, M.y, M.z), p.uniform2f(l.scale, x.x, x.y), p.uniform1f(l.rotation, C.rotation), p.uniform1f(l.opacity, C.opacity), p.uniform3f(l.color, C.color.r, C.color.g, C.color.b), f.setBlending(C.blending, C.blendEquation, C.blendSrc, C.blendDst), e.setTexture(C.texture, 1), p.drawElements(p.TRIANGLES, 6, p.UNSIGNED_SHORT, 0))
                }
              }
            };
            f.enable(p.CULL_FACE), f.enable(p.DEPTH_TEST), f.setDepthWrite(!0), e.resetGLState()
          }
        }
      }, n.SpritePlugin = function(e, t) {
        function i() {
          var e = new Float32Array([-0.5, -0.5, 0, 0, 0.5, -0.5, 1, 0, 0.5, 0.5, 1, 1, -0.5, 0.5, 0, 1]),
            t = new Uint16Array([0, 1, 2, 0, 2, 3]);
          a = d.createBuffer(), s = d.createBuffer(), d.bindBuffer(d.ARRAY_BUFFER, a), d.bufferData(d.ARRAY_BUFFER, e, d.STATIC_DRAW), d.bindBuffer(d.ELEMENT_ARRAY_BUFFER, s), d.bufferData(d.ELEMENT_ARRAY_BUFFER, t, d.STATIC_DRAW), h = r(), l = {
            position: d.getAttribLocation(h, "position"),
            uv: d.getAttribLocation(h, "uv")
          }, c = {
            uvOffset: d.getUniformLocation(h, "uvOffset"),
            uvScale: d.getUniformLocation(h, "uvScale"),
            rotation: d.getUniformLocation(h, "rotation"),
            scale: d.getUniformLocation(h, "scale"),
            color: d.getUniformLocation(h, "color"),
            map: d.getUniformLocation(h, "map"),
            opacity: d.getUniformLocation(h, "opacity"),
            modelViewMatrix: d.getUniformLocation(h, "modelViewMatrix"),
            projectionMatrix: d.getUniformLocation(h, "projectionMatrix"),
            fogType: d.getUniformLocation(h, "fogType"),
            fogDensity: d.getUniformLocation(h, "fogDensity"),
            fogNear: d.getUniformLocation(h, "fogNear"),
            fogFar: d.getUniformLocation(h, "fogFar"),
            fogColor: d.getUniformLocation(h, "fogColor"),
            alphaTest: d.getUniformLocation(h, "alphaTest")
          };
          var i = document.createElement("canvas");
          i.width = 8, i.height = 8;
          var o = i.getContext("2d");
          o.fillStyle = "white", o.fillRect(0, 0, 8, 8), u = new n.Texture(i), u.needsUpdate = !0
        }

        function r() {
          var t = d.createProgram(),
            i = d.createShader(d.VERTEX_SHADER),
            n = d.createShader(d.FRAGMENT_SHADER);
          return d.shaderSource(i, ["precision " + e.getPrecision() + " float;", "uniform mat4 modelViewMatrix;", "uniform mat4 projectionMatrix;", "uniform float rotation;", "uniform vec2 scale;", "uniform vec2 uvOffset;", "uniform vec2 uvScale;", "attribute vec2 position;", "attribute vec2 uv;", "varying vec2 vUV;", "void main() {", "vUV = uvOffset + uv * uvScale;", "vec2 alignedPosition = position * scale;", "vec2 rotatedPosition;", "rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;", "rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;", "vec4 finalPosition;", "finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );", "finalPosition.xy += rotatedPosition;", "finalPosition = projectionMatrix * finalPosition;", "gl_Position = finalPosition;", "}"].join("\x0A")), d.shaderSource(n, ["precision " + e.getPrecision() + " float;", "uniform vec3 color;", "uniform sampler2D map;", "uniform float opacity;", "uniform int fogType;", "uniform vec3 fogColor;", "uniform float fogDensity;", "uniform float fogNear;", "uniform float fogFar;", "uniform float alphaTest;", "varying vec2 vUV;", "void main() {", "vec4 texture = texture2D( map, vUV );", "if ( texture.a < alphaTest ) discard;", "gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );", "if ( fogType > 0 ) {", "float depth = gl_FragCoord.z / gl_FragCoord.w;", "float fogFactor = 0.0;", "if ( fogType == 1 ) {", "fogFactor = smoothstep( fogNear, fogFar, depth );", "} else {", "const float LOG2 = 1.442695;", "fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );", "fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );", "}", "gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );", "}", "}"].join("\x0A")), d.compileShader(i), d.compileShader(n), d.attachShader(t, i), d.attachShader(t, n), d.linkProgram(t), t
        }

        function o(e, t) {
          return e.renderOrder !== t.renderOrder ? e.renderOrder - t.renderOrder : e.z !== t.z ? t.z - e.z : t.id - e.id
        }
        var a, s, h, l, c, u, d = e.context,
          p = e.state,
          f = new n.Vector3,
          m = new n.Quaternion,
          g = new n.Vector3;
        this.render = function(r, v) {
          if (0 !== t.length) {
            void(0) === h && i(), d.useProgram(h), p.initAttributes(), p.enableAttribute(l.position), p.enableAttribute(l.uv), p.disableUnusedAttributes(), p.disable(d.CULL_FACE), p.enable(d.BLEND), d.bindBuffer(d.ARRAY_BUFFER, a), d.vertexAttribPointer(l.position, 2, d.FLOAT, !1, 16, 0), d.vertexAttribPointer(l.uv, 2, d.FLOAT, !1, 16, 8), d.bindBuffer(d.ELEMENT_ARRAY_BUFFER, s), d.uniformMatrix4fv(c.projectionMatrix, !1, v.projectionMatrix.elements), p.activeTexture(d.TEXTURE0), d.uniform1i(c.map, 0);
            var y = 0,
              b = 0,
              w = r.fog;
            w ? (d.uniform3f(c.fogColor, w.color.r, w.color.g, w.color.b), w instanceof n.Fog ? (d.uniform1f(c.fogNear, w.near), d.uniform1f(c.fogFar, w.far), d.uniform1i(c.fogType, 1), y = 1, b = 1) : w instanceof n.FogExp2 && (d.uniform1f(c.fogDensity, w.density), d.uniform1i(c.fogType, 2), y = 2, b = 2)) : (d.uniform1i(c.fogType, 0), y = 0, b = 0);
            for (var _ = 0, x = t.length; x > _; _++) {
              var M = t[_];
              M.modelViewMatrix.multiplyMatrices(v.matrixWorldInverse, M.matrixWorld), M.z = -M.modelViewMatrix.elements[14]
            };
            t.sort(o);
            for (var E = [], _ = 0, x = t.length; x > _; _++) {
              var M = t[_],
                S = M.material;
              d.uniform1f(c.alphaTest, S.alphaTest), d.uniformMatrix4fv(c.modelViewMatrix, !1, M.modelViewMatrix.elements), M.matrixWorld.decompose(f, m, g), E[0] = g.x, E[1] = g.y;
              var T = 0;
              r.fog && S.fog && (T = b), y !== T && (d.uniform1i(c.fogType, T), y = T), null !== S.map ? (d.uniform2f(c.uvOffset, S.map.offset.x, S.map.offset.y), d.uniform2f(c.uvScale, S.map.repeat.x, S.map.repeat.y)) : (d.uniform2f(c.uvOffset, 0, 0), d.uniform2f(c.uvScale, 1, 1)), d.uniform1f(c.opacity, S.opacity), d.uniform3f(c.color, S.color.r, S.color.g, S.color.b), d.uniform1f(c.rotation, S.rotation), d.uniform2fv(c.scale, E), p.setBlending(S.blending, S.blendEquation, S.blendSrc, S.blendDst), p.setDepthTest(S.depthTest), p.setDepthWrite(S.depthWrite), S.map && S.map.image && S.map.image.width ? e.setTexture(S.map, 0) : e.setTexture(u, 0), d.drawElements(d.TRIANGLES, 6, d.UNSIGNED_SHORT, 0)
            };
            p.enable(d.CULL_FACE), e.resetGLState()
          }
        }
      }, Object.defineProperties(n.Box2.prototype, {
        empty: {
          value: function() {
            return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."), this.isEmpty()
          }
        },
        isIntersectionBox: {
          value: function(e) {
            return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."), this.intersectsBox(e)
          }
        }
      }), Object.defineProperties(n.Box3.prototype, {
        empty: {
          value: function() {
            return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."), this.isEmpty()
          }
        },
        isIntersectionBox: {
          value: function(e) {
            return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."), this.intersectsBox(e)
          }
        },
        isIntersectionSphere: {
          value: function(e) {
            return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."), this.intersectsSphere(e)
          }
        }
      }), Object.defineProperties(n.Matrix3.prototype, {
        multiplyVector3: {
          value: function(e) {
            return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."), e.applyMatrix3(this)
          }
        },
        multiplyVector3Array: {
          value: function(e) {
            return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."), this.applyToVector3Array(e)
          }
        }
      }), Object.defineProperties(n.Matrix4.prototype, {
        extractPosition: {
          value: function(e) {
            return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."), this.copyPosition(e)
          }
        },
        setRotationFromQuaternion: {
          value: function(e) {
            return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."), this.makeRotationFromQuaternion(e)
          }
        },
        multiplyVector3: {
          value: function(e) {
            return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."), e.applyProjection(this)
          }
        },
        multiplyVector4: {
          value: function(e) {
            return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."), e.applyMatrix4(this)
          }
        },
        multiplyVector3Array: {
          value: function(e) {
            return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."), this.applyToVector3Array(e)
          }
        },
        rotateAxis: {
          value: function(e) {
            console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."), e.transformDirection(this)
          }
        },
        crossVector: {
          value: function(e) {
            return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."), e.applyMatrix4(this)
          }
        },
        translate: {
          value: function(e) {
            console.error("THREE.Matrix4: .translate() has been removed.")
          }
        },
        rotateX: {
          value: function(e) {
            console.error("THREE.Matrix4: .rotateX() has been removed.")
          }
        },
        rotateY: {
          value: function(e) {
            console.error("THREE.Matrix4: .rotateY() has been removed.")
          }
        },
        rotateZ: {
          value: function(e) {
            console.error("THREE.Matrix4: .rotateZ() has been removed.")
          }
        },
        rotateByAxis: {
          value: function(e, t) {
            console.error("THREE.Matrix4: .rotateByAxis() has been removed.")
          }
        }
      }), Object.defineProperties(n.Plane.prototype, {
        isIntersectionLine: {
          value: function(e) {
            return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."), this.intersectsLine(e)
          }
        }
      }), Object.defineProperties(n.Quaternion.prototype, {
        multiplyVector3: {
          value: function(e) {
            return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."), e.applyQuaternion(this)
          }
        }
      }), Object.defineProperties(n.Ray.prototype, {
        isIntersectionBox: {
          value: function(e) {
            return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."), this.intersectsBox(e)
          }
        },
        isIntersectionPlane: {
          value: function(e) {
            return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."), this.intersectsPlane(e)
          }
        },
        isIntersectionSphere: {
          value: function(e) {
            return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."), this.intersectsSphere(e)
          }
        }
      }), Object.defineProperties(n.Vector3.prototype, {
        setEulerFromRotationMatrix: {
          value: function() {
            console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")
          }
        },
        setEulerFromQuaternion: {
          value: function() {
            console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")
          }
        },
        getPositionFromMatrix: {
          value: function(e) {
            return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."), this.setFromMatrixPosition(e)
          }
        },
        getScaleFromMatrix: {
          value: function(e) {
            return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."), this.setFromMatrixScale(e)
          }
        },
        getColumnFromMatrix: {
          value: function(e, t) {
            return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."), this.setFromMatrixColumn(e, t)
          }
        }
      }), n.Face4 = function(e, t, i, r, o, a, s) {
        return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."), new n.Face3(e, t, i, o, a, s)
      }, n.Vertex = function(e, t, i) {
        return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."), new n.Vector3(e, t, i)
      }, Object.defineProperties(n.Object3D.prototype, {
        eulerOrder: {
          get: function() {
            return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."), this.rotation.order
          },
          set: function(e) {
            console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."), this.rotation.order = e
          }
        },
        getChildByName: {
          value: function(e) {
            return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."), this.getObjectByName(e)
          }
        },
        renderDepth: {
          set: function(e) {
            console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")
          }
        },
        translate: {
          value: function(e, t) {
            return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."), this.translateOnAxis(t, e)
          }
        },
        useQuaternion: {
          get: function() {
            console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")
          },
          set: function(e) {
            console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")
          }
        }
      }), Object.defineProperties(n, {
        PointCloud: {
          value: function(e, t) {
            return console.warn("THREE.PointCloud has been renamed to THREE.Points."), new n.Points(e, t)
          }
        },
        ParticleSystem: {
          value: function(e, t) {
            return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."), new n.Points(e, t)
          }
        }
      }), Object.defineProperties(n.Light.prototype, {
        onlyShadow: {
          set: function(e) {
            console.warn("THREE.Light: .onlyShadow has been removed.")
          }
        },
        shadowCameraFov: {
          set: function(e) {
            console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."), this.shadow.camera.fov = e
          }
        },
        shadowCameraLeft: {
          set: function(e) {
            console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."), this.shadow.camera.left = e
          }
        },
        shadowCameraRight: {
          set: function(e) {
            console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."), this.shadow.camera.right = e
          }
        },
        shadowCameraTop: {
          set: function(e) {
            console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."), this.shadow.camera.top = e
          }
        },
        shadowCameraBottom: {
          set: function(e) {
            console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."), this.shadow.camera.bottom = e
          }
        },
        shadowCameraNear: {
          set: function(e) {
            console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."), this.shadow.camera.near = e
          }
        },
        shadowCameraFar: {
          set: function(e) {
            console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."), this.shadow.camera.far = e
          }
        },
        shadowCameraVisible: {
          set: function(e) {
            console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")
          }
        },
        shadowBias: {
          set: function(e) {
            console.warn("THREE.Light: .shadowBias is now .shadow.bias."), this.shadow.bias = e
          }
        },
        shadowDarkness: {
          set: function(e) {
            console.warn("THREE.Light: .shadowDarkness has been removed.")
          }
        },
        shadowMapWidth: {
          set: function(e) {
            console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."), this.shadow.mapSize.width = e
          }
        },
        shadowMapHeight: {
          set: function(e) {
            console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."), this.shadow.mapSize.height = e
          }
        }
      }), Object.defineProperties(n.BufferAttribute.prototype, {
        length: {
          get: function() {
            return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."), this.array.length
          }
        }
      }), Object.defineProperties(n.BufferGeometry.prototype, {
        drawcalls: {
          get: function() {
            return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."), this.groups
          }
        },
        offsets: {
          get: function() {
            return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."), this.groups
          }
        },
        addIndex: {
          value: function(e) {
            console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."), this.setIndex(e)
          }
        },
        addDrawCall: {
          value: function(e, t, i) {
            void(0) !== i && console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."), console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."), this.addGroup(e, t)
          }
        },
        clearDrawCalls: {
          value: function() {
            console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."), this.clearGroups()
          }
        },
        computeTangents: {
          value: function() {
            console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")
          }
        },
        computeOffsets: {
          value: function() {
            console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")
          }
        }
      }), Object.defineProperties(n.Material.prototype, {
        wrapAround: {
          get: function() {
            console.warn("THREE." + this.type + ": .wrapAround has been removed.")
          },
          set: function(e) {
            console.warn("THREE." + this.type + ": .wrapAround has been removed.")
          }
        },
        wrapRGB: {
          get: function() {
            return console.warn("THREE." + this.type + ": .wrapRGB has been removed."), new n.Color
          }
        }
      }), Object.defineProperties(n, {
        PointCloudMaterial: {
          value: function(e) {
            return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."), new n.PointsMaterial(e)
          }
        },
        ParticleBasicMaterial: {
          value: function(e) {
            return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."), new n.PointsMaterial(e)
          }
        },
        ParticleSystemMaterial: {
          value: function(e) {
            return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."), new n.PointsMaterial(e)
          }
        }
      }), Object.defineProperties(n.MeshPhongMaterial.prototype, {
        metal: {
          get: function() {
            return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."), !1
          },
          set: function(e) {
            console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")
          }
        }
      }), Object.defineProperties(n.ShaderMaterial.prototype, {
        derivatives: {
          get: function() {
            return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."), this.extensions.derivatives
          },
          set: function(e) {
            console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."), this.extensions.derivatives = e
          }
        }
      }), Object.defineProperties(n.WebGLRenderer.prototype, {
        supportsFloatTextures: {
          value: function() {
            return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."), this.extensions["get"]("OES_texture_float")
          }
        },
        supportsHalfFloatTextures: {
          value: function() {
            return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."), this.extensions["get"]("OES_texture_half_float")
          }
        },
        supportsStandardDerivatives: {
          value: function() {
            return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."), this.extensions["get"]("OES_standard_derivatives")
          }
        },
        supportsCompressedTextureS3TC: {
          value: function() {
            return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."), this.extensions["get"]("WEBGL_compressed_texture_s3tc")
          }
        },
        supportsCompressedTexturePVRTC: {
          value: function() {
            return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."), this.extensions["get"]("WEBGL_compressed_texture_pvrtc")
          }
        },
        supportsBlendMinMax: {
          value: function() {
            return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."), this.extensions["get"]("EXT_blend_minmax")
          }
        },
        supportsVertexTextures: {
          value: function() {
            return this.capabilities.vertexTextures
          }
        },
        supportsInstancedArrays: {
          value: function() {
            return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."), this.extensions["get"]("ANGLE_instanced_arrays")
          }
        },
        enableScissorTest: {
          value: function(e) {
            console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."), this.setScissorTest(e)
          }
        },
        initMaterial: {
          value: function() {
            console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")
          }
        },
        addPrePlugin: {
          value: function() {
            console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")
          }
        },
        addPostPlugin: {
          value: function() {
            console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")
          }
        },
        updateShadowMap: {
          value: function() {
            console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")
          }
        },
        shadowMapEnabled: {
          get: function() {
            return this.shadowMap.enabled
          },
          set: function(e) {
            console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."), this.shadowMap.enabled = e
          }
        },
        shadowMapType: {
          get: function() {
            return this.shadowMap.type
          },
          set: function(e) {
            console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."), this.shadowMap.type = e
          }
        },
        shadowMapCullFace: {
          get: function() {
            return this.shadowMap.cullFace
          },
          set: function(e) {
            console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."), this.shadowMap.cullFace = e
          }
        }
      }), Object.defineProperties(n.WebGLRenderTarget.prototype, {
        wrapS: {
          get: function() {
            return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."), this.texture.wrapS
          },
          set: function(e) {
            console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."), this.texture.wrapS = e
          }
        },
        wrapT: {
          get: function() {
            return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."), this.texture.wrapT
          },
          set: function(e) {
            console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."), this.texture.wrapT = e
          }
        },
        magFilter: {
          get: function() {
            return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."), this.texture.magFilter
          },
          set: function(e) {
            console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."), this.texture.magFilter = e
          }
        },
        minFilter: {
          get: function() {
            return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."), this.texture.minFilter
          },
          set: function(e) {
            console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."), this.texture.minFilter = e
          }
        },
        anisotropy: {
          get: function() {
            return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."), this.texture.anisotropy
          },
          set: function(e) {
            console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."), this.texture.anisotropy = e
          }
        },
        offset: {
          get: function() {
            return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."), this.texture.offset
          },
          set: function(e) {
            console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."), this.texture.offset = e
          }
        },
        repeat: {
          get: function() {
            return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."), this.texture.repeat
          },
          set: function(e) {
            console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."), this.texture.repeat = e
          }
        },
        format: {
          get: function() {
            return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."), this.texture.format
          },
          set: function(e) {
            console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."), this.texture.format = e
          }
        },
        type: {
          get: function() {
            return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."), this.texture.type
          },
          set: function(e) {
            console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."), this.texture.type = e
          }
        },
        generateMipmaps: {
          get: function() {
            return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."), this.texture.generateMipmaps
          },
          set: function(e) {
            console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."), this.texture.generateMipmaps = e
          }
        }
      }), n.GeometryUtils = {
        merge: function(e, t, i) {
          console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");
          var r;
          t instanceof n.Mesh && (t.matrixAutoUpdate && t.updateMatrix(), r = t.matrix, t = t.geometry), e.merge(t, r, i)
        },
        center: function(e) {
          return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."), e.center()
        }
      }, n.ImageUtils = {
        crossOrigin: void(0),
        loadTexture: function(e, t, i, r) {
          console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");
          var o = new n.TextureLoader;
          o.setCrossOrigin(this.crossOrigin);
          var a = o.load(e, i, void(0), r);
          return t && (a.mapping = t), a
        },
        loadTextureCube: function(e, t, i, r) {
          console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");
          var o = new n.CubeTextureLoader;
          o.setCrossOrigin(this.crossOrigin);
          var a = o.load(e, i, void(0), r);
          return t && (a.mapping = t), a
        },
        loadCompressedTexture: function() {
          console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")
        },
        loadCompressedTextureCube: function() {
          console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")
        }
      }, n.Projector = function() {
        console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."), this.projectVector = function(e, t) {
          console.warn("THREE.Projector: .projectVector() is now vector.project()."), e.project(t)
        }, this.unprojectVector = function(e, t) {
          console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."), e.unproject(t)
        }, this.pickingRay = function(e, t) {
          console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")
        }
      }, n.CanvasRenderer = function() {
        console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"), this.domElement = document.createElement("canvas"), this.clear = function() {}, this.render = function() {}, this.setClearColor = function() {}, this.setSize = function() {}
      }, n.MeshFaceMaterial = n.MultiMaterial, n.CurveUtils = {
        tangentQuadraticBezier: function(e, t, i, n) {
          return 2 * (1 - e) * (i - t) + 2 * e * (n - i)
        },
        tangentCubicBezier: function(e, t, i, n, r) {
          return -3 * t * (1 - e) * (1 - e) + 3 * i * (1 - e) * (1 - e) - 6 * e * i * (1 - e) + 6 * e * n * (1 - e) - 3 * e * e * n + 3 * e * e * r
        },
        tangentSpline: function(e, t, i, n, r) {
          var o = 6 * e * e - 6 * e,
            a = 3 * e * e - 4 * e + 1,
            s = -6 * e * e + 6 * e,
            h = 3 * e * e - 2 * e;
          return o + a + s + h
        },
        interpolate: function(e, t, i, n, r) {
          var o = 0.5 * (i - e),
            a = 0.5 * (n - t),
            s = r * r,
            h = r * s;
          return (2 * t - 2 * i + o + a) * h + (-3 * t + 3 * i - 2 * o - a) * s + o * r + t
        }
      }, n.SceneUtils = {
        createMultiMaterialObject: function(e, t) {
          for (var i = new n.Group, r = 0, o = t.length; o > r; r++) {
            i.add(new n.Mesh(e, t[r]))
          };
          return i
        },
        detach: function(e, t, i) {
          e.applyMatrix(t.matrixWorld), t.remove(e), i.add(e)
        },
        attach: function(e, t, i) {
          var r = new n.Matrix4;
          r.getInverse(i.matrixWorld), e.applyMatrix(r), t.remove(e), i.add(e)
        }
      }, n.ShapeUtils = {
        area: function(e) {
          for (var t = e.length, i = 0, n = t - 1, r = 0; t > r; n = r++) {
            i += e[n].x * e[r].y - e[r].x * e[n].y
          };
          return 0.5 * i
        },
        triangulate: function() {
          function e(e, t, i, n, r, o) {
            var a, s, h, l, c, u, d, p, f;
            if (s = e[o[t]].x, h = e[o[t]].y, l = e[o[i]].x, c = e[o[i]].y, u = e[o[n]].x, d = e[o[n]].y, Number.EPSILON > (l - s) * (d - h) - (c - h) * (u - s)) {
              return !1
            };
            var m, g, v, y, b, w, _, x, M, E, S, T, P, A, L;
            for (m = u - l, g = d - c, v = s - u, y = h - d, b = l - s, w = c - h, a = 0; r > a; a++) {
              if (p = e[o[a]].x, f = e[o[a]].y, !(p === s && f === h || p === l && f === c || p === u && f === d) && (_ = p - s, x = f - h, M = p - l, E = f - c, S = p - u, T = f - d, L = m * E - g * M, P = b * x - w * _, A = v * T - y * S, L >= -Number.EPSILON && A >= -Number.EPSILON && P >= -Number.EPSILON)) {
                return !1
              }
            };
            return !0
          }
          return function(t, i) {
            var r = t.length;
            if (3 > r) {
              return null
            };
            var o, a, s, h = [],
              l = [],
              c = [];
            if (n.ShapeUtils.area(t) > 0) {
              for (a = 0; r > a; a++) {
                l[a] = a
              }
            } else {
              for (a = 0; r > a; a++) {
                l[a] = r - 1 - a
              }
            };
            var u = r,
              d = 2 * u;
            for (a = u - 1; u > 2;) {
              if (d-- <= 0) {
                return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"), i ? c : h
              };
              if (o = a, o >= u && (o = 0), a = o + 1, a >= u && (a = 0), s = a + 1, s >= u && (s = 0), e(t, o, a, s, u, l)) {
                var p, f, m, g, v;
                for (p = l[o], f = l[a], m = l[s], h.push([t[p], t[f], t[m]]), c.push([l[o], l[a], l[s]]), g = a, v = a + 1; u > v; g++, v++) {
                  l[g] = l[v]
                };
                u--, d = 2 * u
              }
            };
            return i ? c : h
          }
        }(),
        triangulateShape: function(e, t) {
          function i(e, t, i) {
            return e.x !== t.x ? e.x < t.x ? e.x <= i.x && i.x <= t.x : t.x <= i.x && i.x <= e.x : e.y < t.y ? e.y <= i.y && i.y <= t.y : t.y <= i.y && i.y <= e.y
          }

          function r(e, t, n, r, o) {
            var a = t.x - e.x,
              s = t.y - e.y,
              h = r.x - n.x,
              l = r.y - n.y,
              c = e.x - n.x,
              u = e.y - n.y,
              d = s * h - a * l,
              p = s * c - a * u;
            if (Math.abs(d) > Number.EPSILON) {
              var f;
              if (d > 0) {
                if (0 > p || p > d) {
                  return []
                };
                if (f = l * c - h * u, 0 > f || f > d) {
                  return []
                }
              } else {
                if (p > 0 || d > p) {
                  return []
                };
                if (f = l * c - h * u, f > 0 || d > f) {
                  return []
                }
              };
              if (0 === f) {
                return !o || 0 !== p && p !== d ? [e] : []
              };
              if (f === d) {
                return !o || 0 !== p && p !== d ? [t] : []
              };
              if (0 === p) {
                return [n]
              };
              if (p === d) {
                return [r]
              };
              var m = f / d;
              return [{
                x: e.x + m * a,
                y: e.y + m * s
              }]
            };
            if (0 !== p || l * c !== h * u) {
              return []
            };
            var g = 0 === a && 0 === s,
              v = 0 === h && 0 === l;
            if (g && v) {
              return e.x !== n.x || e.y !== n.y ? [] : [e]
            };
            if (g) {
              return i(n, r, e) ? [e] : []
            };
            if (v) {
              return i(e, t, n) ? [n] : []
            };
            var y, b, w, _, x, M, E, S;
            return 0 !== a ? (e.x < t.x ? (y = e, w = e.x, b = t, _ = t.x) : (y = t, w = t.x, b = e, _ = e.x), n.x < r.x ? (x = n, E = n.x, M = r, S = r.x) : (x = r, E = r.x, M = n, S = n.x)) : (e.y < t.y ? (y = e, w = e.y, b = t, _ = t.y) : (y = t, w = t.y, b = e, _ = e.y), n.y < r.y ? (x = n, E = n.y, M = r, S = r.y) : (x = r, E = r.y, M = n, S = n.y)), E >= w ? E > _ ? [] : _ === E ? o ? [] : [x] : S >= _ ? [x, b] : [x, M] : w > S ? [] : w === S ? o ? [] : [y] : S >= _ ? [y, b] : [y, M]
          }

          function o(e, t, i, n) {
            var r = t.x - e.x,
              o = t.y - e.y,
              a = i.x - e.x,
              s = i.y - e.y,
              h = n.x - e.x,
              l = n.y - e.y,
              c = r * s - o * a,
              u = r * l - o * h;
            if (Math.abs(c) > Number.EPSILON) {
              var d = h * s - l * a;
              return c > 0 ? u >= 0 && d >= 0 : u >= 0 || d >= 0
            };
            return u > 0
          }

          function a(e, t) {
            function i(e, t) {
              var i = y.length - 1,
                n = e - 1;
              0 > n && (n = i);
              var r = e + 1;
              r > i && (r = 0);
              var a = o(y[e], y[n], y[r], s[t]);
              if (!a) {
                return !1
              };
              var h = s.length - 1,
                l = t - 1;
              0 > l && (l = h);
              var c = t + 1;
              return c > h && (c = 0), a = o(s[t], s[l], s[c], y[e]), a ? !0 : !1
            }

            function n(e, t) {
              var i, n, o;
              for (i = 0; i < y.length; i++) {
                if (n = i + 1, n %= y.length, o = r(e, t, y[i], y[n], !0), o.length > 0) {
                  return !0
                }
              };
              return !1
            }

            function a(e, i) {
              var n, o, a, s, h;
              for (n = 0; n < b.length; n++) {
                for (o = t[b[n]], a = 0; a < o.length; a++) {
                  if (s = a + 1, s %= o.length, h = r(e, i, o[a], o[s], !0), h.length > 0) {
                    return !0
                  }
                }
              };
              return !1
            }
            for (var s, h, l, c, u, d, p, f, m, g, v, y = e.concat(), b = [], w = [], _ = 0, x = t.length; x > _; _++) {
              b.push(_)
            };
            for (var M = 0, E = 2 * b.length; b.length > 0;) {
              if (E--, 0 > E) {
                console.log("Infinite Loop! Holes left:" + b.length + ", Probably Hole outside Shape!");
                break
              };
              for (l = M; l < y.length; l++) {
                c = y[l], h = -1;
                for (var _ = 0; _ < b.length; _++) {
                  if (d = b[_], p = c.x + ":" + c.y + ":" + d, void(0) === w[p]) {
                    s = t[d];
                    for (var S = 0; S < s.length; S++) {
                      if (u = s[S], i(l, S) && !n(c, u) && !a(c, u)) {
                        h = S, b.splice(_, 1), f = y.slice(0, l + 1), m = y.slice(l), g = s.slice(h), v = s.slice(0, h + 1), y = f.concat(g).concat(v).concat(m), M = l;
                        break
                      }
                    };
                    if (h >= 0) {
                      break
                    };
                    w[p] = !0
                  }
                };
                if (h >= 0) {
                  break
                }
              }
            };
            return y
          }
          for (var s, h, l, c, u, d, p = {}, f = e.concat(), m = 0, g = t.length; g > m; m++) {
            Array.prototype.push.apply(f, t[m])
          };
          for (s = 0, h = f.length; h > s; s++) {
            u = f[s].x + ":" + f[s].y, void(0) !== p[u] && console.warn("THREE.Shape: Duplicate point", u), p[u] = s
          };
          var v = a(e, t),
            y = n.ShapeUtils.triangulate(v, !1);
          for (s = 0, h = y.length; h > s; s++) {
            for (c = y[s], l = 0; 3 > l; l++) {
              u = c[l].x + ":" + c[l].y, d = p[u], void(0) !== d && (c[l] = d)
            }
          };
          return y.concat()
        },
        isClockWise: function(e) {
          return n.ShapeUtils.area(e) < 0
        },
        b2: function() {
          function e(e, t) {
            var i = 1 - e;
            return i * i * t
          }

          function t(e, t) {
            return 2 * (1 - e) * e * t
          }

          function i(e, t) {
            return e * e * t
          }
          return function(n, r, o, a) {
            return e(n, r) + t(n, o) + i(n, a)
          }
        }(),
        b3: function() {
          function e(e, t) {
            var i = 1 - e;
            return i * i * i * t
          }

          function t(e, t) {
            var i = 1 - e;
            return 3 * i * i * e * t
          }

          function i(e, t) {
            var i = 1 - e;
            return 3 * i * e * e * t
          }

          function n(e, t) {
            return e * e * e * t
          }
          return function(r, o, a, s, h) {
            return e(r, o) + t(r, a) + i(r, s) + n(r, h)
          }
        }()
      }, n.Curve = function() {}, n.Curve.prototype = {
        constructor: n.Curve,
        getPoint: function(e) {
          return console.warn("THREE.Curve: Warning, getPoint() not implemented!"), null
        },
        getPointAt: function(e) {
          var t = this.getUtoTmapping(e);
          return this.getPoint(t)
        },
        getPoints: function(e) {
          e || (e = 5);
          var t, i = [];
          for (t = 0; e >= t; t++) {
            i.push(this.getPoint(t / e))
          };
          return i
        },
        getSpacedPoints: function(e) {
          e || (e = 5);
          var t, i = [];
          for (t = 0; e >= t; t++) {
            i.push(this.getPointAt(t / e))
          };
          return i
        },
        getLength: function() {
          var e = this.getLengths();
          return e[e.length - 1]
        },
        getLengths: function(e) {
          if (e || (e = this.__arcLengthDivisions ? this.__arcLengthDivisions : 200), this.cacheArcLengths && this.cacheArcLengths.length === e + 1 && !this.needsUpdate) {
            return this.cacheArcLengths
          };
          this.needsUpdate = !1;
          var t, i, n = [],
            r = this.getPoint(0),
            o = 0;
          for (n.push(0), i = 1; e >= i; i++) {
            t = this.getPoint(i / e), o += t.distanceTo(r), n.push(o), r = t
          };
          return this.cacheArcLengths = n, n
        },
        updateArcLengths: function() {
          this.needsUpdate = !0, this.getLengths()
        },
        getUtoTmapping: function(e, t) {
          var i, n = this.getLengths(),
            r = 0,
            o = n.length;
          i = t ? t : e * n[o - 1];
          for (var a, s = 0, h = o - 1; h >= s;) {
            if (r = Math.floor(s + (h - s) / 2), a = n[r] - i, 0 > a) {
              s = r + 1
            } else {
              if (!(a > 0)) {
                h = r;
                break
              };
              h = r - 1
            }
          };
          if (r = h, n[r] === i) {
            var l = r / (o - 1);
            return l
          };
          var c = n[r],
            u = n[r + 1],
            d = u - c,
            p = (i - c) / d,
            l = (r + p) / (o - 1);
          return l
        },
        getTangent: function(e) {
          var t = 1e-4,
            i = e - t,
            n = e + t;
          0 > i && (i = 0), n > 1 && (n = 1);
          var r = this.getPoint(i),
            o = this.getPoint(n),
            a = o.clone().sub(r);
          return a.normalize()
        },
        getTangentAt: function(e) {
          var t = this.getUtoTmapping(e);
          return this.getTangent(t)
        }
      }, n.Curve.create = function(e, t) {
        return e.prototype = Object.create(n.Curve.prototype), e.prototype.constructor = e, e.prototype.getPoint = t, e
      }, n.CurvePath = function() {
        this.curves = [], this.autoClose = !1
      }, n.CurvePath.prototype = Object.create(n.Curve.prototype), n.CurvePath.prototype.constructor = n.CurvePath, n.CurvePath.prototype.add = function(e) {
        this.curves.push(e)
      }, n.CurvePath.prototype.closePath = function() {
        var e = this.curves[0].getPoint(0),
          t = this.curves[this.curves.length - 1].getPoint(1);
        e.equals(t) || this.curves.push(new n.LineCurve(t, e))
      }, n.CurvePath.prototype.getPoint = function(e) {
        for (var t = e * this.getLength(), i = this.getCurveLengths(), n = 0; n < i.length;) {
          if (i[n] >= t) {
            var r = i[n] - t,
              o = this.curves[n],
              a = 1 - r / o.getLength();
            return o.getPointAt(a)
          };
          n++
        };
        return null
      }, n.CurvePath.prototype.getLength = function() {
        var e = this.getCurveLengths();
        return e[e.length - 1]
      }, n.CurvePath.prototype.getCurveLengths = function() {
        if (this.cacheLengths && this.cacheLengths.length === this.curves.length) {
          return this.cacheLengths
        };
        for (var e = [], t = 0, i = 0, n = this.curves.length; n > i; i++) {
          t += this.curves[i].getLength(), e.push(t)
        };
        return this.cacheLengths = e, e
      }, n.CurvePath.prototype.createPointsGeometry = function(e) {
        var t = this.getPoints(e);
        return this.createGeometry(t)
      }, n.CurvePath.prototype.createSpacedPointsGeometry = function(e) {
        var t = this.getSpacedPoints(e);
        return this.createGeometry(t)
      }, n.CurvePath.prototype.createGeometry = function(e) {
        for (var t = new n.Geometry, i = 0, r = e.length; r > i; i++) {
          var o = e[i];
          t.vertices.push(new n.Vector3(o.x, o.y, o.z || 0))
        };
        return t
      }, n.Font = function(e) {
        this.data = e
      }, n.Font.prototype = {
        constructor: n.Font,
        generateShapes: function(e, t, i) {
          function r(e) {
            for (var i = String(e).split(""), n = t / a.resolution, r = 0, s = [], h = 0; h < i.length; h++) {
              var l = o(i[h], n, r);
              r += l.offset, s.push(l.path)
            };
            return s
          }

          function o(e, t, r) {
            var o = a.glyphs[e] || a.glyphs["?"];
            if (o) {
              var s, h, l, c, u, d, p, f, m, g, v, y = new n.Path,
                b = [],
                w = n.ShapeUtils.b2,
                _ = n.ShapeUtils.b3;
              if (o.o) {
                for (var x = o._cachedOutline || (o._cachedOutline = o.o.split(" ")), M = 0, E = x.length; E > M;) {
                  var S = x[M++];
                  switch (S) {
                    case "m":
                      s = x[M++] * t + r, h = x[M++] * t, y.moveTo(s, h);
                      break;
                    case "l":
                      s = x[M++] * t + r, h = x[M++] * t, y.lineTo(s, h);
                      break;
                    case "q":
                      if (l = x[M++] * t + r, c = x[M++] * t, p = x[M++] * t + r, f = x[M++] * t, y.quadraticCurveTo(p, f, l, c), v = b[b.length - 1]) {
                        u = v.x, d = v.y;
                        for (var T = 1; i >= T; T++) {
                          var P = T / i;
                          w(P, u, p, l), w(P, d, f, c)
                        }
                      };
                      break;
                    case "b":
                      if (l = x[M++] * t + r, c = x[M++] * t, p = x[M++] * t + r, f = x[M++] * t, m = x[M++] * t + r, g = x[M++] * t, y.bezierCurveTo(p, f, m, g, l, c), v = b[b.length - 1]) {
                        u = v.x, d = v.y;
                        for (var T = 1; i >= T; T++) {
                          var P = T / i;
                          _(P, u, p, m, l), _(P, d, f, g, c)
                        }
                      }
                  }
                }
              };
              return {
                offset: o.ha * t,
                path: y
              }
            }
          }
          void(0) === t && (t = 100), void(0) === i && (i = 4);
          for (var a = this.data, s = r(e), h = [], l = 0, c = s.length; c > l; l++) {
            Array.prototype.push.apply(h, s[l].toShapes())
          };
          return h
        }
      }, n.Path = function(e) {
        n.CurvePath.call(this), this.actions = [], e && this.fromPoints(e)
      }, n.Path.prototype = Object.create(n.CurvePath.prototype), n.Path.prototype.constructor = n.Path, n.Path.prototype.fromPoints = function(e) {
        this.moveTo(e[0].x, e[0].y);
        for (var t = 1, i = e.length; i > t; t++) {
          this.lineTo(e[t].x, e[t].y)
        }
      }, n.Path.prototype.moveTo = function(e, t) {
        this.actions.push({
          action: "moveTo",
          args: [e, t]
        })
      }, n.Path.prototype.lineTo = function(e, t) {
        var i = this.actions[this.actions.length - 1].args,
          r = i[i.length - 2],
          o = i[i.length - 1],
          a = new n.LineCurve(new n.Vector2(r, o), new n.Vector2(e, t));
        this.curves.push(a), this.actions.push({
          action: "lineTo",
          args: [e, t]
        })
      }, n.Path.prototype.quadraticCurveTo = function(e, t, i, r) {
        var o = this.actions[this.actions.length - 1].args,
          a = o[o.length - 2],
          s = o[o.length - 1],
          h = new n.QuadraticBezierCurve(new n.Vector2(a, s), new n.Vector2(e, t), new n.Vector2(i, r));
        this.curves.push(h), this.actions.push({
          action: "quadraticCurveTo",
          args: [e, t, i, r]
        })
      }, n.Path.prototype.bezierCurveTo = function(e, t, i, r, o, a) {
        var s = this.actions[this.actions.length - 1].args,
          h = s[s.length - 2],
          l = s[s.length - 1],
          c = new n.CubicBezierCurve(new n.Vector2(h, l), new n.Vector2(e, t), new n.Vector2(i, r), new n.Vector2(o, a));
        this.curves.push(c), this.actions.push({
          action: "bezierCurveTo",
          args: [e, t, i, r, o, a]
        })
      }, n.Path.prototype.splineThru = function(e) {
        var t = Array.prototype.slice.call(arguments),
          i = this.actions[this.actions.length - 1].args,
          r = i[i.length - 2],
          o = i[i.length - 1],
          a = [new n.Vector2(r, o)];
        Array.prototype.push.apply(a, e);
        var s = new n.SplineCurve(a);
        this.curves.push(s), this.actions.push({
          action: "splineThru",
          args: t
        })
      }, n.Path.prototype.arc = function(e, t, i, n, r, o) {
        var a = this.actions[this.actions.length - 1].args,
          s = a[a.length - 2],
          h = a[a.length - 1];
        this.absarc(e + s, t + h, i, n, r, o)
      }, n.Path.prototype.absarc = function(e, t, i, n, r, o) {
        this.absellipse(e, t, i, i, n, r, o)
      }, n.Path.prototype.ellipse = function(e, t, i, n, r, o, a, s) {
        var h = this.actions[this.actions.length - 1].args,
          l = h[h.length - 2],
          c = h[h.length - 1];
        this.absellipse(e + l, t + c, i, n, r, o, a, s)
      }, n.Path.prototype.absellipse = function(e, t, i, r, o, a, s, h) {
        var l = [e, t, i, r, o, a, s, h || 0],
          c = new n.EllipseCurve(e, t, i, r, o, a, s, h);
        this.curves.push(c);
        var u = c.getPoint(1);
        l.push(u.x), l.push(u.y), this.actions.push({
          action: "ellipse",
          args: l
        })
      }, n.Path.prototype.getSpacedPoints = function(e) {
        e || (e = 40);
        for (var t = [], i = 0; e > i; i++) {
          t.push(this.getPoint(i / e))
        };
        return this.autoClose && t.push(t[0]), t
      }, n.Path.prototype.getPoints = function(e) {
        e = e || 12;
        for (var t, i, r, o, a, s, h, l, c, u, d, p = n.ShapeUtils.b2, f = n.ShapeUtils.b3, m = [], g = 0, v = this.actions.length; v > g; g++) {
          var y = this.actions[g],
            b = y.action,
            w = y.args;
          switch (b) {
            case "moveTo":
              m.push(new n.Vector2(w[0], w[1]));
              break;
            case "lineTo":
              m.push(new n.Vector2(w[0], w[1]));
              break;
            case "quadraticCurveTo":
              t = w[2], i = w[3], a = w[0], s = w[1], m.length > 0 ? (c = m[m.length - 1], h = c.x, l = c.y) : (c = this.actions[g - 1].args, h = c[c.length - 2], l = c[c.length - 1]);
              for (var _ = 1; e >= _; _++) {
                var x = _ / e;
                u = p(x, h, a, t), d = p(x, l, s, i), m.push(new n.Vector2(u, d))
              };
              break;
            case "bezierCurveTo":
              t = w[4], i = w[5], a = w[0], s = w[1], r = w[2], o = w[3], m.length > 0 ? (c = m[m.length - 1], h = c.x, l = c.y) : (c = this.actions[g - 1].args, h = c[c.length - 2], l = c[c.length - 1]);
              for (var _ = 1; e >= _; _++) {
                var x = _ / e;
                u = f(x, h, a, r, t), d = f(x, l, s, o, i), m.push(new n.Vector2(u, d))
              };
              break;
            case "splineThru":
              c = this.actions[g - 1].args;
              var M = new n.Vector2(c[c.length - 2], c[c.length - 1]),
                E = [M],
                S = e * w[0].length;
              E = E.concat(w[0]);
              for (var T = new n.SplineCurve(E), _ = 1; S >= _; _++) {
                m.push(T.getPointAt(_ / S))
              };
              break;
            case "arc":
              for (var P, A = w[0], L = w[1], C = w[2], R = w[3], I = w[4], D = !!w[5], O = I - R, k = 2 * e, _ = 1; k >= _; _++) {
                var x = _ / k;
                D || (x = 1 - x), P = R + x * O, u = A + C * Math.cos(P), d = L + C * Math.sin(P), m.push(new n.Vector2(u, d))
              };
              break;
            case "ellipse":
              var P, B, F, A = w[0],
                L = w[1],
                N = w[2],
                U = w[3],
                R = w[4],
                I = w[5],
                D = !!w[6],
                V = w[7],
                O = I - R,
                k = 2 * e;
              0 !== V && (B = Math.cos(V), F = Math.sin(V));
              for (var _ = 1; k >= _; _++) {
                var x = _ / k;
                if (D || (x = 1 - x), P = R + x * O, u = A + N * Math.cos(P), d = L + U * Math.sin(P), 0 !== V) {
                  var z = u,
                    G = d;
                  u = (z - A) * B - (G - L) * F + A, d = (z - A) * F + (G - L) * B + L
                };
                m.push(new n.Vector2(u, d))
              }
          }
        };
        var j = m[m.length - 1];
        return Math.abs(j.x - m[0].x) < Number.EPSILON && Math.abs(j.y - m[0].y) < Number.EPSILON && m.splice(m.length - 1, 1), this.autoClose && m.push(m[0]), m
      }, n.Path.prototype.toShapes = function(e, t) {
        function i(e) {
          for (var t = [], i = new n.Path, r = 0, o = e.length; o > r; r++) {
            var a = e[r],
              s = a.args,
              h = a.action;
            "moveTo" === h && 0 !== i.actions.length && (t.push(i), i = new n.Path), i[h].apply(i, s)
          };
          return 0 !== i.actions.length && t.push(i), t
        }

        function r(e) {
          for (var t = [], i = 0, r = e.length; r > i; i++) {
            var o = e[i],
              a = new n.Shape;
            a.actions = o.actions, a.curves = o.curves, t.push(a)
          };
          return t
        }

        function o(e, t) {
          for (var i = t.length, n = !1, r = i - 1, o = 0; i > o; r = o++) {
            var a = t[r],
              s = t[o],
              h = s.x - a.x,
              l = s.y - a.y;
            if (Math.abs(l) > Number.EPSILON) {
              if (0 > l && (a = t[o], h = -h, s = t[r], l = -l), e.y < a.y || e.y > s.y) {
                continue
              };
              if (e.y === a.y) {
                if (e.x === a.x) {
                  return !0
                }
              } else {
                var c = l * (e.x - a.x) - h * (e.y - a.y);
                if (0 === c) {
                  return !0
                };
                if (0 > c) {
                  continue
                };
                n = !n
              }
            } else {
              if (e.y !== a.y) {
                continue
              };
              if (s.x <= e.x && e.x <= a.x || a.x <= e.x && e.x <= s.x) {
                return !0
              }
            }
          };
          return n
        }
        var a = n.ShapeUtils.isClockWise,
          s = i(this.actions);
        if (0 === s.length) {
          return []
        };
        if (t === !0) {
          return r(s)
        };
        var h, l, c, u = [];
        if (1 === s.length) {
          return l = s[0], c = new n.Shape, c.actions = l.actions, c.curves = l.curves, u.push(c), u
        };
        var d = !a(s[0].getPoints());
        d = e ? !d : d;
        var p, f = [],
          m = [],
          g = [],
          v = 0;
        m[v] = void(0), g[v] = [];
        for (var y = 0, b = s.length; b > y; y++) {
          l = s[y], p = l.getPoints(), h = a(p), h = e ? !h : h, h ? (!d && m[v] && v++, m[v] = {
            s: new n.Shape,
            p: p
          }, m[v].s.actions = l.actions, m[v].s.curves = l.curves, d && v++, g[v] = []) : g[v].push({
            h: l,
            p: p[0]
          })
        };
        if (!m[0]) {
          return r(s)
        };
        if (m.length > 1) {
          for (var w = !1, _ = [], x = 0, M = m.length; M > x; x++) {
            f[x] = []
          };
          for (var x = 0, M = m.length; M > x; x++) {
            for (var E = g[x], S = 0; S < E.length; S++) {
              for (var T = E[S], P = !0, A = 0; A < m.length; A++) {
                o(T.p, m[A].p) && (x !== A && _.push({
                  froms: x,
                  tos: A,
                  hole: S
                }), P ? (P = !1, f[A].push(T)) : w = !0)
              };
              P && f[x].push(T)
            }
          };
          _.length > 0 && (w || (g = f))
        };
        for (var L, y = 0, C = m.length; C > y; y++) {
          c = m[y].s, u.push(c), L = g[y];
          for (var R = 0, I = L.length; I > R; R++) {
            c.holes.push(L[R].h)
          }
        };
        return u
      }, n.Shape = function() {
        n.Path.apply(this, arguments), this.holes = []
      }, n.Shape.prototype = Object.create(n.Path.prototype), n.Shape.prototype.constructor = n.Shape, n.Shape.prototype.extrude = function(e) {
        return new n.ExtrudeGeometry(this, e)
      }, n.Shape.prototype.makeGeometry = function(e) {
        return new n.ShapeGeometry(this, e)
      }, n.Shape.prototype.getPointsHoles = function(e) {
        for (var t = [], i = 0, n = this.holes.length; n > i; i++) {
          t[i] = this.holes[i].getPoints(e)
        };
        return t
      }, n.Shape.prototype.extractAllPoints = function(e) {
        return {
          shape: this.getPoints(e),
          holes: this.getPointsHoles(e)
        }
      }, n.Shape.prototype.extractPoints = function(e) {
        return this.extractAllPoints(e)
      }, n.LineCurve = function(e, t) {
        this.v1 = e, this.v2 = t
      }, n.LineCurve.prototype = Object.create(n.Curve.prototype), n.LineCurve.prototype.constructor = n.LineCurve, n.LineCurve.prototype.getPoint = function(e) {
        var t = this.v2.clone().sub(this.v1);
        return t.multiplyScalar(e).add(this.v1), t
      }, n.LineCurve.prototype.getPointAt = function(e) {
        return this.getPoint(e)
      }, n.LineCurve.prototype.getTangent = function(e) {
        var t = this.v2.clone().sub(this.v1);
        return t.normalize()
      }, n.QuadraticBezierCurve = function(e, t, i) {
        this.v0 = e, this.v1 = t, this.v2 = i
      }, n.QuadraticBezierCurve.prototype = Object.create(n.Curve.prototype), n.QuadraticBezierCurve.prototype.constructor = n.QuadraticBezierCurve, n.QuadraticBezierCurve.prototype.getPoint = function(e) {
        var t = n.ShapeUtils.b2;
        return new n.Vector2(t(e, this.v0.x, this.v1.x, this.v2.x), t(e, this.v0.y, this.v1.y, this.v2.y))
      }, n.QuadraticBezierCurve.prototype.getTangent = function(e) {
        var t = n.CurveUtils.tangentQuadraticBezier;
        return new n.Vector2(t(e, this.v0.x, this.v1.x, this.v2.x), t(e, this.v0.y, this.v1.y, this.v2.y)).normalize()
      }, n.CubicBezierCurve = function(e, t, i, n) {
        this.v0 = e, this.v1 = t, this.v2 = i, this.v3 = n
      }, n.CubicBezierCurve.prototype = Object.create(n.Curve.prototype), n.CubicBezierCurve.prototype.constructor = n.CubicBezierCurve, n.CubicBezierCurve.prototype.getPoint = function(e) {
        var t = n.ShapeUtils.b3;
        return new n.Vector2(t(e, this.v0.x, this.v1.x, this.v2.x, this.v3.x), t(e, this.v0.y, this.v1.y, this.v2.y, this.v3.y))
      }, n.CubicBezierCurve.prototype.getTangent = function(e) {
        var t = n.CurveUtils.tangentCubicBezier;
        return new n.Vector2(t(e, this.v0.x, this.v1.x, this.v2.x, this.v3.x), t(e, this.v0.y, this.v1.y, this.v2.y, this.v3.y)).normalize()
      }, n.SplineCurve = function(e) {
        this.points = void(0) == e ? [] : e
      }, n.SplineCurve.prototype = Object.create(n.Curve.prototype), n.SplineCurve.prototype.constructor = n.SplineCurve, n.SplineCurve.prototype.getPoint = function(e) {
        var t = this.points,
          i = (t.length - 1) * e,
          r = Math.floor(i),
          o = i - r,
          a = t[0 === r ? r : r - 1],
          s = t[r],
          h = t[r > t.length - 2 ? t.length - 1 : r + 1],
          l = t[r > t.length - 3 ? t.length - 1 : r + 2],
          c = n.CurveUtils.interpolate;
        return new n.Vector2(c(a.x, s.x, h.x, l.x, o), c(a.y, s.y, h.y, l.y, o))
      }, n.EllipseCurve = function(e, t, i, n, r, o, a, s) {
        this.aX = e, this.aY = t, this.xRadius = i, this.yRadius = n, this.aStartAngle = r, this.aEndAngle = o, this.aClockwise = a, this.aRotation = s || 0
      }, n.EllipseCurve.prototype = Object.create(n.Curve.prototype), n.EllipseCurve.prototype.constructor = n.EllipseCurve, n.EllipseCurve.prototype.getPoint = function(e) {
        var t = this.aEndAngle - this.aStartAngle;
        0 > t && (t += 2 * Math.PI), t > 2 * Math.PI && (t -= 2 * Math.PI);
        var i;
        i = this.aClockwise === !0 ? this.aEndAngle + (1 - e) * (2 * Math.PI - t) : this.aStartAngle + e * t;
        var r = this.aX + this.xRadius * Math.cos(i),
          o = this.aY + this.yRadius * Math.sin(i);
        if (0 !== this.aRotation) {
          var a = Math.cos(this.aRotation),
            s = Math.sin(this.aRotation),
            h = r,
            l = o;
          r = (h - this.aX) * a - (l - this.aY) * s + this.aX, o = (h - this.aX) * s + (l - this.aY) * a + this.aY
        };
        return new n.Vector2(r, o)
      }, n.ArcCurve = function(e, t, i, r, o, a) {
        n.EllipseCurve.call(this, e, t, i, i, r, o, a)
      }, n.ArcCurve.prototype = Object.create(n.EllipseCurve.prototype), n.ArcCurve.prototype.constructor = n.ArcCurve, n.LineCurve3 = n.Curve.create(function(e, t) {
        this.v1 = e, this.v2 = t
      }, function(e) {
        var t = new n.Vector3;
        return t.subVectors(this.v2, this.v1), t.multiplyScalar(e), t.add(this.v1), t
      }), n.QuadraticBezierCurve3 = n.Curve.create(function(e, t, i) {
        this.v0 = e, this.v1 = t, this.v2 = i
      }, function(e) {
        var t = n.ShapeUtils.b2;
        return new n.Vector3(t(e, this.v0.x, this.v1.x, this.v2.x), t(e, this.v0.y, this.v1.y, this.v2.y), t(e, this.v0.z, this.v1.z, this.v2.z))
      }), n.CubicBezierCurve3 = n.Curve.create(function(e, t, i, n) {
        this.v0 = e, this.v1 = t, this.v2 = i, this.v3 = n
      }, function(e) {
        var t = n.ShapeUtils.b3;
        return new n.Vector3(t(e, this.v0.x, this.v1.x, this.v2.x, this.v3.x), t(e, this.v0.y, this.v1.y, this.v2.y, this.v3.y), t(e, this.v0.z, this.v1.z, this.v2.z, this.v3.z))
      }), n.SplineCurve3 = n.Curve.create(function(e) {
        console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3"), this.points = void(0) == e ? [] : e
      }, function(e) {
        var t = this.points,
          i = (t.length - 1) * e,
          r = Math.floor(i),
          o = i - r,
          a = t[0 == r ? r : r - 1],
          s = t[r],
          h = t[r > t.length - 2 ? t.length - 1 : r + 1],
          l = t[r > t.length - 3 ? t.length - 1 : r + 2],
          c = n.CurveUtils.interpolate;
        return new n.Vector3(c(a.x, s.x, h.x, l.x, o), c(a.y, s.y, h.y, l.y, o), c(a.z, s.z, h.z, l.z, o))
      }), n.CatmullRomCurve3 = function() {
        function e() {}
        var t = new n.Vector3,
          i = new e,
          r = new e,
          o = new e;
        return e.prototype.init = function(e, t, i, n) {
          this.c0 = e, this.c1 = i, this.c2 = -3 * e + 3 * t - 2 * i - n, this.c3 = 2 * e - 2 * t + i + n
        }, e.prototype.initNonuniformCatmullRom = function(e, t, i, n, r, o, a) {
          var s = (t - e) / r - (i - e) / (r + o) + (i - t) / o,
            h = (i - t) / o - (n - t) / (o + a) + (n - i) / a;
          s *= o, h *= o, this.init(t, i, s, h)
        }, e.prototype.initCatmullRom = function(e, t, i, n, r) {
          this.init(t, i, r * (i - e), r * (n - t))
        }, e.prototype.calc = function(e) {
          var t = e * e,
            i = t * e;
          return this.c0 + this.c1 * e + this.c2 * t + this.c3 * i
        }, n.Curve.create(function(e) {
          this.points = e || [], this.closed = !1
        }, function(e) {
          var a, s, h, l, c = this.points;
          l = c.length, 2 > l && console.log("duh, you need at least 2 points"), a = (l - (this.closed ? 0 : 1)) * e, s = Math.floor(a), h = a - s, this.closed ? s += s > 0 ? 0 : (Math.floor(Math.abs(s) / c.length) + 1) * c.length : 0 === h && s === l - 1 && (s = l - 2, h = 1);
          var u, d, p, f;
          if (this.closed || s > 0 ? u = c[(s - 1) % l] : (t.subVectors(c[0], c[1]).add(c[0]), u = t), d = c[s % l], p = c[(s + 1) % l], this.closed || l > s + 2 ? f = c[(s + 2) % l] : (t.subVectors(c[l - 1], c[l - 2]).add(c[l - 1]), f = t), void(0) === this.type || "centripetal" === this.type || "chordal" === this.type) {
            var m = "chordal" === this.type ? 0.5 : 0.25,
              g = Math.pow(u.distanceToSquared(d), m),
              v = Math.pow(d.distanceToSquared(p), m),
              y = Math.pow(p.distanceToSquared(f), m);
            1e-4 > v && (v = 1), 1e-4 > g && (g = v), 1e-4 > y && (y = v), i.initNonuniformCatmullRom(u.x, d.x, p.x, f.x, g, v, y), r.initNonuniformCatmullRom(u.y, d.y, p.y, f.y, g, v, y), o.initNonuniformCatmullRom(u.z, d.z, p.z, f.z, g, v, y)
          } else {
            if ("catmullrom" === this.type) {
              var b = void(0) !== this.tension ? this.tension : 0.5;
              i.initCatmullRom(u.x, d.x, p.x, f.x, b), r.initCatmullRom(u.y, d.y, p.y, f.y, b), o.initCatmullRom(u.z, d.z, p.z, f.z, b)
            }
          };
          var w = new n.Vector3(i.calc(h), r.calc(h), o.calc(h));
          return w
        })
      }(), n.ClosedSplineCurve3 = function(e) {
        console.warn("THREE.ClosedSplineCurve3 has been deprecated. Please use THREE.CatmullRomCurve3."), n.CatmullRomCurve3.call(this, e), this.type = "catmullrom", this.closed = !0
      }, n.ClosedSplineCurve3.prototype = Object.create(n.CatmullRomCurve3.prototype), n.BoxGeometry = function(e, t, i, r, o, a) {
        n.Geometry.call(this), this.type = "BoxGeometry", this.parameters = {
          width: e,
          height: t,
          depth: i,
          widthSegments: r,
          heightSegments: o,
          depthSegments: a
        }, this.fromBufferGeometry(new n.BoxBufferGeometry(e, t, i, r, o, a)), this.mergeVertices()
      }, n.BoxGeometry.prototype = Object.create(n.Geometry.prototype), n.BoxGeometry.prototype.constructor = n.BoxGeometry, n.CubeGeometry = n.BoxGeometry, n.BoxBufferGeometry = function(e, t, i, r, o, a) {
        function s(e, t, i) {
          var n = 0;
          return n += e * t * 2, n += e * i * 2, n += i * t * 2, 4 * n
        }

        function h(e, t, i, r, o, a, s, h, c, u, _) {
          for (var x = a / c, M = s / u, E = a / 2, S = s / 2, T = h / 2, P = c + 1, A = u + 1, L = 0, C = 0, R = new n.Vector3, I = 0; A > I; I++) {
            for (var D = I * M - S, O = 0; P > O; O++) {
              var k = O * x - E;
              R[e] = k * r, R[t] = D * o, R[i] = T, p[g] = R.x, p[g + 1] = R.y, p[g + 2] = R.z, R[e] = 0, R[t] = 0, R[i] = h > 0 ? 1 : -1, f[g] = R.x, f[g + 1] = R.y, f[g + 2] = R.z, m[v] = O / c, m[v + 1] = 1 - I / u, g += 3, v += 2, L += 1
            }
          };
          for (I = 0; u > I; I++) {
            for (O = 0; c > O; O++) {
              var B = b + O + P * I,
                F = b + O + P * (I + 1),
                N = b + (O + 1) + P * (I + 1),
                U = b + (O + 1) + P * I;
              d[y] = B, d[y + 1] = F, d[y + 2] = U, d[y + 3] = F, d[y + 4] = N, d[y + 5] = U, y += 6, C += 6
            }
          };
          l.addGroup(w, C, _), w += C, b += L
        }
        n.BufferGeometry.call(this), this.type = "BoxBufferGeometry", this.parameters = {
          width: e,
          height: t,
          depth: i,
          widthSegments: r,
          heightSegments: o,
          depthSegments: a
        };
        var l = this;
        r = Math.floor(r) || 1, o = Math.floor(o) || 1, a = Math.floor(a) || 1;
        var c = s(r, o, a),
          u = c / 4 * 6,
          d = new(u > 65535 ? Uint32Array : Uint16Array)(u),
          p = new Float32Array(3 * c),
          f = new Float32Array(3 * c),
          m = new Float32Array(2 * c),
          g = 0,
          v = 0,
          y = 0,
          b = 0,
          w = 0;
        h("z", "y", "x", -1, -1, i, t, e, a, o, 0), h("z", "y", "x", 1, -1, i, t, -e, a, o, 1), h("x", "z", "y", 1, 1, e, i, t, r, a, 2), h("x", "z", "y", 1, -1, e, i, -t, r, a, 3), h("x", "y", "z", 1, -1, e, t, i, r, o, 4), h("x", "y", "z", -1, -1, e, t, -i, r, o, 5), this.setIndex(new n.BufferAttribute(d, 1)), this.addAttribute("position", new n.BufferAttribute(p, 3)), this.addAttribute("normal", new n.BufferAttribute(f, 3)), this.addAttribute("uv", new n.BufferAttribute(m, 2))
      }, n.BoxBufferGeometry.prototype = Object.create(n.BufferGeometry.prototype), n.BoxBufferGeometry.prototype.constructor = n.BoxBufferGeometry, n.CircleGeometry = function(e, t, i, r) {
        n.Geometry.call(this), this.type = "CircleGeometry", this.parameters = {
          radius: e,
          segments: t,
          thetaStart: i,
          thetaLength: r
        }, this.fromBufferGeometry(new n.CircleBufferGeometry(e, t, i, r))
      }, n.CircleGeometry.prototype = Object.create(n.Geometry.prototype), n.CircleGeometry.prototype.constructor = n.CircleGeometry, n.CircleBufferGeometry = function(e, t, i, r) {
        n.BufferGeometry.call(this), this.type = "CircleBufferGeometry", this.parameters = {
          radius: e,
          segments: t,
          thetaStart: i,
          thetaLength: r
        }, e = e || 50, t = void(0) !== t ? Math.max(3, t) : 8, i = void(0) !== i ? i : 0, r = void(0) !== r ? r : 2 * Math.PI;
        var o = t + 2,
          a = new Float32Array(3 * o),
          s = new Float32Array(3 * o),
          h = new Float32Array(2 * o);
        s[2] = 1, h[0] = 0.5, h[1] = 0.5;
        for (var l = 0, c = 3, u = 2; t >= l; l++, c += 3, u += 2) {
          var d = i + l / t * r;
          a[c] = e * Math.cos(d), a[c + 1] = e * Math.sin(d), s[c + 2] = 1, h[u] = (a[c] / e + 1) / 2, h[u + 1] = (a[c + 1] / e + 1) / 2
        };
        for (var p = [], c = 1; t >= c; c++) {
          p.push(c, c + 1, 0)
        };
        this.setIndex(new n.BufferAttribute(new Uint16Array(p), 1)), this.addAttribute("position", new n.BufferAttribute(a, 3)), this.addAttribute("normal", new n.BufferAttribute(s, 3)), this.addAttribute("uv", new n.BufferAttribute(h, 2)), this.boundingSphere = new n.Sphere(new n.Vector3, e)
      }, n.CircleBufferGeometry.prototype = Object.create(n.BufferGeometry.prototype), n.CircleBufferGeometry.prototype.constructor = n.CircleBufferGeometry, n.CylinderBufferGeometry = function(e, t, i, r, o, a, s, h) {
        function l() {
          var e = (r + 1) * (o + 1);
          return a === !1 && (e += 2 * (r + 1) + 2 * r), e
        }

        function c() {
          var e = r * o * 2 * 3;
          return a === !1 && (e += 2 * r * 3), e
        }

        function u() {
          var a, l, c = new n.Vector3,
            u = new n.Vector3,
            d = (t - e) / i;
          for (l = 0; o >= l; l++) {
            var p = [],
              f = l / o,
              M = f * (t - e) + e;
            for (a = 0; r >= a; a++) {
              var E = a / r;
              u.x = M * Math.sin(E * h + s), u.y = -f * i + x, u.z = M * Math.cos(E * h + s), g.setXYZ(b, u.x, u.y, u.z), c.copy(u), (0 === e && 0 === l || 0 === t && l === o) && (c.x = Math.sin(E * h + s), c.z = Math.cos(E * h + s)), c.setY(Math.sqrt(c.x * c.x + c.z * c.z) * d).normalize(), v.setXYZ(b, c.x, c.y, c.z), y.setXY(b, E, 1 - f), p.push(b), b++
            };
            _.push(p)
          };
          for (a = 0; r > a; a++) {
            for (l = 0; o > l; l++) {
              var S = _[l][a],
                T = _[l + 1][a],
                P = _[l + 1][a + 1],
                A = _[l][a + 1];
              m.setX(w, S), w++, m.setX(w, T), w++, m.setX(w, A), w++, m.setX(w, T), w++, m.setX(w, P), w++, m.setX(w, A), w++
            }
          }
        }

        function d(i) {
          var o, a, l, c = new n.Vector2,
            u = new n.Vector3,
            d = i === !0 ? e : t,
            p = i === !0 ? 1 : -1;
          for (a = b, o = 1; r >= o; o++) {
            g.setXYZ(b, 0, x * p, 0), v.setXYZ(b, 0, p, 0), i === !0 ? (c.x = o / r, c.y = 0) : (c.x = (o - 1) / r, c.y = 1), y.setXY(b, c.x, c.y), b++
          };
          for (l = b, o = 0; r >= o; o++) {
            var f = o / r;
            u.x = d * Math.sin(f * h + s), u.y = x * p, u.z = d * Math.cos(f * h + s), g.setXYZ(b, u.x, u.y, u.z), v.setXYZ(b, 0, p, 0), y.setXY(b, f, i === !0 ? 1 : 0), b++
          };
          for (o = 0; r > o; o++) {
            var _ = a + o,
              M = l + o;
            i === !0 ? (m.setX(w, M), w++, m.setX(w, M + 1), w++, m.setX(w, _), w++) : (m.setX(w, M + 1), w++, m.setX(w, M), w++, m.setX(w, _), w++)
          }
        }
        n.BufferGeometry.call(this), this.type = "CylinderBufferGeometry", this.parameters = {
          radiusTop: e,
          radiusBottom: t,
          height: i,
          radialSegments: r,
          heightSegments: o,
          openEnded: a,
          thetaStart: s,
          thetaLength: h
        }, e = void(0) !== e ? e : 20, t = void(0) !== t ? t : 20, i = void(0) !== i ? i : 100, r = Math.floor(r) || 8, o = Math.floor(o) || 1, a = void(0) !== a ? a : !1, s = void(0) !== s ? s : 0, h = void(0) !== h ? h : 2 * Math.PI;
        var p = l(),
          f = c(),
          m = new n.BufferAttribute(new(f > 65535 ? Uint32Array : Uint16Array)(f), 1),
          g = new n.BufferAttribute(new Float32Array(3 * p), 3),
          v = new n.BufferAttribute(new Float32Array(3 * p), 3),
          y = new n.BufferAttribute(new Float32Array(2 * p), 2),
          b = 0,
          w = 0,
          _ = [],
          x = i / 2;
        u(), a === !1 && (e > 0 && d(!0), t > 0 && d(!1)), this.setIndex(m), this.addAttribute("position", g), this.addAttribute("normal", v), this.addAttribute("uv", y)
      }, n.CylinderBufferGeometry.prototype = Object.create(n.BufferGeometry.prototype), n.CylinderBufferGeometry.prototype.constructor = n.CylinderBufferGeometry, n.CylinderGeometry = function(e, t, i, r, o, a, s, h) {
        n.Geometry.call(this), this.type = "CylinderGeometry", this.parameters = {
          radiusTop: e,
          radiusBottom: t,
          height: i,
          radialSegments: r,
          heightSegments: o,
          openEnded: a,
          thetaStart: s,
          thetaLength: h
        }, this.fromBufferGeometry(new n.CylinderBufferGeometry(e, t, i, r, o, a, s, h)), this.mergeVertices()
      }, n.CylinderGeometry.prototype = Object.create(n.Geometry.prototype), n.CylinderGeometry.prototype.constructor = n.CylinderGeometry, n.EdgesGeometry = function(e, t) {
        function i(e, t) {
          return e - t
        }
        n.BufferGeometry.call(this), t = void(0) !== t ? t : 1;
        var r, o = Math.cos(n.Math.degToRad(t)),
          a = [0, 0],
          s = {},
          h = ["a", "b", "c"];
        e instanceof n.BufferGeometry ? (r = new n.Geometry, r.fromBufferGeometry(e)) : r = e.clone(), r.mergeVertices(), r.computeFaceNormals();
        for (var l = r.vertices, c = r.faces, u = 0, d = c.length; d > u; u++) {
          for (var p = c[u], f = 0; 3 > f; f++) {
            a[0] = p[h[f]], a[1] = p[h[(f + 1) % 3]], a.sort(i);
            var m = a.toString();
            void(0) === s[m] ? s[m] = {
              vert1: a[0],
              vert2: a[1],
              face1: u,
              face2: void(0)
            } : s[m].face2 = u
          }
        };
        var g = [];
        for (var m in s) {
          var v = s[m];
          if (void(0) === v.face2 || c[v.face1].normal.dot(c[v.face2].normal) <= o) {
            var y = l[v.vert1];
            g.push(y.x), g.push(y.y), g.push(y.z), y = l[v.vert2], g.push(y.x), g.push(y.y), g.push(y.z)
          }
        };
        this.addAttribute("position", new n.BufferAttribute(new Float32Array(g), 3))
      }, n.EdgesGeometry.prototype = Object.create(n.BufferGeometry.prototype), n.EdgesGeometry.prototype.constructor = n.EdgesGeometry, n.ExtrudeGeometry = function(e, t) {
        return "undefined" == typeof e ? void((e = [])) : (n.Geometry.call(this), this.type = "ExtrudeGeometry", e = Array.isArray(e) ? e : [e], this.addShapeList(e, t), void(this.computeFaceNormals()))
      }, n.ExtrudeGeometry.prototype = Object.create(n.Geometry.prototype), n.ExtrudeGeometry.prototype.constructor = n.ExtrudeGeometry, n.ExtrudeGeometry.prototype.addShapeList = function(e, t) {
        for (var i = e.length, n = 0; i > n; n++) {
          var r = e[n];
          this.addShape(r, t)
        }
      }, n.ExtrudeGeometry.prototype.addShape = function(e, t) {
        function i(e, t, i) {
          return t || console.error("THREE.ExtrudeGeometry: vec does not exist"), t.clone().multiplyScalar(i).add(e)
        }

        function r(e, t, i) {
          var r, o, a = 1,
            s = e.x - t.x,
            h = e.y - t.y,
            l = i.x - e.x,
            c = i.y - e.y,
            u = s * s + h * h,
            d = s * c - h * l;
          if (Math.abs(d) > Number.EPSILON) {
            var p = Math.sqrt(u),
              f = Math.sqrt(l * l + c * c),
              m = t.x - h / p,
              g = t.y + s / p,
              v = i.x - c / f,
              y = i.y + l / f,
              b = ((v - m) * c - (y - g) * l) / (s * c - h * l);
            r = m + s * b - e.x, o = g + h * b - e.y;
            var w = r * r + o * o;
            if (2 >= w) {
              return new n.Vector2(r, o)
            };
            a = Math.sqrt(w / 2)
          } else {
            var _ = !1;
            s > Number.EPSILON ? l > Number.EPSILON && (_ = !0) : s < -Number.EPSILON ? l < -Number.EPSILON && (_ = !0) : Math.sign(h) === Math.sign(c) && (_ = !0), _ ? (r = -h, o = s, a = Math.sqrt(u)) : (r = s, o = h, a = Math.sqrt(u / 2))
          };
          return new n.Vector2(r / a, o / a)
        }

        function o() {
          if (w) {
            var e = 0,
              t = j * e;
            for (Y = 0; H > Y; Y++) {
              G = k[Y], l(G[2] + t, G[1] + t, G[0] + t)
            };
            for (e = x + 2 * b, t = j * e, Y = 0; H > Y; Y++) {
              G = k[Y], l(G[0] + t, G[1] + t, G[2] + t)
            }
          } else {
            for (Y = 0; H > Y; Y++) {
              G = k[Y], l(G[2], G[1], G[0])
            };
            for (Y = 0; H > Y; Y++) {
              G = k[Y], l(G[0] + j * x, G[1] + j * x, G[2] + j * x)
            }
          }
        }

        function a() {
          var e = 0;
          for (s(B, e), e += B.length, P = 0, A = D.length; A > P; P++) {
            T = D[P], s(T, e), e += T.length
          }
        }

        function s(e, t) {
          var i, n;
          for (Y = e.length; --Y >= 0;) {
            i = Y, n = Y - 1, 0 > n && (n = e.length - 1);
            var r = 0,
              o = x + 2 * b;
            for (r = 0; o > r; r++) {
              var a = j * r,
                s = j * (r + 1),
                h = t + i + a,
                l = t + n + a,
                u = t + n + s,
                d = t + i + s;
              c(h, l, u, d, e, r, o, i, n)
            }
          }
        }

        function h(e, t, i) {
          L.vertices.push(new n.Vector3(e, t, i))
        }

        function l(e, t, i) {
          e += C, t += C, i += C, L.faces.push(new n.Face3(e, t, i, null, null, 0));
          var r = S.generateTopUV(L, e, t, i);
          L.faceVertexUvs[0].push(r)
        }

        function c(e, t, i, r, o, a, s, h, l) {
          e += C, t += C, i += C, r += C, L.faces.push(new n.Face3(e, t, r, null, null, 1)), L.faces.push(new n.Face3(t, i, r, null, null, 1));
          var c = S.generateSideWallUV(L, e, t, i, r);
          L.faceVertexUvs[0].push([c[0], c[1], c[3]]), L.faceVertexUvs[0].push([c[1], c[2], c[3]])
        }
        var u, d, p, f, m, g = void(0) !== t.amount ? t.amount : 100,
          v = void(0) !== t.bevelThickness ? t.bevelThickness : 6,
          y = void(0) !== t.bevelSize ? t.bevelSize : v - 2,
          b = void(0) !== t.bevelSegments ? t.bevelSegments : 3,
          w = void(0) !== t.bevelEnabled ? t.bevelEnabled : !0,
          _ = void(0) !== t.curveSegments ? t.curveSegments : 12,
          x = void(0) !== t.steps ? t.steps : 1,
          M = t.extrudePath,
          E = !1,
          S = void(0) !== t.UVGenerator ? t.UVGenerator : n.ExtrudeGeometry.WorldUVGenerator;
        M && (u = M.getSpacedPoints(x), E = !0, w = !1, d = void(0) !== t.frames ? t.frames : new n.TubeGeometry.FrenetFrames(M, x, !1), p = new n.Vector3, f = new n.Vector3, m = new n.Vector3), w || (b = 0, v = 0, y = 0);
        var T, P, A, L = this,
          C = this.vertices.length,
          R = e.extractPoints(_),
          I = R.shape,
          D = R.holes,
          O = !n.ShapeUtils.isClockWise(I);
        if (O) {
          for (I = I.reverse(), P = 0, A = D.length; A > P; P++) {
            T = D[P], n.ShapeUtils.isClockWise(T) && (D[P] = T.reverse())
          };
          O = !1
        };
        var k = n.ShapeUtils.triangulateShape(I, D),
          B = I;
        for (P = 0, A = D.length; A > P; P++) {
          T = D[P], I = I.concat(T)
        };
        for (var F, N, U, V, z, G, j = I.length, H = k.length, W = [], Y = 0, X = B.length, q = X - 1, Z = Y + 1; X > Y; Y++, q++, Z++) {
          q === X && (q = 0), Z === X && (Z = 0), W[Y] = r(B[Y], B[q], B[Z])
        };
        var $, Q = [],
          K = W.concat();
        for (P = 0, A = D.length; A > P; P++) {
          for (T = D[P], $ = [], Y = 0, X = T.length, q = X - 1, Z = Y + 1; X > Y; Y++, q++, Z++) {
            q === X && (q = 0), Z === X && (Z = 0), $[Y] = r(T[Y], T[q], T[Z])
          };
          Q.push($), K = K.concat($)
        };
        for (F = 0; b > F; F++) {
          for (U = F / b, V = v * (1 - U), N = y * Math.sin(U * Math.PI / 2), Y = 0, X = B.length; X > Y; Y++) {
            z = i(B[Y], W[Y], N), h(z.x, z.y, -V)
          };
          for (P = 0, A = D.length; A > P; P++) {
            for (T = D[P], $ = Q[P], Y = 0, X = T.length; X > Y; Y++) {
              z = i(T[Y], $[Y], N), h(z.x, z.y, -V)
            }
          }
        };
        for (N = y, Y = 0; j > Y; Y++) {
          z = w ? i(I[Y], K[Y], N) : I[Y], E ? (f.copy(d.normals[0]).multiplyScalar(z.x), p.copy(d.binormals[0]).multiplyScalar(z.y), m.copy(u[0]).add(f).add(p), h(m.x, m.y, m.z)) : h(z.x, z.y, 0)
        };
        var J;
        for (J = 1; x >= J; J++) {
          for (Y = 0; j > Y; Y++) {
            z = w ? i(I[Y], K[Y], N) : I[Y], E ? (f.copy(d.normals[J]).multiplyScalar(z.x), p.copy(d.binormals[J]).multiplyScalar(z.y), m.copy(u[J]).add(f).add(p), h(m.x, m.y, m.z)) : h(z.x, z.y, g / x * J)
          }
        };
        for (F = b - 1; F >= 0; F--) {
          for (U = F / b, V = v * (1 - U), N = y * Math.sin(U * Math.PI / 2), Y = 0, X = B.length; X > Y; Y++) {
            z = i(B[Y], W[Y], N), h(z.x, z.y, g + V)
          };
          for (P = 0, A = D.length; A > P; P++) {
            for (T = D[P], $ = Q[P], Y = 0, X = T.length; X > Y; Y++) {
              z = i(T[Y], $[Y], N), E ? h(z.x, z.y + u[x - 1].y, u[x - 1].x + V) : h(z.x, z.y, g + V)
            }
          }
        };
        o(), a()
      }, n.ExtrudeGeometry.WorldUVGenerator = {
        generateTopUV: function(e, t, i, r) {
          var o = e.vertices,
            a = o[t],
            s = o[i],
            h = o[r];
          return [new n.Vector2(a.x, a.y), new n.Vector2(s.x, s.y), new n.Vector2(h.x, h.y)]
        },
        generateSideWallUV: function(e, t, i, r, o) {
          var a = e.vertices,
            s = a[t],
            h = a[i],
            l = a[r],
            c = a[o];
          return Math.abs(s.y - h.y) < 0.01 ? [new n.Vector2(s.x, 1 - s.z), new n.Vector2(h.x, 1 - h.z), new n.Vector2(l.x, 1 - l.z), new n.Vector2(c.x, 1 - c.z)] : [new n.Vector2(s.y, 1 - s.z), new n.Vector2(h.y, 1 - h.z), new n.Vector2(l.y, 1 - l.z), new n.Vector2(c.y, 1 - c.z)]
        }
      }, n.ShapeGeometry = function(e, t) {
        n.Geometry.call(this), this.type = "ShapeGeometry", Array.isArray(e) === !1 && (e = [e]), this.addShapeList(e, t), this.computeFaceNormals()
      }, n.ShapeGeometry.prototype = Object.create(n.Geometry.prototype), n.ShapeGeometry.prototype.constructor = n.ShapeGeometry, n.ShapeGeometry.prototype.addShapeList = function(e, t) {
        for (var i = 0, n = e.length; n > i; i++) {
          this.addShape(e[i], t)
        };
        return this
      }, n.ShapeGeometry.prototype.addShape = function(e, t) {
        void(0) === t && (t = {});
        var i, r, o, a = void(0) !== t.curveSegments ? t.curveSegments : 12,
          s = t.material,
          h = void(0) === t.UVGenerator ? n.ExtrudeGeometry.WorldUVGenerator : t.UVGenerator,
          l = this.vertices.length,
          c = e.extractPoints(a),
          u = c.shape,
          d = c.holes,
          p = !n.ShapeUtils.isClockWise(u);
        if (p) {
          for (u = u.reverse(), i = 0, r = d.length; r > i; i++) {
            o = d[i], n.ShapeUtils.isClockWise(o) && (d[i] = o.reverse())
          };
          p = !1
        };
        var f = n.ShapeUtils.triangulateShape(u, d);
        for (i = 0, r = d.length; r > i; i++) {
          o = d[i], u = u.concat(o)
        };
        var m, g, v = u.length,
          y = f.length;
        for (i = 0; v > i; i++) {
          m = u[i], this.vertices.push(new n.Vector3(m.x, m.y, 0))
        };
        for (i = 0; y > i; i++) {
          g = f[i];
          var b = g[0] + l,
            w = g[1] + l,
            _ = g[2] + l;
          this.faces.push(new n.Face3(b, w, _, null, null, s)), this.faceVertexUvs[0].push(h.generateTopUV(this, b, w, _))
        }
      }, n.LatheBufferGeometry = function(e, t, i, r) {
        n.BufferGeometry.call(this), this.type = "LatheBufferGeometry", this.parameters = {
          points: e,
          segments: t,
          phiStart: i,
          phiLength: r
        }, t = Math.floor(t) || 12, i = i || 0, r = r || 2 * Math.PI, r = n.Math.clamp(r, 0, 2 * Math.PI);
        var o, a, s, h = (t + 1) * e.length,
          l = t * e.length * 2 * 3,
          c = new n.BufferAttribute(new(l > 65535 ? Uint32Array : Uint16Array)(l), 1),
          u = new n.BufferAttribute(new Float32Array(3 * h), 3),
          d = new n.BufferAttribute(new Float32Array(2 * h), 2),
          p = 0,
          f = 0,
          m = (1 / (e.length - 1), 1 / t),
          g = new n.Vector3,
          v = new n.Vector2;
        for (a = 0; t >= a; a++) {
          var y = i + a * m * r,
            b = Math.sin(y),
            w = Math.cos(y);
          for (s = 0; s <= e.length - 1; s++) {
            g.x = e[s].x * b, g.y = e[s].y, g.z = e[s].x * w, u.setXYZ(p, g.x, g.y, g.z), v.x = a / t, v.y = s / (e.length - 1), d.setXY(p, v.x, v.y), p++
          }
        };
        for (a = 0; t > a; a++) {
          for (s = 0; s < e.length - 1; s++) {
            o = s + a * e.length;
            var _ = o,
              x = o + e.length,
              M = o + e.length + 1,
              E = o + 1;
            c.setX(f, _), f++, c.setX(f, x), f++, c.setX(f, E), f++, c.setX(f, x), f++, c.setX(f, M), f++, c.setX(f, E), f++
          }
        };
        if (this.setIndex(c), this.addAttribute("position", u), this.addAttribute("uv", d), this.computeVertexNormals(), r === 2 * Math.PI) {
          var S = this.attributes.normal.array,
            T = new n.Vector3,
            P = new n.Vector3,
            A = new n.Vector3;
          for (o = t * e.length * 3, a = 0, s = 0; a < e.length; a++, s += 3) {
            T.x = S[s + 0], T.y = S[s + 1], T.z = S[s + 2], P.x = S[o + s + 0], P.y = S[o + s + 1], P.z = S[o + s + 2], A.addVectors(T, P).normalize(), S[s + 0] = S[o + s + 0] = A.x, S[s + 1] = S[o + s + 1] = A.y, S[s + 2] = S[o + s + 2] = A.z
          }
        }
      }, n.LatheBufferGeometry.prototype = Object.create(n.BufferGeometry.prototype), n.LatheBufferGeometry.prototype.constructor = n.LatheBufferGeometry, n.LatheGeometry = function(e, t, i, r) {
        n.Geometry.call(this), this.type = "LatheGeometry", this.parameters = {
          points: e,
          segments: t,
          phiStart: i,
          phiLength: r
        }, this.fromBufferGeometry(new n.LatheBufferGeometry(e, t, i, r)), this.mergeVertices()
      }, n.LatheGeometry.prototype = Object.create(n.Geometry.prototype), n.LatheGeometry.prototype.constructor = n.LatheGeometry, n.PlaneGeometry = function(e, t, i, r) {
        n.Geometry.call(this), this.type = "PlaneGeometry", this.parameters = {
          width: e,
          height: t,
          widthSegments: i,
          heightSegments: r
        }, this.fromBufferGeometry(new n.PlaneBufferGeometry(e, t, i, r))
      }, n.PlaneGeometry.prototype = Object.create(n.Geometry.prototype), n.PlaneGeometry.prototype.constructor = n.PlaneGeometry, n.PlaneBufferGeometry = function(e, t, i, r) {
        n.BufferGeometry.call(this), this.type = "PlaneBufferGeometry", this.parameters = {
          width: e,
          height: t,
          widthSegments: i,
          heightSegments: r
        };
        for (var o = e / 2, a = t / 2, s = Math.floor(i) || 1, h = Math.floor(r) || 1, l = s + 1, c = h + 1, u = e / s, d = t / h, p = new Float32Array(l * c * 3), f = new Float32Array(l * c * 3), m = new Float32Array(l * c * 2), g = 0, v = 0, y = 0; c > y; y++) {
          for (var b = y * d - a, w = 0; l > w; w++) {
            var _ = w * u - o;
            p[g] = _, p[g + 1] = -b, f[g + 2] = 1, m[v] = w / s, m[v + 1] = 1 - y / h, g += 3, v += 2
          }
        };
        g = 0;
        for (var x = new(p.length / 3 > 65535 ? Uint32Array : Uint16Array)(s * h * 6), y = 0; h > y; y++) {
          for (var w = 0; s > w; w++) {
            var M = w + l * y,
              E = w + l * (y + 1),
              S = w + 1 + l * (y + 1),
              T = w + 1 + l * y;
            x[g] = M, x[g + 1] = E, x[g + 2] = T, x[g + 3] = E, x[g + 4] = S, x[g + 5] = T, g += 6
          }
        };
        this.setIndex(new n.BufferAttribute(x, 1)), this.addAttribute("position", new n.BufferAttribute(p, 3)), this.addAttribute("normal", new n.BufferAttribute(f, 3)), this.addAttribute("uv", new n.BufferAttribute(m, 2))
      }, n.PlaneBufferGeometry.prototype = Object.create(n.BufferGeometry.prototype), n.PlaneBufferGeometry.prototype.constructor = n.PlaneBufferGeometry, n.RingBufferGeometry = function(e, t, i, r, o, a) {
        n.BufferGeometry.call(this), this.type = "RingBufferGeometry", this.parameters = {
          innerRadius: e,
          outerRadius: t,
          thetaSegments: i,
          phiSegments: r,
          thetaStart: o,
          thetaLength: a
        }, e = e || 20, t = t || 50, o = void(0) !== o ? o : 0, a = void(0) !== a ? a : 2 * Math.PI, i = void(0) !== i ? Math.max(3, i) : 8, r = void(0) !== r ? Math.max(1, r) : 1;
        var s, h, l, c = (i + 1) * (r + 1),
          u = i * r * 2 * 3,
          d = new n.BufferAttribute(new(u > 65535 ? Uint32Array : Uint16Array)(u), 1),
          p = new n.BufferAttribute(new Float32Array(3 * c), 3),
          f = new n.BufferAttribute(new Float32Array(3 * c), 3),
          m = new n.BufferAttribute(new Float32Array(2 * c), 2),
          g = 0,
          v = 0,
          y = e,
          b = (t - e) / r,
          w = new n.Vector3,
          _ = new n.Vector2;
        for (h = 0; r >= h; h++) {
          for (l = 0; i >= l; l++) {
            s = o + l / i * a, w.x = y * Math.cos(s), w.y = y * Math.sin(s), p.setXYZ(g, w.x, w.y, w.z), f.setXYZ(g, 0, 0, 1), _.x = (w.x / t + 1) / 2, _.y = (w.y / t + 1) / 2, m.setXY(g, _.x, _.y), g++
          };
          y += b
        };
        for (h = 0; r > h; h++) {
          var x = h * (i + 1);
          for (l = 0; i > l; l++) {
            s = l + x;
            var M = s,
              E = s + i + 1,
              S = s + i + 2,
              T = s + 1;
            d.setX(v, M), v++, d.setX(v, E), v++, d.setX(v, S), v++, d.setX(v, M), v++, d.setX(v, S), v++, d.setX(v, T), v++
          }
        };
        this.setIndex(d), this.addAttribute("position", p), this.addAttribute("normal", f), this.addAttribute("uv", m)
      }, n.RingBufferGeometry.prototype = Object.create(n.BufferGeometry.prototype), n.RingBufferGeometry.prototype.constructor = n.RingBufferGeometry, n.RingGeometry = function(e, t, i, r, o, a) {
        n.Geometry.call(this), this.type = "RingGeometry", this.parameters = {
          innerRadius: e,
          outerRadius: t,
          thetaSegments: i,
          phiSegments: r,
          thetaStart: o,
          thetaLength: a
        }, this.fromBufferGeometry(new n.RingBufferGeometry(e, t, i, r, o, a))
      }, n.RingGeometry.prototype = Object.create(n.Geometry.prototype), n.RingGeometry.prototype.constructor = n.RingGeometry, n.SphereGeometry = function(e, t, i, r, o, a, s) {
        n.Geometry.call(this), this.type = "SphereGeometry", this.parameters = {
          radius: e,
          widthSegments: t,
          heightSegments: i,
          phiStart: r,
          phiLength: o,
          thetaStart: a,
          thetaLength: s
        }, this.fromBufferGeometry(new n.SphereBufferGeometry(e, t, i, r, o, a, s))
      }, n.SphereGeometry.prototype = Object.create(n.Geometry.prototype), n.SphereGeometry.prototype.constructor = n.SphereGeometry, n.SphereBufferGeometry = function(e, t, i, r, o, a, s) {
        n.BufferGeometry.call(this), this.type = "SphereBufferGeometry", this.parameters = {
          radius: e,
          widthSegments: t,
          heightSegments: i,
          phiStart: r,
          phiLength: o,
          thetaStart: a,
          thetaLength: s
        }, e = e || 50, t = Math.max(3, Math.floor(t) || 8), i = Math.max(2, Math.floor(i) || 6), r = void(0) !== r ? r : 0, o = void(0) !== o ? o : 2 * Math.PI, a = void(0) !== a ? a : 0, s = void(0) !== s ? s : Math.PI;
        for (var h = a + s, l = (t + 1) * (i + 1), c = new n.BufferAttribute(new Float32Array(3 * l), 3), u = new n.BufferAttribute(new Float32Array(3 * l), 3), d = new n.BufferAttribute(new Float32Array(2 * l), 2), p = 0, f = [], m = new n.Vector3, g = 0; i >= g; g++) {
          for (var v = [], y = g / i, b = 0; t >= b; b++) {
            var w = b / t,
              _ = -e * Math.cos(r + w * o) * Math.sin(a + y * s),
              x = e * Math.cos(a + y * s),
              M = e * Math.sin(r + w * o) * Math.sin(a + y * s);
            m["set"](_, x, M).normalize(), c.setXYZ(p, _, x, M), u.setXYZ(p, m.x, m.y, m.z), d.setXY(p, w, 1 - y), v.push(p), p++
          };
          f.push(v)
        };
        for (var E = [], g = 0; i > g; g++) {
          for (var b = 0; t > b; b++) {
            var S = f[g][b + 1],
              T = f[g][b],
              P = f[g + 1][b],
              A = f[g + 1][b + 1];
            (0 !== g || a > 0) && E.push(S, T, A), (g !== i - 1 || h < Math.PI) && E.push(T, P, A)
          }
        };
        this.setIndex(new(c.count > 65535 ? n.Uint32Attribute : n.Uint16Attribute)(E, 1)), this.addAttribute("position", c), this.addAttribute("normal", u), this.addAttribute("uv", d), this.boundingSphere = new n.Sphere(new n.Vector3, e)
      }, n.SphereBufferGeometry.prototype = Object.create(n.BufferGeometry.prototype), n.SphereBufferGeometry.prototype.constructor = n.SphereBufferGeometry, n.TextGeometry = function(e, t) {
        t = t || {};
        var i = t.font;
        if (i instanceof n.Font == !1) {
          return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."), new n.Geometry
        };
        var r = i.generateShapes(e, t.size, t.curveSegments);
        t.amount = void(0) !== t.height ? t.height : 50, void(0) === t.bevelThickness && (t.bevelThickness = 10), void(0) === t.bevelSize && (t.bevelSize = 8), void(0) === t.bevelEnabled && (t.bevelEnabled = !1), n.ExtrudeGeometry.call(this, r, t), this.type = "TextGeometry"
      }, n.TextGeometry.prototype = Object.create(n.ExtrudeGeometry.prototype), n.TextGeometry.prototype.constructor = n.TextGeometry, n.TorusBufferGeometry = function(e, t, i, r, o) {
        n.BufferGeometry.call(this), this.type = "TorusBufferGeometry", this.parameters = {
          radius: e,
          tube: t,
          radialSegments: i,
          tubularSegments: r,
          arc: o
        }, e = e || 100, t = t || 40, i = Math.floor(i) || 8, r = Math.floor(r) || 6, o = o || 2 * Math.PI;
        var a, s, h = (i + 1) * (r + 1),
          l = i * r * 2 * 3,
          c = new(l > 65535 ? Uint32Array : Uint16Array)(l),
          u = new Float32Array(3 * h),
          d = new Float32Array(3 * h),
          p = new Float32Array(2 * h),
          f = 0,
          m = 0,
          g = 0,
          v = new n.Vector3,
          y = new n.Vector3,
          b = new n.Vector3;
        for (a = 0; i >= a; a++) {
          for (s = 0; r >= s; s++) {
            var w = s / r * o,
              _ = a / i * Math.PI * 2;
            y.x = (e + t * Math.cos(_)) * Math.cos(w), y.y = (e + t * Math.cos(_)) * Math.sin(w), y.z = t * Math.sin(_), u[f] = y.x, u[f + 1] = y.y, u[f + 2] = y.z, v.x = e * Math.cos(w), v.y = e * Math.sin(w), b.subVectors(y, v).normalize(), d[f] = b.x, d[f + 1] = b.y, d[f + 2] = b.z, p[m] = s / r, p[m + 1] = a / i, f += 3, m += 2
          }
        };
        for (a = 1; i >= a; a++) {
          for (s = 1; r >= s; s++) {
            var x = (r + 1) * a + s - 1,
              M = (r + 1) * (a - 1) + s - 1,
              E = (r + 1) * (a - 1) + s,
              S = (r + 1) * a + s;
            c[g] = x, c[g + 1] = M, c[g + 2] = S, c[g + 3] = M, c[g + 4] = E, c[g + 5] = S, g += 6
          }
        };
        this.setIndex(new n.BufferAttribute(c, 1)), this.addAttribute("position", new n.BufferAttribute(u, 3)), this.addAttribute("normal", new n.BufferAttribute(d, 3)), this.addAttribute("uv", new n.BufferAttribute(p, 2))
      }, n.TorusBufferGeometry.prototype = Object.create(n.BufferGeometry.prototype), n.TorusBufferGeometry.prototype.constructor = n.TorusBufferGeometry, n.TorusGeometry = function(e, t, i, r, o) {
        n.Geometry.call(this), this.type = "TorusGeometry", this.parameters = {
          radius: e,
          tube: t,
          radialSegments: i,
          tubularSegments: r,
          arc: o
        }, this.fromBufferGeometry(new n.TorusBufferGeometry(e, t, i, r, o))
      }, n.TorusGeometry.prototype = Object.create(n.Geometry.prototype), n.TorusGeometry.prototype.constructor = n.TorusGeometry, n.TorusKnotBufferGeometry = function(e, t, i, r, o, a) {
        function s(e, t, i, n, r) {
          var o = Math.cos(e),
            a = Math.sin(e),
            s = i / t * e,
            h = Math.cos(s);
          r.x = n * (2 + h) * 0.5 * o, r.y = n * (2 + h) * a * 0.5, r.z = n * Math.sin(s) * 0.5
        }
        n.BufferGeometry.call(this), this.type = "TorusKnotBufferGeometry", this.parameters = {
          radius: e,
          tube: t,
          tubularSegments: i,
          radialSegments: r,
          p: o,
          q: a
        }, e = e || 100, t = t || 40, i = Math.floor(i) || 64, r = Math.floor(r) || 8, o = o || 2, a = a || 3;
        var h, l, c = (r + 1) * (i + 1),
          u = r * i * 2 * 3,
          d = new n.BufferAttribute(new(u > 65535 ? Uint32Array : Uint16Array)(u), 1),
          p = new n.BufferAttribute(new Float32Array(3 * c), 3),
          f = new n.BufferAttribute(new Float32Array(3 * c), 3),
          m = new n.BufferAttribute(new Float32Array(2 * c), 2),
          g = 0,
          v = 0,
          y = new n.Vector3,
          b = new n.Vector3,
          w = new n.Vector2,
          _ = new n.Vector3,
          x = new n.Vector3,
          M = new n.Vector3,
          E = new n.Vector3,
          S = new n.Vector3;
        for (h = 0; i >= h; ++h) {
          var T = h / i * o * Math.PI * 2;
          for (s(T, o, a, e, _), s(T + 0.01, o, a, e, x), E.subVectors(x, _), S.addVectors(x, _), M.crossVectors(E, S), S.crossVectors(M, E), M.normalize(), S.normalize(), l = 0; r >= l; ++l) {
            var P = l / r * Math.PI * 2,
              A = -t * Math.cos(P),
              L = t * Math.sin(P);
            y.x = _.x + (A * S.x + L * M.x), y.y = _.y + (A * S.y + L * M.y), y.z = _.z + (A * S.z + L * M.z), p.setXYZ(g, y.x, y.y, y.z), b.subVectors(y, _).normalize(), f.setXYZ(g, b.x, b.y, b.z), w.x = h / i, w.y = l / r, m.setXY(g, w.x, w.y), g++
          }
        };
        for (l = 1; i >= l; l++) {
          for (h = 1; r >= h; h++) {
            var C = (r + 1) * (l - 1) + (h - 1),
              R = (r + 1) * l + (h - 1),
              I = (r + 1) * l + h,
              D = (r + 1) * (l - 1) + h;
            d.setX(v, C), v++, d.setX(v, R), v++, d.setX(v, D), v++, d.setX(v, R), v++, d.setX(v, I), v++, d.setX(v, D), v++
          }
        };
        this.setIndex(d), this.addAttribute("position", p), this.addAttribute("normal", f), this.addAttribute("uv", m)
      }, n.TorusKnotBufferGeometry.prototype = Object.create(n.BufferGeometry.prototype), n.TorusKnotBufferGeometry.prototype.constructor = n.TorusKnotBufferGeometry, n.TorusKnotGeometry = function(e, t, i, r, o, a, s) {
        n.Geometry.call(this), this.type = "TorusKnotGeometry", this.parameters = {
          radius: e,
          tube: t,
          tubularSegments: i,
          radialSegments: r,
          p: o,
          q: a
        }, void(0) !== s && console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."), this.fromBufferGeometry(new n.TorusKnotBufferGeometry(e, t, i, r, o, a)), this.mergeVertices()
      }, n.TorusKnotGeometry.prototype = Object.create(n.Geometry.prototype), n.TorusKnotGeometry.prototype.constructor = n.TorusKnotGeometry, n.TubeGeometry = function(e, t, i, r, o, a) {
        function s(e, t, i) {
          return C.vertices.push(new n.Vector3(e, t, i)) - 1
        }
        n.Geometry.call(this), this.type = "TubeGeometry", this.parameters = {
          path: e,
          segments: t,
          radius: i,
          radialSegments: r,
          closed: o,
          taper: a
        }, t = t || 64, i = i || 1, r = r || 8, o = o || !1, a = a || n.TubeGeometry.NoTaper;
        var h, l, c, u, d, p, f, m, g, v, y, b, w, _, x, M, E, S, T, P, A, L = [],
          C = this,
          R = t + 1,
          I = new n.Vector3,
          D = new n.TubeGeometry.FrenetFrames(e, t, o),
          O = D.tangents,
          k = D.normals,
          B = D.binormals;
        for (this.tangents = O, this.normals = k, this.binormals = B, v = 0; R > v; v++) {
          for (L[v] = [], u = v / (R - 1), g = e.getPointAt(u), h = O[v], l = k[v], c = B[v], p = i * a(u), y = 0; r > y; y++) {
            d = y / r * 2 * Math.PI, f = -p * Math.cos(d), m = p * Math.sin(d), I.copy(g), I.x += f * l.x + m * c.x, I.y += f * l.y + m * c.y, I.z += f * l.z + m * c.z, L[v][y] = s(I.x, I.y, I.z)
          }
        };
        for (v = 0; t > v; v++) {
          for (y = 0; r > y; y++) {
            b = o ? (v + 1) % t : v + 1, w = (y + 1) % r, _ = L[v][y], x = L[b][y], M = L[b][w], E = L[v][w], S = new n.Vector2(v / t, y / r), T = new n.Vector2((v + 1) / t, y / r), P = new n.Vector2((v + 1) / t, (y + 1) / r), A = new n.Vector2(v / t, (y + 1) / r), this.faces.push(new n.Face3(_, x, E)), this.faceVertexUvs[0].push([S, T, A]), this.faces.push(new n.Face3(x, M, E)), this.faceVertexUvs[0].push([T.clone(), P, A.clone()])
          }
        };
        this.computeFaceNormals(), this.computeVertexNormals()
      }, n.TubeGeometry.prototype = Object.create(n.Geometry.prototype), n.TubeGeometry.prototype.constructor = n.TubeGeometry, n.TubeGeometry.NoTaper = function(e) {
        return 1
      }, n.TubeGeometry.SinusoidalTaper = function(e) {
        return Math.sin(Math.PI * e)
      }, n.TubeGeometry.FrenetFrames = function(e, t, i) {
        function r() {
          f[0] = new n.Vector3, m[0] = new n.Vector3, a = Number.MAX_VALUE, s = Math.abs(p[0].x), h = Math.abs(p[0].y), l = Math.abs(p[0].z), a >= s && (a = s, d["set"](1, 0, 0)), a >= h && (a = h, d["set"](0, 1, 0)), a >= l && d["set"](0, 0, 1), g.crossVectors(p[0], d).normalize(), f[0].crossVectors(p[0], g), m[0].crossVectors(p[0], f[0])
        }
        var o, a, s, h, l, c, u, d = new n.Vector3,
          p = [],
          f = [],
          m = [],
          g = new n.Vector3,
          v = new n.Matrix4,
          y = t + 1;
        for (this.tangents = p, this.normals = f, this.binormals = m, c = 0; y > c; c++) {
          u = c / (y - 1), p[c] = e.getTangentAt(u), p[c].normalize()
        };
        for (r(), c = 1; y > c; c++) {
          f[c] = f[c - 1].clone(), m[c] = m[c - 1].clone(), g.crossVectors(p[c - 1], p[c]), g.length() > Number.EPSILON && (g.normalize(), o = Math.acos(n.Math.clamp(p[c - 1].dot(p[c]), -1, 1)), f[c].applyMatrix4(v.makeRotationAxis(g, o))), m[c].crossVectors(p[c], f[c])
        };
        if (i) {
          for (o = Math.acos(n.Math.clamp(f[0].dot(f[y - 1]), -1, 1)), o /= y - 1, p[0].dot(g.crossVectors(f[0], f[y - 1])) > 0 && (o = -o), c = 1; y > c; c++) {
            f[c].applyMatrix4(v.makeRotationAxis(p[c], o * c)), m[c].crossVectors(p[c], f[c])
          }
        }
      }, n.PolyhedronGeometry = function(e, t, i, r) {
        function o(e) {
          var t = e.normalize().clone();
          t.index = u.vertices.push(t) - 1;
          var i = h(e) / 2 / Math.PI + 0.5,
            r = l(e) / Math.PI + 0.5;
          return t.uv = new n.Vector2(i, 1 - r), t
        }

        function a(e, t, i, r) {
          var o = new n.Face3(e.index, t.index, i.index, [e.clone(), t.clone(), i.clone()], void(0), r);
          u.faces.push(o), w.copy(e).add(t).add(i).divideScalar(3);
          var a = h(w);
          u.faceVertexUvs[0].push([c(e.uv, e, a), c(t.uv, t, a), c(i.uv, i, a)])
        }

        function s(e, t) {
          for (var i = Math.pow(2, t), n = o(u.vertices[e.a]), r = o(u.vertices[e.b]), s = o(u.vertices[e.c]), h = [], l = e.materialIndex, c = 0; i >= c; c++) {
            h[c] = [];
            for (var d = o(n.clone().lerp(s, c / i)), p = o(r.clone().lerp(s, c / i)), f = i - c, m = 0; f >= m; m++) {
              h[c][m] = 0 === m && c === i ? d : o(d.clone().lerp(p, m / f))
            }
          };
          for (var c = 0; i > c; c++) {
            for (var m = 0; 2 * (i - c) - 1 > m; m++) {
              var g = Math.floor(m / 2);
              m % 2 === 0 ? a(h[c][g + 1], h[c + 1][g], h[c][g], l) : a(h[c][g + 1], h[c + 1][g + 1], h[c + 1][g], l)
            }
          }
        }

        function h(e) {
          return Math.atan2(e.z, -e.x)
        }

        function l(e) {
          return Math.atan2(-e.y, Math.sqrt(e.x * e.x + e.z * e.z))
        }

        function c(e, t, i) {
          return 0 > i && 1 === e.x && (e = new n.Vector2(e.x - 1, e.y)), 0 === t.x && 0 === t.z && (e = new n.Vector2(i / 2 / Math.PI + 0.5, e.y)), e.clone()
        }
        n.Geometry.call(this), this.type = "PolyhedronGeometry", this.parameters = {
          vertices: e,
          indices: t,
          radius: i,
          detail: r
        }, i = i || 1, r = r || 0;
        for (var u = this, d = 0, p = e.length; p > d; d += 3) {
          o(new n.Vector3(e[d], e[d + 1], e[d + 2]))
        };
        for (var f = this.vertices, m = [], d = 0, g = 0, p = t.length; p > d; d += 3, g++) {
          var v = f[t[d]],
            y = f[t[d + 1]],
            b = f[t[d + 2]];
          m[g] = new n.Face3(v.index, y.index, b.index, [v.clone(), y.clone(), b.clone()], void(0), g)
        };
        for (var w = new n.Vector3, d = 0, p = m.length; p > d; d++) {
          s(m[d], r)
        };
        for (var d = 0, p = this.faceVertexUvs[0].length; p > d; d++) {
          var _ = this.faceVertexUvs[0][d],
            x = _[0].x,
            M = _[1].x,
            E = _[2].x,
            S = Math.max(x, M, E),
            T = Math.min(x, M, E);
          S > 0.9 && 0.1 > T && (0.2 > x && (_[0].x += 1), 0.2 > M && (_[1].x += 1), 0.2 > E && (_[2].x += 1))
        };
        for (var d = 0, p = this.vertices.length; p > d; d++) {
          this.vertices[d].multiplyScalar(i)
        };
        this.mergeVertices(), this.computeFaceNormals(), this.boundingSphere = new n.Sphere(new n.Vector3, i)
      }, n.PolyhedronGeometry.prototype = Object.create(n.Geometry.prototype), n.PolyhedronGeometry.prototype.constructor = n.PolyhedronGeometry, n.DodecahedronGeometry = function(e, t) {
        var i = (1 + Math.sqrt(5)) / 2,
          r = 1 / i,
          o = [-1, -1, -1, -1, -1, 1, -1, 1, -1, -1, 1, 1, 1, -1, -1, 1, -1, 1, 1, 1, -1, 1, 1, 1, 0, -r, -i, 0, -r, i, 0, r, -i, 0, r, i, -r, -i, 0, -r, i, 0, r, -i, 0, r, i, 0, -i, 0, -r, i, 0, -r, -i, 0, r, i, 0, r],
          a = [3, 11, 7, 3, 7, 15, 3, 15, 13, 7, 19, 17, 7, 17, 6, 7, 6, 15, 17, 4, 8, 17, 8, 10, 17, 10, 6, 8, 0, 16, 8, 16, 2, 8, 2, 10, 0, 12, 1, 0, 1, 18, 0, 18, 16, 6, 10, 2, 6, 2, 13, 6, 13, 15, 2, 16, 18, 2, 18, 3, 2, 3, 13, 18, 1, 9, 18, 9, 11, 18, 11, 3, 4, 14, 12, 4, 12, 0, 4, 0, 8, 11, 9, 5, 11, 5, 19, 11, 19, 7, 19, 5, 14, 19, 14, 4, 19, 4, 17, 1, 12, 14, 1, 14, 5, 1, 5, 9];
        n.PolyhedronGeometry.call(this, o, a, e, t), this.type = "DodecahedronGeometry", this.parameters = {
          radius: e,
          detail: t
        }
      }, n.DodecahedronGeometry.prototype = Object.create(n.PolyhedronGeometry.prototype), n.DodecahedronGeometry.prototype.constructor = n.DodecahedronGeometry, n.IcosahedronGeometry = function(e, t) {
        var i = (1 + Math.sqrt(5)) / 2,
          r = [-1, i, 0, 1, i, 0, -1, -i, 0, 1, -i, 0, 0, -1, i, 0, 1, i, 0, -1, -i, 0, 1, -i, i, 0, -1, i, 0, 1, -i, 0, -1, -i, 0, 1],
          o = [0, 11, 5, 0, 5, 1, 0, 1, 7, 0, 7, 10, 0, 10, 11, 1, 5, 9, 5, 11, 4, 11, 10, 2, 10, 7, 6, 7, 1, 8, 3, 9, 4, 3, 4, 2, 3, 2, 6, 3, 6, 8, 3, 8, 9, 4, 9, 5, 2, 4, 11, 6, 2, 10, 8, 6, 7, 9, 8, 1];
        n.PolyhedronGeometry.call(this, r, o, e, t), this.type = "IcosahedronGeometry", this.parameters = {
          radius: e,
          detail: t
        }
      }, n.IcosahedronGeometry.prototype = Object.create(n.PolyhedronGeometry.prototype), n.IcosahedronGeometry.prototype.constructor = n.IcosahedronGeometry, n.OctahedronGeometry = function(e, t) {
        var i = [1, 0, 0, -1, 0, 0, 0, 1, 0, 0, -1, 0, 0, 0, 1, 0, 0, -1],
          r = [0, 2, 4, 0, 4, 3, 0, 3, 5, 0, 5, 2, 1, 2, 5, 1, 5, 3, 1, 3, 4, 1, 4, 2];
        n.PolyhedronGeometry.call(this, i, r, e, t), this.type = "OctahedronGeometry", this.parameters = {
          radius: e,
          detail: t
        }
      }, n.OctahedronGeometry.prototype = Object.create(n.PolyhedronGeometry.prototype), n.OctahedronGeometry.prototype.constructor = n.OctahedronGeometry, n.TetrahedronGeometry = function(e, t) {
        var i = [1, 1, 1, -1, -1, 1, -1, 1, -1, 1, -1, -1],
          r = [2, 1, 0, 0, 3, 2, 1, 3, 0, 2, 3, 1];
        n.PolyhedronGeometry.call(this, i, r, e, t), this.type = "TetrahedronGeometry", this.parameters = {
          radius: e,
          detail: t
        }
      }, n.TetrahedronGeometry.prototype = Object.create(n.PolyhedronGeometry.prototype), n.TetrahedronGeometry.prototype.constructor = n.TetrahedronGeometry, n.ParametricGeometry = function(e, t, i) {
        n.Geometry.call(this), this.type = "ParametricGeometry", this.parameters = {
          func: e,
          slices: t,
          stacks: i
        };
        var r, o, a, s, h, l = this.vertices,
          c = this.faces,
          u = this.faceVertexUvs[0],
          d = t + 1;
        for (r = 0; i >= r; r++) {
          for (h = r / i, o = 0; t >= o; o++) {
            s = o / t, a = e(s, h), l.push(a)
          }
        };
        var p, f, m, g, v, y, b, w;
        for (r = 0; i > r; r++) {
          for (o = 0; t > o; o++) {
            p = r * d + o, f = r * d + o + 1, m = (r + 1) * d + o + 1, g = (r + 1) * d + o, v = new n.Vector2(o / t, r / i), y = new n.Vector2((o + 1) / t, r / i), b = new n.Vector2((o + 1) / t, (r + 1) / i), w = new n.Vector2(o / t, (r + 1) / i), c.push(new n.Face3(p, f, g)), u.push([v, y, w]), c.push(new n.Face3(f, m, g)), u.push([y.clone(), b, w.clone()])
          }
        };
        this.computeFaceNormals(), this.computeVertexNormals()
      }, n.ParametricGeometry.prototype = Object.create(n.Geometry.prototype), n.ParametricGeometry.prototype.constructor = n.ParametricGeometry, n.WireframeGeometry = function(e) {
        function t(e, t) {
          return e - t
        }
        n.BufferGeometry.call(this);
        var i = [0, 0],
          r = {},
          o = ["a", "b", "c"];
        if (e instanceof n.Geometry) {
          for (var a = e.vertices, s = e.faces, h = 0, l = new Uint32Array(6 * s.length), c = 0, u = s.length; u > c; c++) {
            for (var d = s[c], p = 0; 3 > p; p++) {
              i[0] = d[o[p]], i[1] = d[o[(p + 1) % 3]], i.sort(t);
              var f = i.toString();
              void(0) === r[f] && (l[2 * h] = i[0], l[2 * h + 1] = i[1], r[f] = !0, h++)
            }
          };
          for (var m = new Float32Array(2 * h * 3), c = 0, u = h; u > c; c++) {
            for (var p = 0; 2 > p; p++) {
              var g = a[l[2 * c + p]],
                v = 6 * c + 3 * p;
              m[v + 0] = g.x, m[v + 1] = g.y, m[v + 2] = g.z
            }
          };
          this.addAttribute("position", new n.BufferAttribute(m, 3))
        } else {
          if (e instanceof n.BufferGeometry) {
            if (null !== e.index) {
              var y = e.index.array,
                a = e.attributes.position,
                b = e.groups,
                h = 0;
              0 === b.length && e.addGroup(0, y.length);
              for (var l = new Uint32Array(2 * y.length), w = 0, _ = b.length; _ > w; ++w) {
                for (var x = b[w], M = x.start, E = x.count, c = M, S = M + E; S > c; c += 3) {
                  for (var p = 0; 3 > p; p++) {
                    i[0] = y[c + p], i[1] = y[c + (p + 1) % 3], i.sort(t);
                    var f = i.toString();
                    void(0) === r[f] && (l[2 * h] = i[0], l[2 * h + 1] = i[1], r[f] = !0, h++)
                  }
                }
              };
              for (var m = new Float32Array(2 * h * 3), c = 0, u = h; u > c; c++) {
                for (var p = 0; 2 > p; p++) {
                  var v = 6 * c + 3 * p,
                    T = l[2 * c + p];
                  m[v + 0] = a.getX(T), m[v + 1] = a.getY(T), m[v + 2] = a.getZ(T)
                }
              };
              this.addAttribute("position", new n.BufferAttribute(m, 3))
            } else {
              for (var a = e.attributes.position.array, h = a.length / 3, P = h / 3, m = new Float32Array(2 * h * 3), c = 0, u = P; u > c; c++) {
                for (var p = 0; 3 > p; p++) {
                  var v = 18 * c + 6 * p,
                    A = 9 * c + 3 * p;
                  m[v + 0] = a[A], m[v + 1] = a[A + 1], m[v + 2] = a[A + 2];
                  var T = 9 * c + 3 * ((p + 1) % 3);
                  m[v + 3] = a[T], m[v + 4] = a[T + 1], m[v + 5] = a[T + 2]
                }
              };
              this.addAttribute("position", new n.BufferAttribute(m, 3))
            }
          }
        }
      }, n.WireframeGeometry.prototype = Object.create(n.BufferGeometry.prototype), n.WireframeGeometry.prototype.constructor = n.WireframeGeometry, n.AxisHelper = function(e) {
        e = e || 1;
        var t = new Float32Array([0, 0, 0, e, 0, 0, 0, 0, 0, 0, e, 0, 0, 0, 0, 0, 0, e]),
          i = new Float32Array([1, 0, 0, 1, 0.6, 0, 0, 1, 0, 0.6, 1, 0, 0, 0, 1, 0, 0.6, 1]),
          r = new n.BufferGeometry;
        r.addAttribute("position", new n.BufferAttribute(t, 3)), r.addAttribute("color", new n.BufferAttribute(i, 3));
        var o = new n.LineBasicMaterial({
          vertexColors: n.VertexColors
        });
        n.LineSegments.call(this, r, o)
      }, n.AxisHelper.prototype = Object.create(n.LineSegments.prototype), n.AxisHelper.prototype.constructor = n.AxisHelper, n.ArrowHelper = function() {
        var e = new n.Geometry;
        e.vertices.push(new n.Vector3(0, 0, 0), new n.Vector3(0, 1, 0));
        var t = new n.CylinderGeometry(0, 0.5, 1, 5, 1);
        return t.translate(0, -0.5, 0),
          function(i, r, o, a, s, h) {
            n.Object3D.call(this), void(0) === a && (a = 16776960), void(0) === o && (o = 1), void(0) === s && (s = 0.2 * o), void(0) === h && (h = 0.2 * s), this.position.copy(r), this.line = new n.Line(e, new n.LineBasicMaterial({
              color: a
            })), this.line.matrixAutoUpdate = !1, this.add(this.line), this.cone = new n.Mesh(t, new n.MeshBasicMaterial({
              color: a
            })), this.cone.matrixAutoUpdate = !1, this.add(this.cone), this.setDirection(i), this.setLength(o, s, h)
          }
      }(), n.ArrowHelper.prototype = Object.create(n.Object3D.prototype), n.ArrowHelper.prototype.constructor = n.ArrowHelper, n.ArrowHelper.prototype.setDirection = function() {
        var e, t = new n.Vector3;
        return function(i) {
          i.y > 0.99999 ? this.quaternion["set"](0, 0, 0, 1) : i.y < -0.99999 ? this.quaternion["set"](1, 0, 0, 0) : (t["set"](i.z, 0, -i.x).normalize(), e = Math.acos(i.y), this.quaternion.setFromAxisAngle(t, e))
        }
      }(), n.ArrowHelper.prototype.setLength = function(e, t, i) {
        void(0) === t && (t = 0.2 * e), void(0) === i && (i = 0.2 * t), this.line.scale["set"](1, Math.max(0, e - t), 1), this.line.updateMatrix(), this.cone.scale["set"](i, t, i), this.cone.position.y = e, this.cone.updateMatrix()
      }, n.ArrowHelper.prototype.setColor = function(e) {
        this.line.material.color["set"](e), this.cone.material.color["set"](e)
      }, n.BoxHelper = function(e) {
        var t = new Uint16Array([0, 1, 1, 2, 2, 3, 3, 0, 4, 5, 5, 6, 6, 7, 7, 4, 0, 4, 1, 5, 2, 6, 3, 7]),
          i = new Float32Array(24),
          r = new n.BufferGeometry;
        r.setIndex(new n.BufferAttribute(t, 1)), r.addAttribute("position", new n.BufferAttribute(i, 3)), n.LineSegments.call(this, r, new n.LineBasicMaterial({
          color: 16776960
        })), void(0) !== e && this.update(e)
      }, n.BoxHelper.prototype = Object.create(n.LineSegments.prototype), n.BoxHelper.prototype.constructor = n.BoxHelper, n.BoxHelper.prototype.update = function() {
        var e = new n.Box3;
        return function(t) {
          if (e.setFromObject(t), !e.isEmpty()) {
            var i = e.min,
              n = e.max,
              r = this.geometry.attributes.position,
              o = r.array;
            o[0] = n.x, o[1] = n.y, o[2] = n.z, o[3] = i.x, o[4] = n.y, o[5] = n.z, o[6] = i.x, o[7] = i.y, o[8] = n.z, o[9] = n.x, o[10] = i.y, o[11] = n.z, o[12] = n.x, o[13] = n.y, o[14] = i.z, o[15] = i.x, o[16] = n.y, o[17] = i.z, o[18] = i.x, o[19] = i.y, o[20] = i.z, o[21] = n.x, o[22] = i.y, o[23] = i.z, r.needsUpdate = !0, this.geometry.computeBoundingSphere()
          }
        }
      }(), n.BoundingBoxHelper = function(e, t) {
        var i = void(0) !== t ? t : 8947848;
        this.object = e, this.box = new n.Box3, n.Mesh.call(this, new n.BoxGeometry(1, 1, 1), new n.MeshBasicMaterial({
          color: i,
          wireframe: !0
        }))
      }, n.BoundingBoxHelper.prototype = Object.create(n.Mesh.prototype), n.BoundingBoxHelper.prototype.constructor = n.BoundingBoxHelper, n.BoundingBoxHelper.prototype.update = function() {
        this.box.setFromObject(this.object), this.box.size(this.scale), this.box.center(this.position)
      }, n.CameraHelper = function(e) {
        function t(e, t, n) {
          i(e, n), i(t, n)
        }

        function i(e, t) {
          r.vertices.push(new n.Vector3), r.colors.push(new n.Color(t)), void(0) === a[e] && (a[e] = []), a[e].push(r.vertices.length - 1)
        }
        var r = new n.Geometry,
          o = new n.LineBasicMaterial({
            color: 16777215,
            vertexColors: n.FaceColors
          }),
          a = {},
          s = 16755200,
          h = 16711680,
          l = 43775,
          c = 16777215,
          u = 3355443;
        t("n1", "n2", s), t("n2", "n4", s), t("n4", "n3", s), t("n3", "n1", s), t("f1", "f2", s), t("f2", "f4", s), t("f4", "f3", s), t("f3", "f1", s), t("n1", "f1", s), t("n2", "f2", s), t("n3", "f3", s), t("n4", "f4", s), t("p", "n1", h), t("p", "n2", h), t("p", "n3", h), t("p", "n4", h), t("u1", "u2", l), t("u2", "u3", l), t("u3", "u1", l), t("c", "t", c), t("p", "c", u), t("cn1", "cn2", u), t("cn3", "cn4", u), t("cf1", "cf2", u), t("cf3", "cf4", u), n.LineSegments.call(this, r, o), this.camera = e, this.camera.updateProjectionMatrix(), this.matrix = e.matrixWorld, this.matrixAutoUpdate = !1, this.pointMap = a, this.update()
      }, n.CameraHelper.prototype = Object.create(n.LineSegments.prototype), n.CameraHelper.prototype.constructor = n.CameraHelper, n.CameraHelper.prototype.update = function() {
        function e(e, n, a, s) {
          r["set"](n, a, s).unproject(o);
          var h = i[e];
          if (void(0) !== h) {
            for (var l = 0, c = h.length; c > l; l++) {
              t.vertices[h[l]].copy(r)
            }
          }
        }
        var t, i, r = new n.Vector3,
          o = new n.Camera;
        return function() {
          t = this.geometry, i = this.pointMap;
          var n = 1,
            r = 1;
          o.projectionMatrix.copy(this.camera.projectionMatrix), e("c", 0, 0, -1), e("t", 0, 0, 1), e("n1", -n, -r, -1), e("n2", n, -r, -1), e("n3", -n, r, -1), e("n4", n, r, -1), e("f1", -n, -r, 1), e("f2", n, -r, 1), e("f3", -n, r, 1), e("f4", n, r, 1), e("u1", 0.7 * n, 1.1 * r, -1), e("u2", 0.7 * -n, 1.1 * r, -1), e("u3", 0, 2 * r, -1), e("cf1", -n, 0, 1), e("cf2", n, 0, 1), e("cf3", 0, -r, 1), e("cf4", 0, r, 1), e("cn1", -n, 0, -1), e("cn2", n, 0, -1), e("cn3", 0, -r, -1), e("cn4", 0, r, -1), t.verticesNeedUpdate = !0
        }
      }(), n.DirectionalLightHelper = function(e, t) {
        n.Object3D.call(this), this.light = e, this.light.updateMatrixWorld(), this.matrix = e.matrixWorld, this.matrixAutoUpdate = !1, t = t || 1;
        var i = new n.Geometry;
        i.vertices.push(new n.Vector3(-t, t, 0), new n.Vector3(t, t, 0), new n.Vector3(t, -t, 0), new n.Vector3(-t, -t, 0), new n.Vector3(-t, t, 0));
        var r = new n.LineBasicMaterial({
          fog: !1
        });
        r.color.copy(this.light.color).multiplyScalar(this.light.intensity), this.lightPlane = new n.Line(i, r), this.add(this.lightPlane), i = new n.Geometry, i.vertices.push(new n.Vector3, new n.Vector3), r = new n.LineBasicMaterial({
          fog: !1
        }), r.color.copy(this.light.color).multiplyScalar(this.light.intensity), this.targetLine = new n.Line(i, r), this.add(this.targetLine), this.update()
      }, n.DirectionalLightHelper.prototype = Object.create(n.Object3D.prototype), n.DirectionalLightHelper.prototype.constructor = n.DirectionalLightHelper, n.DirectionalLightHelper.prototype.dispose = function() {
        this.lightPlane.geometry.dispose(), this.lightPlane.material.dispose(), this.targetLine.geometry.dispose(), this.targetLine.material.dispose()
      }, n.DirectionalLightHelper.prototype.update = function() {
        var e = new n.Vector3,
          t = new n.Vector3,
          i = new n.Vector3;
        return function() {
          e.setFromMatrixPosition(this.light.matrixWorld), t.setFromMatrixPosition(this.light.target.matrixWorld), i.subVectors(t, e), this.lightPlane.lookAt(i), this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity), this.targetLine.geometry.vertices[1].copy(i), this.targetLine.geometry.verticesNeedUpdate = !0, this.targetLine.material.color.copy(this.lightPlane.material.color)
        }
      }(), n.EdgesHelper = function(e, t, i) {
        var r = void(0) !== t ? t : 16777215;
        n.LineSegments.call(this, new n.EdgesGeometry(e.geometry, i), new n.LineBasicMaterial({
          color: r
        })), this.matrix = e.matrixWorld, this.matrixAutoUpdate = !1
      }, n.EdgesHelper.prototype = Object.create(n.LineSegments.prototype), n.EdgesHelper.prototype.constructor = n.EdgesHelper, n.FaceNormalsHelper = function(e, t, i, r) {
        this.object = e, this.size = void(0) !== t ? t : 1;
        var o = void(0) !== i ? i : 16776960,
          a = void(0) !== r ? r : 1,
          s = 0,
          h = this.object.geometry;
        h instanceof n.Geometry ? s = h.faces.length : console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");
        var l = new n.BufferGeometry,
          c = new n.Float32Attribute(2 * s * 3, 3);
        l.addAttribute("position", c), n.LineSegments.call(this, l, new n.LineBasicMaterial({
          color: o,
          linewidth: a
        })), this.matrixAutoUpdate = !1, this.update()
      }, n.FaceNormalsHelper.prototype = Object.create(n.LineSegments.prototype), n.FaceNormalsHelper.prototype.constructor = n.FaceNormalsHelper, n.FaceNormalsHelper.prototype.update = function() {
        var e = new n.Vector3,
          t = new n.Vector3,
          i = new n.Matrix3;
        return function() {
          this.object.updateMatrixWorld(!0), i.getNormalMatrix(this.object.matrixWorld);
          for (var n = this.object.matrixWorld, r = this.geometry.attributes.position, o = this.object.geometry, a = o.vertices, s = o.faces, h = 0, l = 0, c = s.length; c > l; l++) {
            var u = s[l],
              d = u.normal;
            e.copy(a[u.a]).add(a[u.b]).add(a[u.c]).divideScalar(3).applyMatrix4(n), t.copy(d).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e), r.setXYZ(h, e.x, e.y, e.z), h += 1, r.setXYZ(h, t.x, t.y, t.z), h += 1
          };
          return r.needsUpdate = !0, this
        }
      }(), n.GridHelper = function(e, t) {
        var i = new n.Geometry,
          r = new n.LineBasicMaterial({
            vertexColors: n.VertexColors
          });
        this.color1 = new n.Color(4473924), this.color2 = new n.Color(8947848);
        for (var o = -e; e >= o; o += t) {
          i.vertices.push(new n.Vector3(-e, 0, o), new n.Vector3(e, 0, o), new n.Vector3(o, 0, -e), new n.Vector3(o, 0, e));
          var a = 0 === o ? this.color1 : this.color2;
          i.colors.push(a, a, a, a)
        };
        n.LineSegments.call(this, i, r)
      }, n.GridHelper.prototype = Object.create(n.LineSegments.prototype), n.GridHelper.prototype.constructor = n.GridHelper, n.GridHelper.prototype.setColors = function(e, t) {
        this.color1["set"](e), this.color2["set"](t), this.geometry.colorsNeedUpdate = !0
      }, n.HemisphereLightHelper = function(e, t) {
        n.Object3D.call(this), this.light = e, this.light.updateMatrixWorld(), this.matrix = e.matrixWorld, this.matrixAutoUpdate = !1, this.colors = [new n.Color, new n.Color];
        var i = new n.SphereGeometry(t, 4, 2);
        i.rotateX(-Math.PI / 2);
        for (var r = 0, o = 8; o > r; r++) {
          i.faces[r].color = this.colors[4 > r ? 0 : 1]
        };
        var a = new n.MeshBasicMaterial({
          vertexColors: n.FaceColors,
          wireframe: !0
        });
        this.lightSphere = new n.Mesh(i, a), this.add(this.lightSphere), this.update()
      }, n.HemisphereLightHelper.prototype = Object.create(n.Object3D.prototype), n.HemisphereLightHelper.prototype.constructor = n.HemisphereLightHelper, n.HemisphereLightHelper.prototype.dispose = function() {
        this.lightSphere.geometry.dispose(), this.lightSphere.material.dispose()
      }, n.HemisphereLightHelper.prototype.update = function() {
        var e = new n.Vector3;
        return function() {
          this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity), this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity), this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()), this.lightSphere.geometry.colorsNeedUpdate = !0
        }
      }(), n.PointLightHelper = function(e, t) {
        this.light = e, this.light.updateMatrixWorld();
        var i = new n.SphereGeometry(t, 4, 2),
          r = new n.MeshBasicMaterial({
            wireframe: !0,
            fog: !1
          });
        r.color.copy(this.light.color).multiplyScalar(this.light.intensity), n.Mesh.call(this, i, r), this.matrix = this.light.matrixWorld, this.matrixAutoUpdate = !1
      }, n.PointLightHelper.prototype = Object.create(n.Mesh.prototype), n.PointLightHelper.prototype.constructor = n.PointLightHelper, n.PointLightHelper.prototype.dispose = function() {
        this.geometry.dispose(), this.material.dispose()
      }, n.PointLightHelper.prototype.update = function() {
        this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)
      }, n.SkeletonHelper = function(e) {
        this.bones = this.getBoneList(e);
        for (var t = new n.Geometry, i = 0; i < this.bones.length; i++) {
          var r = this.bones[i];
          r.parent instanceof n.Bone && (t.vertices.push(new n.Vector3), t.vertices.push(new n.Vector3), t.colors.push(new n.Color(0, 0, 1)), t.colors.push(new n.Color(0, 1, 0)))
        };
        t.dynamic = !0;
        var o = new n.LineBasicMaterial({
          vertexColors: n.VertexColors,
          depthTest: !1,
          depthWrite: !1,
          transparent: !0
        });
        n.LineSegments.call(this, t, o), this.root = e, this.matrix = e.matrixWorld, this.matrixAutoUpdate = !1, this.update()
      }, n.SkeletonHelper.prototype = Object.create(n.LineSegments.prototype), n.SkeletonHelper.prototype.constructor = n.SkeletonHelper, n.SkeletonHelper.prototype.getBoneList = function(e) {
        var t = [];
        e instanceof n.Bone && t.push(e);
        for (var i = 0; i < e.children.length; i++) {
          t.push.apply(t, this.getBoneList(e.children[i]))
        };
        return t
      }, n.SkeletonHelper.prototype.update = function() {
        for (var e = this.geometry, t = (new n.Matrix4).getInverse(this.root.matrixWorld), i = new n.Matrix4, r = 0, o = 0; o < this.bones.length; o++) {
          var a = this.bones[o];
          a.parent instanceof n.Bone && (i.multiplyMatrices(t, a.matrixWorld), e.vertices[r].setFromMatrixPosition(i), i.multiplyMatrices(t, a.parent.matrixWorld), e.vertices[r + 1].setFromMatrixPosition(i), r += 2)
        };
        e.verticesNeedUpdate = !0, e.computeBoundingSphere()
      }, n.SpotLightHelper = function(e) {
        n.Object3D.call(this), this.light = e, this.light.updateMatrixWorld(), this.matrix = e.matrixWorld, this.matrixAutoUpdate = !1;
        var t = new n.CylinderGeometry(0, 1, 1, 8, 1, !0);
        t.translate(0, -0.5, 0), t.rotateX(-Math.PI / 2);
        var i = new n.MeshBasicMaterial({
          wireframe: !0,
          fog: !1
        });
        this.cone = new n.Mesh(t, i), this.add(this.cone), this.update()
      }, n.SpotLightHelper.prototype = Object.create(n.Object3D.prototype), n.SpotLightHelper.prototype.constructor = n.SpotLightHelper, n.SpotLightHelper.prototype.dispose = function() {
        this.cone.geometry.dispose(), this.cone.material.dispose()
      }, n.SpotLightHelper.prototype.update = function() {
        var e = new n.Vector3,
          t = new n.Vector3;
        return function() {
          var i = this.light.distance ? this.light.distance : 1e4,
            n = i * Math.tan(this.light.angle);
          this.cone.scale["set"](n, n, i), e.setFromMatrixPosition(this.light.matrixWorld), t.setFromMatrixPosition(this.light.target.matrixWorld), this.cone.lookAt(t.sub(e)), this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)
        }
      }(), n.VertexNormalsHelper = function(e, t, i, r) {
        this.object = e, this.size = void(0) !== t ? t : 1;
        var o = void(0) !== i ? i : 16711680,
          a = void(0) !== r ? r : 1,
          s = 0,
          h = this.object.geometry;
        h instanceof n.Geometry ? s = 3 * h.faces.length : h instanceof n.BufferGeometry && (s = h.attributes.normal.count);
        var l = new n.BufferGeometry,
          c = new n.Float32Attribute(2 * s * 3, 3);
        l.addAttribute("position", c), n.LineSegments.call(this, l, new n.LineBasicMaterial({
          color: o,
          linewidth: a
        })), this.matrixAutoUpdate = !1, this.update()
      }, n.VertexNormalsHelper.prototype = Object.create(n.LineSegments.prototype), n.VertexNormalsHelper.prototype.constructor = n.VertexNormalsHelper, n.VertexNormalsHelper.prototype.update = function() {
        var e = new n.Vector3,
          t = new n.Vector3,
          i = new n.Matrix3;
        return function() {
          var r = ["a", "b", "c"];
          this.object.updateMatrixWorld(!0), i.getNormalMatrix(this.object.matrixWorld);
          var o = this.object.matrixWorld,
            a = this.geometry.attributes.position,
            s = this.object.geometry;
          if (s instanceof n.Geometry) {
            for (var h = s.vertices, l = s.faces, c = 0, u = 0, d = l.length; d > u; u++) {
              for (var p = l[u], f = 0, m = p.vertexNormals.length; m > f; f++) {
                var g = h[p[r[f]]],
                  v = p.vertexNormals[f];
                e.copy(g).applyMatrix4(o), t.copy(v).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e), a.setXYZ(c, e.x, e.y, e.z), c += 1, a.setXYZ(c, t.x, t.y, t.z), c += 1
              }
            }
          } else {
            if (s instanceof n.BufferGeometry) {
              for (var y = s.attributes.position, b = s.attributes.normal, c = 0, f = 0, m = y.count; m > f; f++) {
                e["set"](y.getX(f), y.getY(f), y.getZ(f)).applyMatrix4(o), t["set"](b.getX(f), b.getY(f), b.getZ(f)), t.applyMatrix3(i).normalize().multiplyScalar(this.size).add(e), a.setXYZ(c, e.x, e.y, e.z), c += 1, a.setXYZ(c, t.x, t.y, t.z), c += 1
              }
            }
          };
          return a.needsUpdate = !0, this
        }
      }(), n.WireframeHelper = function(e, t) {
        var i = void(0) !== t ? t : 16777215;
        n.LineSegments.call(this, new n.WireframeGeometry(e.geometry), new n.LineBasicMaterial({
          color: i
        })), this.matrix = e.matrixWorld, this.matrixAutoUpdate = !1
      }, n.WireframeHelper.prototype = Object.create(n.LineSegments.prototype), n.WireframeHelper.prototype.constructor = n.WireframeHelper, n.ImmediateRenderObject = function(e) {
        n.Object3D.call(this), this.material = e, this.render = function(e) {}
      }, n.ImmediateRenderObject.prototype = Object.create(n.Object3D.prototype), n.ImmediateRenderObject.prototype.constructor = n.ImmediateRenderObject, n.MorphBlendMesh = function(e, t) {
        n.Mesh.call(this, e, t), this.animationsMap = {}, this.animationsList = [];
        var i = this.geometry.morphTargets.length,
          r = "__default",
          o = 0,
          a = i - 1,
          s = i / 1;
        this.createAnimation(r, o, a, s), this.setAnimationWeight(r, 1)
      }, n.MorphBlendMesh.prototype = Object.create(n.Mesh.prototype), n.MorphBlendMesh.prototype.constructor = n.MorphBlendMesh, n.MorphBlendMesh.prototype.createAnimation = function(e, t, i, n) {
        var r = {
          start: t,
          end: i,
          length: i - t + 1,
          fps: n,
          duration: (i - t) / n,
          lastFrame: 0,
          currentFrame: 0,
          active: !1,
          time: 0,
          direction: 1,
          weight: 1,
          directionBackwards: !1,
          mirroredLoop: !1
        };
        this.animationsMap[e] = r, this.animationsList.push(r)
      }, n.MorphBlendMesh.prototype.autoCreateAnimations = function(e) {
        for (var t, i = /([a-z]+)_?(\d+)/i, n = {}, r = this.geometry, o = 0, a = r.morphTargets.length; a > o; o++) {
          var s = r.morphTargets[o],
            h = s.name.match(i);
          if (h && h.length > 1) {
            var l = h[1];
            n[l] || (n[l] = {
              start: 1 / 0,
              end: -(1 / 0)
            });
            var c = n[l];
            o < c.start && (c.start = o), o > c.end && (c.end = o), t || (t = l)
          }
        };
        for (var l in n) {
          var c = n[l];
          this.createAnimation(l, c.start, c.end, e)
        };
        this.firstAnimation = t
      }, n.MorphBlendMesh.prototype.setAnimationDirectionForward = function(e) {
        var t = this.animationsMap[e];
        t && (t.direction = 1, t.directionBackwards = !1)
      }, n.MorphBlendMesh.prototype.setAnimationDirectionBackward = function(e) {
        var t = this.animationsMap[e];
        t && (t.direction = -1, t.directionBackwards = !0)
      }, n.MorphBlendMesh.prototype.setAnimationFPS = function(e, t) {
        var i = this.animationsMap[e];
        i && (i.fps = t, i.duration = (i.end - i.start) / i.fps)
      }, n.MorphBlendMesh.prototype.setAnimationDuration = function(e, t) {
        var i = this.animationsMap[e];
        i && (i.duration = t, i.fps = (i.end - i.start) / i.duration)
      }, n.MorphBlendMesh.prototype.setAnimationWeight = function(e, t) {
        var i = this.animationsMap[e];
        i && (i.weight = t)
      }, n.MorphBlendMesh.prototype.setAnimationTime = function(e, t) {
        var i = this.animationsMap[e];
        i && (i.time = t)
      }, n.MorphBlendMesh.prototype.getAnimationTime = function(e) {
        var t = 0,
          i = this.animationsMap[e];
        return i && (t = i.time), t
      }, n.MorphBlendMesh.prototype.getAnimationDuration = function(e) {
        var t = -1,
          i = this.animationsMap[e];
        return i && (t = i.duration), t
      }, n.MorphBlendMesh.prototype.playAnimation = function(e) {
        var t = this.animationsMap[e];
        t ? (t.time = 0, t.active = !0) : console.warn("THREE.MorphBlendMesh: animation[" + e + "] undefined in .playAnimation()")
      }, n.MorphBlendMesh.prototype.stopAnimation = function(e) {
        var t = this.animationsMap[e];
        t && (t.active = !1)
      }, n.MorphBlendMesh.prototype.update = function(e) {
        for (var t = 0, i = this.animationsList.length; i > t; t++) {
          var r = this.animationsList[t];
          if (r.active) {
            var o = r.duration / r.length;
            r.time += r.direction * e, r.mirroredLoop ? (r.time > r.duration || r.time < 0) && (r.direction *= -1, r.time > r.duration && (r.time = r.duration, r.directionBackwards = !0), r.time < 0 && (r.time = 0, r.directionBackwards = !1)) : (r.time = r.time % r.duration, r.time < 0 && (r.time += r.duration));
            var a = r.start + n.Math.clamp(Math.floor(r.time / o), 0, r.length - 1),
              s = r.weight;
            a !== r.currentFrame && (this.morphTargetInfluences[r.lastFrame] = 0, this.morphTargetInfluences[r.currentFrame] = 1 * s, this.morphTargetInfluences[a] = 0, r.lastFrame = r.currentFrame, r.currentFrame = a);
            var h = r.time % o / o;
            r.directionBackwards && (h = 1 - h), r.currentFrame !== r.lastFrame ? (this.morphTargetInfluences[r.currentFrame] = h * s, this.morphTargetInfluences[r.lastFrame] = (1 - h) * s) : this.morphTargetInfluences[r.currentFrame] = s
          }
        }
      }, "undefined" != typeof i ? ("undefined" != typeof t && t.exports && (i = t.exports = n), i.THREE = n) : this.THREE = n
  }

  function _$af269077(t, i, n) {
    function r(a, s) {
      if (!i[a]) {
        if (!t[a]) {
          var h = "function" == typeof require && require;
          if (!s && h) {
            return h(a, !0)
          };
          if (o) {
            return o(a, !0)
          };
          var l = new Error("\u627e\u4e0d\u5230\u6a21\u5757 '" + a + "'");
          throw l.code = "MODULE_NOT_FOUND", l
        };
        var c = i[a] = {
          exports: {}
        };
        t[a][0].call(c.exports, function(e) {
          var i = t[a][1][e];
          return r(i ? i : e)
        }, c, c.exports, e, t, i, n)
      };
      return i[a].exports
    }
    for (var o = "function" == typeof require && require, a = 0; a < n.length; a++) {
      r(n[a])
    };
    return r
  }
  e = _$af269077;
  if ("undefined" == typeof jQuery) {
    throw new Error("Bootstrap's JavaScript requires jQuery")
  }; + _$af268850(jQuery);
  !_$af268887("Keen", this, _$af268888);
  !_$af268954(document, window.mixpanel || []);
  !_$af268960(this);
  window.Modernizr = _$af268980(this, this.document);
  !_$af268990(jQuery, window);
  !_$af269077({
    1: [_$af269080, {
      "./util/logger": 90
    }],
    2: [_$af269084, {
      "./ab": 1,
      "./enum/Viewmode": 20,
      "./settings": 78,
      "./util/ajax": 84,
      "./util/browser": 85,
      "./util/common": 86,
      "./util/logger": 90,
      three: 116
    }],
    3: [_$af269122, {
      "./enum/Keys": 15,
      "./enum/Vectors": 19,
      "./enum/Viewmode": 20,
      "./postmessage.js": 76,
      "./settings": 78,
      "./util/logger": 90,
      "./util/math.js": 91,
      three: 116
    }],
    4: [_$af269155, {
      "../enum/Viewmode": 20,
      "../settings": 78,
      three: 116
    }],
    5: [_$af269158, {
      "../settings": 78,
      "../util/easing": 87,
      "../util/lerp": 89,
      "../util/transitions": 94,
      three: 116
    }],
    6: [_$af269161, {
      "../settings": 78,
      "../util/lerp": 89,
      "../util/transitions": 94,
      three: 116
    }],
    7: [_$af269164, {
      "../settings": 78,
      "./OutsideControls": 9,
      three: 116
    }],
    8: [_$af269171, {
      "../settings": 78,
      "./OutsideControls": 9,
      three: 116
    }],
    9: [_$af269173, {
      "../enum/Keys": 15,
      "../enum/Vectors": 19,
      "../settings": 78,
      "../util/common": 86,
      events: 102,
      three: 116
    }],
    10: [_$af269222, {
      "../enum/Joystick": 14,
      "../enum/Keys": 15,
      "../enum/Vectors": 19,
      "../settings": 78,
      "../util/common": 86,
      "../util/logger": 90,
      events: 102,
      three: 116
    }],
    11: [_$af269262, {
      "./analytics": 2,
      "./enum/Viewmode": 20,
      "./enum/WarpStyle": 21,
      "./settings": 78,
      "./util/history": 88,
      "./util/logger": 90,
      "./util/transitions": 94,
      events: 102,
      three: 116
    }],
    12: [_$af269320, {
      "./enum/Viewmode": 20,
      "./settings": 78,
      "./util/transitions": 94,
      three: 116
    }],
    13: [_$af269326, {
      three: 116
    }],
    14: [_$af269329, {}],
    15: [_$af269332, {
      three: 116
    }],
    16: [_$af269333, {}],
    17: [_$af269334, {}],
    18: [_$af269335, {}],
    19: [_$af269336, {
      three: 116
    }],
    20: [_$af269337, {}],
    21: [_$af269341, {}],
    22: [_$af269342, {
      "./settings": 78,
      "./util/ajax": 84,
      "./util/logger": 90,
      three: 116,
      url: 109
    }],
    23: [_$af269350, {
      "../util/common": 86
    }],
    24: [_$af269359, {
      "../enum/Colors": 13,
      "../enum/LinkDestination": 16,
      "../enum/Viewmode": 20,
      "../enum/WarpStyle": 21,
      "../lib/dat.gui": 29,
      "../objects/Mattertag": 67,
      "../settings": 78,
      "../util/easing": 87,
      three: 116
    }],
    25: [_$af269432, {
      "./../analytics": 2,
      "./../settings": 78,
      "./../util/browser": 85,
      "./../util/logger": 90
    }],
    26: [_$af269439, {
      "../analytics": 2,
      "../enum/Keys": 15,
      "../enum/Viewmode": 20,
      "../lib/dat.gui": 29,
      "../objects/Model": 68,
      "../settings": 78,
      "../util/ajax": 84,
      "../util/browser": 85,
      "../util/common": 86,
      "../util/easing": 87,
      "../util/lerp": 89,
      "../util/logger": 90,
      "../util/transitions": 94,
      "./circleLoader": 23,
      "./help": 27,
      "./konami": 28
    }],
    27: [_$af269547, {
      "./../analytics": 2,
      "./../enum/Viewmode": 20,
      "./../settings": 78,
      "./../util/browser": 85,
      "./../util/logger": 90,
      "./gui": 26
    }],
    28: [_$af269567, {
      "./../settings": 78,
      "./../util/common": 86,
      "./../util/logger": 90,
      "./debug": 24,
      "./gui": 26
    }],
    29: [_$af269572, {}],
    30: [_$af269837, {
      "./LZ/BinTree": 31,
      "./LZ/InWindow": 32,
      "./LZ/OutWindow": 33,
      "./freeze": 45,
      amdefine: 96
    }],
    31: [_$af269839, {
      "../freeze": 45,
      "./InWindow": 32,
      amdefine: 96
    }],
    32: [_$af269852, {
      "../freeze": 45,
      "../makeBuffer": 46,
      amdefine: 96
    }],
    33: [_$af269867, {
      "../freeze": 45,
      "../makeBuffer": 46,
      amdefine: 96
    }],
    34: [_$af269878, {
      "./LZMA/Decoder": 36,
      "./LZMA/Encoder": 37,
      "./freeze": 45,
      amdefine: 96
    }],
    35: [_$af269880, {
      "../freeze": 45,
      amdefine: 96
    }],
    36: [_$af269889, {
      "../LZ": 30,
      "../RangeCoder": 38,
      "./Base": 35,
      amdefine: 96
    }],
    37: [_$af269910, {
      "../LZ": 30,
      "../RangeCoder": 38,
      "../freeze": 45,
      "../makeBuffer": 46,
      "./Base": 35,
      amdefine: 96
    }],
    38: [_$af269971, {
      "./RangeCoder/BitTreeDecoder": 39,
      "./RangeCoder/BitTreeEncoder": 40,
      "./RangeCoder/Decoder": 41,
      "./RangeCoder/Encoder": 42,
      "./freeze": 45,
      amdefine: 96
    }],
    39: [_$af269973, {
      "../freeze": 45,
      "./Encoder": 42,
      amdefine: 96
    }],
    40: [_$af269980, {
      "../freeze": 45,
      "./Encoder": 42,
      amdefine: 96
    }],
    41: [_$af269990, {
      "../freeze": 45,
      amdefine: 96
    }],
    42: [_$af269998, {
      "../freeze": 45,
      amdefine: 96
    }],
    43: [_$af270015, {
      "./freeze": 45,
      amdefine: 96
    }],
    44: [_$af270024, {
      "./LZMA": 34,
      "./Stream": 43,
      "./freeze": 45,
      "./makeBuffer": 46,
      amdefine: 96,
      buffer: 98
    }],
    45: [_$af270043, {
      amdefine: 96
    }],
    46: [_$af270046, {
      amdefine: 96,
      buffer: 98
    }],
    47: [_$af270052, {
      "./lib/LZ": 30,
      "./lib/LZMA": 34,
      "./lib/RangeCoder": 38,
      "./lib/Stream": 43,
      "./lib/Util": 44,
      "./lib/freeze": 45,
      amdefine: 96
    }],
    48: [_$af270054, {
      three: 116
    }],
    49: [_$af270062, {
      three: 116
    }],
    50: [_$af270067, {
      three: 116
    }],
    51: [_$af270070, {
      three: 116
    }],
    52: [_$af270073, {
      three: 116
    }],
    53: [_$af270074, {
      three: 116
    }],
    54: [_$af270075, {
      three: 116
    }],
    55: [_$af270076, {
      three: 116
    }],
    56: [_$af270112, {
      "../util/ajax": 84,
      "../util/common": 86,
      "../util/logger": 90,
      "../util/texture": 93,
      buffer: 98,
      protobufjs: 113,
      three: 116
    }],
    57: [_$af270125, {
      "../lib/lzma-purejs": 47,
      "../util/logger": 90,
      "./DamLoader": 56,
      three: 116
    }],
    58: [_$af270129, {
      "../settings": 78,
      "../util/browser": 85,
      "../util/logger": 90,
      "./DamLoader": 56,
      "./LZMADamLoader": 57,
      three: 116
    }],
    59: [_$af270133, {
      "../util/ajax": 84,
      "../util/common": 86,
      "../util/logger": 90,
      "../util/math": 91,
      buffer: 98,
      protobufjs: 113,
      three: 116
    }],
    60: [_$af270151, {
      "./ab": 1,
      "./analytics": 2,
      "./automation.js": 3,
      "./director": 11,
      "./effects": 12,
      "./enum/Viewmode": 20,
      "./featureflags": 22,
      "./gui/error": 25,
      "./gui/gui": 26,
      "./gui/help": 27,
      "./gui/konami": 28,
      "./lib/postprocessing/EffectComposer.js": 48,
      "./lib/postprocessing/MaskPass.js": 49,
      "./lib/postprocessing/RenderPass.js": 50,
      "./lib/postprocessing/ShaderPass.js": 51,
      "./lib/shaders/CopyShader.js": 52,
      "./lib/shaders/HorizontalBlurShader.js": 53,
      "./lib/shaders/VerticalBlurShader.js": 54,
      "./lib/three75-shim": 55,
      "./objects/Panorama": 70,
      "./objects/Skybox": 74,
      "./player": 75,
      "./preloaders": 77,
      "./settings": 78,
      "../shaders": 79,
      "./showcase": 80,
      "./util/ajax": 84,
      "./util/browser": 85,
      "./util/common": 86,
      "./util/lerp": 89,
      "./util/logger": 90,
      "./util/math": 91,
      "./util/sentry": 92,
      "./util/transitions": 94,
      events: 102,
      three: 116
    }],
    61: [_$af270197, {
      three: 116
    }],
    62: [_$af270199, {
      "../enum/Viewmode": 20,
      "../settings": 78,
      "../shaders": 79,
      "../util/logger": 90,
      "./BoundingMesh": 61,
      three: 116
    }],
    63: [_$af270202, {
      "../enum/Viewmode": 20,
      "../shaders": 79,
      "../util/texture": 93,
      three: 116
    }],
    64: [_$af270205, {
      "../enum/Viewmode": 20,
      three: 116
    }],
    65: [_$af270209, {
      "../enum/RenderOrder": 17,
      "../objects/Panorama": 70,
      "../settings": 78,
      "../util/common": 86,
      "../util/easing": 87,
      "../util/lerp": 89,
      "../util/transitions": 94,
      "./ChunkedCollider": 64,
      three: 116
    }],
    66: [_$af270230, {
      "../util/browser": 85,
      three: 116
    }],
    67: [_$af270233, {
      "../analytics": 2,
      "../enum/Colors": 13,
      "../enum/LinkDestination": 16,
      "../enum/RenderOrder": 17,
      "../enum/Viewmode": 20,
      "../settings": 78,
      "../util/browser": 85,
      "../util/common": 86,
      "../util/easing": 87,
      "../util/lerp": 89,
      "../util/logger": 90,
      "../util/texture": 93,
      "../util/transitions": 94,
      "./Panorama": 70,
      events: 102,
      three: 116
    }],
    68: [_$af270291, {
      "../enum/RenderOrder": 17,
      "../enum/Viewmode": 20,
      "../loaders/ModelLoader": 58,
      "../loaders/SweepDataLoader": 59,
      "../objects/Mattertag": 67,
      "../objects/Panorama": 70,
      "../settings": 78,
      "../shaders": 79,
      "../util/ModelUrls": 81,
      "../util/PanoramaCollection": 82,
      "../util/ajax": 84,
      "../util/common": 86,
      "../util/easing": 87,
      "../util/lerp": 89,
      "../util/logger": 90,
      "../util/math": 91,
      "../util/transitions": 94,
      "./../util/browser": 85,
      "./BoundingTextureSkybox": 62,
      "./Chunk": 63,
      "./Floor": 65,
      "./Label": 66,
      "./Room": 72,
      events: 102,
      three: 116
    }],
    69: [_$af270396, {
      "../settings": 78,
      three: 116
    }],
    70: [_$af270401, {
      "../enum/Viewmode": 20,
      "../settings": 78,
      "../util/ajax": 84,
      "../util/common": 86,
      "../util/lerp": 89,
      "../util/logger": 90,
      "../util/texture": 93,
      "../util/transitions": 94,
      events: 102,
      three: 116
    }],
    71: [_$af270483, {
      "../settings": 78,
      "../shaders": 79,
      "../util/lerp": 89,
      "../util/texture": 93,
      "../util/transitions": 94,
      three: 116
    }],
    72: [_$af270492, {
      three: 116
    }],
    73: [_$af270495, {
      "../effects": 12,
      "../enum/RenderOrder": 17,
      "../enum/Vectors": 19,
      "../enum/Viewmode": 20,
      "../enum/WarpStyle": 21,
      "../gui/gui": 26,
      "../settings": 78,
      "../shaders": 79,
      "../util/easing": 87,
      "../util/lerp": 89,
      "../util/logger": 90,
      "../util/math": 91,
      "../util/transitions": 94,
      three: 116
    }],
    74: [_$af270591, {
      "../shaders": 79,
      three: 116
    }],
    75: [_$af270593, {
      "./cameras/DollhouseCamera": 4,
      "./cameras/FloorplanCamera": 5,
      "./cameras/PanoramaCamera": 6,
      "./controls/DollhouseControls": 7,
      "./controls/FloorplanControls": 8,
      "./controls/PanoramaControls": 10,
      "./enum/TagStates": 18,
      "./enum/Vectors": 19,
      "./enum/Viewmode": 20,
      "./objects/NSpider": 69,
      "./objects/Panorama": 70,
      "./objects/Reticule": 71,
      "./objects/ShowPath": 73,
      "./settings": 78,
      "./shaders": 79,
      "./util/browser": 85,
      "./util/common": 86,
      "./util/easing": 87,
      "./util/lerp": 89,
      "./util/logger": 90,
      "./util/math": 91,
      "./util/transitions": 94,
      events: 102,
      three: 116
    }],
    76: [_$af270723, {}],
    77: [_$af270734, {
      "./enum/Viewmode": 20,
      "./objects/Panorama": 70,
      "./settings": 78,
      "./util/logger": 90,
      three: 116
    }],
    78: [_$af270746, {
      "./enum/Colors": 13,
      "./enum/Viewmode": 20,
      "./enum/WarpStyle": 21,
      "./util/browser": 85,
      "./util/common": 86,
      "./util/easing": 87,
      three: 116
    }],
    79: [_$af270748, {
      "./settings": 78,
      three: 116
    }],
    80: [_$af270749, {
      "./cameras/DollhouseCamera": 4,
      "./cameras/FloorplanCamera": 5,
      "./cameras/PanoramaCamera": 6,
      "./controls/DollhouseControls": 7,
      "./controls/FloorplanControls": 8,
      "./controls/PanoramaControls": 10,
      "./objects/Chunk": 63,
      "./objects/Floor": 65,
      "./objects/Model": 68,
      "./objects/Panorama": 70,
      "./objects/Reticule": 71,
      "./objects/Skybox": 74,
      "./settings": 78,
      "./shaders": 79,
      "./util/ajax": 84,
      "./util/logger": 90,
      "./util/transitions": 94,
      three: 116,
      url: 109
    }],
    81: [_$af270761, {
      "../ab": 1,
      "../settings": 78,
      "./ajax": 84,
      "../util/browser": 85,
      "./logger": 90
    }],
    82: [_$af270786, {
      "../objects/Panorama": 70,
      "../settings": 78,
      "./aStar": 83,
      "./common": 86,
      "./logger": 90,
      three: 116
    }],
    83: [_$af270817, {
      Set: 95,
      dict: 110,
      heap: 111
    }],
    84: [_$af270822, {
      "./logger": 90
    }],
    85: [_$af270837, {}],
    86: [_$af270858, {
      three: 116
    }],
    87: [_$af270879, {}],
    88: [_$af270911, {
      "../enum/Joystick": 14
    }],
    89: [_$af270918, {}],
    90: [_$af270933, {
      "../settings": 78
    }],
    91: [_$af270952, {
      three: 116
    }],
    92: [_$af270959, {}],
    93: [_$af270963, {
      "../util/ajax": 84,
      three: 116
    }],
    94: [_$af270966, {
      "./easing": 87
    }],
    95: [_$af270980, {}],
    96: [_$af270991, {
      _process: 104,
      path: 103
    }],
    97: [_$af271012, {}],
    98: [_$af271013, {
      "base64-js": 99,
      ieee754: 100,
      "is-array": 101
    }],
    99: [_$af271112, {}],
    100: [_$af271120, {}],
    101: [_$af271123, {}],
    102: [_$af271125, {}],
    103: [_$af271140, {
      _process: 104
    }],
    104: [_$af271159, {}],
    105: [_$af271167, {}],
    106: [_$af271186, {}],
    107: [_$af271190, {}],
    108: [_$af271198, {
      "./decode": 106,
      "./encode": 107
    }],
    109: [_$af271199, {
      punycode: 105,
      querystring: 108
    }],
    110: [_$af271218, {}],
    111: [_$af271232, {
      "./lib/heap": 112
    }],
    112: [_$af271233, {}],
    113: [_$af271265, {
      _process: 104,
      bytebuffer: 114,
      fs: 97,
      path: 97
    }],
    114: [_$af271450, {
      "long": 115
    }],
    115: [_$af271584, {}],
    116: [_$af271629, {}]
  }, {}, [60])
})()